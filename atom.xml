<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>WL&#39;s blog</title>
  
  
  <link href="https://taeyang0126.github.io/atom.xml" rel="self"/>
  
  <link href="https://taeyang0126.github.io/"/>
  <updated>2025-02-10T14:16:05.824Z</updated>
  <id>https://taeyang0126.github.io/</id>
  
  <author>
    <name>WU LEI</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>dockerfile</title>
    <link href="https://taeyang0126.github.io/2025/02/10/docker/dockerfile/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/10/docker/dockerfile/posts/undefined/</id>
    <published>2025-02-10T09:51:22.000Z</published>
    <updated>2025-02-10T14:16:05.824Z</updated>
    
    <content type="html"><![CDATA[<h3 id="Dockerignore"><a href="#Dockerignore" class="headerlink" title="Dockerignore"></a>Dockerignore</h3><blockquote><p>dockerfileä¸­å¿½ç•¥ç‰¹å®šçš„æ–‡ä»¶å’Œç›®å½•</p></blockquote><ul><li>ç¤ºä¾‹è¡¨ç¤ºå¿½ç•¥å…¨éƒ¨ï¼Œé™¤äº†ä¸€äº›å¿…è¦çš„</li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">*</span><br><span class="line">!pom.xml</span><br><span class="line">!sh</span><br><span class="line">!src</span><br></pre></td></tr></table></figure><h3 id="DockerFile"><a href="#DockerFile" class="headerlink" title="DockerFile"></a>DockerFile</h3><blockquote><p>æ„å»ºjavaåŸºç¡€é¡¹ç›®dockeré•œåƒ</p></blockquote><ul><li>æä¾› maven ç¼–è¯‘æ„å»º + è¿è¡Œ</li><li><code>BASE_JAVA_IMAGE</code> åŸºç¡€çš„javaé•œåƒï¼Œå»ºè®®é€‰æ‹©å¸¦æœ‰jreçš„åŸºç¡€javaé•œåƒ</li><li><code>MAVEN_IMAGE</code> mavenç¼–è¯‘çš„åŸºç¡€é•œåƒï¼Œå»ºè®®ä¸javaç‰ˆæœ¬å¯¹åº”</li><li>å†…ç½® <code>arthas</code></li><li>å†…ç½®è¿è¡Œè„šæœ¬ <code>run.sh</code></li></ul><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">####################################################################</span></span><br><span class="line"><span class="comment"># Global ARGs (build-time variables)</span></span><br><span class="line"><span class="comment"># ARG å®šä¹‰çš„å˜é‡åœ¨ FROM æŒ‡ä»¤ä¸­æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨çš„</span></span><br><span class="line"><span class="comment"># ARG å®šä¹‰çš„å˜é‡åœ¨ä¸åŒçš„æ„å»ºé˜¶æ®µéœ€è¦é‡æ–°å®šä¹‰</span></span><br><span class="line"><span class="comment"># ARG æ˜¯æ„å»ºæ—¶çš„å˜é‡ï¼Œä¸èƒ½åœ¨å®¹å™¨ä¸­è®¿é—®ï¼Œè€ŒENVæ˜¯ç¯å¢ƒå˜é‡</span></span><br><span class="line"><span class="comment">####################################################################</span></span><br><span class="line"><span class="comment"># Base images</span></span><br><span class="line"><span class="keyword">ARG</span> BASE_JAVA_IMAGE=eclipse-temurin:<span class="number">8</span>-jdk-jammy</span><br><span class="line"><span class="keyword">ARG</span> MAVEN_IMAGE=maven:<span class="number">3</span>-eclipse-temurin-<span class="number">8</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Application info</span></span><br><span class="line"><span class="keyword">ARG</span> APP_NAME=aws-starter</span><br><span class="line"><span class="keyword">ARG</span> APP_VERSION=<span class="number">1.0</span></span><br><span class="line"><span class="keyword">ARG</span> <span class="keyword">MAINTAINER</span>=<span class="number">17674030991</span>@<span class="number">163</span>.com</span><br><span class="line"></span><br><span class="line"><span class="comment"># Arthas</span></span><br><span class="line"><span class="keyword">ARG</span> ARTHAS_VERSION=<span class="number">3.7</span>.<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Directory structure</span></span><br><span class="line"><span class="keyword">ARG</span> WORK_HOME=/opt/deployments</span><br><span class="line"><span class="keyword">ARG</span> APP_USER=app</span><br><span class="line"><span class="keyword">ARG</span> APP_GROUP=app</span><br><span class="line"></span><br><span class="line"><span class="comment">####################################################################</span></span><br><span class="line"><span class="comment"># Stage 0 : Download Arthas</span></span><br><span class="line"><span class="comment">####################################################################</span></span><br><span class="line"><span class="keyword">FROM</span> alpine:latest AS arthas-downloader</span><br><span class="line"><span class="keyword">ARG</span> ARTHAS_VERSION</span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> apk add --no-cache wget unzip &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">mkdir</span> -p /opt/arthas &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    wget -q https://maven.aliyun.com/repository/public/com/taobao/arthas/arthas-packaging/<span class="variable">$&#123;ARTHAS_VERSION&#125;</span>/arthas-packaging-<span class="variable">$&#123;ARTHAS_VERSION&#125;</span>-bin.zip -O arthas-bin.zip &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    unzip -q arthas-bin.zip -d /opt/arthas &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    <span class="built_in">rm</span> -f arthas-bin.zip</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####################################################################</span></span><br><span class="line"><span class="comment"># Stage 1 : BUILD JAR</span></span><br><span class="line"><span class="comment">####################################################################</span></span><br><span class="line"><span class="keyword">FROM</span> $&#123;MAVEN_IMAGE&#125; AS maven-builder</span><br><span class="line"></span><br><span class="line"><span class="comment"># Maven configuration</span></span><br><span class="line"><span class="keyword">ENV</span> MAVEN_OPTS=<span class="string">&quot;-Dmaven.test.skip=true -Dmaven.compile.fork=true&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è‡ªå®šä¹‰ settings.xml</span></span><br><span class="line"><span class="comment"># ä½¿ç”¨ --build-arg ä¼ å…¥æœ¬åœ° settings.xml çš„è·¯å¾„</span></span><br><span class="line"><span class="comment"># ARG MAVEN_SETTINGS</span></span><br><span class="line"><span class="comment"># COPY $&#123;MAVEN_SETTINGS&#125; /root/.m2/settings.xml</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆå¤åˆ¶ pom æ–‡ä»¶ä»¥åˆ©ç”¨ç¼“å­˜</span></span><br><span class="line"><span class="comment"># pom æ–‡ä»¶ä¸å˜ï¼Œä¾èµ–çš„ä¸‹è½½å°±ä¼šä½¿ç”¨ç¼“å­˜ï¼Œæºä»£ç æ”¹å˜åªä¼šè§¦å‘ç¼–è¯‘ï¼Œä¸ä¼šé‡æ–°ä¸‹è½½ä¾èµ–</span></span><br><span class="line"><span class="comment"># -B: æ‰¹å¤„ç†æ¨¡å¼</span></span><br><span class="line"><span class="comment"># dependency:resolve: é¢„ä¸‹è½½å£°æ˜åœ¨ pom.xml ä¸­çš„ä¾èµ–</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> pom.xml ./</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> mvn dependency:resolve -B</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¤åˆ¶æºä»£ç å’Œå…¶ä»–æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> src ./src/</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> sh ./sh/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ„å»ºåº”ç”¨</span></span><br><span class="line"><span class="comment"># -am åŒæ—¶æ„å»ºæ‰€åˆ—æ¨¡å—çš„ä¾èµ–æ¨¡å—</span></span><br><span class="line"><span class="comment"># -B ä»¥&quot;æ‰¹å¤„ç†æ¨¡å¼&quot;è¿è¡Œ Mavenï¼Œå‡å°‘è¾“å‡ºä¿¡æ¯</span></span><br><span class="line"><span class="comment"># -DskipUTs è·³è¿‡å•å…ƒæµ‹è¯•</span></span><br><span class="line"><span class="comment"># -DskipITs è·³è¿‡é›†æˆæµ‹è¯•</span></span><br><span class="line"><span class="comment"># --no-transfer-progress ä¸æ˜¾ç¤ºæ–‡ä»¶ä¼ è¾“è¿›åº¦ï¼Œå‡å°‘è¾“å‡º</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> mvn clean package -am -B -DskipUTs -DskipITs --no-transfer-progress</span></span><br><span class="line"></span><br><span class="line"><span class="comment">####################################################################</span></span><br><span class="line"><span class="comment"># Stage 2: BUILD IMAGE</span></span><br><span class="line"><span class="comment">####################################################################</span></span><br><span class="line"><span class="keyword">FROM</span> $&#123;BASE_JAVA_IMAGE&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># Use ARGs in LABEL</span></span><br><span class="line"><span class="keyword">ARG</span> APP_NAME</span><br><span class="line"><span class="keyword">ARG</span> APP_VERSION</span><br><span class="line"><span class="keyword">ARG</span> <span class="keyword">MAINTAINER</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">LABEL</span><span class="language-bash"> maintainer=<span class="string">&quot;<span class="variable">$&#123;MAINTAINER&#125;</span>&quot;</span> \</span></span><br><span class="line"><span class="language-bash">      version=<span class="string">&quot;<span class="variable">$&#123;APP_VERSION&#125;</span>&quot;</span> \</span></span><br><span class="line"><span class="language-bash">      description=<span class="string">&quot;<span class="variable">$&#123;APP_NAME&#125;</span>&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Set environment variables</span></span><br><span class="line"><span class="keyword">ARG</span> WORK_HOME</span><br><span class="line"><span class="keyword">ARG</span> APP_USER</span><br><span class="line"><span class="keyword">ARG</span> APP_GROUP</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENV</span> WORK_HOME=$&#123;WORK_HOME&#125;</span><br><span class="line"><span class="keyword">ENV</span> ARTHAS_OUTPUT_DIR=$&#123;WORK_HOME&#125;/arthas-output</span><br><span class="line"></span><br><span class="line"><span class="comment"># Ubuntu/Debian æ–¹å¼åˆ›å»ºç”¨æˆ·å’Œç›®å½•</span></span><br><span class="line"><span class="comment"># install -d -m é¿å… chown å‘½ä»¤å¯¼è‡´é•œåƒè†¨èƒ€</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> groupadd --system <span class="variable">$&#123;APP_GROUP&#125;</span> &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    useradd --system --gid <span class="variable">$&#123;APP_GROUP&#125;</span> --shell /bin/false <span class="variable">$&#123;APP_USER&#125;</span> &amp;&amp; \</span></span><br><span class="line"><span class="language-bash">    install -d -m 755 -o <span class="variable">$&#123;APP_USER&#125;</span> -g <span class="variable">$&#123;APP_GROUP&#125;</span> <span class="variable">$&#123;WORK_HOME&#125;</span>/logs <span class="variable">$&#123;WORK_HOME&#125;</span>/arthas-output</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="language-bash"> <span class="variable">$&#123;WORK_HOME&#125;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Copy application files</span></span><br><span class="line"><span class="comment"># è¿™é‡Œä½¿ç”¨ --chown=$&#123;APP_USER&#125;:$&#123;APP_GROUP&#125; æ˜¯ä¸ºäº†é¿å…å•ç‹¬ä½¿ç”¨chown -R $&#123;APP_USER&#125;:$&#123;APP_GROUP&#125;å‘½ä»¤ï¼Œå¯¼è‡´é•œåƒå¤§å°è†¨èƒ€1å€</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=maven-builder --<span class="built_in">chown</span>=<span class="variable">$&#123;APP_USER&#125;</span>:<span class="variable">$&#123;APP_GROUP&#125;</span> target/*-exec.jar ./app.jar</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=maven-builder --<span class="built_in">chown</span>=<span class="variable">$&#123;APP_USER&#125;</span>:<span class="variable">$&#123;APP_GROUP&#125;</span> sh ./</span></span><br><span class="line"><span class="keyword">COPY</span><span class="language-bash"> --from=arthas-downloader --<span class="built_in">chown</span>=<span class="variable">$&#123;APP_USER&#125;</span>:<span class="variable">$&#123;APP_GROUP&#125;</span> /opt/arthas ./arthas/</span></span><br><span class="line"><span class="keyword">RUN</span><span class="language-bash"> <span class="built_in">chmod</span> +x ./run.sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Switch to app user</span></span><br><span class="line"><span class="keyword">USER</span> $&#123;APP_USER&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="language-bash"> [<span class="string">&quot;./run.sh&quot;</span>]</span></span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;Dockerignore&quot;&gt;&lt;a href=&quot;#Dockerignore&quot; class=&quot;headerlink&quot; title=&quot;Dockerignore&quot;&gt;&lt;/a&gt;Dockerignore&lt;/h3&gt;&lt;blockquote&gt;
&lt;p&gt;dockerfileä¸­å¿½ç•¥ç‰¹å®šçš„æ–‡ä»¶å’Œç›®å½•&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;ç¤ºä¾‹è¡¨ç¤ºå¿½ç•¥å…¨éƒ¨ï¼Œé™¤äº†ä¸€äº›å¿…è¦çš„&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="docker" scheme="https://taeyang0126.github.io/categories/docker/"/>
    
    
    <category term="docker" scheme="https://taeyang0126.github.io/tags/docker/"/>
    
    <category term="dockerfile" scheme="https://taeyang0126.github.io/tags/dockerfile/"/>
    
    <category term="åŸºç¡€é•œåƒ" scheme="https://taeyang0126.github.io/tags/%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F/"/>
    
  </entry>
  
  <entry>
    <title>å®¹å™¨å†…å­˜</title>
    <link href="https://taeyang0126.github.io/2025/02/10/k8s/rong-qi-nei-cun/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/10/k8s/rong-qi-nei-cun/posts/undefined/</id>
    <published>2025-02-10T08:51:22.000Z</published>
    <updated>2025-02-10T14:16:05.825Z</updated>
    
    <content type="html"><![CDATA[<h3 id="WorkingSet-ä¸PageCache-ç›‘æ§"><a href="#WorkingSet-ä¸PageCache-ç›‘æ§" class="headerlink" title="WorkingSet ä¸PageCache ç›‘æ§"></a><a href="https://www.cnblogs.com/alisystemsoftware/p/18196395">WorkingSet ä¸PageCache ç›‘æ§</a></h3><h3 id="K8sç›‘æ§çš„å†…å­˜æŒ‡æ ‡"><a href="#K8sç›‘æ§çš„å†…å­˜æŒ‡æ ‡" class="headerlink" title="K8sç›‘æ§çš„å†…å­˜æŒ‡æ ‡"></a>K8sç›‘æ§çš„å†…å­˜æŒ‡æ ‡</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">    memoryStats = &amp;statsapi.MemoryStats&#123;</span><br><span class="line">        Time:            metav1.NewTime(cstat.Timestamp),</span><br><span class="line">        UsageBytes:      &amp;cstat.Memory.Usage,</span><br><span class="line">        WorkingSetBytes: &amp;cstat.Memory.WorkingSet,</span><br><span class="line">        RSSBytes:        &amp;cstat.Memory.RSS,</span><br><span class="line">        PageFaults:      &amp;pageFaults,</span><br><span class="line">        MajorPageFaults: &amp;majorPageFaults,</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// availableBytes = memory limit (if known) - workingset</span></span><br><span class="line">    <span class="keyword">if</span> !isMemoryUnlimited(info.Spec.Memory.Limit) &#123;</span><br><span class="line">        availableBytes := info.Spec.Memory.Limit - cstat.Memory.WorkingSet</span><br><span class="line">        memoryStats.AvailableBytes = &amp;availableBytes</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">type MemoryStats struct &#123;</span><br><span class="line"><span class="comment">// Current memory usage, this includes all memory regardless of when it was</span></span><br><span class="line"><span class="comment">// accessed.</span></span><br><span class="line"><span class="comment">// Units: Bytes.</span></span><br><span class="line">Usage uint64 `json:<span class="string">&quot;usage&quot;</span>`</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Maximum memory usage recorded.</span></span><br><span class="line"><span class="comment">// Units: Bytes.</span></span><br><span class="line">MaxUsage uint64 `json:<span class="string">&quot;max_usage&quot;</span>`</span><br><span class="line"> </span><br><span class="line"><span class="comment">// Number of bytes of page cache memory.</span></span><br><span class="line"><span class="comment">// Units: Bytes.</span></span><br><span class="line">Cache uint64 `json:<span class="string">&quot;cache&quot;</span>`</span><br><span class="line"> </span><br><span class="line"><span class="comment">// The amount of anonymous and swap cache memory (includes transparent</span></span><br><span class="line"><span class="comment">// hugepages).</span></span><br><span class="line"><span class="comment">// Units: Bytes.</span></span><br><span class="line">RSS uint64 `json:<span class="string">&quot;rss&quot;</span>`</span><br><span class="line"> </span><br><span class="line"><span class="comment">// The amount of swap currently used by the processes in this cgroup</span></span><br><span class="line"><span class="comment">// Units: Bytes.</span></span><br><span class="line">Swap uint64 `json:<span class="string">&quot;swap&quot;</span>`</span><br><span class="line"> </span><br><span class="line"><span class="comment">// The amount of memory used for mapped files (includes tmpfs/shmem)</span></span><br><span class="line">MappedFile uint64 `json:<span class="string">&quot;mapped_file&quot;</span>`</span><br><span class="line"> </span><br><span class="line"><span class="comment">// The amount of working set memory, this includes recently accessed memory,</span></span><br><span class="line"><span class="comment">// dirty memory, and kernel memory. Working set is &lt;= &quot;usage&quot;.</span></span><br><span class="line"><span class="comment">// Units: Bytes.</span></span><br><span class="line">WorkingSet uint64 `json:<span class="string">&quot;working_set&quot;</span>`</span><br></pre></td></tr></table></figure><h4 id="OOMçš„åˆ¤æ–­"><a href="#OOMçš„åˆ¤æ–­" class="headerlink" title="OOMçš„åˆ¤æ–­"></a>OOMçš„åˆ¤æ–­</h4><blockquote><p>availableBytes &#x3D; memory limit (if known) - workingset</p></blockquote><p>working_setè¿™ä¸ªæŒ‡æ ‡æ˜¯å¦é€¼è¿‘MemoryLimitçš„å€¼ï¼Œå¯ä»¥æœ‰åŠ©äºæˆ‘ä»¬åˆ¤æ–­å®¹å™¨æ˜¯å¦åœ¨æœªæ¥å‘ç”ŸOOMã€‚</p><h4 id="æŒ‡æ ‡"><a href="#æŒ‡æ ‡" class="headerlink" title="æŒ‡æ ‡"></a>æŒ‡æ ‡</h4><table><thead><tr><th>æŒ‡æ ‡åç§°</th><th>å®šä¹‰</th><th>ç‰¹ç‚¹</th><th>ç”¨é€”</th></tr></thead><tbody><tr><td>å†…å­˜ä½¿ç”¨é‡ (Usage)</td><td>å®¹å™¨å½“å‰ä½¿ç”¨çš„æ€»å†…å­˜é‡</td><td>åŒ…æ‹¬åº”ç”¨ç¨‹åºå†…å­˜ã€ç¼“å­˜ç­‰</td><td>åæ˜ æ€»ä½“å†…å­˜å ç”¨</td></tr><tr><td>å·¥ä½œé›† (Working Set)</td><td>å®¹å™¨æ´»è·ƒä½¿ç”¨çš„å†…å­˜é›†åˆ</td><td>â‰ˆ Usage - Cache</td><td>åæ˜ åº”ç”¨å®é™…éœ€è¦çš„å†…å­˜</td></tr><tr><td>RSS (Resident Set Size)</td><td>è¿›ç¨‹å®é™…å ç”¨çš„ç‰©ç†å†…å­˜</td><td>ä¸åŒ…æ‹¬å·²æ¢å‡ºçš„å†…å­˜</td><td>åæ˜ å®é™…ç‰©ç†å†…å­˜ä½¿ç”¨</td></tr><tr><td>ç¼“å­˜ (Cache)</td><td>ä¸»è¦æ˜¯é¡µé¢ç¼“å­˜</td><td>å¯è¢«å›æ”¶çš„å†…å­˜</td><td>æé«˜æ–‡ä»¶I&#x2F;Oæ€§èƒ½</td></tr><tr><td>å†…å­˜é™åˆ¶ (Memory Limit)</td><td>å®¹å™¨çš„å†…å­˜ä½¿ç”¨ä¸Šé™</td><td>ç¡¬æ€§é™åˆ¶</td><td>èµ„æºæ§åˆ¶å’ŒOOMåˆ¤å®š</td></tr><tr><td>å†…å­˜è¯·æ±‚ (Memory Request)</td><td>å®¹å™¨è¯·æ±‚çš„æœ€å°å†…å­˜é‡</td><td>è½¯æ€§é™åˆ¶</td><td>è°ƒåº¦å†³ç­–å’Œèµ„æºåˆ†é…</td></tr><tr><td>å¯åˆ†é…å†…å­˜ (Allocatable)</td><td>èŠ‚ç‚¹ä¸Šå¯ä¾›Podä½¿ç”¨çš„å†…å­˜</td><td>æ€»å†…å­˜ - ç³»ç»Ÿé¢„ç•™ - Kubeé¢„ç•™</td><td>èµ„æºè§„åˆ’å’Œè°ƒåº¦</td></tr><tr><td>OOMé£é™©æŒ‡æ ‡</td><td>Memory Limit - Working Set</td><td>å€¼è¶Šå°é£é™©è¶Šé«˜</td><td>è¯„ä¼°OOMé£é™©</td></tr><tr><td>å†…å­˜åˆ©ç”¨ç‡</td><td>Usage &#x2F; Limit æˆ– Working Set &#x2F; Limit</td><td>ç™¾åˆ†æ¯”è¡¨ç¤º</td><td>è¯„ä¼°å†…å­˜ä½¿ç”¨æ•ˆç‡</td></tr><tr><td>åŒ¿åå†…å­˜</td><td>ä¸ä¸æ–‡ä»¶å…³è”çš„å†…å­˜</td><td>å¦‚å †å’Œæ ˆ</td><td>åæ˜ æ ¸å¿ƒå†…å­˜ä½¿ç”¨</td></tr><tr><td>æ´»è·ƒæ–‡ä»¶å†…å­˜</td><td>æœ€è¿‘è®¿é—®çš„æ–‡ä»¶ç¼“å­˜</td><td>ä¸æ˜“è¢«å›æ”¶</td><td>è¯„ä¼°çƒ­æ•°æ®å ç”¨</td></tr><tr><td>éæ´»è·ƒæ–‡ä»¶å†…å­˜</td><td>é•¿æ—¶é—´æœªè®¿é—®çš„æ–‡ä»¶ç¼“å­˜</td><td>æ˜“è¢«å›æ”¶</td><td>è¯„ä¼°å¯å›æ”¶å†…å­˜</td></tr><tr><td>å…±äº«å†…å­˜</td><td>å¤šä¸ªè¿›ç¨‹å…±äº«çš„å†…å­˜</td><td>å¯èƒ½åœ¨RSSä¸­é‡å¤è®¡ç®—</td><td>è¯„ä¼°å†…å­˜å…±äº«æƒ…å†µ</td></tr><tr><td>Swapä½¿ç”¨é‡ (å¦‚å¯ç”¨)</td><td>ä½¿ç”¨çš„äº¤æ¢ç©ºé—´å¤§å°</td><td>é€šå¸¸åœ¨å®¹å™¨ä¸­ç¦ç”¨</td><td>æ€§èƒ½è¯„ä¼°ï¼ˆå¦‚å¯ç”¨ï¼‰</td></tr></tbody></table><ul><li>Usage â‰ˆ Working Set + Cache</li><li>Working Set â‰ˆ RSS + ä¸€äº›å¯èƒ½è¢«æ¢å‡ºçš„åŒ¿åé¡µé¢</li><li>OOMé£é™© âˆ 1 &#x2F; (Memory Limit - Working Set)</li></ul><p>k8såº•å±‚çš„å®¹å™¨è¿è¡Œæ—¶ï¼Œå®Œå…¨ä½¿ç”¨äº†linuxå†…æ ¸OOMKillerçš„scoreæœºåˆ¶ï¼Œå½“å®¹å™¨çš„ç‰©ç†å†…å­˜è¾¾åˆ°è®¾ç½®çš„memory limitæ—¶ï¼Œscoreå¯¹åº”çš„æƒé‡ï¼Œå†³å®šäº†å®¹å™¨è¢«Killçš„ä¼˜å…ˆçº§ã€‚</p><p>å¼ºçƒˆå»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒï¼ŒæŠŠ <strong>memory limit</strong> å’Œ <strong>memory request</strong> è®¾ç½®æˆ<strong>ç›¸åŒçš„å€¼</strong>ï¼Œå…¶å®æœ‰ä¸€ä¸ªé‡è¦åŸå› ï¼Œå°±æ˜¯ä¸¤è€…ç›¸åŒæ—¶ï¼Œé»˜è®¤çš„score adjæ˜¯-997ï¼Œè¢«Killçš„ä¼˜å…ˆçº§ç›¸å¯¹ä½ã€‚</p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;WorkingSet-ä¸PageCache-ç›‘æ§&quot;&gt;&lt;a href=&quot;#WorkingSet-ä¸PageCache-ç›‘æ§&quot; class=&quot;headerlink&quot; title=&quot;WorkingSet ä¸PageCache ç›‘æ§&quot;&gt;&lt;/a&gt;&lt;a href=&quot;https://www.cnblogs.com/alisystemsoftware/p/18196395&quot;&gt;WorkingSet ä¸PageCache ç›‘æ§&lt;/a&gt;&lt;/h3&gt;&lt;h3 id=&quot;K8sç›‘æ§çš„å†…å­˜æŒ‡æ ‡&quot;&gt;&lt;a href=&quot;#K8sç›‘æ§çš„å†…å­˜æŒ‡æ ‡&quot; class=&quot;headerlink&quot; title=&quot;K8sç›‘æ§çš„å†…å­˜æŒ‡æ ‡&quot;&gt;&lt;/a&gt;K8sç›‘æ§çš„å†…å­˜æŒ‡æ ‡&lt;/h3&gt;&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;    memoryStats = &amp;amp;statsapi.MemoryStats&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Time:            metav1.NewTime(cstat.Timestamp),&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        UsageBytes:      &amp;amp;cstat.Memory.Usage,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        WorkingSetBytes: &amp;amp;cstat.Memory.WorkingSet,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        RSSBytes:        &amp;amp;cstat.Memory.RSS,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        PageFaults:      &amp;amp;pageFaults,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        MajorPageFaults: &amp;amp;majorPageFaults,&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// availableBytes = memory limit (if known) - workingset&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt; !isMemoryUnlimited(info.Spec.Memory.Limit) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        availableBytes := info.Spec.Memory.Limit - cstat.Memory.WorkingSet&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        memoryStats.AvailableBytes = &amp;amp;availableBytes&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;type MemoryStats struct &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Current memory usage, this includes all memory regardless of when it was&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// accessed.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Units: Bytes.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Usage uint64 `json:&lt;span class=&quot;string&quot;&gt;&amp;quot;usage&amp;quot;&lt;/span&gt;`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Maximum memory usage recorded.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Units: Bytes.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MaxUsage uint64 `json:&lt;span class=&quot;string&quot;&gt;&amp;quot;max_usage&amp;quot;&lt;/span&gt;`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Number of bytes of page cache memory.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Units: Bytes.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Cache uint64 `json:&lt;span class=&quot;string&quot;&gt;&amp;quot;cache&amp;quot;&lt;/span&gt;`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// The amount of anonymous and swap cache memory (includes transparent&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// hugepages).&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Units: Bytes.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;RSS uint64 `json:&lt;span class=&quot;string&quot;&gt;&amp;quot;rss&amp;quot;&lt;/span&gt;`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// The amount of swap currently used by the processes in this cgroup&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Units: Bytes.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;Swap uint64 `json:&lt;span class=&quot;string&quot;&gt;&amp;quot;swap&amp;quot;&lt;/span&gt;`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// The amount of memory used for mapped files (includes tmpfs/shmem)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;MappedFile uint64 `json:&lt;span class=&quot;string&quot;&gt;&amp;quot;mapped_file&amp;quot;&lt;/span&gt;`&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt; &lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// The amount of working set memory, this includes recently accessed memory,&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// dirty memory, and kernel memory. Working set is &amp;lt;= &amp;quot;usage&amp;quot;.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// Units: Bytes.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;WorkingSet uint64 `json:&lt;span class=&quot;string&quot;&gt;&amp;quot;working_set&amp;quot;&lt;/span&gt;`&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="k8s" scheme="https://taeyang0126.github.io/categories/k8s/"/>
    
    
    <category term="ç›‘æ§" scheme="https://taeyang0126.github.io/tags/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="k8s" scheme="https://taeyang0126.github.io/tags/k8s/"/>
    
    <category term="å®¹å™¨" scheme="https://taeyang0126.github.io/tags/%E5%AE%B9%E5%99%A8/"/>
    
  </entry>
  
  <entry>
    <title>k8sç›‘æ§</title>
    <link href="https://taeyang0126.github.io/2025/02/10/k8s/k8s-jian-kong/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/10/k8s/k8s-jian-kong/posts/undefined/</id>
    <published>2025-02-10T07:51:22.000Z</published>
    <updated>2025-02-10T14:16:05.825Z</updated>
    
    <content type="html"><![CDATA[<ul><li><a href="https://kubernetes.io/zh-cn/docs/home/">å®˜æ–¹æ–‡æ¡£</a></li></ul><h3 id="metric-server"><a href="#metric-server" class="headerlink" title="metric-server"></a>metric-server</h3><p>ä» Kubernetes v1.8 å¼€å§‹ï¼Œèµ„æºä½¿ç”¨æƒ…å†µçš„ç›‘æ§å¯ä»¥é€šè¿‡ <strong>Metrics</strong> <strong>API</strong> çš„å½¢å¼è·å–ï¼Œä¾‹å¦‚å®¹å™¨ CPU å’Œå†…å­˜ä½¿ç”¨ç‡ã€‚è¿™äº›åº¦é‡å¯ä»¥ç”±ç”¨æˆ·ç›´æ¥è®¿é—®ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ä½¿ç”¨ kubectl top å‘½ä»¤ï¼‰ï¼›<strong>Metrics-Server</strong> æ˜¯é›†ç¾¤æ ¸å¿ƒç›‘æ§æ•°æ®çš„èšåˆå™¨ã€‚é€šä¿—åœ°è¯´ï¼Œå®ƒå­˜å‚¨äº†é›†ç¾¤ä¸­å„èŠ‚ç‚¹çš„ç›‘æ§æ•°æ®ï¼Œå¹¶ä¸”æä¾›äº† API ä»¥ä¾›åˆ†æå’Œä½¿ç”¨ã€‚Metrics-Server ä½œä¸ºä¸€ä¸ª Deployment å¯¹è±¡é»˜è®¤éƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤ä¸­ã€‚ä¸è¿‡å‡†ç¡®åœ°è¯´ï¼Œå®ƒæ˜¯ Deploymentï¼ŒServiceï¼ŒClusterRoleï¼ŒClusterRoleBindingï¼ŒAPIServiceï¼ŒRoleBinding ç­‰èµ„æºå¯¹è±¡çš„ç»¼åˆä½“ã€‚</p><ul><li>metric-server æä¾›çš„æ˜¯å®æ—¶çš„æŒ‡æ ‡ï¼ˆå®é™…æ˜¯æœ€è¿‘ä¸€æ¬¡é‡‡é›†çš„æ•°æ®ï¼Œä¿å­˜åœ¨å†…å­˜ä¸­ï¼‰ï¼Œå¹¶æ²¡æœ‰æ•°æ®åº“æ¥å­˜å‚¨</li><li>è¿™äº›æ•°æ®æŒ‡æ ‡å¹¶éç”± metric-server æœ¬èº«é‡‡é›†ï¼Œè€Œæ˜¯ç”±æ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„ cadvisor é‡‡é›†ï¼Œmetric-server åªæ˜¯å‘è¯·æ±‚ç»™ cadvisor å¹¶å°† metric æ ¼å¼çš„æ•°æ®è½¬æ¢æˆ aggregate api</li><li><a href="https://cloud.tencent.com/developer/article/2180278">K8s ç›‘æ§ä¹‹ Metrics-Server æŒ‡æ ‡è·å–é“¾è·¯åˆ†æ</a></li></ul><h4 id="ä¸€ã€éªŒè¯-metric-server-åŠŸèƒ½"><a href="#ä¸€ã€éªŒè¯-metric-server-åŠŸèƒ½" class="headerlink" title="ä¸€ã€éªŒè¯ metric-server åŠŸèƒ½"></a>ä¸€ã€éªŒè¯ metric-server åŠŸèƒ½</h4><ol><li><p>é€šè¿‡ raw api è·å– cadvisor æŒ‡æ ‡</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl get --raw=/api/v1/nodes/&#123;nodename&#125;/proxy/metrics/cadvisor</span><br></pre></td></tr></table></figure></li><li><p>é€šè¿‡ cAdvisor çš„æœ¬åœ°æ¥å£&#x2F;metrics&#x2F;cadvisor è·å–æ•°æ®</p> <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œçš„tokenæŸ¥çœ‹ğŸ‘‡ğŸ»è¿™ç« çš„å†…å®¹ </span></span><br><span class="line">curl -k -H <span class="string">&quot;Authorization: Bearer <span class="variable">$TOKEN</span>&quot;</span> https://127.0.0.1:10250/metrics/cadvisor</span><br></pre></td></tr></table></figure></li></ol><h4 id="äºŒã€å¤„ç†-cadvisor-æƒé™é—®é¢˜"><a href="#äºŒã€å¤„ç†-cadvisor-æƒé™é—®é¢˜" class="headerlink" title="äºŒã€å¤„ç† cadvisor æƒé™é—®é¢˜"></a>äºŒã€å¤„ç† cadvisor æƒé™é—®é¢˜</h4><ol><li><p>æ–°å»º ServiceAccount</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">monitor</span></span><br><span class="line"><span class="attr">namespace:</span> <span class="string">kube-system</span></span><br></pre></td></tr></table></figure></li><li><p>æ–°å»º ClusterRoleï¼Œæ„é€ è®¿é—®æƒé™</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">metrics-reader</span></span><br><span class="line"><span class="attr">rules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">nodes/stats</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">nodes/metrics</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">nodes/proxy</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">watch</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">apiGroups:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">metrics.k8s.io</span></span><br><span class="line">    <span class="attr">resources:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">nodes</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">pods</span></span><br><span class="line">    <span class="attr">verbs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">get</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">list</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">watch</span></span><br></pre></td></tr></table></figure></li><li><p>ç»‘å®šè´¦å·å’Œè§’è‰² ClusterRoleBinding</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">rbac.authorization.k8s.io/v1</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRoleBinding</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">monitor-clusterrolebinding-i26re</span></span><br><span class="line"><span class="attr">roleRef:</span></span><br><span class="line"><span class="attr">apiGroup:</span> <span class="string">rbac.authorization.k8s.io</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">ClusterRole</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">metrics-reader</span></span><br><span class="line"><span class="attr">subjects:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">kind:</span> <span class="string">ServiceAccount</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">monitor</span></span><br><span class="line">    <span class="attr">namespace:</span> <span class="string">kube-system</span></span><br></pre></td></tr></table></figure></li><li><p>ç»™ ServiceAccount ç”Ÿæˆ token</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;kind&quot;:</span> <span class="string">&quot;Secret&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;apiVersion&quot;:</span> <span class="string">&quot;v1&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;metadata&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;monitor-token&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;annotations&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;kubernetes.io/service-account.name&quot;:</span> <span class="string">&quot;monitor&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;kubernetes.io/service-account-token&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹åˆ›å»ºçš„ token</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">kubectl</span> <span class="string">get</span> <span class="string">secret</span> <span class="string">monitor-token</span> <span class="string">-n</span> <span class="string">kube-system</span> <span class="string">-o</span> <span class="string">jsonpath=&#x27;&#123;.data.token&#125;&#x27;</span> <span class="string">|</span> <span class="string">base64</span> <span class="string">--decode</span></span><br></pre></td></tr></table></figure></li></ol><h4 id="ä¸‰ã€é…ç½®-prometheus"><a href="#ä¸‰ã€é…ç½®-prometheus" class="headerlink" title="ä¸‰ã€é…ç½® prometheus"></a>ä¸‰ã€é…ç½® prometheus</h4><ol><li><p>å…·ä½“é…ç½®</p> <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># cadvisor</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">job_name:</span> <span class="string">&#x27;kubernetes-cadvisor&#x27;</span></span><br><span class="line"><span class="attr">scheme:</span> <span class="string">https</span></span><br><span class="line"><span class="attr">tls_config:</span></span><br><span class="line">    <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">authorization:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Bearer</span></span><br><span class="line">    <span class="attr">credentials:</span> <span class="string">token</span> <span class="comment"># æ›¿æ¢ä¸ºServiceAccountç”Ÿæˆçš„token</span></span><br><span class="line"><span class="attr">kubernetes_sd_configs:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">api_server:</span> <span class="string">https://192.168.8.10:6443</span>  <span class="comment"># æ›¿æ¢ä¸º Kubernetes API æœåŠ¡å™¨åœ°å€</span></span><br><span class="line">    <span class="attr">role:</span> <span class="string">node</span></span><br><span class="line">    <span class="attr">tls_config:</span></span><br><span class="line">    <span class="attr">insecure_skip_verify:</span> <span class="literal">true</span></span><br><span class="line">    <span class="attr">authorization:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">Bearer</span></span><br><span class="line">    <span class="attr">credentials:</span> <span class="string">token</span> <span class="comment"># æ›¿æ¢ä¸ºServiceAccountç”Ÿæˆçš„token</span></span><br><span class="line"><span class="attr">relabel_configs:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">action:</span> <span class="string">labelmap</span></span><br><span class="line">    <span class="attr">regex:</span> <span class="string">__meta_kubernetes_node_label_(.+)</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_node_address_InternalIP</span>] <span class="comment"># è¿™é‡Œå®é™…æ˜¯é€šè¿‡æœåŠ¡å‘ç°æŸ¥è¯¢åˆ°å…¶ä»–çš„k8sé›†ç¾¤ç»“ç‚¹</span></span><br><span class="line">    <span class="attr">target_label:</span> <span class="string">__address__</span></span><br><span class="line">    <span class="attr">replacement:</span> <span class="string">$&#123;1&#125;:10250</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">source_labels:</span> [<span class="string">__meta_kubernetes_node_name</span>]</span><br><span class="line">    <span class="attr">regex:</span> <span class="string">(.+)</span></span><br><span class="line">    <span class="attr">target_label:</span> <span class="string">__metrics_path__</span></span><br><span class="line">    <span class="attr">replacement:</span> <span class="string">/metrics/cadvisor</span></span><br></pre></td></tr></table></figure></li><li><p>æŸ¥çœ‹é…ç½®æ˜¯å¦æˆåŠŸ</p></li></ol><p><img data-src="/images/k8s/01.png" alt="img"></p><h4 id="å››ã€é…ç½®-grafana"><a href="#å››ã€é…ç½®-grafana" class="headerlink" title="å››ã€é…ç½® grafana"></a>å››ã€é…ç½® grafana</h4><blockquote><p>è¿™é‡Œé…ç½®ä¸€ä¸ªç®€å•çš„ cpuã€å†…å­˜ <code>deployment</code> å›¾è¡¨</p></blockquote><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;annotations&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;list&quot;:</span> [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;builtIn&quot;:</span> <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;datasource&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;grafana&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;-- Grafana --&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;enable&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;hide&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;iconColor&quot;:</span> <span class="string">&quot;rgba(0, 211, 255, 1)&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;Annotations &amp; Alerts&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;dashboard&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;editable&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;fiscalYearStartMonth&quot;:</span> <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;graphTooltip&quot;:</span> <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;id&quot;:</span> <span class="number">10</span>,</span><br><span class="line">  <span class="attr">&quot;links&quot;:</span> [],</span><br><span class="line">  <span class="attr">&quot;panels&quot;:</span> [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;datasource&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;default&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;prometheus&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;ddz6drhemat4wf&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;fieldConfig&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;defaults&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;color&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;mode&quot;:</span> <span class="string">&quot;palette-classic&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;custom&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;axisBorderShow&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;axisCenteredZero&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;axisColorMode&quot;:</span> <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;axisLabel&quot;:</span> <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;axisPlacement&quot;:</span> <span class="string">&quot;auto&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;axisSoftMax&quot;:</span> <span class="number">10</span>,</span><br><span class="line">            <span class="attr">&quot;axisSoftMin&quot;:</span> <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;barAlignment&quot;:</span> <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;barWidthFactor&quot;:</span> <span class="number">0.6</span>,</span><br><span class="line">            <span class="attr">&quot;drawStyle&quot;:</span> <span class="string">&quot;line&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;fillOpacity&quot;:</span> <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;gradientMode&quot;:</span> <span class="string">&quot;none&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;hideFrom&quot;:</span> &#123;</span><br><span class="line">              <span class="attr">&quot;legend&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">              <span class="attr">&quot;tooltip&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">              <span class="attr">&quot;viz&quot;:</span> <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;insertNulls&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;lineInterpolation&quot;:</span> <span class="string">&quot;smooth&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;lineWidth&quot;:</span> <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;pointSize&quot;:</span> <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;scaleDistribution&quot;:</span> &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;linear&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;showPoints&quot;:</span> <span class="string">&quot;auto&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;spanNulls&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;stacking&quot;:</span> &#123;</span><br><span class="line">              <span class="attr">&quot;group&quot;:</span> <span class="string">&quot;A&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;mode&quot;:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;thresholdsStyle&quot;:</span> &#123;</span><br><span class="line">              <span class="attr">&quot;mode&quot;:</span> <span class="string">&quot;off&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;mappings&quot;:</span> [],</span><br><span class="line">          <span class="attr">&quot;max&quot;:</span> <span class="number">10</span>,</span><br><span class="line">          <span class="attr">&quot;min&quot;:</span> <span class="number">0</span>,</span><br><span class="line">          <span class="attr">&quot;thresholds&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;mode&quot;:</span> <span class="string">&quot;absolute&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;steps&quot;:</span> [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">&quot;color&quot;:</span> <span class="string">&quot;green&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;value&quot;:</span> <span class="literal">null</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">&quot;color&quot;:</span> <span class="string">&quot;red&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;value&quot;:</span> <span class="number">80</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;unit&quot;:</span> <span class="string">&quot;percent&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;overrides&quot;:</span> [</span><br><span class="line">          &#123;</span><br><span class="line">            <span class="attr">&quot;__systemRef&quot;:</span> <span class="string">&quot;hideSeriesFrom&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;matcher&quot;:</span> &#123;</span><br><span class="line">              <span class="attr">&quot;id&quot;:</span> <span class="string">&quot;byNames&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;options&quot;:</span> &#123;</span><br><span class="line">                <span class="attr">&quot;mode&quot;:</span> <span class="string">&quot;exclude&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;names&quot;:</span> [</span><br><span class="line">                  <span class="string">&quot;nginx-77c6dcdbff-rjrpk&quot;</span></span><br><span class="line">                ],</span><br><span class="line">                <span class="attr">&quot;prefix&quot;:</span> <span class="string">&quot;All except:&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;readOnly&quot;:</span> <span class="literal">true</span></span><br><span class="line">              &#125;</span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;properties&quot;:</span> [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">&quot;id&quot;:</span> <span class="string">&quot;custom.hideFrom&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;value&quot;:</span> &#123;</span><br><span class="line">                  <span class="attr">&quot;legend&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">                  <span class="attr">&quot;tooltip&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">                  <span class="attr">&quot;viz&quot;:</span> <span class="literal">true</span></span><br><span class="line">                &#125;</span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;gridPos&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;h&quot;:</span> <span class="number">8</span>,</span><br><span class="line">        <span class="attr">&quot;w&quot;:</span> <span class="number">12</span>,</span><br><span class="line">        <span class="attr">&quot;x&quot;:</span> <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;y&quot;:</span> <span class="number">0</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;id&quot;:</span> <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;options&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;legend&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;calcs&quot;:</span> [],</span><br><span class="line">          <span class="attr">&quot;displayMode&quot;:</span> <span class="string">&quot;table&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;placement&quot;:</span> <span class="string">&quot;right&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;showLegend&quot;:</span> <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;tooltip&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;mode&quot;:</span> <span class="string">&quot;single&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;sort&quot;:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;targets&quot;:</span> [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;datasource&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;prometheus&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;ddz6drhemat4wf&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;editorMode&quot;:</span> <span class="string">&quot;code&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;expr&quot;:</span> <span class="string">&quot;sum(rate(container_cpu_usage_seconds_total&#123;namespace=\&quot;$namespace\&quot;,container=~\&quot;$deployment\&quot;,pod=~\&quot;$pod\&quot;&#125;[5m])) by (pod)&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;instant&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;:</span> <span class="string">&quot;__auto&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;range&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">&quot;refId&quot;:</span> <span class="string">&quot;A&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;title&quot;:</span> <span class="string">&quot;Nginx CPU Usage&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;timeseries&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;datasource&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;default&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;prometheus&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;ddz6drhemat4wf&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;description&quot;:</span> <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;fieldConfig&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;defaults&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;color&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;mode&quot;:</span> <span class="string">&quot;palette-classic&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;custom&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;axisBorderShow&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;axisCenteredZero&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;axisColorMode&quot;:</span> <span class="string">&quot;text&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;axisLabel&quot;:</span> <span class="string">&quot;&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;axisPlacement&quot;:</span> <span class="string">&quot;auto&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;barAlignment&quot;:</span> <span class="number">0</span>,</span><br><span class="line">            <span class="attr">&quot;barWidthFactor&quot;:</span> <span class="number">0.6</span>,</span><br><span class="line">            <span class="attr">&quot;drawStyle&quot;:</span> <span class="string">&quot;line&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;fillOpacity&quot;:</span> <span class="number">13</span>,</span><br><span class="line">            <span class="attr">&quot;gradientMode&quot;:</span> <span class="string">&quot;none&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;hideFrom&quot;:</span> &#123;</span><br><span class="line">              <span class="attr">&quot;legend&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">              <span class="attr">&quot;tooltip&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">              <span class="attr">&quot;viz&quot;:</span> <span class="literal">false</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;insertNulls&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;lineInterpolation&quot;:</span> <span class="string">&quot;smooth&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;lineStyle&quot;:</span> &#123;</span><br><span class="line">              <span class="attr">&quot;fill&quot;:</span> <span class="string">&quot;solid&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;lineWidth&quot;:</span> <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;pointSize&quot;:</span> <span class="number">1</span>,</span><br><span class="line">            <span class="attr">&quot;scaleDistribution&quot;:</span> &#123;</span><br><span class="line">              <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;linear&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;showPoints&quot;:</span> <span class="string">&quot;auto&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;spanNulls&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">            <span class="attr">&quot;stacking&quot;:</span> &#123;</span><br><span class="line">              <span class="attr">&quot;group&quot;:</span> <span class="string">&quot;A&quot;</span>,</span><br><span class="line">              <span class="attr">&quot;mode&quot;:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="attr">&quot;thresholdsStyle&quot;:</span> &#123;</span><br><span class="line">              <span class="attr">&quot;mode&quot;:</span> <span class="string">&quot;off&quot;</span></span><br><span class="line">            &#125;</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;mappings&quot;:</span> [],</span><br><span class="line">          <span class="attr">&quot;thresholds&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;mode&quot;:</span> <span class="string">&quot;absolute&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;steps&quot;:</span> [</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">&quot;color&quot;:</span> <span class="string">&quot;green&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;value&quot;:</span> <span class="literal">null</span></span><br><span class="line">              &#125;,</span><br><span class="line">              &#123;</span><br><span class="line">                <span class="attr">&quot;color&quot;:</span> <span class="string">&quot;red&quot;</span>,</span><br><span class="line">                <span class="attr">&quot;value&quot;:</span> <span class="number">80</span></span><br><span class="line">              &#125;</span><br><span class="line">            ]</span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;unit&quot;:</span> <span class="string">&quot;MB&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;overrides&quot;:</span> []</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;gridPos&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;h&quot;:</span> <span class="number">8</span>,</span><br><span class="line">        <span class="attr">&quot;w&quot;:</span> <span class="number">12</span>,</span><br><span class="line">        <span class="attr">&quot;x&quot;:</span> <span class="number">12</span>,</span><br><span class="line">        <span class="attr">&quot;y&quot;:</span> <span class="number">0</span></span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;id&quot;:</span> <span class="number">2</span>,</span><br><span class="line">      <span class="attr">&quot;options&quot;:</span> &#123;</span><br><span class="line">        <span class="attr">&quot;legend&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;calcs&quot;:</span> [</span><br><span class="line">            <span class="string">&quot;max&quot;</span>,</span><br><span class="line">            <span class="string">&quot;mean&quot;</span></span><br><span class="line">          ],</span><br><span class="line">          <span class="attr">&quot;displayMode&quot;:</span> <span class="string">&quot;table&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;placement&quot;:</span> <span class="string">&quot;right&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;showLegend&quot;:</span> <span class="literal">true</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;tooltip&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;mode&quot;:</span> <span class="string">&quot;multi&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;sort&quot;:</span> <span class="string">&quot;none&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="attr">&quot;targets&quot;:</span> [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;datasource&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;prometheus&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;ddz6drhemat4wf&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;editorMode&quot;:</span> <span class="string">&quot;code&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;exemplar&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;expr&quot;:</span> <span class="string">&quot;sum by (pod) (\n  container_memory_rss&#123;namespace=\&quot;$namespace\&quot;,container=~\&quot;$deployment\&quot;,pod=~\&quot;$pod\&quot;&#125;\n) / 1024 / 1024&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;instant&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;pod&#125;&#125;</span> - RSS&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;range&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">&quot;refId&quot;:</span> <span class="string">&quot;A&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;datasource&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;prometheus&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;ddz6drhemat4wf&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;editorMode&quot;:</span> <span class="string">&quot;code&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;expr&quot;:</span> <span class="string">&quot;sum by (pod) (\n  container_memory_usage_bytes&#123;namespace=\&quot;$namespace\&quot;,container=~\&quot;$deployment\&quot;,pod=~\&quot;$pod\&quot;&#125;\n) / 1024 / 1024&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;hide&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;instant&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;pod&#125;&#125;</span> - Usage&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;range&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">&quot;refId&quot;:</span> <span class="string">&quot;B&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;datasource&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;prometheus&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;ddz6drhemat4wf&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;editorMode&quot;:</span> <span class="string">&quot;code&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;expr&quot;:</span> <span class="string">&quot;sum by (pod) (\n  container_memory_working_set_bytes&#123;namespace=\&quot;$namespace\&quot;,container=~\&quot;$deployment\&quot;,pod=~\&quot;$pod\&quot;&#125;\n) / 1024 / 1024&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;hide&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;instant&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;pod&#125;&#125;</span> - Working Set&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;range&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">&quot;refId&quot;:</span> <span class="string">&quot;C&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;datasource&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;prometheus&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;ddz6drhemat4wf&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;editorMode&quot;:</span> <span class="string">&quot;code&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;expr&quot;:</span> <span class="string">&quot;sum by (pod) (\n  container_memory_cache&#123;namespace=\&quot;$namespace\&quot;,container=~\&quot;$deployment\&quot;,pod=~\&quot;$pod\&quot;&#125;\n) / 1024 / 1024&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;hide&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;instant&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;pod&#125;&#125;</span> - Cache&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;range&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">&quot;refId&quot;:</span> <span class="string">&quot;D&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;datasource&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;prometheus&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;ddz6drhemat4wf&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;editorMode&quot;:</span> <span class="string">&quot;code&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;expr&quot;:</span> <span class="string">&quot;sum by (pod) (\n  kube_pod_container_resource_requests&#123;resource=\&quot;memory\&quot;,namespace=\&quot;$namespace\&quot;,container=~\&quot;$deployment\&quot;,pod=~\&quot;$pod\&quot;&#125;\n) / 1024 / 1024&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;hide&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;instant&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;pod&#125;&#125;</span> - Requests&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;range&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">&quot;refId&quot;:</span> <span class="string">&quot;E&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;datasource&quot;:</span> &#123;</span><br><span class="line">            <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;prometheus&quot;</span>,</span><br><span class="line">            <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;ddz6drhemat4wf&quot;</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="attr">&quot;editorMode&quot;:</span> <span class="string">&quot;code&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;expr&quot;:</span> <span class="string">&quot;sum by (pod) (\n  kube_pod_container_resource_limits&#123;resource=\&quot;memory\&quot;,namespace=\&quot;$namespace\&quot;,container=~\&quot;$deployment\&quot;,pod=~\&quot;$pod\&quot;&#125;\n) / 1024 / 1024&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;hide&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;instant&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;legendFormat&quot;:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;pod&#125;&#125;</span> - Limits&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;range&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">&quot;refId&quot;:</span> <span class="string">&quot;F&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;title&quot;:</span> <span class="string">&quot;Nginx Pods - Memory Metrics&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;timeseries&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;schemaVersion&quot;:</span> <span class="number">39</span>,</span><br><span class="line">  <span class="attr">&quot;tags&quot;:</span> [],</span><br><span class="line">  <span class="attr">&quot;templating&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;list&quot;:</span> [</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;current&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;selected&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">          <span class="attr">&quot;text&quot;:</span> <span class="string">&quot;cadvisor&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;value&quot;:</span> <span class="string">&quot;cadvisor&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;datasource&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;prometheus&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;ddz6drhemat4wf&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;definition&quot;:</span> <span class="string">&quot;label_values(namespace)&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;hide&quot;:</span> <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;includeAll&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">&quot;label&quot;:</span> <span class="string">&quot;namespace&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;multi&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;namespace&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;options&quot;:</span> [],</span><br><span class="line">        <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;qryType&quot;:</span> <span class="number">1</span>,</span><br><span class="line">          <span class="attr">&quot;query&quot;:</span> <span class="string">&quot;label_values(namespace)&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;refId&quot;:</span> <span class="string">&quot;PrometheusVariableQueryEditor-VariableQuery&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;refresh&quot;:</span> <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;regex&quot;:</span> <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;skipUrlSync&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">&quot;sort&quot;:</span> <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;query&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;allValue&quot;:</span> <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;current&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;selected&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">&quot;text&quot;:</span> <span class="string">&quot;nginx&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;value&quot;:</span> <span class="string">&quot;nginx&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;datasource&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;prometheus&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;ddz6drhemat4wf&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;definition&quot;:</span> <span class="string">&quot;label_values(&#123;namespace=\&quot;$namespace\&quot;&#125;,container)&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;hide&quot;:</span> <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;includeAll&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;label&quot;:</span> <span class="string">&quot;deployment&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;multi&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;deployment&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;options&quot;:</span> [],</span><br><span class="line">        <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;qryType&quot;:</span> <span class="number">1</span>,</span><br><span class="line">          <span class="attr">&quot;query&quot;:</span> <span class="string">&quot;label_values(&#123;namespace=\&quot;$namespace\&quot;&#125;,container)&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;refId&quot;:</span> <span class="string">&quot;PrometheusVariableQueryEditor-VariableQuery&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;refresh&quot;:</span> <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;regex&quot;:</span> <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;skipUrlSync&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">&quot;sort&quot;:</span> <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;query&quot;</span></span><br><span class="line">      &#125;,</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="attr">&quot;current&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;selected&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">          <span class="attr">&quot;text&quot;:</span> <span class="string">&quot;All&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;value&quot;:</span> <span class="string">&quot;$__all&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;datasource&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;prometheus&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;ddz6drhemat4wf&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;definition&quot;:</span> <span class="string">&quot;label_values(&#123;namespace=\&quot;$namespace\&quot;, container=\&quot;$deployment\&quot;&#125;,pod)&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;hide&quot;:</span> <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;includeAll&quot;:</span> <span class="literal">true</span>,</span><br><span class="line">        <span class="attr">&quot;label&quot;:</span> <span class="string">&quot;pod&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;multi&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;:</span> <span class="string">&quot;pod&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;options&quot;:</span> [],</span><br><span class="line">        <span class="attr">&quot;query&quot;:</span> &#123;</span><br><span class="line">          <span class="attr">&quot;qryType&quot;:</span> <span class="number">1</span>,</span><br><span class="line">          <span class="attr">&quot;query&quot;:</span> <span class="string">&quot;label_values(&#123;namespace=\&quot;$namespace\&quot;, container=\&quot;$deployment\&quot;&#125;,pod)&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;refId&quot;:</span> <span class="string">&quot;PrometheusVariableQueryEditor-VariableQuery&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">&quot;refresh&quot;:</span> <span class="number">1</span>,</span><br><span class="line">        <span class="attr">&quot;regex&quot;:</span> <span class="string">&quot;&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;skipUrlSync&quot;:</span> <span class="literal">false</span>,</span><br><span class="line">        <span class="attr">&quot;sort&quot;:</span> <span class="number">0</span>,</span><br><span class="line">        <span class="attr">&quot;type&quot;:</span> <span class="string">&quot;query&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;time&quot;:</span> &#123;</span><br><span class="line">    <span class="attr">&quot;from&quot;:</span> <span class="string">&quot;now-5m&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;to&quot;:</span> <span class="string">&quot;now&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;timepicker&quot;:</span> &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;timezone&quot;:</span> <span class="string">&quot;browser&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;title&quot;:</span> <span class="string">&quot;Deployment&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;uid&quot;:</span> <span class="string">&quot;cdz7nqi6hjvnkf&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;version&quot;:</span> <span class="number">20</span>,</span><br><span class="line">  <span class="attr">&quot;weekStart&quot;:</span> <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://kubernetes.io/zh-cn/docs/home/&quot;&gt;å®˜æ–¹æ–‡æ¡£&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;metric-server&quot;&gt;&lt;a href=&quot;#metric-server&quot; class=&quot;headerlink&quot; title=&quot;metric-server&quot;&gt;&lt;/a&gt;metric-server&lt;/h3&gt;&lt;p&gt;ä» Kubernetes v1.8 å¼€å§‹ï¼Œèµ„æºä½¿ç”¨æƒ…å†µçš„ç›‘æ§å¯ä»¥é€šè¿‡ &lt;strong&gt;Metrics&lt;/strong&gt; &lt;strong&gt;API&lt;/strong&gt; çš„å½¢å¼è·å–ï¼Œä¾‹å¦‚å®¹å™¨ CPU å’Œå†…å­˜ä½¿ç”¨ç‡ã€‚è¿™äº›åº¦é‡å¯ä»¥ç”±ç”¨æˆ·ç›´æ¥è®¿é—®ï¼ˆä¾‹å¦‚ï¼Œé€šè¿‡ä½¿ç”¨ kubectl top å‘½ä»¤ï¼‰ï¼›&lt;strong&gt;Metrics-Server&lt;/strong&gt; æ˜¯é›†ç¾¤æ ¸å¿ƒç›‘æ§æ•°æ®çš„èšåˆå™¨ã€‚é€šä¿—åœ°è¯´ï¼Œå®ƒå­˜å‚¨äº†é›†ç¾¤ä¸­å„èŠ‚ç‚¹çš„ç›‘æ§æ•°æ®ï¼Œå¹¶ä¸”æä¾›äº† API ä»¥ä¾›åˆ†æå’Œä½¿ç”¨ã€‚Metrics-Server ä½œä¸ºä¸€ä¸ª Deployment å¯¹è±¡é»˜è®¤éƒ¨ç½²åœ¨ Kubernetes é›†ç¾¤ä¸­ã€‚ä¸è¿‡å‡†ç¡®åœ°è¯´ï¼Œå®ƒæ˜¯ Deploymentï¼ŒServiceï¼ŒClusterRoleï¼ŒClusterRoleBindingï¼ŒAPIServiceï¼ŒRoleBinding ç­‰èµ„æºå¯¹è±¡çš„ç»¼åˆä½“ã€‚&lt;/p&gt;</summary>
    
    
    
    <category term="k8s" scheme="https://taeyang0126.github.io/categories/k8s/"/>
    
    
    <category term="ç›‘æ§" scheme="https://taeyang0126.github.io/tags/%E7%9B%91%E6%8E%A7/"/>
    
    <category term="k8s" scheme="https://taeyang0126.github.io/tags/k8s/"/>
    
  </entry>
  
  <entry>
    <title>Cè¯­è¨€åŸºç¡€çŸ¥è¯†</title>
    <link href="https://taeyang0126.github.io/2025/02/10/c/c-yu-yan-ji-chu-zhi-shi/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/10/c/c-yu-yan-ji-chu-zhi-shi/posts/undefined/</id>
    <published>2025-02-10T06:51:22.000Z</published>
    <updated>2025-02-10T14:16:05.824Z</updated>
    
    <content type="html"><![CDATA[<h3 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h3><ul><li><strong>&amp;</strong> è·å–å˜é‡åœ°å€</li><li>***** è¯´æ˜å˜é‡ä¸ºæŒ‡é’ˆå˜é‡ï¼Œå­˜å‚¨çš„æ˜¯å¦ä¸€ä¸ªå˜é‡çš„åœ°å€ï¼›*<strong>p</strong> è‹¥pæœ¬èº«å·²ç»æ˜¯åœ°å€ï¼Œé‚£ä¹ˆèƒ½è·å–åˆ°è¿™ä¸ªåœ°å€å¯¹åº”çš„å€¼</li><li>å¤šçº§æŒ‡é’ˆä½¿ç”¨å¤šä¸ª ***** è¡¨ç¤º</li><li>æ•°ç»„åä¸ä»£è¡¨æ•´ä¸ªæ•°ç»„ï¼Œåªä»£è¡¨æ•°ç»„é¦–å…ƒç´ çš„åœ°å€ï¼Œå¯¹è¿™ä¸ª<strong>åœ°å€+1</strong>å³å¯è·å–æ•°ç»„ä¸‹ä¸€ä¸ªå…ƒç´ çš„åœ°å€</li><li><strong>char</strong> <strong>string[]</strong> æ•°ç»„å®šä¹‰å­—ç¬¦ä¸²ï¼Œ<strong>char*</strong> <strong>str</strong> <strong>&#x3D; â€œxâ€</strong> æŒ‡é’ˆå®šä¹‰å­—ç¬¦ä¸²</li><li>å‡½æ•°æŒ‡é’ˆï¼Œå‡½æ•°åä»£è¡¨å‡½æ•°çš„åœ°å€ã€‚å®šä¹‰å‡½æ•°æŒ‡é’ˆæŠ€å·§å¦‚ä¸‹: <ul><li>æŠŠè¦æŒ‡å‘å‡½æ•°å¤´æ‹·è´è¿‡æ¥</li><li>æŠŠå‡½æ•°åç§°ä½¿ç”¨å°æ‹¬å·æ‹¬èµ·æ¥</li><li>åœ¨å‡½æ•°åç§°å‰é¢åŠ ä¸Šä¸€ä¸ª *</li><li>ä¿®æ”¹å‡½æ•°åç§°</li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">sum</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">multi</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¡ç®—funcç»“æœï¼Œå¹¶æ‰“å°</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">printFunc</span><span class="params">(<span class="type">char</span> *prefix, <span class="type">int</span> (*func)(<span class="type">int</span> a, <span class="type">int</span> b), <span class="type">int</span> a, <span class="type">int</span> b)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">int</span> c = func(a, b);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;[%d %s %d] = %d\n&quot;</span>, a, prefix, b, c);</span><br><span class="line">    <span class="keyword">return</span> c;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// a æ˜¯ä¸€ä¸ªå˜é‡ï¼Œç›´æ¥è·å–aé‚£ä¹ˆå¾—åˆ°çš„æ˜¯å…·ä½“çš„å€¼ä¹Ÿå°±æ˜¯1</span></span><br><span class="line">    <span class="comment">// æ€ä¹ˆè·å–å˜é‡açš„åœ°å€å‘¢ï¼Ÿ&amp;a</span></span><br><span class="line">    <span class="type">int</span> a = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç°åœ¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæŒ‡é’ˆå˜é‡æŒ‡å‘açš„åœ°å€ï¼Œè€Œä¸æ˜¯a</span></span><br><span class="line">    <span class="type">int</span>* b = &amp;a;</span><br><span class="line">    <span class="comment">// è¿™é‡Œè¡¨ç¤ºç›´æ¥è·å–å˜é‡bçš„å€¼ï¼Œæˆ‘ä»¬çŸ¥é“å˜é‡bå­˜å‚¨çš„æ˜¯åœ°å€ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¾ç¤ºçš„åœ°å€</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;b: %p\n&quot;</span>, b);</span><br><span class="line">    <span class="comment">// æ€ä¹ˆé€šè¿‡è¿™ä¸ªåœ°å€è·å–åˆ°åœ°å€æŒ‡å‘çš„å€¼å‘¢ï¼Ÿä½¿ç”¨ *</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;b: %d\n&quot;</span>, *b);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// äºŒçº§æŒ‡é’ˆï¼Œæ­¤å˜é‡å­˜æ”¾çš„ä¹Ÿæ˜¯åœ°å€ï¼Œä½†æ˜¯ä¸æ˜¯å…·ä½“å˜é‡çš„åœ°å€ï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„åœ°å€</span></span><br><span class="line">    <span class="type">int</span>** c = &amp;b;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;c: %p\n&quot;</span>, c);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;c: %p\n&quot;</span>, *c);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;c: %d\n&quot;</span>, **c);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ•°ç»„ådä¸ä»£è¡¨æ•´ä¸ªæ•°ç»„,åªä»£è¡¨æ•°ç»„é¦–å…ƒç´ çš„åœ°å€</span></span><br><span class="line">    <span class="type">int</span> d[<span class="number">3</span>] = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;d: %p\n&quot;</span>, d);</span><br><span class="line">    <span class="type">int</span>* p = d;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;p: %p\n&quot;</span>, p);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;p0: %d\n&quot;</span>, *(p));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;p1: %d\n&quot;</span>, *(p + <span class="number">1</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;p2: %d\n&quot;</span>, *(p + <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="comment">// 1. ä½¿ç”¨æ•°ç»„</span></span><br><span class="line">    <span class="type">char</span> <span class="built_in">string</span>[] = <span class="string">&quot;æˆ‘æ˜¯...&quot;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;s: %s\n&quot;</span>, <span class="built_in">string</span>);</span><br><span class="line">    <span class="comment">// 2. å­—ç¬¦ä¸²æŒ‡é’ˆæŒ‡å‘å­—ç¬¦ä¸²</span></span><br><span class="line">    <span class="comment">// ç”¨å­—ç¬¦æŒ‡é’ˆæ¥ä¿å­˜å­—ç¬¦ä¸²,å®ƒä¿å­˜çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡åœ°å€,å¸¸é‡åŒºæ˜¯åªè¯»çš„,æ‰€ä»¥æˆ‘ä»¬ä¸å¯ä»¥ä¿®æ”¹å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦</span></span><br><span class="line">    <span class="type">char</span>* str = <span class="string">&quot;xxxyyyy...&quot;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;str: %p\n&quot;</span>, str);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;str: %s\n&quot;</span>, str);</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(str); ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;%c&quot;</span>, *(str + i));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‡½æ•°æŒ‡é’ˆ</span></span><br><span class="line">    <span class="comment">// å‡½æ•°ä½œä¸ºä¸€æ®µç¨‹åºï¼Œåœ¨å†…å­˜ä¸­ä¹Ÿè¦å æ®éƒ¨åˆ†å­˜å‚¨ç©ºé—´ï¼Œå®ƒä¹Ÿæœ‰ä¸€ä¸ªèµ·å§‹åœ°å€</span></span><br><span class="line">    <span class="comment">// å› æ­¤å¯ä»¥åˆ©ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå‡½æ•°ã€‚å…¶ä¸­ï¼Œå‡½æ•°åå°±ä»£è¡¨ç€å‡½æ•°çš„åœ°å€</span></span><br><span class="line">    <span class="comment">// å…·ä½“æ ¼å¼å°±æ˜¯ è¿”å›å€¼ æŒ‡é’ˆå˜é‡ å‚æ•°</span></span><br><span class="line">    <span class="comment">// æŒ‡é’ˆå‡½æ•°å®šä¹‰æŠ€å·§</span></span><br><span class="line">    <span class="comment">// 1ã€ æŠŠè¦æŒ‡å‘å‡½æ•°å¤´æ‹·è´è¿‡æ¥</span></span><br><span class="line">    <span class="comment">// 2ã€ æŠŠå‡½æ•°åç§°ä½¿ç”¨å°æ‹¬å·æ‹¬èµ·æ¥</span></span><br><span class="line">    <span class="comment">// 3ã€ åœ¨å‡½æ•°åç§°å‰é¢åŠ ä¸Šä¸€ä¸ª *</span></span><br><span class="line">    <span class="comment">// 4ã€ ä¿®æ”¹å‡½æ•°åç§°</span></span><br><span class="line">    <span class="type">int</span> (*add)(<span class="type">int</span>, <span class="type">int</span>);</span><br><span class="line">    add = sum;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;add: %p\n&quot;</span>, add);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;add result: %d\n&quot;</span>, add(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line">    <span class="comment">// è®¡ç®—å¹¶æ‰“å°</span></span><br><span class="line">    printFunc(<span class="string">&quot;add&quot;</span>, add, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">    printFunc(<span class="string">&quot;multi&quot;</span>, multi, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ç»“æ„ä½“"><a href="#ç»“æ„ä½“" class="headerlink" title="ç»“æ„ä½“"></a>ç»“æ„ä½“</h3><ul><li>ç»“æ„ä½“ä¸­æ²¡æœ‰åˆå§‹åŒ–çš„å±æ€§å¯èƒ½æœ‰åƒåœ¾å€¼ï¼Œè¿™æ˜¯å› ä¸ºå†…å­˜æ²¡æœ‰åˆå§‹åŒ–å¯¼è‡´çš„ï¼Œå»ºè®®ç»“æ„ä½“ä¸­å†…åµŒçš„ç»“æ„ä½“ä½¿ç”¨æŒ‡é’ˆçš„å½¢å¼ï¼Œä¾¿äºä½¿ç”¨NULLå®šä¹‰</li><li>ç»“æ„ä½“ä¹‹é—´èµ‹å€¼æ˜¯å€¼æ‹·è´, è€Œä¸æ˜¯åœ°å€ä¼ é€’</li><li>ç»“æ„ä½“å˜é‡ä½œä¸ºå‡½æ•°å½¢å‚æ—¶ä¹Ÿæ˜¯å€¼ä¼ é€’, åœ¨å‡½æ•°å†…ä¿®æ”¹å½¢å‚, ä¸ä¼šå½±å“å¤–ç•Œå®å‚</li><li>sizeofè®¡ç®—æ™®é€šç»“æ„ä½“å˜é‡ï¼Œè®¡ç®—çš„æ˜¯ç»“æ„ä½“æ•´ä½“å ç”¨çš„å†…å­˜å¤§å°ï¼›è®¡ç®—æŒ‡é’ˆåˆ™æ˜¯æŒ‡é’ˆæœ¬èº«å ç”¨çš„å†…å­˜å¤§å°</li><li>å…±ç”¨ä½“ union å†…éƒ¨æ‰€æœ‰å±æ€§å…±äº«ä¸€å—å†…å­˜ï¼Œå…¶ä¸­ä¸€ä¸ªå±æ€§å‘ç”Ÿå˜åŒ–ï¼Œå…¶ä»–å±æ€§ä¹Ÿä¼šæ”¹å˜</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Date</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">int</span> month;</span><br><span class="line">    <span class="type">int</span> day;</span><br><span class="line">    <span class="type">int</span> year;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">char</span>* name;</span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Date</span> <span class="title">birthday</span>;</span></span><br><span class="line">&#125; Student;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printStudent</span><span class="params">(<span class="type">const</span> Student* student)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;name:%s,age:%d,&quot;</span>, student-&gt;name, student-&gt;age);</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Date</span> <span class="title">birthday</span> =</span> student-&gt;birthday;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;birthday:%d-%d-%d\n&quot;</span>, birthday.year, birthday.month, birthday.day);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">union</span> <span class="title">Test</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">int</span> age;</span><br><span class="line">    <span class="type">char</span> a;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å…ˆå®šä¹‰å†åˆå§‹åŒ–</span></span><br><span class="line">    <span class="comment">// struct Student student è¿™é‡Œä¼šä¸ºæ•´ä¸ªç»“æ„ä½“åˆ†é…å†…å­˜ï¼ŒåŒ…å«å†…éƒ¨çš„ä¸‰ä¸ªå±æ€§</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Student</span> <span class="title">student</span>;</span></span><br><span class="line">    <span class="comment">// memset(&amp;student, 0, sizeof(&amp;student));</span></span><br><span class="line">    student.age = <span class="number">10</span>;</span><br><span class="line">    student.name = <span class="string">&quot;123&quot;</span>;</span><br><span class="line">    printStudent(&amp;student);</span><br><span class="line">    <span class="comment">// æ‰“å°æ²¡æœ‰åˆå§‹åŒ–çš„birthdayå±æ€§ï¼Œä¼šå‘ç°æœ‰å€¼</span></span><br><span class="line">    <span class="comment">// è¿™äº›å€¼æ˜¯å°šæœªåˆå§‹åŒ–çš„å†…å­˜ï¼Œæ˜¯å†…å­˜ä¸­åŸæœ¬å°±æœ‰çš„æ•°æ®ï¼Œå±äºåƒåœ¾å€¼</span></span><br><span class="line">    <span class="comment">// è¿™æ—¶å€™å¯ä»¥è€ƒè™‘ä½¿ç”¨æŒ‡é’ˆï¼Œè®¾ç½®ä¸ºNULLå³å¯</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Date</span> <span class="title">birthday</span> =</span> student.birthday;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;birthday:%d-%d-%d\n&quot;</span>, birthday.year, birthday.month, birthday.day);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–çš„æ—¶å€™å®šä¹‰</span></span><br><span class="line">    <span class="type">const</span> <span class="class"><span class="keyword">struct</span> <span class="title">Student</span> <span class="title">stu</span> =</span> &#123;.name = <span class="string">&quot;name&quot;</span>, .age = <span class="number">29</span>&#125;;</span><br><span class="line">    printStudent(&amp;stu);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…ˆå®šä¹‰åä¸€æ¬¡åˆå§‹åŒ–</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Student</span> <span class="title">stu2</span>;</span></span><br><span class="line">    stu2 = (<span class="keyword">struct</span> Student)&#123;<span class="string">&quot;lnj&quot;</span>, <span class="number">35</span>&#125;;</span><br><span class="line">    printStudent(&amp;stu2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰åŒ…å«ç»“æ„ä½“çš„ç»“æ„ä½“</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Student</span> <span class="title">stu3</span> =</span> &#123;.name = <span class="string">&quot;name3&quot;</span>, .age = <span class="number">20</span>, .birthday = &#123;.year = <span class="number">2024</span>, .month = <span class="number">10</span>, .day = <span class="number">22</span>&#125;&#125;;</span><br><span class="line">    printStudent(&amp;stu3);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç»“æ„ä½“ä¹‹é—´èµ‹å€¼æ˜¯å€¼æ‹·è´, è€Œä¸æ˜¯åœ°å€ä¼ é€’</span></span><br><span class="line">    <span class="comment">// åŒç† ç»“æ„ä½“å˜é‡ä½œä¸ºå‡½æ•°å½¢å‚æ—¶ä¹Ÿæ˜¯å€¼ä¼ é€’, åœ¨å‡½æ•°å†…ä¿®æ”¹å½¢å‚, ä¸ä¼šå½±å“å¤–ç•Œå®å‚</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªè·Ÿjavaä¸ä¸€æ ·ï¼Œjavaä¸­åªè¦ä¸æ˜¯åŸºæœ¬å¯¹è±¡ï¼Œå…¶ä»–éƒ½æ˜¯æ‹·è´åœ°å€ï¼Œè€Œä¸æ˜¯å€¼æ‹·è´</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">Student</span> <span class="title">copyStudent</span> =</span> student;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;age1:%d, age2:%d\n&quot;</span>, student.age, copyStudent.age);</span><br><span class="line">    <span class="comment">// å‘ç°copyStudentå¯¹åº”çš„æ•°æ®å˜åŒ–äº†ï¼Œä½†æ˜¯studentæ•°æ®æ²¡æœ‰æ”¹å˜</span></span><br><span class="line">    copyStudent.age = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;age1:%d, age2:%d\n&quot;</span>, student.age, copyStudent.age);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// sizeof</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œè®¡ç®—çš„æ˜¯æ™®é€šå˜é‡ï¼Œä¹Ÿå°±æ˜¯æ•´ä¸ªç»“æ„ä½“çš„å¤§å°=24</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sizeof: %lu\n&quot;</span>, <span class="keyword">sizeof</span>(student));</span><br><span class="line">    <span class="comment">// è¿™é‡Œè®¡ç®—çš„æ˜¯æŒ‡é’ˆå˜é‡ï¼Œä¹Ÿå°±æ˜¯è®¡ç®—è¿™ä¸ªæŒ‡é’ˆå˜é‡æœ¬èº«çš„å¤§å°ï¼Œåœ¨64ä½æœºå™¨ä¸Šæ˜¯8ä¸ªbyte</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sizeof: %lu\n&quot;</span>, <span class="keyword">sizeof</span>(&amp;student));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨typeofå®šä¹‰çš„åç§°è®¿é—®</span></span><br><span class="line">    Student studentx = &#123;.name = <span class="string">&quot;x&quot;</span>&#125;;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;name: %s&quot;</span>, studentx.name);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…±ç”¨ä½“ï¼Œå†…éƒ¨æ‰€æœ‰çš„å±æ€§å ç”¨åŒä¸€å—å†…å­˜ï¼Œä¿®æ”¹æŸä¸ªå±æ€§ä¼šå½±å“åˆ°å…¶ä»–å±æ€§</span></span><br><span class="line">    <span class="comment">// é€šä¿¡ä¸­çš„æ•°æ®åŒ…ä¼šç”¨åˆ°å…±ç”¨ä½“ï¼Œå› ä¸ºä¸çŸ¥é“å¯¹æ–¹ä¼šå‘é€ä»€ä¹ˆæ ·çš„æ•°æ®åŒ…è¿‡æ¥ï¼Œç”¨å…±ç”¨ä½“çš„è¯å°±ç®€å•äº†ï¼Œå®šä¹‰å‡ ç§æ ¼å¼çš„åŒ…ï¼Œæ”¶åˆ°åŒ…ä¹‹åå°±å¯ä»¥æ ¹æ®åŒ…çš„æ ¼å¼å–å‡ºæ•°æ®</span></span><br><span class="line">    <span class="comment">// èŠ‚çº¦å†…å­˜ã€‚å¦‚æœæœ‰2ä¸ªå¾ˆé•¿çš„æ•°æ®ç»“æ„ï¼Œä½†ä¸ä¼šåŒæ—¶ä½¿ç”¨</span></span><br><span class="line">    <span class="comment">// æŸäº›åº”ç”¨éœ€è¦å¤§é‡çš„ä¸´æ—¶å˜é‡ï¼Œè¿™äº›å˜é‡ç±»å‹ä¸åŒï¼Œè€Œä¸”ä¼šéšæ—¶æ›´æ¢ã€‚è€Œä½ çš„å †æ ˆç©ºé—´æœ‰é™ï¼Œä¸èƒ½åŒæ—¶åˆ†é…é‚£ä¹ˆå¤šä¸´æ—¶å˜é‡ã€‚è¿™æ—¶å¯ä»¥ä½¿ç”¨å…±ç”¨ä½“è®©è¿™äº›å˜é‡å…±äº«åŒä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œè¿™äº›ä¸´æ—¶å˜é‡ä¸ç”¨é•¿æœŸä¿å­˜ï¼Œç”¨å®Œå³ä¸¢ï¼Œå’Œå¯„å­˜å™¨å·®ä¸å¤šï¼Œä¸ç”¨ç»´æŠ¤</span></span><br><span class="line">    <span class="class"><span class="keyword">union</span> <span class="title">Test</span> <span class="title">t</span>;</span></span><br><span class="line">    <span class="comment">// å‘ç°è¿™ä¸ªå…±ç”¨ä½“å ç”¨çš„å†…å­˜æ˜¯4ï¼Œä¹Ÿå°±æ˜¯å…¶ä¸­æŸä¸ªå±æ€§å ç”¨å†…å­˜çš„æœ€å¤§å€¼</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;sizeof union: %lu\n&quot;</span>, <span class="keyword">sizeof</span>(t));</span><br><span class="line">    t.age = <span class="number">33</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;t.age = %i\n&quot;</span>, t.age); <span class="comment">// 33</span></span><br><span class="line">    t.a = <span class="string">&#x27;a&#x27;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;t.ch = %c\n&quot;</span>, t.a); <span class="comment">// a</span></span><br><span class="line">    <span class="comment">// ä¿®æ”¹å±æ€§aå‘ç°ageå±æ€§ä¹Ÿå˜åŒ–äº†</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;t.age = %i\n&quot;</span>, t.age); <span class="comment">// 97</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å®"><a href="#å®" class="headerlink" title="å®"></a>å®</h3><ul><li>æºç¨‹åºä¸­æ‰€æœ‰çš„å®åœ¨ç¼–è¯‘é¢„å¤„ç†çš„æ—¶å€™éƒ½ä¼šè¿›è¡Œæ–‡æœ¬æ›¿æ¢</li><li>å®šä¹‰ä¸€ä¸ªå®æ—¶å¯ä»¥å¼•ç”¨å·²ç»å®šä¹‰çš„å®å</li><li>å¯ç”¨å®å®šä¹‰è¡¨ç¤ºæ•°æ®ç±»å‹,ä½¿ä¹¦å†™æ–¹ä¾¿  <code>#define String char*</code></li><li>å¸¦å‚æ•°çš„å®å®šä¹‰<ul><li>Cè¯­è¨€å…è®¸å®å¸¦æœ‰å‚æ•°ã€‚åœ¨å®å®šä¹‰ä¸­çš„å‚æ•°ç§°ä¸ºå½¢å¼å‚æ•°,åœ¨å®è°ƒç”¨ä¸­çš„å‚æ•°ç§°ä¸ºå®é™…å‚æ•°ã€‚å¯¹å¸¦å‚æ•°çš„å®,åœ¨è°ƒç”¨ä¸­,ä¸ä»…è¦å®å±•å¼€,è€Œä¸”è¦ç”¨å®å‚å»ä»£æ¢å½¢å‚</li><li>æ ¼å¼: #define å®å(å½¢å‚è¡¨) å­—ç¬¦ä¸²</li><li><ol><li>å®åå’Œå‚æ•°åˆ—è¡¨ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå¦åˆ™ç©ºæ ¼åé¢çš„æ‰€æœ‰å­—ç¬¦ä¸²éƒ½ä½œä¸ºæ›¿æ¢çš„å­—ç¬¦ä¸².</li></ol></li><li><ol start="2"><li>å¸¦å‚æ•°çš„å®åœ¨å±•å¼€æ—¶ï¼Œåªä½œç®€å•çš„å­—ç¬¦å’Œå‚æ•°çš„æ›¿æ¢ï¼Œä¸è¿›è¡Œä»»ä½•è®¡ç®—æ“ä½œã€‚æ‰€ä»¥åœ¨å®šä¹‰å®æ—¶ï¼Œä¸€èˆ¬ç”¨ä¸€ä¸ªå°æ‹¬å·æ‹¬ä½å­—ç¬¦ä¸²çš„å‚æ•°</li></ol></li><li><ol start="3"><li>è®¡ç®—ç»“æœæœ€å¥½ä¹Ÿç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œé¿å…å‡ºç°ä¸€äº›ä¼˜å…ˆçš„é—®é¢˜ #define Pow(a) ( (a) * (a) )</li></ol></li></ul></li><li>æ¡ä»¶ç¼–è¯‘</li></ul><blockquote><p>å¸Œæœ›ç¨‹åºçš„å…¶ä¸­ä¸€éƒ¨åˆ†ä»£ç åªæœ‰åœ¨æ»¡è¶³ä¸€å®šæ¡ä»¶æ—¶æ‰è¿›è¡Œç¼–è¯‘ï¼Œå¦åˆ™ä¸å‚ä¸ç¼–è¯‘(åªæœ‰å‚ä¸ç¼–è¯‘çš„ä»£ç æœ€ç»ˆæ‰èƒ½è¢«æ‰§è¡Œ)ï¼Œè¿™å°±æ˜¯æ¡ä»¶ç¼–è¯‘</p></blockquote><ul><li>å®å®šä¹‰ä¸å‡½æ•°çš„åŒºåˆ«<ul><li>å®å®šä¹‰ä¸æ¶‰åŠå­˜å‚¨ç©ºé—´çš„åˆ†é…ã€å‚æ•°ç±»å‹åŒ¹é…ã€å‚æ•°ä¼ é€’ã€è¿”å›å€¼é—®é¢˜</li><li>å‡½æ•°è°ƒç”¨åœ¨ç¨‹åºè¿è¡Œæ—¶æ‰§è¡Œï¼Œè€Œå®æ›¿æ¢åªåœ¨ç¼–è¯‘é¢„å¤„ç†é˜¶æ®µè¿›è¡Œã€‚æ‰€ä»¥å¸¦å‚æ•°çš„å®æ¯”å‡½æ•°å…·æœ‰æ›´é«˜çš„æ‰§è¡Œæ•ˆç‡</li></ul></li><li>typedefå’Œ#defineçš„åŒºåˆ«<ul><li>å®å®šä¹‰åªæ˜¯ç®€å•çš„å­—ç¬¦ä¸²æ›¿æ¢,ï¿¼æ˜¯åœ¨é¢„å¤„ç†å®Œæˆçš„</li><li>typedefæ˜¯åœ¨ç¼–è¯‘æ—¶å¤„ç†çš„,å®ƒä¸æ˜¯ä½œç®€å•çš„ä»£æ¢,è€Œæ˜¯å¯¹ç±»å‹è¯´æ˜ç¬¦ï¿¼é‡æ–°å‘½åã€‚è¢«å‘½åçš„æ ‡è¯†ç¬¦å…·æœ‰ç±»å‹å®šä¹‰è¯´æ˜çš„åŠŸèƒ½</li></ul></li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æºç¨‹åºä¸­æ‰€æœ‰çš„å®åPIåœ¨ç¼–è¯‘é¢„å¤„ç†çš„æ—¶å€™éƒ½ä¼šè¢«3.14æ‰€ä»£æ›¿</span></span><br><span class="line"><span class="comment">// å®åä¸€èˆ¬ç”¨å¤§å†™å­—æ¯ï¼Œä»¥ä¾¿ä¸å˜é‡ååŒºåˆ«å¼€æ¥</span></span><br><span class="line"><span class="comment">// å®šä¹‰ä¸€ä¸ªå®æ—¶å¯ä»¥å¼•ç”¨å·²ç»å®šä¹‰çš„å®å</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> PI 3.14</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯ç”¨å®å®šä¹‰è¡¨ç¤ºæ•°æ®ç±»å‹,ä½¿ä¹¦å†™æ–¹ä¾¿</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> String char*</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// å¸¦å‚æ•°çš„å®å®šä¹‰</span></span><br><span class="line"><span class="comment">// Cè¯­è¨€å…è®¸å®å¸¦æœ‰å‚æ•°ã€‚åœ¨å®å®šä¹‰ä¸­çš„å‚æ•°ç§°ä¸ºå½¢å¼å‚æ•°,åœ¨å®è°ƒç”¨ä¸­çš„å‚æ•°ç§°ä¸ºå®é™…å‚æ•°ã€‚å¯¹å¸¦å‚æ•°çš„å®,åœ¨è°ƒç”¨ä¸­,ä¸ä»…è¦å®å±•å¼€,è€Œä¸”è¦ç”¨å®å‚å»ä»£æ¢å½¢å‚</span></span><br><span class="line"><span class="comment">// æ ¼å¼: #define å®å(å½¢å‚è¡¨) å­—ç¬¦ä¸²</span></span><br><span class="line"><span class="comment">// 1. å®åå’Œå‚æ•°åˆ—è¡¨ä¹‹é—´ä¸èƒ½æœ‰ç©ºæ ¼ï¼Œå¦åˆ™ç©ºæ ¼åé¢çš„æ‰€æœ‰å­—ç¬¦ä¸²éƒ½ä½œä¸ºæ›¿æ¢çš„å­—ç¬¦ä¸².</span></span><br><span class="line"><span class="comment">// 2. å¸¦å‚æ•°çš„å®åœ¨å±•å¼€æ—¶ï¼Œåªä½œç®€å•çš„å­—ç¬¦å’Œå‚æ•°çš„æ›¿æ¢ï¼Œä¸è¿›è¡Œä»»ä½•è®¡ç®—æ“ä½œã€‚æ‰€ä»¥åœ¨å®šä¹‰å®æ—¶ï¼Œä¸€èˆ¬ç”¨ä¸€ä¸ªå°æ‹¬å·æ‹¬ä½å­—ç¬¦ä¸²çš„å‚æ•°</span></span><br><span class="line"><span class="comment">// 3. è®¡ç®—ç»“æœæœ€å¥½ä¹Ÿç”¨æ‹¬å·æ‹¬èµ·æ¥ï¼Œé¿å…å‡ºç°ä¸€äº›ä¼˜å…ˆçš„é—®é¢˜ #define Pow(a) ( (a) * (a) )</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> average(a, b) ((a + b) / 2)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¡ä»¶ç¼–è¯‘ï¼Œå¸Œæœ›ç¨‹åºçš„å…¶ä¸­ä¸€éƒ¨åˆ†ä»£ç åªæœ‰åœ¨æ»¡è¶³ä¸€å®šæ¡ä»¶æ—¶æ‰è¿›è¡Œç¼–è¯‘ï¼Œå¦åˆ™ä¸å‚ä¸ç¼–è¯‘(åªæœ‰å‚ä¸ç¼–è¯‘çš„ä»£ç æœ€ç»ˆæ‰èƒ½è¢«æ‰§è¡Œ)ï¼Œè¿™å°±æ˜¯æ¡ä»¶ç¼–è¯‘</span></span><br><span class="line"><span class="comment">// #if å¸¸é‡è¡¨è¾¾å¼</span></span><br><span class="line"><span class="comment">//      ..code1...</span></span><br><span class="line"><span class="comment">// #else</span></span><br><span class="line"><span class="comment">//      ..code2...</span></span><br><span class="line"><span class="comment">// #endif</span></span><br><span class="line"><span class="comment">// !! æ¡ä»¶ç¼–è¯‘åé¢çš„æ¡ä»¶è¡¨è¾¾å¼ä¸­ä¸èƒ½è¯†åˆ«å˜é‡,å®ƒé‡Œé¢åªèƒ½è¯†åˆ«å¸¸é‡å’Œå®å®šä¹‰ï¼ŒåŒæ ·çš„ï¼Œä¹Ÿåªèƒ½å®šä¹‰å¸¸é‡å’Œå®</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> SCORE 67</span></span><br><span class="line"><span class="meta">#<span class="keyword">if</span> SCORE &gt; 90</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> printScore() printf(<span class="string">&quot;ä¼˜ç§€&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">elif</span> SCORE &gt; 60</span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> printScore() printf(<span class="string">&quot;è‰¯å¥½&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">else</span></span></span><br><span class="line">    <span class="meta">#<span class="keyword">define</span> printScore() printf(<span class="string">&quot;ä¸åŠæ ¼&quot;</span>)</span></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// æ ¹æ®åœ†çš„åŠå¾„è®¡radiusç®—å‘¨é•¿</span></span><br><span class="line"><span class="type">float</span> <span class="title function_">girth</span><span class="params">(<span class="type">float</span> radius)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">2</span> * PI * radius;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="type">float</span> g = girth(<span class="number">2</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;å‘¨é•¿ä¸ºï¼š%f\n&quot;</span>, g);</span><br><span class="line"></span><br><span class="line">    String str = <span class="string">&quot;123&quot;</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;str: %s\n&quot;</span>, str);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;avg: %d\n&quot;</span>, average(<span class="number">1</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    printScore();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="malloc"><a href="#malloc" class="headerlink" title="malloc"></a>malloc</h3><ul><li>malloc å’Œ free æˆå¯¹ä½¿ç”¨</li></ul><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// å­˜å‚¨åœ¨æ ˆä¸­, å†…å­˜åœ°å€ä»å¤§åˆ°å°</span></span><br><span class="line">    <span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line">    <span class="type">int</span> b = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&amp;a = %p\n&quot;</span>, &amp;a); <span class="comment">// &amp;a = 0x16b90eb68</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&amp;b = %p\n&quot;</span>, &amp;b); <span class="comment">// &amp;b = 0x16b90eb64</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å­˜å‚¨åœ¨æ ˆä¸­, å†…å­˜åœ°å€ä»å°åˆ°å¤§</span></span><br><span class="line">    <span class="type">int</span>* p1 = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    *p1 = <span class="number">10</span>;</span><br><span class="line">    <span class="type">int</span>* p2 = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    *p2 = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;p1 = %p\n&quot;</span>, p1); <span class="comment">//  p1 = 00762F48</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;p2 = %p\n&quot;</span>, p2); <span class="comment">// p2 = 00762F58</span></span><br><span class="line">    <span class="built_in">free</span>(p1);</span><br><span class="line">    <span class="built_in">free</span>(p2);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// malloc æ‰€åœ¨æ–‡ä»¶:stdlib.h</span></span><br><span class="line">    <span class="comment">// ç”³è¯·å †å†…å­˜ç©ºé—´å¹¶è¿”å›,æ‰€ç”³è¯·çš„ç©ºé—´å¹¶æœªåˆå§‹åŒ–ã€‚</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * malloc</span></span><br><span class="line"><span class="comment">     * ç¬¬ä¸€ä¸ªå‚æ•°: éœ€è¦ç”³è¯·å¤šå°‘ä¸ªå­—èŠ‚ç©ºé—´</span></span><br><span class="line"><span class="comment">     * è¿”å›å€¼ç±»å‹: void *</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="type">int</span>* p = <span class="built_in">malloc</span>(<span class="keyword">sizeof</span>(<span class="type">int</span>));</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;p = %i\n&quot;</span>, *p); <span class="comment">// *på¯èƒ½æ˜¯åƒåœ¾æ•°æ®</span></span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">     * ç¬¬ä¸€ä¸ªå‚æ•°: éœ€è¦åˆå§‹åŒ–çš„å†…å­˜åœ°å€</span></span><br><span class="line"><span class="comment">     * ç¬¬äºŒä¸ªåˆå§‹: éœ€è¦åˆå§‹åŒ–çš„å€¼</span></span><br><span class="line"><span class="comment">     * ç¬¬ä¸‰ä¸ªå‚æ•°: éœ€è¦åˆå§‹åŒ–å¯¹å°‘ä¸ªå­—èŠ‚</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="built_in">memset</span>(p, <span class="number">0</span>, <span class="keyword">sizeof</span>(<span class="type">int</span>)); <span class="comment">// å¯¹ç”³è¯·çš„å†…å­˜ç©ºé—´è¿›è¡Œåˆå§‹åŒ–</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;p = %i\n&quot;</span>, *p); <span class="comment">// åˆå§‹åŒ–ä¸º0</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&amp;p = %p\n&quot;</span>, p);</span><br><span class="line">    *p = <span class="number">20</span>;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;p = %i\n&quot;</span>, *p);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// realloc æ‰©å®¹/ç¼©å®¹</span></span><br><span class="line">    <span class="comment">// è¿”å›çš„æŒ‡é’ˆï¼Œå¯èƒ½ä¸ ptr çš„å€¼ç›¸åŒï¼Œä¹Ÿæœ‰å¯èƒ½ä¸åŒã€‚</span></span><br><span class="line">    <span class="comment">// è‹¥ç›¸åŒï¼Œåˆ™è¯´æ˜åœ¨åŸç©ºé—´åé¢ç”³è¯·ï¼Œå¦åˆ™ï¼Œåˆ™å¯èƒ½åç»­ç©ºé—´ä¸è¶³ï¼Œé‡æ–°ç”³è¯·çš„æ–°çš„è¿ç»­ç©ºé—´ï¼ŒåŸæ•°æ®æ‹·è´åˆ°æ–°ç©ºé—´ï¼Œ åŸæœ‰ç©ºé—´è‡ªåŠ¨é‡Šæ”¾</span></span><br><span class="line">    p = <span class="built_in">realloc</span>(p, <span class="keyword">sizeof</span>(<span class="type">int</span>) * <span class="number">2</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&amp;p = %p\n&quot;</span>, p);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;p = %i\n&quot;</span>, *p);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// free stdlib.h</span></span><br><span class="line">    <span class="comment">// é€šè¿‡mallocç”³è¯·çš„å­˜å‚¨ç©ºé—´ä¸€å®šè¦é‡Šæ”¾, æ‰€ä»¥mallocå’Œfreeå‡½æ•°æ€»æ˜¯æˆå¯¹å‡ºç°</span></span><br><span class="line">    <span class="comment">// é‡Šæ”¾ç”³è¯·çš„å †å†…å­˜</span></span><br><span class="line">    <span class="built_in">free</span>(p);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="é“¾è¡¨å®ç°"><a href="#é“¾è¡¨å®ç°" class="headerlink" title="é“¾è¡¨å®ç°"></a>é“¾è¡¨å®ç°</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">node</span></span></span><br><span class="line"><span class="class">&#123;</span></span><br><span class="line">    <span class="type">int</span> data;</span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">node</span>* <span class="title">next</span>;</span></span><br><span class="line">&#125; Node;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> NODE_SIZE sizeof(Node)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºä¸€ä¸ªç©ºé“¾è¡¨ï¼ŒåŒ…å«ä¸€ä¸ªå¤´ç»“ç‚¹</span></span><br><span class="line">Node* <span class="title function_">createNodeList</span><span class="params">()</span>;</span><br><span class="line"><span class="comment">// å°¾æ’æ³•</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">insertTail</span><span class="params">(Node* head, <span class="type">int</span> data)</span>;</span><br><span class="line"><span class="comment">// å¤´æ’æ³•</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">insertHead</span><span class="params">(Node* head, <span class="type">int</span> data)</span>;</span><br><span class="line"><span class="comment">// æ‰“å°é“¾è¡¨</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">printNodeList</span><span class="params">(Node* node)</span>;</span><br><span class="line"><span class="comment">// é‡Šæ”¾ä¸€ä¸ªé“¾è¡¨</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">freeNode</span><span class="params">(Node* head)</span>;</span><br><span class="line"><span class="comment">// è®¡ç®—é“¾è¡¨é•¿åº¦</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">listLength</span><span class="params">(<span class="type">const</span> Node* head)</span>;</span><br><span class="line"><span class="comment">// é“¾è¡¨æŸ¥æ‰¾</span></span><br><span class="line">Node* <span class="title function_">searchList</span><span class="params">(Node* head, <span class="type">int</span> key)</span>;</span><br><span class="line"><span class="comment">// é“¾è¡¨åˆ é™¤</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">deleteNodeList</span><span class="params">(Node* head, Node* find)</span>;</span><br><span class="line"><span class="comment">// åè½¬é“¾è¡¨</span></span><br><span class="line"><span class="type">void</span> <span class="title function_">reverseList</span><span class="params">(Node* head)</span>;</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">(<span class="type">void</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Node* head = createNodeList();</span><br><span class="line">    <span class="keyword">if</span> (!head)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    insertHead(head, <span class="number">1</span>);</span><br><span class="line">    insertHead(head, <span class="number">2</span>);</span><br><span class="line">    insertTail(head, <span class="number">3</span>);</span><br><span class="line">    insertTail(head, <span class="number">4</span>);</span><br><span class="line">    printNodeList(head);</span><br><span class="line">    reverseList(head);</span><br><span class="line">    printNodeList(head);</span><br><span class="line">    <span class="type">int</span> length = listLength(head);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;é“¾è¡¨é•¿åº¦: %i\n&quot;</span>, length);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (searchList(head, <span class="number">4</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;æ‰¾åˆ°äº†å€¼ä¸º%içš„èŠ‚ç‚¹\n&quot;</span>, <span class="number">4</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (searchList(head, <span class="number">2</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;æ‰¾åˆ°äº†å€¼ä¸º%içš„èŠ‚ç‚¹\n&quot;</span>, <span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!searchList(head, <span class="number">100</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;æ²¡æ‰¾åˆ°å€¼ä¸º%içš„èŠ‚ç‚¹\n&quot;</span>, <span class="number">100</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    deleteNodeList(head, searchList(head, <span class="number">4</span>));</span><br><span class="line">    deleteNodeList(head, searchList(head, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">    printNodeList(head);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">free</span>(head);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Node* <span class="title function_">createNodeList</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    Node* head = <span class="built_in">malloc</span>(NODE_SIZE);</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    head-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">insertTail</span><span class="params">(Node* head, <span class="type">int</span> data)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// æ‰¾åˆ°å°¾ç»“ç‚¹</span></span><br><span class="line">    Node* pre = head;</span><br><span class="line">    <span class="keyword">while</span> (pre != <span class="literal">NULL</span> &amp;&amp; pre-&gt;next != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        pre = pre-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (pre == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node* node = <span class="built_in">malloc</span>(NODE_SIZE);</span><br><span class="line">    node-&gt;data = data;</span><br><span class="line">    node-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    pre-&gt;next = node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">insertHead</span><span class="params">(Node* head, <span class="type">int</span> data)</span></span><br><span class="line">&#123;</span><br><span class="line">    Node* node = <span class="built_in">malloc</span>(NODE_SIZE);</span><br><span class="line">    node-&gt;data = data;</span><br><span class="line">    node-&gt;next = head-&gt;next;</span><br><span class="line">    head-&gt;next = node;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">printNodeList</span><span class="params">(Node* node)</span></span><br><span class="line">&#123;</span><br><span class="line">    Node* head = node-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (head != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">int</span> currentData = head-&gt;data;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">&quot;currentData = %i\n&quot;</span>, currentData);</span><br><span class="line">        head = head-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">freeNode</span><span class="params">(Node* head)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Node* cur = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span> (head != <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        cur = head-&gt;next;</span><br><span class="line">        <span class="built_in">free</span>(head);</span><br><span class="line">        head = cur;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// const Node* head è¡¨ç¤ºæŒ‡é’ˆæŒ‡å‘çš„å†…å®¹ä¸èƒ½ä¿®æ”¹</span></span><br><span class="line"><span class="comment">// Node* const head è¡¨ç¤ºè¿™ä¸ªæŒ‡é’ˆä¸èƒ½ä¿®æ”¹</span></span><br><span class="line"><span class="type">int</span> <span class="title function_">listLength</span><span class="params">(<span class="type">const</span> Node* head)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (head == <span class="literal">NULL</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">int</span> count = <span class="number">0</span>;</span><br><span class="line">    head = head-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (head)</span><br><span class="line">    &#123;</span><br><span class="line">        count++;</span><br><span class="line">        head = head-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> count;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Node* <span class="title function_">searchList</span><span class="params">(Node* head, <span class="type">int</span> key)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!head)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    head = head-&gt;next;</span><br><span class="line">    <span class="keyword">while</span> (head)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span> (key == head-&gt;data)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        head = head-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> head;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">deleteNodeList</span><span class="params">(Node* head, Node* find)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">if</span> (!head)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span> (head-&gt;next != find)</span><br><span class="line">    &#123;</span><br><span class="line">        head = head-&gt;next;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (head)</span><br><span class="line">    &#123;</span><br><span class="line">        head-&gt;next = find-&gt;next;</span><br><span class="line">        <span class="built_in">free</span>(find);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="type">void</span> <span class="title function_">reverseList</span><span class="params">(Node* head)</span></span><br><span class="line">&#123;</span><br><span class="line">    Node *pre, *cur;</span><br><span class="line">    pre = head-&gt;next;</span><br><span class="line">    <span class="comment">// æŠŠheadç½®ä¸ºä¸€ä¸ªç©ºé“¾è¡¨</span></span><br><span class="line">    head-&gt;next = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">while</span> (pre)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// åè½¬é“¾è¡¨ï¼Œç›¸å½“äºå¤´æ’æ³•</span></span><br><span class="line">        cur = pre-&gt;next;</span><br><span class="line">        pre-&gt;next = head-&gt;next;</span><br><span class="line">        head-&gt;next = pre;</span><br><span class="line">        pre = cur;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;æŒ‡é’ˆ&quot;&gt;&lt;a href=&quot;#æŒ‡é’ˆ&quot; class=&quot;headerlink&quot; title=&quot;æŒ‡é’ˆ&quot;&gt;&lt;/a&gt;æŒ‡é’ˆ&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;strong&gt;&amp;amp;&lt;/strong&gt; è·å–å˜é‡åœ°å€&lt;/li&gt;
&lt;li&gt;***** è¯´æ˜å˜é‡ä¸ºæŒ‡é’ˆå˜é‡ï¼Œå­˜å‚¨çš„æ˜¯å¦ä¸€ä¸ªå˜é‡çš„åœ°å€ï¼›*&lt;strong&gt;p&lt;/strong&gt; è‹¥pæœ¬èº«å·²ç»æ˜¯åœ°å€ï¼Œé‚£ä¹ˆèƒ½è·å–åˆ°è¿™ä¸ªåœ°å€å¯¹åº”çš„å€¼&lt;/li&gt;
&lt;li&gt;å¤šçº§æŒ‡é’ˆä½¿ç”¨å¤šä¸ª ***** è¡¨ç¤º&lt;/li&gt;
&lt;li&gt;æ•°ç»„åä¸ä»£è¡¨æ•´ä¸ªæ•°ç»„ï¼Œåªä»£è¡¨æ•°ç»„é¦–å…ƒç´ çš„åœ°å€ï¼Œå¯¹è¿™ä¸ª&lt;strong&gt;åœ°å€+1&lt;/strong&gt;å³å¯è·å–æ•°ç»„ä¸‹ä¸€ä¸ªå…ƒç´ çš„åœ°å€&lt;/li&gt;
&lt;li&gt;&lt;strong&gt;char&lt;/strong&gt; &lt;strong&gt;string[]&lt;/strong&gt; æ•°ç»„å®šä¹‰å­—ç¬¦ä¸²ï¼Œ&lt;strong&gt;char*&lt;/strong&gt; &lt;strong&gt;str&lt;/strong&gt; &lt;strong&gt;&amp;#x3D; â€œxâ€&lt;/strong&gt; æŒ‡é’ˆå®šä¹‰å­—ç¬¦ä¸²&lt;/li&gt;
&lt;li&gt;å‡½æ•°æŒ‡é’ˆï¼Œå‡½æ•°åä»£è¡¨å‡½æ•°çš„åœ°å€ã€‚å®šä¹‰å‡½æ•°æŒ‡é’ˆæŠ€å·§å¦‚ä¸‹: &lt;ul&gt;
&lt;li&gt;æŠŠè¦æŒ‡å‘å‡½æ•°å¤´æ‹·è´è¿‡æ¥&lt;/li&gt;
&lt;li&gt;æŠŠå‡½æ•°åç§°ä½¿ç”¨å°æ‹¬å·æ‹¬èµ·æ¥&lt;/li&gt;
&lt;li&gt;åœ¨å‡½æ•°åç§°å‰é¢åŠ ä¸Šä¸€ä¸ª *&lt;/li&gt;
&lt;li&gt;ä¿®æ”¹å‡½æ•°åç§°&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight c&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;lt;stdio.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;#&lt;span class=&quot;keyword&quot;&gt;include&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&amp;lt;string.h&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;sum&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; a, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; b)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; a + b;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;multi&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; a, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; b)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; a * b;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// è®¡ç®—funcç»“æœï¼Œå¹¶æ‰“å°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;printFunc&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;char&lt;/span&gt; *prefix, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; (*func)(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; a, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; b), &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; a, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; b)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; c = func(a, b);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;[%d %s %d] = %d&#92;n&amp;quot;&lt;/span&gt;, a, prefix, b, c);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; c;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(&lt;span class=&quot;type&quot;&gt;void&lt;/span&gt;)&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// a æ˜¯ä¸€ä¸ªå˜é‡ï¼Œç›´æ¥è·å–aé‚£ä¹ˆå¾—åˆ°çš„æ˜¯å…·ä½“çš„å€¼ä¹Ÿå°±æ˜¯1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æ€ä¹ˆè·å–å˜é‡açš„åœ°å€å‘¢ï¼Ÿ&amp;amp;a&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; a = &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ç°åœ¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæŒ‡é’ˆå˜é‡æŒ‡å‘açš„åœ°å€ï¼Œè€Œä¸æ˜¯a&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;* b = &amp;amp;a;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è¿™é‡Œè¡¨ç¤ºç›´æ¥è·å–å˜é‡bçš„å€¼ï¼Œæˆ‘ä»¬çŸ¥é“å˜é‡bå­˜å‚¨çš„æ˜¯åœ°å€ï¼Œæ‰€ä»¥è¿™é‡Œæ˜¾ç¤ºçš„åœ°å€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;b: %p&#92;n&amp;quot;&lt;/span&gt;, b);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æ€ä¹ˆé€šè¿‡è¿™ä¸ªåœ°å€è·å–åˆ°åœ°å€æŒ‡å‘çš„å€¼å‘¢ï¼Ÿä½¿ç”¨ *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;b: %d&#92;n&amp;quot;&lt;/span&gt;, *b);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// äºŒçº§æŒ‡é’ˆï¼Œæ­¤å˜é‡å­˜æ”¾çš„ä¹Ÿæ˜¯åœ°å€ï¼Œä½†æ˜¯ä¸æ˜¯å…·ä½“å˜é‡çš„åœ°å€ï¼Œè€Œæ˜¯ä¸€ä¸ªæŒ‡é’ˆçš„åœ°å€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;** c = &amp;amp;b;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;c: %p&#92;n&amp;quot;&lt;/span&gt;, c);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;c: %p&#92;n&amp;quot;&lt;/span&gt;, *c);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;c: %d&#92;n&amp;quot;&lt;/span&gt;, **c);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æ•°ç»„ådä¸ä»£è¡¨æ•´ä¸ªæ•°ç»„,åªä»£è¡¨æ•°ç»„é¦–å…ƒç´ çš„åœ°å€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; d[&lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;] = &amp;#123;&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;&amp;#125;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;d: %p&#92;n&amp;quot;&lt;/span&gt;, d);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;* p = d;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;p: %p&#92;n&amp;quot;&lt;/span&gt;, p);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;p0: %d&#92;n&amp;quot;&lt;/span&gt;, *(p));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;p1: %d&#92;n&amp;quot;&lt;/span&gt;, *(p + &lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;p2: %d&#92;n&amp;quot;&lt;/span&gt;, *(p + &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å®šä¹‰å­—ç¬¦ä¸²&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 1. ä½¿ç”¨æ•°ç»„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;built_in&quot;&gt;string&lt;/span&gt;[] = &lt;span class=&quot;string&quot;&gt;&amp;quot;æˆ‘æ˜¯...&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;s: %s&#92;n&amp;quot;&lt;/span&gt;, &lt;span class=&quot;built_in&quot;&gt;string&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 2. å­—ç¬¦ä¸²æŒ‡é’ˆæŒ‡å‘å­—ç¬¦ä¸²&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ç”¨å­—ç¬¦æŒ‡é’ˆæ¥ä¿å­˜å­—ç¬¦ä¸²,å®ƒä¿å­˜çš„æ˜¯å­—ç¬¦ä¸²å¸¸é‡åœ°å€,å¸¸é‡åŒºæ˜¯åªè¯»çš„,æ‰€ä»¥æˆ‘ä»¬ä¸å¯ä»¥ä¿®æ”¹å­—ç¬¦ä¸²ä¸­çš„å­—ç¬¦&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;char&lt;/span&gt;* str = &lt;span class=&quot;string&quot;&gt;&amp;quot;xxxyyyy...&amp;quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;str: %p&#92;n&amp;quot;&lt;/span&gt;, str);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;str: %s&#92;n&amp;quot;&lt;/span&gt;, str);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;for&lt;/span&gt; (&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; i = &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;; i &amp;lt; &lt;span class=&quot;built_in&quot;&gt;strlen&lt;/span&gt;(str); ++i)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;%c&amp;quot;&lt;/span&gt;, *(str + i));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;&#92;n&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å‡½æ•°æŒ‡é’ˆ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å‡½æ•°ä½œä¸ºä¸€æ®µç¨‹åºï¼Œåœ¨å†…å­˜ä¸­ä¹Ÿè¦å æ®éƒ¨åˆ†å­˜å‚¨ç©ºé—´ï¼Œå®ƒä¹Ÿæœ‰ä¸€ä¸ªèµ·å§‹åœ°å€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å› æ­¤å¯ä»¥åˆ©ç”¨ä¸€ä¸ªæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªå‡½æ•°ã€‚å…¶ä¸­ï¼Œå‡½æ•°åå°±ä»£è¡¨ç€å‡½æ•°çš„åœ°å€&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å…·ä½“æ ¼å¼å°±æ˜¯ è¿”å›å€¼ æŒ‡é’ˆå˜é‡ å‚æ•°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æŒ‡é’ˆå‡½æ•°å®šä¹‰æŠ€å·§&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 1ã€ æŠŠè¦æŒ‡å‘å‡½æ•°å¤´æ‹·è´è¿‡æ¥&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 2ã€ æŠŠå‡½æ•°åç§°ä½¿ç”¨å°æ‹¬å·æ‹¬èµ·æ¥&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 3ã€ åœ¨å‡½æ•°åç§°å‰é¢åŠ ä¸Šä¸€ä¸ª *&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// 4ã€ ä¿®æ”¹å‡½æ•°åç§°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt; (*add)(&lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;, &lt;span class=&quot;type&quot;&gt;int&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    add = sum;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;add: %p&#92;n&amp;quot;&lt;/span&gt;, add);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;built_in&quot;&gt;printf&lt;/span&gt;(&lt;span class=&quot;string&quot;&gt;&amp;quot;add result: %d&#92;n&amp;quot;&lt;/span&gt;, add(&lt;span class=&quot;number&quot;&gt;1&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è®¡ç®—å¹¶æ‰“å°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    printFunc(&lt;span class=&quot;string&quot;&gt;&amp;quot;add&amp;quot;&lt;/span&gt;, add, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    printFunc(&lt;span class=&quot;string&quot;&gt;&amp;quot;multi&amp;quot;&lt;/span&gt;, multi, &lt;span class=&quot;number&quot;&gt;2&lt;/span&gt;, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="C" scheme="https://taeyang0126.github.io/categories/C/"/>
    
    
    <category term="C" scheme="https://taeyang0126.github.io/tags/C/"/>
    
  </entry>
  
  <entry>
    <title>spring-kafka</title>
    <link href="https://taeyang0126.github.io/2025/02/09/xiao-xi-dui-lie/kafka/spring-kakfa/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/xiao-xi-dui-lie/kafka/spring-kakfa/posts/undefined/</id>
    <published>2025-02-09T11:58:22.000Z</published>
    <updated>2025-02-10T14:16:05.825Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p> Spring kafka ç‰ˆæœ¬ 2.8.4</p></blockquote><h2 id="ç½‘ç«™èµ„æ–™"><a href="#ç½‘ç«™èµ„æ–™" class="headerlink" title="ç½‘ç«™èµ„æ–™"></a>ç½‘ç«™èµ„æ–™</h2><ul><li><a href="https://docs.spring.io/spring-kafka/docs/2.8.11/reference/html/#message-listener-container">spring-kafka(2.8.11)</a></li><li><a href="https://www.baeldung.com/?s=spring+kafka">baeldung-spring-kafka</a></li></ul><h2 id="offsetç®¡ç†"><a href="#offsetç®¡ç†" class="headerlink" title="offsetç®¡ç†"></a>offsetç®¡ç†</h2><h3 id="Kafka-è‡ªåŠ¨æäº¤-offset"><a href="#Kafka-è‡ªåŠ¨æäº¤-offset" class="headerlink" title="Kafka è‡ªåŠ¨æäº¤ offset"></a>Kafka è‡ªåŠ¨æäº¤ offset</h3><ul><li>enable.auto.commit&#x3D;true</li><li>auto-commit-interval è‡ªåŠ¨æäº¤çš„æ—¶é—´é—´éš”</li></ul><p>â€‹      æ¯”å¦‚ 1sï¼Œé‚£ä¹ˆè‡ªåŠ¨æäº¤çš„æ—¶é—´ç‚¹ deadline å°±æ˜¯å½“å‰æ—¶é—´ +1sï¼Œä½†æ˜¯è‡ªåŠ¨æäº¤ offset çš„çº¿ç¨‹ä¹Ÿæ˜¯ poll çº¿ç¨‹ï¼Œæ‰€ä»¥æäº¤ offset çš„æ—¶é—´ä¸ä¸€å®šæ˜¯å›ºå®šçš„ 1sï¼Œä¼šæœ‰ä¸‹é¢å‡ ç§æƒ…å†µ</p><pre><code>  A.  ä¸šåŠ¡å¤„ç†æ—¶é—´ &gt;= auto-commit-interval  æäº¤ offset çš„æ—¶é—´ç‚¹å°±æ˜¯æ¯æ¬¡ poll çš„æ—¶å€™ï¼Œç”±äºä¸šåŠ¡å¤„ç†æ—¶é—´å·²ç»å¤§äºè‡ªå®šæäº¤é—´éš”ï¼Œé‚£ä¹ˆæ¯æ¬¡ poll çš„æ—¶å€™å½“å‰æ—¶é—´ä¸€å®šå¤§äº deadlineï¼Œ  æ‰€ä»¥ä¸€å®šä¼šè¿›è¡Œä¸€æ¬¡ offset æäº¤ï¼ˆå¼‚æ­¥æäº¤ï¼‰ï¼Œè¿™é‡Œæäº¤çš„ offset åŒºé—´å°±æ˜¯å•æ¬¡æ‹‰å–æ¶ˆæ¯çš„æ•°é‡å¤§å° max.poll.records  B.  ä¸šåŠ¡å¤„ç†æ—¶é—´ &lt;&lt; auto-commit-interval  æå« offset çš„æ—¶é—´ç‚¹å¯èƒ½åœ¨ç¬¬ n æ¬¡ poll çš„æ—¶å€™ï¼ˆå‡è®¾ m=ä¸šåŠ¡å¤„ç†æ—¶é—´ï¼Œè¦æ±‚  $$n * m$$  &gt; auto-commit-intervalï¼‰ï¼Œè¿™æ—¶å€™ä¼šè¿›è¡Œä¸€æ¬¡ä¸€æ¬¡ offset æäº¤ï¼ˆå¼‚æ   äº¤ï¼‰ï¼Œè¿™é‡Œæäº¤çš„ offset åŒºé—´= $$n * $$max.poll.records </code></pre><ul><li>è‡ªåŠ¨æäº¤æµç¨‹</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">maybeAutoCommitOffsetsAsync</span><span class="params">(<span class="type">long</span> now)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (autoCommitEnabled) &#123;</span><br><span class="line">        nextAutoCommitTimer.update(now);</span><br><span class="line">        <span class="keyword">if</span> (nextAutoCommitTimer.isExpired()) &#123;</span><br><span class="line">            nextAutoCommitTimer.reset(autoCommitIntervalMs);</span><br><span class="line">            doAutoCommitOffsetsAsync();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img data-src="/images/message/kafka/02.png" alt="img"></p><h3 id="SpringKafka-æäº¤-offset-æµç¨‹"><a href="#SpringKafka-æäº¤-offset-æµç¨‹" class="headerlink" title="SpringKafka æäº¤ offset æµç¨‹"></a>SpringKafka æäº¤ offset æµç¨‹</h3><ul><li>å‰ç½®æ¡ä»¶ï¼š <strong>enable-auto-commit</strong> &#x3D; false</li><li>ackMode &#x3D; <em>RECORD</em></li></ul><p>â€‹      ä¸šåŠ¡æ¶ˆæ¯å¤„ç†å®Œæˆä¹‹åï¼Œå³ doInvokeOnMessage æ–¹æ³•ä¹‹åï¼Œä¼šå¯¹å‘é€æ¯æ¡æ¶ˆæ¯çš„ offset ç»™ broker</p><p><img data-src="/images/message/kafka/03.PNG" alt="img"></p><ul><li>ackMode !&#x3D; <em>RECORD</em></li></ul><p><img data-src="/images/message/kafka/04.png" alt="img"></p><ul><li>AckMode è§£æ</li></ul><table><thead><tr><th align="left">ç±»å‹</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><em>RECORD</em></td><td align="left">è‡ªåŠ¨æäº¤æ¯æ¡æ¶ˆæ¯å¤„ç†å®Œåæäº¤ offsetç›‘å¬æ¨¡å¼ä¸æ”¯æŒæ‰¹é‡ï¼Œåªæ”¯æŒå•æ¡æ¶ˆæ¯ä¸šåŠ¡å¤„ç†å®Œæˆåå‘ broker æäº¤ offset</td></tr><tr><td align="left"><em>BATCH</em></td><td align="left">è‡ªåŠ¨æäº¤é»˜è®¤çš„ç±»å‹ä¸€æ‰¹æ¶ˆæ¯å¤„ç†å®Œæˆåå†æäº¤ offsetæ¶ˆæ¯å¤„ç†å®Œæˆåä¼šè®°å½•åœ¨ acks ä¸­ï¼Œå†æ¬¡ poll çš„æ—¶å€™ä¼šå°† akcs è½¬æ¢ä¸º offset å¹¶æäº¤åˆ° broker</td></tr><tr><td align="left"><em>TIME</em></td><td align="left">è‡ªåŠ¨æäº¤ç»è¿‡ ackTime ä¹‹åæäº¤ offsetæ¶ˆæ¯å¤„ç†å®Œæˆåä¼šè®°å½•åœ¨ acks ä¸­</td></tr><tr><td align="left"><em>COUNT</em></td><td align="left">è‡ªåŠ¨æäº¤æ¶ˆæ¯æ¶ˆè´¹æ•°é‡è¶…è¿‡æ­¤é…ç½®åæäº¤æ¶ˆæ¯å¤„ç†å®Œæˆåä¼šè®°å½•åœ¨ acks ä¸­</td></tr><tr><td align="left"><em>COUNT_TIME</em></td><td align="left">è‡ªåŠ¨æäº¤æ»¡è¶³ COUNT æˆ– <em>TIME</em> æ—¶æäº¤ offset</td></tr><tr><td align="left"><em>MANUAL</em></td><td align="left">æ‰‹åŠ¨æäº¤ä¸šåŠ¡å¤„ç†åè°ƒç”¨ acknowledgment.acknowledgeï¼ˆï¼‰ æäº¤ offsetï¼ˆæŒ‡çš„æ˜¯å†…å­˜ä¸­ç»´æŠ¤çš„ offsetï¼‰çœŸæ­£å‘ broker æäº¤ offset è¿˜æ˜¯åœ¨ä¸‹ä¸€æ¬¡ pollï¼ˆï¼‰æ–¹æ³•æ‰§è¡Œæ—¶</td></tr><tr><td align="left"><em>MANUAL_IMMEDIATE</em></td><td align="left">æ‰‹åŠ¨æäº¤ä¸šåŠ¡å¤„ç†åè°ƒç”¨ acknowledgment.acknowledgeï¼ˆï¼‰ æäº¤ offsetæäº¤ offset æŒ‡å‘ broker æäº¤ offsetï¼Œè€Œä¸æ˜¯ç»´æŠ¤å†…å­˜ä¸­çš„æ•°æ®</td></tr></tbody></table><h3 id="å‘-Broker-æäº¤-offset-æµç¨‹"><a href="#å‘-Broker-æäº¤-offset-æµç¨‹" class="headerlink" title="å‘ Broker æäº¤ offset æµç¨‹"></a>å‘ Broker æäº¤ offset æµç¨‹</h3><ul><li>åŒæ­¥æäº¤ syncCommits&#x3D;trueï¼ˆ<strong>é»˜è®¤</strong>ï¼‰</li><li>å¼‚æ­¥æäº¤ syncCommits&#x3D;false</li></ul><p><img data-src="/images/message/kafka/05.png" alt="img"></p><h2 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a><a href="https://rq3nt70g815.feishu.cn/wiki/RO2qwqD4YiF4W8kQXmPcos02n8f">å¼‚å¸¸å¤„ç†</a></h2><h3 id="é»˜è®¤çš„å¼‚å¸¸å¤„ç†å™¨-DefaultErrorHandler"><a href="#é»˜è®¤çš„å¼‚å¸¸å¤„ç†å™¨-DefaultErrorHandler" class="headerlink" title="é»˜è®¤çš„å¼‚å¸¸å¤„ç†å™¨ DefaultErrorHandler"></a>é»˜è®¤çš„å¼‚å¸¸å¤„ç†å™¨ DefaultErrorHandler</h3><ul><li>æ­¤å¤„ç†ä¼šé‡è¯• n æ¬¡ï¼Œn æ¬¡é‡è¯•éƒ½å¤±è´¥åä¼šè·³è¿‡å½“å‰å¤±è´¥çš„æ¶ˆæ¯ï¼Œoffset æ¨è¿›ä¸€ä½ï¼Œæ‰€ä»¥ä¼šå¯¼è‡´å¤±è´¥æ¶ˆæ¯ä¸¢å¤±ï¼</li><li>é»˜è®¤é‡è¯• 9 æ¬¡ï¼Œæ¯æ¬¡é‡è¯•ä¹‹å‰æ²¡æœ‰é—´éš”</li></ul><p><img data-src="/images/message/kafka/06.png" alt="img"></p><ul><li>ä¸šåŠ¡å¤„ç†å¤±è´¥ &amp; é‡è¯•æ¬¡æ•° &lt; 9ï¼ŒæŠ›å‡ºå¼‚å¸¸ï¼›ä¼šé‡æ–° poll æ¶ˆæ¯è¿›è¡Œæ¶ˆè´¹ï¼›</li></ul><p>å‡è®¾æ‹‰å–çš„æ•´æ‰¹æ¶ˆæ¯ä¸­ç¬¬ n æ¡æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥ï¼ˆn &gt; 1ï¼‰ï¼Œé‚£ä¹ˆåœ¨æ¶ˆè´¹å¤±è´¥æ—¶ä¼šå…ˆæäº¤ offsetï¼Œä¿è¯å‰é¢å·²ç»æ¶ˆè´¹çš„ offset æ­£å¸¸æäº¤</p><p><img data-src="/images/message/kafka/07.png" alt="img"></p><ul><li>å®šä¹‰é‡è¯•æ¬¡æ•° &amp; é‡è¯•é—´éš”</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">FixedBackOff</span> <span class="variable">fixedBackOff</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FixedBackOff</span>(<span class="number">100</span>, <span class="number">1</span>);</span><br><span class="line"><span class="type">DefaultErrorHandler</span> <span class="variable">defaultErrorHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultErrorHandler</span>(fixedBackOff);</span><br><span class="line">kafkaMessageListenerContainer.setCommonErrorHandler(defaultErrorHandler);</span><br></pre></td></tr></table></figure><ul><li>æ‰¹é‡æ¶ˆè´¹æ—¶ï¼Œé‡åˆ°å¼‚å¸¸éœ€è¦æŠ›å‡º BatchListenerFailedExceptionï¼Œå¦åˆ™ä¼šé‡è¯•æ•´ä¸ªæ‰¹æ¬¡ï¼Œé‡è¯•æ¬¡æ•°è¿‡åä¼šè¶Šè¿‡æ•´ä¸ªæ‰¹æ¬¡çš„ offset</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 3 æŒ‡çš„æ˜¯å¤±è´¥æœ€å°æ¶ˆæ¯çš„indexï¼Œé‡è¯•ä¼šä»è¿™é‡Œå¼€å§‹</span></span><br><span class="line"><span class="type">BatchListenerFailedException</span> <span class="variable">batchListenerFailedException</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BatchListenerFailedException</span>(<span class="string">&quot;æ‰¹æ¬¡æ¶ˆè´¹å¤±è´¥&quot;</span>, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">throw</span> batchListenerFailedException;</span><br></pre></td></tr></table></figure><h3 id="ä¼˜é›…çš„å¼‚å¸¸å¤„ç†"><a href="#ä¼˜é›…çš„å¼‚å¸¸å¤„ç†" class="headerlink" title="ä¼˜é›…çš„å¼‚å¸¸å¤„ç†"></a>ä¼˜é›…çš„å¼‚å¸¸å¤„ç†</h3><p>é»˜è®¤çš„å¼‚å¸¸å¤„ç†å™¨é‡è¯•å¤±è´¥ä»…ä»…æ‰“å°æ—¥å¿—ï¼Œå¯¹äºç³»ç»Ÿæ¥è¯´æ¶ˆæ¯å°±ä¸¢å¤±äº†ã€‚</p><p>æ‰€ä»¥éœ€è¦é‡å†™ ConsumerRecordRecoverer æ¥å£ï¼Œå°†å¤±è´¥çš„æ¶ˆæ¯å‘é€åˆ°æ­»ä¿¡é˜Ÿåˆ—ä¸­ï¼Œä¾¿äºåç»­äººå·¥æˆ–ç¨‹åºè¿›è¡Œå¤„ç†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‡ªå®šä¹‰é‡è¯•æ¬¡æ•° &amp; é‡è¯•é—´éš”</span></span><br><span class="line"><span class="type">FixedBackOff</span> <span class="variable">fixedBackOff</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FixedBackOff</span>(<span class="number">2000</span>, <span class="number">1</span>);</span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰æ¶ˆæ¯recoverï¼Œé’ˆå¯¹ä¸åŒç±»å‹çš„æ¶ˆæ¯ï¼Œè½¬å‘åˆ°ä¸åŒçš„topicä¸­</span></span><br><span class="line"><span class="type">DeadLetterPublishingRecoverer</span> <span class="variable">recoverer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DeadLetterPublishingRecoverer</span>(kafkaTemplate, (record, exception) -&gt; &#123;</span><br><span class="line">    log.error(<span class="string">&quot;æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥, topic: &#123;&#125;, partition: &#123;&#125;, offset: &#123;&#125;, data: &#123;&#125;&quot;</span>, record.topic(), record.partition(), record.offset(), record.value());</span><br><span class="line">    <span class="keyword">if</span> (exception.getCause() <span class="keyword">instanceof</span> ArithmeticException) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TopicPartition</span>(record.topic() + <span class="string">&quot;.arithmetic.failures&quot;</span>, record.partition());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">TopicPartition</span>(record.topic() + <span class="string">&quot;.other.failures&quot;</span>, record.partition());</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="type">DefaultErrorHandler</span> <span class="variable">defaultErrorHandler</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultErrorHandler</span>(recoverer, fixedBackOff);</span><br></pre></td></tr></table></figure><h3 id="ç‰ˆæœ¬å·®å¼‚"><a href="#ç‰ˆæœ¬å·®å¼‚" class="headerlink" title="ç‰ˆæœ¬å·®å¼‚"></a>ç‰ˆæœ¬å·®å¼‚</h3><ul><li>å½“å‰ spring kafka ç‰ˆæœ¬ä¸º 2.8.4ï¼Œè¿™ä¸ªç‰ˆæœ¬ä¸‹å› ä¸º DefaultErrorHandler  çš„åŸå› ï¼Œæ— è®ºæ˜¯è‡ªåŠ¨æäº¤è¿˜æ˜¯æ‰‹åŠ¨æäº¤ï¼Œéƒ½ä¼š seek åˆ°å¤±è´¥çš„æ¶ˆæ¯ï¼Œå†è¿›è¡Œé‡è¯•ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç°æ¶ˆè´¹å¼‚å¸¸æ—¶ç›´æ¥æäº¤ offset çš„æƒ…å†µï¼›åŒæ—¶æ­¤å¼‚å¸¸å¤„ç†å™¨å¯¹äºæŸæ¡æ¶ˆæ¯å¤„ç†å¤±è´¥åï¼Œä¸ä¼šè·³è¿‡è¿™æ¡æ¶ˆæ¯æ˜¯å°è¯•ä¸‹ä¸€æ¡æ¶ˆæ¯æ¶ˆè´¹ï¼Œæ‰€ä»¥ç†è®ºä¸Šä¸ä¼šå‡ºç°æ¶ˆæ¯ä¸¢å¤±çš„æƒ…å†µï¼Œåªæ˜¯æ¶ˆè´¹å¤±è´¥ä»…ä»…æ‰“å°æ—¥å¿—ä¸å‹å¥½ï¼Œéœ€è¦å‚è€ƒ 2ã€‚ä¼˜é›…çš„å¼‚å¸¸å¤„ç† è¿›è¡Œå¤„ç†</li><li>åœ¨æŸäº›æ—©ç‰ˆæœ¬çš„ spring kafkaï¼ˆæ¯”å¦‚ 2.2.4ï¼‰ä¸­ï¼Œæ¶ˆè´¹å¤±è´¥ä¼šç›´æ¥æäº¤ offsetï¼›æˆ–è€…å½“å‰è¿™æ¡æ¶ˆæ¯æ¶ˆè´¹å¤±è´¥ï¼Œä¸‹ä¸€æ¡æ¶ˆæ¯æ¶ˆè´¹æˆåŠŸåä¼šæäº¤ä¸‹ä¸€æ¡æ¶ˆæ¯çš„ offsetï¼Œå¯¼è‡´æ¶ˆæ¯ä¸¢å¤±ï¼›é‡åˆ°è¿™ç§æƒ…å†µï¼Œä»¥ä¸‹æ“ä½œæ˜¯ç›¸å¯¹âœ…çš„<ul><li>autoCommit &#x3D; false</li><li>ackMode &#x3D; æ‰‹åŠ¨&#x2F;æ‰‹åŠ¨ç«‹å³</li><li>è®¾ç½®é”™è¯¯å¤„ç†å™¨ SeekToCurrentErrorHandler æ›´æ–°æœ¬åœ°å†…å­˜æ‹‰å– offset çš„å€¼ä¸ºæ¶ˆè´¹å¤±è´¥çš„ record çš„ offset å€¼ï¼Œä¸‹æ¬¡ poll å‘¨æœŸå°±ä¼šå»é‡æ–°æ‹‰å–æœªæäº¤çš„ offsetã€‚é‡è¯• DeadLetterPublishRecover å¤šæ¬¡æ¶ˆè´¹å¤±è´¥ï¼š å…¥æ­»ä¿¡é˜Ÿåˆ—ï¼Œå¯è®¾ç½® Topic åç§°ï¼Œé»˜è®¤åˆ° [target_topic]ã€‚DLT</li></ul></li></ul><p><img data-src="/images/message/kafka/08.png" alt="img"></p>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt; Spring kafka ç‰ˆæœ¬ 2.8.4&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;ç½‘ç«™èµ„æ–™&quot;&gt;&lt;a href=&quot;#ç½‘ç«™èµ„æ–™&quot; class=&quot;headerlink&quot; title=&quot;ç½‘ç«™èµ„æ–™&quot;&gt;&lt;/a&gt;ç½‘ç«™èµ„æ–™&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://docs.spring.io/spring-kafka/docs/2.8.11/reference/html/#message-listener-container&quot;&gt;spring-kafka(2.8.11)&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.baeldung.com/?s=spring+kafka&quot;&gt;baeldung-spring-kafka&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="https://taeyang0126.github.io/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://taeyang0126.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="https://taeyang0126.github.io/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    <category term="ä¸­é—´ä»¶" scheme="https://taeyang0126.github.io/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    <category term="kafka" scheme="https://taeyang0126.github.io/tags/kafka/"/>
    
    <category term="spring" scheme="https://taeyang0126.github.io/tags/spring/"/>
    
  </entry>
  
  <entry>
    <title>kafka-consumer</title>
    <link href="https://taeyang0126.github.io/2025/02/09/xiao-xi-dui-lie/kafka/consumer/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/xiao-xi-dui-lie/kafka/consumer/posts/undefined/</id>
    <published>2025-02-09T11:55:22.000Z</published>
    <updated>2025-02-10T14:16:05.825Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é‡è¦å‚æ•°"><a href="#é‡è¦å‚æ•°" class="headerlink" title="é‡è¦å‚æ•°"></a>é‡è¦å‚æ•°</h2><table><thead><tr><th align="left">é…ç½®é¡¹</th><th align="left">é»˜è®¤å€¼</th><th align="left">è¯´æ˜</th><th align="left">ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="left"><strong>bootstrap.servers</strong></td><td align="left"></td><td align="left">Kafka broker åœ°å€</td><td align="left"><code>*properties*.put(ProducerConfig.*BOOTSTRAP_SERVERS_CONFIG*, *brokerList*);</code></td></tr><tr><td align="left"><strong>key.deserializer</strong></td><td align="left"></td><td align="left">Key ååºåˆ—åŒ– å®ç° Deserializer æ¥å£</td><td align="left"><code>*properties*.put(ConsumerConfig.*KEY_DESERIALIZER_CLASS_CONFIG*, StringDeserializer.class.getName());</code></td></tr><tr><td align="left"><strong>value.deserializer</strong></td><td align="left"></td><td align="left">Value ååºåˆ—åŒ–å®ç° Deserializer æ¥å£</td><td align="left"><code>*properties*.put(ConsumerConfig.*VALUE_DESERIALIZER_CLASS_CONFIG*, StringDeserializer.class.getName());</code></td></tr><tr><td align="left"><strong>group.id</strong></td><td align="left"></td><td align="left">æ¶ˆè´¹ç»„ ID</td><td align="left"><code>*properties*.put(ConsumerConfig.*GROUP_ID_CONFIG*, *groupId*);</code></td></tr><tr><td align="left"><strong>enable.auto.commit</strong></td><td align="left">true</td><td align="left">æ˜¯å¦å¼€å¯è‡ªåŠ¨æäº¤é»˜è®¤ä¸º true</td><td align="left"><code>*properties*.put(ConsumerConfig.*ENABLE_AUTO_COMMIT_CONFIG*, false);</code></td></tr><tr><td align="left"><strong>auto.commit.interval.ms</strong></td><td align="left">5000</td><td align="left">è‡ªåŠ¨æäº¤é—´éš”æ—¶é—´ï¼Œåªæœ‰åœ¨ enable.auto.commit è®¾ç½®ä¸º true æ—¶ç”Ÿæ•ˆï¼Œé»˜è®¤æ˜¯ 5s! ! offset æäº¤æ—¶é—´ç‚¹&#x3D;maxï¼ˆå•æ¬¡ poll æ—¶é—´ï¼Œ auto.commit.interval.msï¼‰</td><td align="left"><code>*properties*.put(ConsumerConfig.*AUTO_COMMIT_INTERVAL_MS_CONFIG*, 5000);</code></td></tr><tr><td align="left"><strong>auto.offset.reset</strong></td><td align="left">latest</td><td align="left">ä»æœ€æ—©çš„æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ é»˜è®¤æ˜¯ latestï¼Œæ­¤å‚æ•°è¡¨ç¤ºå½“å‰æ¶ˆè´¹ç»„åœ¨æ²¡æœ‰ offset çš„æƒ…å†µä¸‹ï¼Œä»å“ªé‡Œå¼€å§‹æ¶ˆè´¹è¿™é‡Œçš„æ²¡æœ‰ offset æŒ‡çš„æ˜¯æ¶ˆè´¹ç»„ç¬¬ä¸€æ¬¡æ¶ˆè´¹æˆ–è€…_consumer_offsets ä¸»é¢˜ä¸­æ²¡æœ‰å½“å‰æ¶ˆè´¹ç»„çš„ offset! ! å»ºè®®è®¾ç½®ä¸º earliestï¼Œå¦åˆ™æ‰©åˆ†åŒºæ—¶ï¼Œæ–°å¢åŠ çš„æ¶ˆè´¹è€…å¯èƒ½ä¸¢å¤±æ–°åˆ†åŒºäº§ç”Ÿçš„æ•°æ®ï¼›è®¾ç½®ä¸º earliest æ—¶ä¸šåŠ¡ä¸Šéœ€è¦åšå¥½å¹‚ç­‰å¤„ç†</td><td align="left"><code>*properties*.put(ConsumerConfig.*AUTO_OFFSET_RESET_CONFIG*, &quot;earliest&quot;);</code></td></tr><tr><td align="left"><strong>max.poll.records</strong></td><td align="left">500</td><td align="left">ä¸€æ¬¡æ‹‰å–è¯·æ±‚ä¸­æ‹‰å–çš„æœ€å¤§æ¶ˆæ¯æ•°é‡ é»˜è®¤æ˜¯ 500 æ¡! ! å»ºè®®è°ƒæ•´æ­¤å‚æ•°ï¼Œä¸šåŠ¡å¤„ç†æ—¶é—´è¶…è¿‡ max.poll.interval.ms ä¼šå¯¼è‡´ rebalanceï¼Œæ‰€ä»¥è¿™é‡Œçš„å•æ¬¡æ‹‰å–çš„æ•°æ®é‡éœ€è¦è€ƒè™‘å¤„ç†æ—¶é—´ï¼›max.poll.records &lt; max.poll.interval.ms &#x2F; å•æ¡æ¶ˆæ¯å¤„ç†æ—¶é—´</td><td align="left"><code>*properties*.put(ConsumerConfig.*MAX_POLL_RECORDS_CONFIG*, 500);</code></td></tr><tr><td align="left"><strong>max.poll.interval.ms</strong></td><td align="left">5 * 60 * 1000</td><td align="left">æ‹‰å–æ¶ˆæ¯çº¿ç¨‹æœ€é•¿ç©ºé—²æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 5 åˆ†é’Ÿï¼Œè‹¥è¶…è¿‡è¿™ä¸ªé—´éš”è¿˜æ²¡æœ‰å‘èµ· poll è¯·æ±‚ï¼Œæ¶ˆè´¹è€…ä¼šè®¤ä¸ºæ¶ˆè´¹è€…æŒ‚æ‰äº†ï¼Œç„¶åè§¦å‘ rebalanceå› ä¸º poll æ–¹æ³•è¿˜æ¶‰åŠä¸šåŠ¡å¤„ç†ï¼Œæ‰€ä»¥å¦‚æœä¸šåŠ¡å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œé‚£ä¹ˆéœ€è¦é€‚å½“å¢å¤§æ­¤å€¼ï¼Œæˆ–è€…å‡å°‘å•æ¬¡æ‹‰å–çš„æ¶ˆæ¯æ•°é‡! ! å¦‚æœä¸šåŠ¡å¤„ç†æ—¶é—´è¾ƒé•¿ï¼Œä¸€å®šè¦å¢åŠ æ­¤é…ç½®ï¼Œå¦åˆ™ä¼šå¯¼è‡´ rebalance</td><td align="left"><code>*properties*.put(ConsumerConfig.*MAX_POLL_INTERVAL_MS_CONFIG*, 5 * 60 * 1000);</code></td></tr><tr><td align="left"><strong>heartbeat.interval.ms</strong></td><td align="left">3 * 1000</td><td align="left">é…ç½®æ¶ˆè´¹è€…çš„æœ€å¤§å¿ƒè·³é—´éš”æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 3så¿ƒè·³é—´éš”æ—¶é—´æ˜¯æŒ‡æ¶ˆè´¹è€…å‘é€å¿ƒè·³ç»™ broker çš„æ—¶é—´é—´éš”å¿…é¡»æ¯” session.timeout.ms å°ï¼Œä¸€èˆ¬æ˜¯ session.timeout.ms çš„ 1&#x2F;3</td><td align="left"><code>*properties*.put(ConsumerConfig.*HEARTBEAT_INTERVAL_MS_CONFIG*, 3 * 1000);</code></td></tr><tr><td align="left"><strong>session.timeout.ms</strong></td><td align="left">10 * 1000</td><td align="left">é…ç½®æ¶ˆè´¹è€…ä¸ broker çš„ä¼šè¯è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 10sè¶…è¿‡æ­¤æ—¶é—´ broker æ²¡æœ‰æ”¶åˆ°æ¶ˆè´¹è€…çš„å¿ƒè·³ï¼Œé‚£ä¹ˆ broker ä¼šè®¤ä¸ºæ¶ˆè´¹è€…æŒ‚æ‰äº†ï¼Œç„¶åè§¦å‘ rebalance! ! æ­¤å‚æ•°ä¸èƒ½é…ç½®è¿‡å¤§ï¼ï¼</td><td align="left"></td></tr><tr><td align="left">fetch.max.bytes</td><td align="left">50 * 1024 * 1024</td><td align="left">ä¸€æ¬¡è¯·æ±‚ä» kafka ä¸­æ‹‰å–çš„æœ€å¤§æ•°æ®é‡ï¼Œé»˜è®¤æ˜¯ 50Mï¼Œæ­¤å‚æ•°ä¸æ˜¯ç»å¯¹çš„æœ€å¤§å€¼ï¼Œå¦‚æœä¸€æ¡æ¶ˆæ¯çš„å¤§å°æ¯”æ­¤å‚æ•°è¿˜å¤§ï¼Œé‚£ä¹ˆä¸€æ¬¡è¯·æ±‚ä¹Ÿä¼šæ‹‰å–è¿™æ¡æ¶ˆæ¯</td><td align="left"><code>*properties*.put(ConsumerConfig.*FETCH_MAX_BYTES_CONFIG*, ConsumerConfig.*DEFAULT_FETCH_MAX_BYTES*);</code></td></tr><tr><td align="left">max.partition.fetch.bytes</td><td align="left">1 * 1024 * 1024</td><td align="left">ä¸€æ¬¡è¯·æ±‚ä» kafka ä¸­æ‹‰å–å•ä¸ªåˆ†åŒºçš„æœ€å¤§æ•°æ®é‡ï¼Œé»˜è®¤æ˜¯ 1M</td><td align="left"><code>*properties*.put(ConsumerConfig.*MAX_PARTITION_FETCH_BYTES_CONFIG*, ConsumerConfig.*DEFAULT_MAX_PARTITION_FETCH_BYTES*);</code></td></tr><tr><td align="left">connections.max.idle.ms</td><td align="left">9 * 60 * 1000</td><td align="left">æŒ‡å®šå¤šä¹…ä¹‹åå…³é—­é—²ç½®çš„è¿æ¥ï¼Œé»˜è®¤æ˜¯ 9 åˆ†é’Ÿ</td><td align="left"><code>*properties*.put(ConsumerConfig.*CONNECTIONS_MAX_IDLE_MS_CONFIG*, 9 * 60 * 1000);</code></td></tr><tr><td align="left">receive.buffer.bytes</td><td align="left">64 * 1024</td><td align="left">è®¾ç½® socket æ¥æ”¶æ¶ˆæ¯ç¼“å†²åŒºï¼ˆSO_RCVBUFï¼‰çš„å¤§å°ï¼Œé»˜è®¤æ˜¯ 64KBï¼Œå¦‚æœè®¾ç½®ä¸º -1ï¼Œé‚£ä¹ˆä½¿ç”¨æ“ä½œç³»ç»Ÿçš„é»˜è®¤å€¼ï¼Œå¦‚æœ Consumer ä¸ Kafka å¤„äºä¸åŒçš„æ•°æ®ä¸­å¿ƒï¼Œé‚£ä¹ˆå¯ä»¥é€‚å½“å¢å¤§æ­¤å€¼</td><td align="left"><code>*properties*.put(ConsumerConfig.*RECEIVE_BUFFER_CONFIG*, 64 * 1024);</code></td></tr><tr><td align="left">send.buffer.bytes</td><td align="left">128 * 1024</td><td align="left">è®¾ç½® socket å‘é€æ¶ˆæ¯ç¼“å†²åŒºï¼ˆSO_SNDBUFï¼‰çš„å¤§å°ï¼Œé»˜è®¤æ˜¯ 128KBï¼Œå¦‚æœè®¾ç½®ä¸º -1ï¼Œé‚£ä¹ˆä½¿ç”¨æ“ä½œç³»ç»Ÿçš„é»˜è®¤å€¼ï¼Œå¦‚æœ Consumer ä¸ Kafka å¤„äºä¸åŒçš„æ•°æ®ä¸­å¿ƒï¼Œé‚£ä¹ˆå¯ä»¥é€‚å½“å¢å¤§æ­¤å€¼</td><td align="left"><code>*properties*.put(ConsumerConfig.*SEND_BUFFER_CONFIG*, 128 * 1024);</code></td></tr><tr><td align="left">request.timeout.ms</td><td align="left">30 * 1000</td><td align="left">é…ç½® consumer ç­‰å¾…è¯·æ±‚å“åº”çš„æœ€å¤§æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 30s</td><td align="left"><code>*properties*.put(ConsumerConfig.*REQUEST_TIMEOUT_MS_CONFIG*, 30 * 1000);</code></td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, brokerList);</span><br><span class="line">    properties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());</span><br><span class="line">    properties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());</span><br><span class="line">    properties.put(ConsumerConfig.GROUP_ID_CONFIG, groupId);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æäº¤ï¼Œé»˜è®¤æ˜¯è‡ªåŠ¨æäº¤ï¼Œé—´éš”æ˜¯5s</span></span><br><span class="line">    <span class="comment">// properties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, true);</span></span><br><span class="line">    <span class="comment">// properties.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, 5000);</span></span><br><span class="line">    <span class="comment">// è°ƒæ•´ä¸ºæ‰‹åŠ¨æäº¤</span></span><br><span class="line">    properties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, <span class="literal">false</span>);</span><br><span class="line">    <span class="comment">// è‡ªåŠ¨æäº¤é—´éš”æ—¶é—´ï¼Œåªæœ‰åœ¨enable.auto.commitè®¾ç½®ä¸ºtrueæ—¶ç”Ÿæ•ˆï¼Œé»˜è®¤æ˜¯5s</span></span><br><span class="line">    properties.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, <span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä»æœ€æ—©çš„æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ é»˜è®¤æ˜¯latestï¼Œæ­¤å‚æ•°è¡¨ç¤ºå½“å‰æ¶ˆè´¹ç»„åœ¨æ²¡æœ‰offsetçš„æƒ…å†µä¸‹ï¼Œä»å“ªé‡Œå¼€å§‹æ¶ˆè´¹</span></span><br><span class="line">    <span class="comment">// è¿™é‡Œçš„æ²¡æœ‰offsetæŒ‡çš„æ˜¯æ¶ˆè´¹ç»„ç¬¬ä¸€æ¬¡æ¶ˆè´¹æˆ–è€…_consumer_offsetsä¸»é¢˜ä¸­æ²¡æœ‰å½“å‰æ¶ˆè´¹ç»„çš„offset</span></span><br><span class="line">    properties.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, <span class="string">&quot;earliest&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸€æ¬¡è¯·æ±‚ä»kafkaä¸­æ‹‰å–çš„æœ€å¤§æ•°æ®é‡ï¼Œé»˜è®¤æ˜¯50Mï¼Œæ­¤å‚æ•°ä¸æ˜¯ç»å¯¹çš„æœ€å¤§å€¼ï¼Œå¦‚æœä¸€æ¡æ¶ˆæ¯çš„å¤§å°æ¯”æ­¤å‚æ•°è¿˜å¤§ï¼Œé‚£ä¹ˆä¸€æ¬¡è¯·æ±‚ä¹Ÿä¼šæ‹‰å–è¿™æ¡æ¶ˆæ¯</span></span><br><span class="line">    properties.put(ConsumerConfig.FETCH_MAX_BYTES_CONFIG, ConsumerConfig.DEFAULT_FETCH_MAX_BYTES);</span><br><span class="line">    <span class="comment">// ä¸€æ¬¡è¯·æ±‚ä»kafkaä¸­æ‹‰å–å•ä¸ªåˆ†åŒºçš„æœ€å¤§æ•°æ®é‡ï¼Œé»˜è®¤æ˜¯1M</span></span><br><span class="line">    properties.put(ConsumerConfig.MAX_PARTITION_FETCH_BYTES_CONFIG, ConsumerConfig.DEFAULT_MAX_PARTITION_FETCH_BYTES);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä¸€æ¬¡æ‹‰å–è¯·æ±‚ä¸­æ‹‰å–çš„æœ€å¤§æ¶ˆæ¯æ•°é‡ é»˜è®¤æ˜¯500æ¡</span></span><br><span class="line">    properties.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, <span class="number">500</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æŒ‡å®šå¤šä¹…ä¹‹åå…³é—­é—²ç½®çš„è¿æ¥ï¼Œé»˜è®¤æ˜¯9åˆ†é’Ÿ</span></span><br><span class="line">    properties.put(ConsumerConfig.CONNECTIONS_MAX_IDLE_MS_CONFIG, <span class="number">9</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è®¾ç½®socketæ¥æ”¶æ¶ˆæ¯ç¼“å†²åŒº(SO_RCVBUF)çš„å¤§å°ï¼Œé»˜è®¤æ˜¯64KBï¼Œå¦‚æœè®¾ç½®ä¸º-1ï¼Œé‚£ä¹ˆä½¿ç”¨æ“ä½œç³»ç»Ÿçš„é»˜è®¤å€¼ï¼Œå¦‚æœConsumerä¸Kafkaå¤„äºä¸åŒçš„æ•°æ®ä¸­å¿ƒï¼Œé‚£ä¹ˆå¯ä»¥é€‚å½“å¢å¤§æ­¤å€¼</span></span><br><span class="line">    properties.put(ConsumerConfig.RECEIVE_BUFFER_CONFIG, <span class="number">64</span> * <span class="number">1024</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®socketå‘é€æ¶ˆæ¯ç¼“å†²åŒº(SO_SNDBUF)çš„å¤§å°ï¼Œé»˜è®¤æ˜¯128KBï¼Œå¦‚æœè®¾ç½®ä¸º-1ï¼Œé‚£ä¹ˆä½¿ç”¨æ“ä½œç³»ç»Ÿçš„é»˜è®¤å€¼ï¼Œå¦‚æœConsumerä¸Kafkaå¤„äºä¸åŒçš„æ•°æ®ä¸­å¿ƒï¼Œé‚£ä¹ˆå¯ä»¥é€‚å½“å¢å¤§æ­¤å€¼</span></span><br><span class="line">    properties.put(ConsumerConfig.SEND_BUFFER_CONFIG, <span class="number">128</span> * <span class="number">1024</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…ç½®consumerç­‰å¾…è¯·æ±‚å“åº”çš„æœ€å¤§æ—¶é—´ï¼Œé»˜è®¤æ˜¯30s</span></span><br><span class="line">    properties.put(ConsumerConfig.REQUEST_TIMEOUT_MS_CONFIG, <span class="number">30</span> * <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// todo-wl é…ç½®æ¶ˆè´¹è€…çš„äº‹åŠ¡éš”ç¦»çº§åˆ«</span></span><br><span class="line">    <span class="comment">// properties.put(ConsumerConfig.ISOLATION_LEVEL_CONFIG, &quot;read_committed&quot;);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// !! é…ç½®æ¶ˆè´¹è€…çš„æœ€å¤§å¿ƒè·³é—´éš”æ—¶é—´ï¼Œé»˜è®¤æ˜¯3s</span></span><br><span class="line">    <span class="comment">// å¿ƒè·³é—´éš”æ—¶é—´æ˜¯æŒ‡æ¶ˆè´¹è€…å‘é€å¿ƒè·³ç»™brokerçš„æ—¶é—´é—´éš”</span></span><br><span class="line">    <span class="comment">// å¿…é¡»æ¯”session.timeout.mså°ï¼Œä¸€èˆ¬æ˜¯session.timeout.msçš„1/3</span></span><br><span class="line">    properties.put(ConsumerConfig.HEARTBEAT_INTERVAL_MS_CONFIG, <span class="number">3</span> * <span class="number">1000</span>);</span><br><span class="line">    <span class="comment">// !! é…ç½®æ¶ˆè´¹è€…ä¸brokerçš„ä¼šè¯è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯10s</span></span><br><span class="line">    <span class="comment">// è¶…è¿‡æ­¤æ—¶é—´brokeræ²¡æœ‰æ”¶åˆ°æ¶ˆè´¹è€…çš„å¿ƒè·³ï¼Œé‚£ä¹ˆbrokerä¼šè®¤ä¸ºæ¶ˆè´¹è€…æŒ‚æ‰äº†ï¼Œç„¶åè§¦å‘rebalance</span></span><br><span class="line">    properties.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, <span class="number">10</span> * <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// !! æ‹‰å–æ¶ˆæ¯çº¿ç¨‹æœ€é•¿ç©ºé—²æ—¶é—´ï¼Œé»˜è®¤æ˜¯5åˆ†é’Ÿï¼Œè‹¥è¶…è¿‡è¿™ä¸ªé—´éš”è¿˜æ²¡æœ‰å‘èµ·pollè¯·æ±‚ï¼Œæ¶ˆè´¹è€…ä¼šè®¤ä¸ºæ¶ˆè´¹è€…æŒ‚æ‰äº†ï¼Œç„¶åè§¦å‘rebalance</span></span><br><span class="line">    <span class="comment">// å› ä¸ºpollæ–¹æ³•è¿˜æ¶‰åŠä¸šåŠ¡å¤„ç†ï¼Œæ‰€ä»¥å¦‚æœä¸šåŠ¡å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œé‚£ä¹ˆéœ€è¦é€‚å½“å¢å¤§æ­¤å€¼ï¼Œæˆ–è€…å‡å°‘å•æ¬¡æ‹‰å–çš„æ¶ˆæ¯æ•°é‡</span></span><br><span class="line">    properties.put(ConsumerConfig.MAX_POLL_INTERVAL_MS_CONFIG, <span class="number">5</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="Kafka-rebalance"><a href="#Kafka-rebalance" class="headerlink" title="Kafka-rebalance"></a>Kafka-rebalance</h2><ul><li><a href="https://redpanda.com/guides/kafka-performance/kafka-rebalancing">kafka-rebalancing</a></li><li>å‘ç”Ÿå†å¹³è¡¡çš„åœºæ™¯<ul><li>æ¶ˆè´¹è€…åŠ å…¥æˆ–ç¦»å¼€</li><li>æ¶ˆè´¹è€…é‡åˆ°æš‚æ—¶æ•…éšœæˆ–ç½‘ç»œä¸­æ–­</li><li>æ¶ˆè´¹è€…é—²ç½®æ—¶é—´è¿‡é•¿</li><li>æ‰©å¤§äº†ä¸»é¢˜åˆ†åŒº</li></ul></li><li>å†å¹³è¡¡çš„å‰¯ä½œç”¨<ul><li>å»¶è¿Ÿå¢åŠ </li><li>ååé‡é™ä½</li><li>èµ„æºä½¿ç”¨é‡å¢åŠ </li><li>æ½œåœ¨çš„æ•°æ®é‡å¤å’Œä¸¢å¤±</li><li>å¤æ‚æ€§å¢åŠ </li></ul></li><li>å‡å°‘å†å¹³è¡¡çš„æªæ–½<ul><li>å¢åŠ ä¼šè¯è¶…æ—¶æ—¶é—´ session.timeout.msï¼Œæ­¤å‚æ•°ä¸èƒ½è®¾ç½®å¤ªé«˜ï¼Œä¸ç„¶å¯¼è‡´æ¶ˆè´¹è€…é•¿æ—¶é—´ä¸æ´»åŠ¨è¿›è€Œå¯¼è‡´æ¶ˆæ¯å †ç§¯ï¼›heartbeat.interval.ms æ­¤å‚æ•°</li><li>â€‹       éœ€è¦å°äº session.timeout.msï¼Œä¸€èˆ¬æ˜¯ 1&#x2F;3</li><li>å‡å°‘æ¯ä¸ªä¸»é¢˜çš„åˆ†åŒºï¼Œæ¯ä¸ªä¸»é¢˜çš„åˆ†åŒºè¿‡å¤šä¼šå¢åŠ é‡æ–°å¹³è¡¡çš„é¢‘ç‡</li><li>å¢åŠ è½®è®­é—´éš”æ—¶é—´ï¼Œmax.poll.interval.ms é…ç½®è§„å®šäº†æ¶ˆè´¹è€…è¢«è§†ä¸ºéæ´»åŠ¨å¹¶ä»ç»„ä¸­ç§»é™¤å‰çš„æœ€é•¿ç©ºé—²æ—¶é—´ï¼Œå¢åŠ æ­¤æ—¶é—´åŠ©äºé¿å…æ¶ˆè´¹è€…ç»„çš„é¢‘ç¹æ›´æ”¹</li></ul></li><li>å¢é‡åˆä½œå†å¹³è¡¡<ul><li>Kafka 2.4 ä¸­å¼•å…¥äº†å¢é‡åˆä½œå†å¹³è¡¡åè®®ï¼Œä»¥æœ€å¤§ç¨‹åº¦åœ°å‡å°‘ Kafka å†å¹³è¡¡é€ æˆçš„ä¸­æ–­ã€‚åœ¨ä¼ ç»Ÿçš„å†å¹³è¡¡ä¸­ï¼Œç»„ä¸­çš„æ‰€æœ‰æ¶ˆè´¹è€…åœ¨é‡æ–°å¹³è¡¡è¿‡ç¨‹ä¸­åœæ­¢ä½¿ç”¨æ•°æ®ï¼Œé€šå¸¸ç§°ä¸ºâ€œåœæ­¢ä¸–ç•Œæ•ˆåº”â€ã€‚è¿™ä¼šå¯¼è‡´æ•°æ®å¤„ç†å»¶è¿Ÿå’Œä¸­æ–­ã€‚</li><li>å¢é‡åˆä½œå†å¹³è¡¡åè®®å°†å†å¹³è¡¡æ‹†åˆ†ä¸ºæ›´å°çš„å­ä»»åŠ¡ï¼Œæ¶ˆè´¹è€…åœ¨è¿™äº›å­ä»»åŠ¡å®Œæˆåç»§ç»­ä½¿ç”¨æ•°æ®ã€‚å› æ­¤ï¼Œé‡æ–°å¹³è¡¡å‘ç”Ÿå¾—æ›´å¿«ï¼Œå¯¹æ•°æ®å¤„ç†çš„ä¸­æ–­æ›´å°‘ã€‚</li><li>è¯¥åè®®è¿˜ä¸ºå†å¹³è¡¡è¿‡ç¨‹æä¾›äº†æ›´ç²¾ç»†çš„æ§åˆ¶ã€‚ä¾‹å¦‚ï¼Œå®ƒå…è®¸ä½¿ç”¨è€…æ ¹æ®å…¶å½“å‰è´Ÿè½½å’Œå®¹é‡åå•†ä»–ä»¬å°†ä½¿ç”¨çš„ç‰¹å®šåˆ†åŒºé›†ã€‚è¿™å¯ä»¥é˜²æ­¢å•ä¸ªä½¿ç”¨è€…çš„è¿‡è½½ï¼Œå¹¶ç¡®ä¿ä»¥æ›´å¹³è¡¡çš„æ–¹å¼åˆ†é…åˆ†åŒºã€‚</li></ul></li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;é‡è¦å‚æ•°&quot;&gt;&lt;a href=&quot;#é‡è¦å‚æ•°&quot; class=&quot;headerlink&quot; title=&quot;é‡è¦å‚æ•°&quot;&gt;&lt;/a&gt;é‡è¦å‚æ•°&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;left&quot;&gt;é…ç½®é¡¹&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;é»˜è®¤å€¼&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;è¯´æ˜&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;ç¤ºä¾‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;bootstrap.servers&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;Kafka broker åœ°å€&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*BOOTSTRAP_SERVERS_CONFIG*, *brokerList*);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;key.deserializer&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;Key ååºåˆ—åŒ– å®ç° Deserializer æ¥å£&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ConsumerConfig.*KEY_DESERIALIZER_CLASS_CONFIG*, StringDeserializer.class.getName());&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;value.deserializer&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;Value ååºåˆ—åŒ–å®ç° Deserializer æ¥å£&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ConsumerConfig.*VALUE_DESERIALIZER_CLASS_CONFIG*, StringDeserializer.class.getName());&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;group.id&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;æ¶ˆè´¹ç»„ ID&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ConsumerConfig.*GROUP_ID_CONFIG*, *groupId*);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;enable.auto.commit&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;true&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;æ˜¯å¦å¼€å¯è‡ªåŠ¨æäº¤é»˜è®¤ä¸º true&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ConsumerConfig.*ENABLE_AUTO_COMMIT_CONFIG*, false);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;auto.commit.interval.ms&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;5000&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;è‡ªåŠ¨æäº¤é—´éš”æ—¶é—´ï¼Œåªæœ‰åœ¨ enable.auto.commit è®¾ç½®ä¸º true æ—¶ç”Ÿæ•ˆï¼Œé»˜è®¤æ˜¯ 5s! ! offset æäº¤æ—¶é—´ç‚¹&amp;#x3D;maxï¼ˆå•æ¬¡ poll æ—¶é—´ï¼Œ auto.commit.interval.msï¼‰&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ConsumerConfig.*AUTO_COMMIT_INTERVAL_MS_CONFIG*, 5000);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;auto.offset.reset&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;latest&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;ä»æœ€æ—©çš„æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ é»˜è®¤æ˜¯ latestï¼Œæ­¤å‚æ•°è¡¨ç¤ºå½“å‰æ¶ˆè´¹ç»„åœ¨æ²¡æœ‰ offset çš„æƒ…å†µä¸‹ï¼Œä»å“ªé‡Œå¼€å§‹æ¶ˆè´¹è¿™é‡Œçš„æ²¡æœ‰ offset æŒ‡çš„æ˜¯æ¶ˆè´¹ç»„ç¬¬ä¸€æ¬¡æ¶ˆè´¹æˆ–è€…_consumer_offsets ä¸»é¢˜ä¸­æ²¡æœ‰å½“å‰æ¶ˆè´¹ç»„çš„ offset! ! å»ºè®®è®¾ç½®ä¸º earliestï¼Œå¦åˆ™æ‰©åˆ†åŒºæ—¶ï¼Œæ–°å¢åŠ çš„æ¶ˆè´¹è€…å¯èƒ½ä¸¢å¤±æ–°åˆ†åŒºäº§ç”Ÿçš„æ•°æ®ï¼›è®¾ç½®ä¸º earliest æ—¶ä¸šåŠ¡ä¸Šéœ€è¦åšå¥½å¹‚ç­‰å¤„ç†&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ConsumerConfig.*AUTO_OFFSET_RESET_CONFIG*, &amp;quot;earliest&amp;quot;);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;max.poll.records&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;500&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;ä¸€æ¬¡æ‹‰å–è¯·æ±‚ä¸­æ‹‰å–çš„æœ€å¤§æ¶ˆæ¯æ•°é‡ é»˜è®¤æ˜¯ 500 æ¡! ! å»ºè®®è°ƒæ•´æ­¤å‚æ•°ï¼Œä¸šåŠ¡å¤„ç†æ—¶é—´è¶…è¿‡ max.poll.interval.ms ä¼šå¯¼è‡´ rebalanceï¼Œæ‰€ä»¥è¿™é‡Œçš„å•æ¬¡æ‹‰å–çš„æ•°æ®é‡éœ€è¦è€ƒè™‘å¤„ç†æ—¶é—´ï¼›max.poll.records &amp;lt; max.poll.interval.ms &amp;#x2F; å•æ¡æ¶ˆæ¯å¤„ç†æ—¶é—´&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ConsumerConfig.*MAX_POLL_RECORDS_CONFIG*, 500);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;max.poll.interval.ms&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;5 * 60 * 1000&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;æ‹‰å–æ¶ˆæ¯çº¿ç¨‹æœ€é•¿ç©ºé—²æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 5 åˆ†é’Ÿï¼Œè‹¥è¶…è¿‡è¿™ä¸ªé—´éš”è¿˜æ²¡æœ‰å‘èµ· poll è¯·æ±‚ï¼Œæ¶ˆè´¹è€…ä¼šè®¤ä¸ºæ¶ˆè´¹è€…æŒ‚æ‰äº†ï¼Œç„¶åè§¦å‘ rebalanceå› ä¸º poll æ–¹æ³•è¿˜æ¶‰åŠä¸šåŠ¡å¤„ç†ï¼Œæ‰€ä»¥å¦‚æœä¸šåŠ¡å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œé‚£ä¹ˆéœ€è¦é€‚å½“å¢å¤§æ­¤å€¼ï¼Œæˆ–è€…å‡å°‘å•æ¬¡æ‹‰å–çš„æ¶ˆæ¯æ•°é‡! ! å¦‚æœä¸šåŠ¡å¤„ç†æ—¶é—´è¾ƒé•¿ï¼Œä¸€å®šè¦å¢åŠ æ­¤é…ç½®ï¼Œå¦åˆ™ä¼šå¯¼è‡´ rebalance&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ConsumerConfig.*MAX_POLL_INTERVAL_MS_CONFIG*, 5 * 60 * 1000);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;heartbeat.interval.ms&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;3 * 1000&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;é…ç½®æ¶ˆè´¹è€…çš„æœ€å¤§å¿ƒè·³é—´éš”æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 3så¿ƒè·³é—´éš”æ—¶é—´æ˜¯æŒ‡æ¶ˆè´¹è€…å‘é€å¿ƒè·³ç»™ broker çš„æ—¶é—´é—´éš”å¿…é¡»æ¯” session.timeout.ms å°ï¼Œä¸€èˆ¬æ˜¯ session.timeout.ms çš„ 1&amp;#x2F;3&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ConsumerConfig.*HEARTBEAT_INTERVAL_MS_CONFIG*, 3 * 1000);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;session.timeout.ms&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;10 * 1000&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;é…ç½®æ¶ˆè´¹è€…ä¸ broker çš„ä¼šè¯è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 10sè¶…è¿‡æ­¤æ—¶é—´ broker æ²¡æœ‰æ”¶åˆ°æ¶ˆè´¹è€…çš„å¿ƒè·³ï¼Œé‚£ä¹ˆ broker ä¼šè®¤ä¸ºæ¶ˆè´¹è€…æŒ‚æ‰äº†ï¼Œç„¶åè§¦å‘ rebalance! ! æ­¤å‚æ•°ä¸èƒ½é…ç½®è¿‡å¤§ï¼ï¼&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;fetch.max.bytes&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;50 * 1024 * 1024&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;ä¸€æ¬¡è¯·æ±‚ä» kafka ä¸­æ‹‰å–çš„æœ€å¤§æ•°æ®é‡ï¼Œé»˜è®¤æ˜¯ 50Mï¼Œæ­¤å‚æ•°ä¸æ˜¯ç»å¯¹çš„æœ€å¤§å€¼ï¼Œå¦‚æœä¸€æ¡æ¶ˆæ¯çš„å¤§å°æ¯”æ­¤å‚æ•°è¿˜å¤§ï¼Œé‚£ä¹ˆä¸€æ¬¡è¯·æ±‚ä¹Ÿä¼šæ‹‰å–è¿™æ¡æ¶ˆæ¯&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ConsumerConfig.*FETCH_MAX_BYTES_CONFIG*, ConsumerConfig.*DEFAULT_FETCH_MAX_BYTES*);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;max.partition.fetch.bytes&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;1 * 1024 * 1024&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;ä¸€æ¬¡è¯·æ±‚ä» kafka ä¸­æ‹‰å–å•ä¸ªåˆ†åŒºçš„æœ€å¤§æ•°æ®é‡ï¼Œé»˜è®¤æ˜¯ 1M&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ConsumerConfig.*MAX_PARTITION_FETCH_BYTES_CONFIG*, ConsumerConfig.*DEFAULT_MAX_PARTITION_FETCH_BYTES*);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;connections.max.idle.ms&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;9 * 60 * 1000&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;æŒ‡å®šå¤šä¹…ä¹‹åå…³é—­é—²ç½®çš„è¿æ¥ï¼Œé»˜è®¤æ˜¯ 9 åˆ†é’Ÿ&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ConsumerConfig.*CONNECTIONS_MAX_IDLE_MS_CONFIG*, 9 * 60 * 1000);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;receive.buffer.bytes&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;64 * 1024&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;è®¾ç½® socket æ¥æ”¶æ¶ˆæ¯ç¼“å†²åŒºï¼ˆSO_RCVBUFï¼‰çš„å¤§å°ï¼Œé»˜è®¤æ˜¯ 64KBï¼Œå¦‚æœè®¾ç½®ä¸º -1ï¼Œé‚£ä¹ˆä½¿ç”¨æ“ä½œç³»ç»Ÿçš„é»˜è®¤å€¼ï¼Œå¦‚æœ Consumer ä¸ Kafka å¤„äºä¸åŒçš„æ•°æ®ä¸­å¿ƒï¼Œé‚£ä¹ˆå¯ä»¥é€‚å½“å¢å¤§æ­¤å€¼&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ConsumerConfig.*RECEIVE_BUFFER_CONFIG*, 64 * 1024);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;send.buffer.bytes&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;128 * 1024&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;è®¾ç½® socket å‘é€æ¶ˆæ¯ç¼“å†²åŒºï¼ˆSO_SNDBUFï¼‰çš„å¤§å°ï¼Œé»˜è®¤æ˜¯ 128KBï¼Œå¦‚æœè®¾ç½®ä¸º -1ï¼Œé‚£ä¹ˆä½¿ç”¨æ“ä½œç³»ç»Ÿçš„é»˜è®¤å€¼ï¼Œå¦‚æœ Consumer ä¸ Kafka å¤„äºä¸åŒçš„æ•°æ®ä¸­å¿ƒï¼Œé‚£ä¹ˆå¯ä»¥é€‚å½“å¢å¤§æ­¤å€¼&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ConsumerConfig.*SEND_BUFFER_CONFIG*, 128 * 1024);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;request.timeout.ms&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;30 * 1000&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;é…ç½® consumer ç­‰å¾…è¯·æ±‚å“åº”çš„æœ€å¤§æ—¶é—´ï¼Œé»˜è®¤æ˜¯ 30s&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ConsumerConfig.*REQUEST_TIMEOUT_MS_CONFIG*, 30 * 1000);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG, brokerList);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG, StringDeserializer.class.getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.GROUP_ID_CONFIG, groupId);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æäº¤ï¼Œé»˜è®¤æ˜¯è‡ªåŠ¨æäº¤ï¼Œé—´éš”æ˜¯5s&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// properties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, true);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// properties.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, 5000);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è°ƒæ•´ä¸ºæ‰‹åŠ¨æäº¤&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG, &lt;span class=&quot;literal&quot;&gt;false&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è‡ªåŠ¨æäº¤é—´éš”æ—¶é—´ï¼Œåªæœ‰åœ¨enable.auto.commitè®¾ç½®ä¸ºtrueæ—¶ç”Ÿæ•ˆï¼Œé»˜è®¤æ˜¯5s&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.AUTO_COMMIT_INTERVAL_MS_CONFIG, &lt;span class=&quot;number&quot;&gt;5000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ä»æœ€æ—©çš„æ¶ˆæ¯å¼€å§‹æ¶ˆè´¹ é»˜è®¤æ˜¯latestï¼Œæ­¤å‚æ•°è¡¨ç¤ºå½“å‰æ¶ˆè´¹ç»„åœ¨æ²¡æœ‰offsetçš„æƒ…å†µä¸‹ï¼Œä»å“ªé‡Œå¼€å§‹æ¶ˆè´¹&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è¿™é‡Œçš„æ²¡æœ‰offsetæŒ‡çš„æ˜¯æ¶ˆè´¹ç»„ç¬¬ä¸€æ¬¡æ¶ˆè´¹æˆ–è€…_consumer_offsetsä¸»é¢˜ä¸­æ²¡æœ‰å½“å‰æ¶ˆè´¹ç»„çš„offset&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.AUTO_OFFSET_RESET_CONFIG, &lt;span class=&quot;string&quot;&gt;&amp;quot;earliest&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ä¸€æ¬¡è¯·æ±‚ä»kafkaä¸­æ‹‰å–çš„æœ€å¤§æ•°æ®é‡ï¼Œé»˜è®¤æ˜¯50Mï¼Œæ­¤å‚æ•°ä¸æ˜¯ç»å¯¹çš„æœ€å¤§å€¼ï¼Œå¦‚æœä¸€æ¡æ¶ˆæ¯çš„å¤§å°æ¯”æ­¤å‚æ•°è¿˜å¤§ï¼Œé‚£ä¹ˆä¸€æ¬¡è¯·æ±‚ä¹Ÿä¼šæ‹‰å–è¿™æ¡æ¶ˆæ¯&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.FETCH_MAX_BYTES_CONFIG, ConsumerConfig.DEFAULT_FETCH_MAX_BYTES);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ä¸€æ¬¡è¯·æ±‚ä»kafkaä¸­æ‹‰å–å•ä¸ªåˆ†åŒºçš„æœ€å¤§æ•°æ®é‡ï¼Œé»˜è®¤æ˜¯1M&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.MAX_PARTITION_FETCH_BYTES_CONFIG, ConsumerConfig.DEFAULT_MAX_PARTITION_FETCH_BYTES);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ä¸€æ¬¡æ‹‰å–è¯·æ±‚ä¸­æ‹‰å–çš„æœ€å¤§æ¶ˆæ¯æ•°é‡ é»˜è®¤æ˜¯500æ¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.MAX_POLL_RECORDS_CONFIG, &lt;span class=&quot;number&quot;&gt;500&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æŒ‡å®šå¤šä¹…ä¹‹åå…³é—­é—²ç½®çš„è¿æ¥ï¼Œé»˜è®¤æ˜¯9åˆ†é’Ÿ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.CONNECTIONS_MAX_IDLE_MS_CONFIG, &lt;span class=&quot;number&quot;&gt;9&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;60&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è®¾ç½®socketæ¥æ”¶æ¶ˆæ¯ç¼“å†²åŒº(SO_RCVBUF)çš„å¤§å°ï¼Œé»˜è®¤æ˜¯64KBï¼Œå¦‚æœè®¾ç½®ä¸º-1ï¼Œé‚£ä¹ˆä½¿ç”¨æ“ä½œç³»ç»Ÿçš„é»˜è®¤å€¼ï¼Œå¦‚æœConsumerä¸Kafkaå¤„äºä¸åŒçš„æ•°æ®ä¸­å¿ƒï¼Œé‚£ä¹ˆå¯ä»¥é€‚å½“å¢å¤§æ­¤å€¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.RECEIVE_BUFFER_CONFIG, &lt;span class=&quot;number&quot;&gt;64&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è®¾ç½®socketå‘é€æ¶ˆæ¯ç¼“å†²åŒº(SO_SNDBUF)çš„å¤§å°ï¼Œé»˜è®¤æ˜¯128KBï¼Œå¦‚æœè®¾ç½®ä¸º-1ï¼Œé‚£ä¹ˆä½¿ç”¨æ“ä½œç³»ç»Ÿçš„é»˜è®¤å€¼ï¼Œå¦‚æœConsumerä¸Kafkaå¤„äºä¸åŒçš„æ•°æ®ä¸­å¿ƒï¼Œé‚£ä¹ˆå¯ä»¥é€‚å½“å¢å¤§æ­¤å€¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.SEND_BUFFER_CONFIG, &lt;span class=&quot;number&quot;&gt;128&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// é…ç½®consumerç­‰å¾…è¯·æ±‚å“åº”çš„æœ€å¤§æ—¶é—´ï¼Œé»˜è®¤æ˜¯30s&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.REQUEST_TIMEOUT_MS_CONFIG, &lt;span class=&quot;number&quot;&gt;30&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// todo-wl é…ç½®æ¶ˆè´¹è€…çš„äº‹åŠ¡éš”ç¦»çº§åˆ«&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// properties.put(ConsumerConfig.ISOLATION_LEVEL_CONFIG, &amp;quot;read_committed&amp;quot;);&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// !! é…ç½®æ¶ˆè´¹è€…çš„æœ€å¤§å¿ƒè·³é—´éš”æ—¶é—´ï¼Œé»˜è®¤æ˜¯3s&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å¿ƒè·³é—´éš”æ—¶é—´æ˜¯æŒ‡æ¶ˆè´¹è€…å‘é€å¿ƒè·³ç»™brokerçš„æ—¶é—´é—´éš”&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å¿…é¡»æ¯”session.timeout.mså°ï¼Œä¸€èˆ¬æ˜¯session.timeout.msçš„1/3&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.HEARTBEAT_INTERVAL_MS_CONFIG, &lt;span class=&quot;number&quot;&gt;3&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// !! é…ç½®æ¶ˆè´¹è€…ä¸brokerçš„ä¼šè¯è¶…æ—¶æ—¶é—´ï¼Œé»˜è®¤æ˜¯10s&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è¶…è¿‡æ­¤æ—¶é—´brokeræ²¡æœ‰æ”¶åˆ°æ¶ˆè´¹è€…çš„å¿ƒè·³ï¼Œé‚£ä¹ˆbrokerä¼šè®¤ä¸ºæ¶ˆè´¹è€…æŒ‚æ‰äº†ï¼Œç„¶åè§¦å‘rebalance&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.SESSION_TIMEOUT_MS_CONFIG, &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// !! æ‹‰å–æ¶ˆæ¯çº¿ç¨‹æœ€é•¿ç©ºé—²æ—¶é—´ï¼Œé»˜è®¤æ˜¯5åˆ†é’Ÿï¼Œè‹¥è¶…è¿‡è¿™ä¸ªé—´éš”è¿˜æ²¡æœ‰å‘èµ·pollè¯·æ±‚ï¼Œæ¶ˆè´¹è€…ä¼šè®¤ä¸ºæ¶ˆè´¹è€…æŒ‚æ‰äº†ï¼Œç„¶åè§¦å‘rebalance&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å› ä¸ºpollæ–¹æ³•è¿˜æ¶‰åŠä¸šåŠ¡å¤„ç†ï¼Œæ‰€ä»¥å¦‚æœä¸šåŠ¡å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œé‚£ä¹ˆéœ€è¦é€‚å½“å¢å¤§æ­¤å€¼ï¼Œæˆ–è€…å‡å°‘å•æ¬¡æ‹‰å–çš„æ¶ˆæ¯æ•°é‡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ConsumerConfig.MAX_POLL_INTERVAL_MS_CONFIG, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;60&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="https://taeyang0126.github.io/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://taeyang0126.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="https://taeyang0126.github.io/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    <category term="ä¸­é—´ä»¶" scheme="https://taeyang0126.github.io/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    <category term="kafka" scheme="https://taeyang0126.github.io/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>kafka-producer</title>
    <link href="https://taeyang0126.github.io/2025/02/09/xiao-xi-dui-lie/kafka/producer/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/xiao-xi-dui-lie/kafka/producer/posts/undefined/</id>
    <published>2025-02-09T11:52:22.000Z</published>
    <updated>2025-02-10T14:16:05.825Z</updated>
    
    <content type="html"><![CDATA[<h2 id="é‡è¦å‚æ•°"><a href="#é‡è¦å‚æ•°" class="headerlink" title="é‡è¦å‚æ•°"></a>é‡è¦å‚æ•°</h2><table><thead><tr><th align="left">é…ç½®é¡¹</th><th align="left">é»˜è®¤å€¼</th><th align="left">è¯´æ˜</th><th align="left">ç¤ºä¾‹</th></tr></thead><tbody><tr><td align="left"><strong>bootstrap.servers</strong></td><td align="left"></td><td align="left">Kafka broker åœ°å€</td><td align="left"><code>*properties*.put(ProducerConfig.*BOOTSTRAP_SERVERS_CONFIG*, *brokerList*);</code></td></tr><tr><td align="left"><strong>key.serializer</strong></td><td align="left"></td><td align="left">Key åºåˆ—åŒ–å™¨å®ç° Serializer æ¥å£</td><td align="left"><code>*properties*.put(ProducerConfig.*KEY_SERIALIZER_CLASS_CONFIG*, StringSerializer.class.getName());</code></td></tr><tr><td align="left"><strong>value.serializer</strong></td><td align="left"></td><td align="left">Value åºåˆ—åŒ–å™¨å®ç° Serializer æ¥å£</td><td align="left"><code>*properties*.put(ProducerConfig.*VALUE_SERIALIZER_CLASS_CONFIG*, StringSerializer.class.getName());</code></td></tr><tr><td align="left"><strong>acks</strong></td><td align="left">1</td><td align="left">æŒ‡å®šåˆ†åŒºä¸­å¿…é¡»æœ‰å¤šå°‘ä¸ªå‰¯æœ¬æ”¶åˆ°æ¶ˆæ¯ï¼Œç”Ÿäº§è€…æ‰è®¤ä¸ºæ¶ˆæ¯å†™å…¥æˆåŠŸï¼Œé»˜è®¤ 1acks&#x3D;1 ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°åˆ†åŒº leaderï¼Œleader å°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ—¥å¿—åå³è¿”å›æˆåŠŸacks&#x3D;0 ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°åˆ†åŒº leaderï¼Œä¸ç­‰å¾… leader å†™å…¥æœ¬åœ°æ—¥å¿—ï¼Œç›´æ¥è¿”å›æˆåŠŸacks&#x3D;all&#x2F;acks&#x3D;-1 ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°åˆ†åŒº leaderï¼Œleader å°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ—¥å¿—åï¼Œç­‰å¾… ISR ä¸­æ‰€æœ‰å‰¯æœ¬éƒ½å†™å…¥æˆåŠŸåæ‰è¿”å›æˆåŠŸ acks&#x3D;all ç­‰ä»·äº acks&#x3D;-1 å¹¶ä¸ä¸€å®šæœ€å¯é ï¼Œå› ä¸º ISR ä¸­çš„å‰¯æœ¬å¯èƒ½ä¼šå› ä¸ºå„ç§åŸå› ä¸å¯ç”¨ï¼Œå¯¼è‡´ ISR å‰¯æœ¬åªæœ‰ leader èŠ‚ç‚¹ä¸€ä¸ªï¼Œå¦‚æœéœ€è¦è·å¾—æ›´é«˜çš„å¯é æ€§ï¼Œéœ€è¦é…ç½® min.insync.replicas å‚æ•°ï¼ˆbroker å‚æ•°ï¼Œå»ºè®®é…ç½®å¤§äº 1 &amp; å°äºå‰¯æœ¬æ•°é‡ï¼‰ï¼Œæ­¤å‚æ•°è¡¨ç¤º ISR ä¸­è‡³å°‘æœ‰å¤šå°‘ä¸ªå‰¯æœ¬æ˜¯å¯ç”¨çš„</td><td align="left"><code>*properties*.put(ProducerConfig.*ACKS_CONFIG*, &quot;all&quot;);</code></td></tr><tr><td align="left"><strong>retries</strong></td><td align="left"></td><td align="left">é…ç½®é‡è¯•æ¬¡æ•°ï¼Œé‡è¯•æ¬¡æ•°åªé™åˆ¶äºå¯é‡è¯•çš„å¼‚å¸¸ï¼Œä¸å¯é‡è¯•çš„å¼‚å¸¸æ­¤å‚æ•°æ— æ„ä¹‰</td><td align="left"><code>*properties*.put(ProducerConfig.*RETRIES_CONFIG*, 10);</code></td></tr><tr><td align="left"><strong>retry.backoff.ms</strong></td><td align="left"></td><td align="left">é‡è¯•çš„æ—¶é—´é—´éš”</td><td align="left"><code>*properties*.put(ProducerConfig.*RETRY_BACKOFF_MS_CONFIG*, 100);</code></td></tr><tr><td align="left"><strong>max.in.flight.requests.per.connection</strong></td><td align="left">5</td><td align="left">é…ç½®å•ä¸ªè¿æ¥æœ€å¤§ç¼“å­˜è¯·æ±‚æ•°é‡ï¼Œå‘é€çš„è¯·æ±‚ ProducerBatch ä¼šç¼“å­˜åˆ° InFlightRequests ä¸­ï¼Œæ­¤å‚æ•°é™åˆ¶ InFlightRequests çš„å¤§å°ï¼Œé»˜è®¤ 5ï¼Œå³æ¯ä¸ªè¿æ¥æœ€å¤šåªèƒ½ç¼“å­˜ 5 ä¸ªæœªå“åº”çš„è¯·æ±‚</td><td align="left"><code>*properties*.put(ProducerConfig.*MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION*, 5);</code></td></tr><tr><td align="left">request.timeout.ms</td><td align="left">30 * 1000</td><td align="left">Producer ç­‰å¾…è¯·æ±‚å“åº”çš„æœ€é•¿æ—¶é—´ï¼Œé»˜è®¤ 30sï¼Œå¦‚æœåœ¨ 30s å†…æ²¡æœ‰æ”¶åˆ°å“åº”ï¼Œé‚£ä¹ˆä¼šé‡å‘æ¶ˆæ¯è¿™ä¸ªå‚æ•°éœ€è¦æ¯” broker ç«¯çš„å‚æ•° replica.lag.time.max.msï¼ˆFollower å‰¯æœ¬èƒ½å¤Ÿè½å Leader å‰¯æœ¬çš„æœ€é•¿æ—¶é—´é—´éš”ï¼Œé»˜è®¤å€¼æ˜¯ 10 ç§’ï¼‰å¤§ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°æ¶ˆæ¯ä¸¢å¤±</td><td align="left"><code>*properties*.put(ProducerConfig.*REQUEST_TIMEOUT_MS_CONFIG*, 30 * 1000);</code></td></tr><tr><td align="left">linger.ms</td><td align="left">0</td><td align="left">æŒ‡å®šç”Ÿäº§è€…å‘é€ ProducerBatch ä¹‹å‰ç­‰å¾…æ›´å¤šæ¶ˆæ¯åŠ å…¥åˆ° ProducerBatch çš„æ—¶é—´ï¼Œé»˜è®¤ 0ï¼Œå³ç«‹å³å‘é€ï¼Œè¿™ä¸ªå‚æ•°ä¸ TCP çš„ Nagle ç®—æ³•ç±»ä¼¼</td><td align="left"><code>*properties*.put(ProducerConfig.*LINGER_MS_CONFIG*, 0);</code></td></tr><tr><td align="left">send.buffer.bytes</td><td align="left">128 * 1024</td><td align="left">è®¾ç½® socket å‘é€ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤ 128kï¼Œå¦‚æœè®¾ç½®ä¸º -1ï¼Œé‚£ä¹ˆä½¿ç”¨æ“ä½œç³»ç»Ÿé»˜è®¤çš„å¤§å°</td><td align="left"><code>*properties*.put(ProducerConfig.*SEND_BUFFER_CONFIG*, 128 * 1024);</code></td></tr><tr><td align="left">interceptor.classes</td><td align="left"></td><td align="left">æ¶ˆæ¯å‘é€æ‹¦æˆªå™¨æ¶ˆæ¯å‘é€åˆ° broker ä¹‹å‰æ‹¦æˆªï¼Œå¯ä¿®æ”¹æ¶ˆæ¯å†…å®¹å®ç° ProducerInterceptor æ¥å£</td><td align="left"><code>*properties*.put(ProducerConfig.*INTERCEPTOR_CLASSES_CONFIG*, ProducerInterceptorPrefix.class.getName());</code></td></tr><tr><td align="left">buffer.memory</td><td align="left">32 * 1024 * 1024</td><td align="left">ç¼“å­˜æ¶ˆæ¯å¤§å°ç”Ÿäº§è€…ä¸»çº¿ç¨‹ä¼šå°†æ¶ˆæ¯ç¼“å­˜åˆ° RecordAccumulator ä¸­ï¼Œç„¶åç”± Sender çº¿ç¨‹å‘é€åˆ° Kafkaï¼Œè¿™é‡Œçš„å‚æ•°æ˜¯ RecordAccumulator çš„ç¼“å­˜å¤§å°ï¼Œé»˜è®¤ 32M</td><td align="left"><code>// ç¼“å­˜æ¶ˆæ¯å¤§å°ï¼Œç”Ÿäº§è€…ä¸»çº¿ç¨‹ä¼šå°†æ¶ˆæ¯ç¼“å­˜åˆ°RecordAccumulatorä¸­ï¼Œç„¶åç”±Senderçº¿ç¨‹å‘é€åˆ°Kafkaï¼Œè¿™é‡Œçš„å‚æ•°æ˜¯RecordAccumulatorçš„ç¼“å­˜å¤§å°ï¼Œé»˜è®¤32M *properties*.put(ProducerConfig.*BUFFER_MEMORY_CONFIG*, 32 * 1024 * 1024L);</code></td></tr><tr><td align="left">max.block.ms</td><td align="left">60 * 1000</td><td align="left">RecordAccumulator ç¼“å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œæœ€å¤§é˜»å¡æ—¶é—´ï¼Œé»˜è®¤ 60s</td><td align="left"><code>// RecordAccumulatorç¼“å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œæœ€å¤§é˜»å¡æ—¶é—´ï¼Œé»˜è®¤60s *properties*.put(ProducerConfig.*MAX_BLOCK_MS_CONFIG*, 60 * 1000);</code></td></tr><tr><td align="left">batch.size</td><td align="left">16 * 1024</td><td align="left">å•æ¬¡å‘é€æ¶ˆæ¯å¤§å°ï¼Œkafka ä¼šå°†æ¶ˆæ¯ç»„è£…ä¸º ProducerBatchï¼Œæ­¤å‚æ•°å½±å“ ProducerBatch çš„å¤§å°ï¼Œå¦‚æœæ¶ˆæ¯å°äºæ­¤å‚æ•°ï¼Œåˆ™ä¼šé€šè¿‡ BufferPool è¿›è¡Œå¤ç”¨ï¼Œé»˜è®¤ 16k</td><td align="left"><code>*properties*.put(ProducerConfig.*BATCH_SIZE_CONFIG*, 16 * 1024);</code></td></tr><tr><td align="left">max.request.size</td><td align="left">1024 * 1024</td><td align="left">å®¢æˆ·ç«¯èƒ½å‘é€æ¶ˆæ¯çš„æœ€å¤§å€¼ï¼Œé»˜è®¤ 1Mï¼Œä¸å»ºè®®ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œå› ä¸ºæ¶‰åŠåˆ° broker ç«¯çš„å‚æ•°å®¢æˆ·ç«¯èƒ½å‘é€æ¶ˆæ¯çš„æœ€å¤§å€¼ï¼Œé»˜è®¤ 1Mï¼Œä¸å»ºè®®ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œå› ä¸ºæ¶‰åŠåˆ° broker ç«¯çš„å‚æ•°</td><td align="left"><code>*properties*.put(ProducerConfig.*MAX_REQUEST_SIZE_CONFIG*, 1024 * 1024);</code></td></tr><tr><td align="left">compression.type</td><td align="left">none</td><td align="left">æ¶ˆæ¯å‹ç¼©æ–¹å¼ï¼Œé»˜è®¤æ˜¯ noneï¼Œæ”¯æŒ noneã€gzipã€snappyã€lz4ï¼Œå¦‚æœéœ€è¦æå‡ååé‡ï¼Œå¯ä»¥å¼€å¯æ¶ˆæ¯å‹ç¼©</td><td align="left"><code>*properties*.put(ProducerConfig.*COMPRESSION_TYPE_CONFIG*, &quot;none&quot;);</code></td></tr><tr><td align="left">connections.max.idle.ms</td><td align="left">9 * 60 * 1000</td><td align="left">å…³é—­é—²ç½®çš„è¿æ¥ï¼Œé»˜è®¤ 9 åˆ†é’Ÿï¼Œå¦‚æœç”Ÿäº§è€…åœ¨ 9 åˆ†é’Ÿå†…æ²¡æœ‰å‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆç”Ÿäº§è€…ä¼šå…³é—­è¿æ¥ï¼Œå¦‚æœç”Ÿäº§è€…åœ¨ 9 åˆ†é’Ÿå†…å‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆç”Ÿäº§è€…ä¼šé‡ç½®é—²ç½®æ—¶é—´</td><td align="left"><code>*properties*.put(ProducerConfig.*CONNECTIONS_MAX_IDLE_MS_CONFIG*, 9 * 60 * 1000);</code></td></tr></tbody></table><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, brokerList);</span><br><span class="line">    properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line">    properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‘é€æ‹¦æˆªå™¨</span></span><br><span class="line">    properties.put(ProducerConfig.INTERCEPTOR_CLASSES_CONFIG, ProducerInterceptorPrefix.class.getName());</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç”Ÿäº§è€…å‘é€é…ç½®</span></span><br><span class="line">    <span class="comment">// ç¼“å­˜æ¶ˆæ¯å¤§å°ï¼Œç”Ÿäº§è€…ä¸»çº¿ç¨‹ä¼šå°†æ¶ˆæ¯ç¼“å­˜åˆ°RecordAccumulatorä¸­ï¼Œç„¶åç”±Senderçº¿ç¨‹å‘é€åˆ°Kafkaï¼Œè¿™é‡Œçš„å‚æ•°æ˜¯RecordAccumulatorçš„ç¼“å­˜å¤§å°ï¼Œé»˜è®¤32M</span></span><br><span class="line">    properties.put(ProducerConfig.BUFFER_MEMORY_CONFIG, <span class="number">32</span> * <span class="number">1024</span> * <span class="number">1024L</span>);</span><br><span class="line">    <span class="comment">// RecordAccumulatorç¼“å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œæœ€å¤§é˜»å¡æ—¶é—´ï¼Œé»˜è®¤60s</span></span><br><span class="line">    properties.put(ProducerConfig.MAX_BLOCK_MS_CONFIG, <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line">    <span class="comment">// å•æ¬¡å‘é€æ¶ˆæ¯å¤§å°ï¼Œkafkaä¼šå°†æ¶ˆæ¯ç»„è£…ä¸ºProducerBatchï¼Œæ­¤å‚æ•°å½±å“ProducerBatchçš„å¤§å°ï¼Œå¦‚æœæ¶ˆæ¯å°äºæ­¤å‚æ•°ï¼Œåˆ™ä¼šé€šè¿‡pBufferPoolè¿›è¡Œå¤ç”¨ï¼Œé»˜è®¤16k</span></span><br><span class="line">    properties.put(ProducerConfig.BATCH_SIZE_CONFIG, <span class="number">16</span> * <span class="number">1024</span>);</span><br><span class="line">    <span class="comment">// é…ç½®å•ä¸ªè¿æ¥æœ€å¤§ç¼“å­˜è¯·æ±‚æ•°é‡ï¼Œå‘é€çš„è¯·æ±‚ProducerBatchä¼šç¼“å­˜åˆ°InFlightRequestsä¸­ï¼Œæ­¤å‚æ•°é™åˆ¶InFlightRequestsçš„å¤§å°ï¼Œé»˜è®¤5ï¼Œå³æ¯ä¸ªè¿æ¥æœ€å¤šåªèƒ½ç¼“å­˜5ä¸ªæœªå“åº”çš„è¯·æ±‚</span></span><br><span class="line">    properties.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é‡è¦çš„ç”Ÿäº§è€…å‚æ•°</span></span><br><span class="line">    <span class="comment">// æŒ‡å®šåˆ†åŒºä¸­å¿…é¡»æœ‰å¤šå°‘ä¸ªå‰¯æœ¬æ”¶åˆ°æ¶ˆæ¯ï¼Œç”Ÿäº§è€…æ‰è®¤ä¸ºæ¶ˆæ¯å†™å…¥æˆåŠŸï¼Œé»˜è®¤1</span></span><br><span class="line">    <span class="comment">// acks=1 ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°åˆ†åŒºleaderï¼Œleaderå°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ—¥å¿—åå³è¿”å›æˆåŠŸ</span></span><br><span class="line">    <span class="comment">// acks=0 ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°åˆ†åŒºleaderï¼Œä¸ç­‰å¾…leaderå†™å…¥æœ¬åœ°æ—¥å¿—ï¼Œç›´æ¥è¿”å›æˆåŠŸ</span></span><br><span class="line">    <span class="comment">// acks=all/acks=-1 ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°åˆ†åŒºleaderï¼Œleaderå°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ—¥å¿—åï¼Œç­‰å¾…ISRä¸­æ‰€æœ‰å‰¯æœ¬éƒ½å†™å…¥æˆåŠŸåæ‰è¿”å›æˆåŠŸ</span></span><br><span class="line">    <span class="comment">// acks=all ç­‰ä»·äº acks=-1 å¹¶ä¸ä¸€å®šæœ€å¯é ï¼Œå› ä¸ºISRä¸­çš„å‰¯æœ¬å¯èƒ½ä¼šå› ä¸ºå„ç§åŸå› ä¸å¯ç”¨ï¼Œå¯¼è‡´ISRå‰¯æœ¬åªæœ‰leaderèŠ‚ç‚¹ä¸€ä¸ªï¼Œå¦‚æœéœ€è¦è·å¾—æ›´é«˜çš„å¯é æ€§ï¼Œéœ€è¦é…ç½® min.insync.replicas å‚æ•°ï¼Œæ­¤å‚æ•°è¡¨ç¤ºISRä¸­è‡³å°‘æœ‰å¤šå°‘ä¸ªå‰¯æœ¬æ˜¯å¯ç”¨çš„</span></span><br><span class="line">    properties.put(ProducerConfig.ACKS_CONFIG, <span class="string">&quot;all&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®¢æˆ·ç«¯èƒ½å‘é€æ¶ˆæ¯çš„æœ€å¤§å€¼ï¼Œé»˜è®¤1Mï¼Œä¸å»ºè®®ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œå› ä¸ºæ¶‰åŠåˆ°brokerç«¯çš„å‚æ•°</span></span><br><span class="line">    <span class="comment">// æ­¤å‚æ•°è¡¨ç¤ºå•æ¬¡ç½‘ç»œè¯·æ±‚çš„å¤§å°ï¼Œè¿™æ¬¡è¯·æ±‚ä¸­å¯èƒ½åŒ…å«å¾ˆå¤šä¸ªProducerBatch</span></span><br><span class="line">    properties.put(ProducerConfig.MAX_REQUEST_SIZE_CONFIG, <span class="number">1024</span> * <span class="number">1024</span>);</span><br><span class="line">    <span class="comment">// æŒ‡å®šç”Ÿäº§è€…å‘é€ProducerBatchä¹‹å‰ç­‰å¾…æ›´å¤šæ¶ˆæ¯åŠ å…¥åˆ°ProducerBatchçš„æ—¶é—´ï¼Œé»˜è®¤0ï¼Œå³ç«‹å³å‘é€ï¼Œè¿™ä¸ªå‚æ•°ä¸TCPçš„Nagleç®—æ³•ç±»ä¼¼</span></span><br><span class="line">    properties.put(ProducerConfig.LINGER_MS_CONFIG, <span class="number">0</span>);</span><br><span class="line">    <span class="comment">// è®¾ç½®socketå‘é€ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤128kï¼Œå¦‚æœè®¾ç½®ä¸º-1ï¼Œé‚£ä¹ˆä½¿ç”¨æ“ä½œç³»ç»Ÿé»˜è®¤çš„å¤§å°</span></span><br><span class="line">    properties.put(ProducerConfig.SEND_BUFFER_CONFIG, <span class="number">128</span> * <span class="number">1024</span>);</span><br><span class="line">    <span class="comment">// Producerç­‰å¾…æ°¢æ°”å“åº”çš„æœ€é•¿æ—¶é—´ï¼Œé»˜è®¤30sï¼Œå¦‚æœåœ¨30så†…æ²¡æœ‰æ”¶åˆ°å“åº”ï¼Œé‚£ä¹ˆä¼šé‡å‘æ¶ˆæ¯</span></span><br><span class="line">    <span class="comment">// è¿™ä¸ªå‚æ•°éœ€è¦æ¯”brokerç«¯çš„å‚æ•°replica.lag.time.max.msï¼ˆFollower å‰¯æœ¬èƒ½å¤Ÿè½å Leader å‰¯æœ¬çš„æœ€é•¿æ—¶é—´é—´éš”ï¼Œé»˜è®¤å€¼æ˜¯ 10 ç§’ï¼‰å¤§ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°æ¶ˆæ¯ä¸¢å¤±</span></span><br><span class="line">    properties.put(ProducerConfig.REQUEST_TIMEOUT_MS_CONFIG, <span class="number">30</span> * <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// é…ç½®é‡è¯•æ¬¡æ•°ï¼Œé‡è¯•æ¬¡æ•°åªé™åˆ¶äºå¯é‡è¯•çš„å¼‚å¸¸ï¼Œä¸å¯é‡è¯•çš„å¼‚å¸¸æ­¤å‚æ•°æ— æ„ä¹‰</span></span><br><span class="line">    properties.put(ProducerConfig.RETRIES_CONFIG, <span class="number">10</span>);</span><br><span class="line">    <span class="comment">// é‡è¯•çš„æ—¶é—´é—´éš”</span></span><br><span class="line">    properties.put(ProducerConfig.RETRY_BACKOFF_MS_CONFIG, <span class="number">100</span>);</span><br><span class="line">    <span class="comment">// æŸäº›åœºæ™¯ä¸‹æ¶ˆæ¯çš„é¡ºåºæ˜¯éå¸¸é‡è¦çš„ï¼Œå¦‚æœretryé‡è¯•æ¬¡æ•°è®¾ç½®å¤§äº0 &amp; max.in.flight.requests.per.connection &gt; 1ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¹±åº</span></span><br><span class="line">    <span class="comment">// æ¯”å¦‚ç¬¬ä¸€æ‰¹æ¬¡æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œç¬¬äºŒæ‰¹æ¬¡æ¶ˆæ¯å‘é€æˆåŠŸï¼Œç¬¬ä¸€æ‰¹æ¬¡æ¶ˆæ¯é‡è¯•å‘é€æˆåŠŸï¼Œé‚£ä¹ˆç¬¬ä¸€æ‰¹æ¬¡æ¶ˆæ¯å°±ä¼šå‡ºç°åœ¨ç¬¬äºŒæ‰¹æ¬¡æ¶ˆæ¯ä¹‹å</span></span><br><span class="line">    <span class="comment">// å»ºè®®å¦‚æœéœ€è¦ä¿è¯æ¶ˆæ¯çš„é¡ºåºï¼Œé‚£ä¹ˆå°†max.in.flight.requests.per.connectionè®¾ç½®ä¸º1ï¼Œè€Œä¸æ˜¯è®¾ç½®é‡è¯•æ¬¡æ•°ä¸º0ï¼Œä¸è¿‡è¿™æ ·ä¼šå¯¼è‡´ååé‡ä¸‹é™</span></span><br><span class="line">    <span class="comment">// ? todo-wl å¦‚æœé‡è¯•æ¬¡æ•°=0ï¼Œmax.in.flight.requests.per.connection&gt;1ï¼Œæ€ä¹ˆä¿è¯æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Ÿ</span></span><br><span class="line">    <span class="comment">// -&gt; å› ä¸ºå•æ¬¡ç½‘ç»œåŒ…å¯èƒ½åŒ…å«å¤šä¸ªProducerBatchï¼Œkafkaåœ¨å¤„ç†çš„æ—¶å€™ä¼šå°†å¤šä¸ªProducerBatchåˆå¹¶ä¸ºä¸€ä¸ªè¯·æ±‚ï¼ŒåŒæ—¶å¯¹äºåŒä¸€ä¸ªåˆ†åŒºçš„æ¶ˆæ¯ï¼Œkafkaä¼šä¿è¯æ¶ˆæ¯çš„é¡ºåºï¼Œæ‰€ä»¥èƒ½ä¿è¯æ¶ˆæ¯æ˜¯æœ‰åºçš„</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ¶ˆæ¯å‹ç¼©æ–¹å¼ï¼Œé»˜è®¤æ˜¯noneï¼Œæ”¯æŒnoneã€gzipã€snappyã€lz4ï¼Œå¦‚æœéœ€è¦æå‡ååé‡ï¼Œå¯ä»¥å¼€å¯æ¶ˆæ¯å‹ç¼©</span></span><br><span class="line">    properties.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, <span class="string">&quot;none&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…³é—­é—²ç½®çš„è¿æ¥ï¼Œé»˜è®¤9åˆ†é’Ÿï¼Œå¦‚æœç”Ÿäº§è€…åœ¨9åˆ†é’Ÿå†…æ²¡æœ‰å‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆç”Ÿäº§è€…ä¼šå…³é—­è¿æ¥ï¼Œå¦‚æœç”Ÿäº§è€…åœ¨9åˆ†é’Ÿå†…å‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆç”Ÿäº§è€…ä¼šé‡ç½®é—²ç½®æ—¶é—´</span></span><br><span class="line">    properties.put(ProducerConfig.CONNECTIONS_MAX_IDLE_MS_CONFIG, <span class="number">9</span> * <span class="number">60</span> * <span class="number">1000</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¹‚ç­‰æ€§é…ç½®</span></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="comment">// å¼€å¯å¹‚ç­‰æ€§</span></span><br><span class="line">    properties.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, <span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// å¹‚ç­‰çš„åŸç†æ˜¯æ¶ˆè´¹è€…ä¼šè¢«åˆ†é…ä¸€ä¸ªpidï¼Œpidæ˜¯ä¸€ä¸ªé€’å¢çš„åºåˆ—å·ï¼Œç”Ÿäº§è€…æ¯å‘é€ä¸€æ¡æ¶ˆæ¯å°±ä¼šå°†&lt;PID,åˆ†åŒº&gt;å¯¹åº”çš„åºåˆ—å·+1</span></span><br><span class="line">    <span class="comment">// å½“å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šå°†seqå‘é€åˆ°brokerï¼Œbrokerå†…å­˜ä¸­ä¿å­˜&lt;PID,åˆ†åŒº&gt;å¯¹åº”çš„åºåˆ—å·ï¼Œå¦‚æœseqå¤§äºbrokerä¸­çš„åºåˆ—å·+1ï¼Œé‚£ä¹ˆbrokerä¼šå°†æ¶ˆæ¯å†™å…¥æ—¥å¿—ï¼Œç„¶åæ›´æ–°åºåˆ—å·</span></span><br><span class="line">    <span class="comment">// å¦‚æœseqå°äºbrokerä¸­çš„åºåˆ—å·+1ï¼Œé‚£ä¹ˆbrokerä¼šç›´æ¥è¿”å›æˆåŠŸï¼Œä¸ä¼šå†™å…¥æ—¥å¿—</span></span><br><span class="line">    <span class="comment">// å¦‚æœseqå¤§äºbrokerä¸­çš„åºåˆ—å·+1ï¼Œé‚£ä¹ˆbrokerä¼šè¿”å›é”™è¯¯</span></span><br><span class="line">    <span class="comment">// !! Kafkaå¹‚ç­‰åªä¿è¯å•ä¸ªç”Ÿäº§è€…ä¼šè¯(session)ä¸­å•ä¸ªåˆ†åŒºå†…çš„å¹‚ç­‰æ€§ï¼Œä¸ä¿è¯å¤šä¸ªåˆ†åŒºä¹‹é—´çš„å¹‚ç­‰æ€§</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰é…ç½®ä»¥ä¸‹é…ç½®ï¼Œåªéœ€è¦é…ç½®ä¸Šé¢çš„é…ç½®å³å¯</span></span><br><span class="line">    <span class="comment">// retryé‡è¯•æ¬¡æ•°å¿…é¡»å¤§äº0</span></span><br><span class="line">    properties.put(ProducerConfig.RETRIES_CONFIG, <span class="number">10</span>);</span><br><span class="line">    <span class="comment">// acks å¿…é¡»æ˜¯ all</span></span><br><span class="line">    properties.put(ProducerConfig.ACKS_CONFIG, <span class="string">&quot;all&quot;</span>);</span><br><span class="line">    <span class="comment">// max.in.flight.requests.per.connection ä¸èƒ½å¤§äº5</span></span><br><span class="line">    properties.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// äº‹åŠ¡é…ç½®</span></span><br><span class="line"><span class="comment">// å¹‚ç­‰æ€§ä¸èƒ½è·¨åˆ†åŒºï¼Œå¦‚æœéœ€è¦è·¨åˆ†åŒºçš„å¹‚ç­‰æ€§ï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨äº‹åŠ¡</span></span><br><span class="line"><span class="comment">// äº‹åŠ¡å¯ä»¥ä¿è¯å¯¹å¤šä¸ªåˆ†åŒºå†™å…¥æ“ä½œçš„åŸå­æ€§</span></span><br><span class="line"><span class="comment">// kafkaä¸­çš„äº‹åŠ¡å¯ä»¥ä½¿åº”ç”¨ç¨‹åºå°†æ¶ˆè´¹æ¶ˆæ¯ã€ç”Ÿäº§æ¶ˆæ¯ã€æäº¤æ¶ˆè´¹ä½ç§»å½“åšåŸå­æ“ä½œæ¥å¤„ç†ï¼ŒåŒæ—¶æˆåŠŸæˆ–å¤±è´¥</span></span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="comment">// å¿…é¡»æä¾›å”¯ä¸€çš„transactional.idï¼Œå¦‚æœtransactional.idç›¸åŒï¼Œé‚£ä¹ˆä¼šè®¤ä¸ºæ˜¯åŒä¸€ä¸ªäº‹åŠ¡</span></span><br><span class="line">    <span class="comment">// æ˜¾ç¤ºè®¾ç½®</span></span><br><span class="line">    properties.put(ProducerConfig.TRANSACTIONAL_ID_CONFIG, <span class="string">&quot;transactional-id&quot;</span>);</span><br><span class="line">    <span class="comment">// ï¼ï¼äº‹åŠ¡è¦æ±‚ç”Ÿäº§è€…å¼€å¯å¹‚ç­‰æ€§</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="å¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåº"><a href="#å¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåº" class="headerlink" title="å¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåº"></a>å¦‚ä½•ä¿è¯æ¶ˆæ¯é¡ºåº</h2><ul><li><strong>retries</strong> &gt; 0 &amp; <strong>max.in.flight.requests.per.connection</strong> &#x3D; 1</li></ul><p>â€‹      æ¨èä½¿ç”¨æ­¤æ–¹å¼ï¼Œä¸€å®šç¨‹åº¦ä¸Šèƒ½ä¿è¯æ¶ˆæ¯ä¸ä¸¢å¤±ï¼Œä½†æ˜¯ä¼šå¯¼è‡´ååé‡ä¸‹é™ï¼›</p><ul><li><strong>retries</strong> &#x3D; 0 &amp; <strong>max.in.flight.requests.per.connection</strong> &gt; 1</li></ul><p>NetworkClient:</p><p><img data-src="/images/message/kafka/01.png" alt="img"></p><p>â€‹      </p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;é‡è¦å‚æ•°&quot;&gt;&lt;a href=&quot;#é‡è¦å‚æ•°&quot; class=&quot;headerlink&quot; title=&quot;é‡è¦å‚æ•°&quot;&gt;&lt;/a&gt;é‡è¦å‚æ•°&lt;/h2&gt;&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th align=&quot;left&quot;&gt;é…ç½®é¡¹&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;é»˜è®¤å€¼&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;è¯´æ˜&lt;/th&gt;
&lt;th align=&quot;left&quot;&gt;ç¤ºä¾‹&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;bootstrap.servers&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;Kafka broker åœ°å€&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*BOOTSTRAP_SERVERS_CONFIG*, *brokerList*);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;key.serializer&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;Key åºåˆ—åŒ–å™¨å®ç° Serializer æ¥å£&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*KEY_SERIALIZER_CLASS_CONFIG*, StringSerializer.class.getName());&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;value.serializer&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;Value åºåˆ—åŒ–å™¨å®ç° Serializer æ¥å£&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*VALUE_SERIALIZER_CLASS_CONFIG*, StringSerializer.class.getName());&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;acks&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;1&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;æŒ‡å®šåˆ†åŒºä¸­å¿…é¡»æœ‰å¤šå°‘ä¸ªå‰¯æœ¬æ”¶åˆ°æ¶ˆæ¯ï¼Œç”Ÿäº§è€…æ‰è®¤ä¸ºæ¶ˆæ¯å†™å…¥æˆåŠŸï¼Œé»˜è®¤ 1acks&amp;#x3D;1 ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°åˆ†åŒº leaderï¼Œleader å°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ—¥å¿—åå³è¿”å›æˆåŠŸacks&amp;#x3D;0 ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°åˆ†åŒº leaderï¼Œä¸ç­‰å¾… leader å†™å…¥æœ¬åœ°æ—¥å¿—ï¼Œç›´æ¥è¿”å›æˆåŠŸacks&amp;#x3D;all&amp;#x2F;acks&amp;#x3D;-1 ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°åˆ†åŒº leaderï¼Œleader å°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ—¥å¿—åï¼Œç­‰å¾… ISR ä¸­æ‰€æœ‰å‰¯æœ¬éƒ½å†™å…¥æˆåŠŸåæ‰è¿”å›æˆåŠŸ acks&amp;#x3D;all ç­‰ä»·äº acks&amp;#x3D;-1 å¹¶ä¸ä¸€å®šæœ€å¯é ï¼Œå› ä¸º ISR ä¸­çš„å‰¯æœ¬å¯èƒ½ä¼šå› ä¸ºå„ç§åŸå› ä¸å¯ç”¨ï¼Œå¯¼è‡´ ISR å‰¯æœ¬åªæœ‰ leader èŠ‚ç‚¹ä¸€ä¸ªï¼Œå¦‚æœéœ€è¦è·å¾—æ›´é«˜çš„å¯é æ€§ï¼Œéœ€è¦é…ç½® min.insync.replicas å‚æ•°ï¼ˆbroker å‚æ•°ï¼Œå»ºè®®é…ç½®å¤§äº 1 &amp;amp; å°äºå‰¯æœ¬æ•°é‡ï¼‰ï¼Œæ­¤å‚æ•°è¡¨ç¤º ISR ä¸­è‡³å°‘æœ‰å¤šå°‘ä¸ªå‰¯æœ¬æ˜¯å¯ç”¨çš„&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*ACKS_CONFIG*, &amp;quot;all&amp;quot;);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;retries&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;é…ç½®é‡è¯•æ¬¡æ•°ï¼Œé‡è¯•æ¬¡æ•°åªé™åˆ¶äºå¯é‡è¯•çš„å¼‚å¸¸ï¼Œä¸å¯é‡è¯•çš„å¼‚å¸¸æ­¤å‚æ•°æ— æ„ä¹‰&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*RETRIES_CONFIG*, 10);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;retry.backoff.ms&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;é‡è¯•çš„æ—¶é—´é—´éš”&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*RETRY_BACKOFF_MS_CONFIG*, 100);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;&lt;strong&gt;max.in.flight.requests.per.connection&lt;/strong&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;5&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;é…ç½®å•ä¸ªè¿æ¥æœ€å¤§ç¼“å­˜è¯·æ±‚æ•°é‡ï¼Œå‘é€çš„è¯·æ±‚ ProducerBatch ä¼šç¼“å­˜åˆ° InFlightRequests ä¸­ï¼Œæ­¤å‚æ•°é™åˆ¶ InFlightRequests çš„å¤§å°ï¼Œé»˜è®¤ 5ï¼Œå³æ¯ä¸ªè¿æ¥æœ€å¤šåªèƒ½ç¼“å­˜ 5 ä¸ªæœªå“åº”çš„è¯·æ±‚&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION*, 5);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;request.timeout.ms&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;30 * 1000&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;Producer ç­‰å¾…è¯·æ±‚å“åº”çš„æœ€é•¿æ—¶é—´ï¼Œé»˜è®¤ 30sï¼Œå¦‚æœåœ¨ 30s å†…æ²¡æœ‰æ”¶åˆ°å“åº”ï¼Œé‚£ä¹ˆä¼šé‡å‘æ¶ˆæ¯è¿™ä¸ªå‚æ•°éœ€è¦æ¯” broker ç«¯çš„å‚æ•° replica.lag.time.max.msï¼ˆFollower å‰¯æœ¬èƒ½å¤Ÿè½å Leader å‰¯æœ¬çš„æœ€é•¿æ—¶é—´é—´éš”ï¼Œé»˜è®¤å€¼æ˜¯ 10 ç§’ï¼‰å¤§ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°æ¶ˆæ¯ä¸¢å¤±&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*REQUEST_TIMEOUT_MS_CONFIG*, 30 * 1000);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;linger.ms&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;0&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;æŒ‡å®šç”Ÿäº§è€…å‘é€ ProducerBatch ä¹‹å‰ç­‰å¾…æ›´å¤šæ¶ˆæ¯åŠ å…¥åˆ° ProducerBatch çš„æ—¶é—´ï¼Œé»˜è®¤ 0ï¼Œå³ç«‹å³å‘é€ï¼Œè¿™ä¸ªå‚æ•°ä¸ TCP çš„ Nagle ç®—æ³•ç±»ä¼¼&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*LINGER_MS_CONFIG*, 0);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;send.buffer.bytes&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;128 * 1024&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;è®¾ç½® socket å‘é€ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤ 128kï¼Œå¦‚æœè®¾ç½®ä¸º -1ï¼Œé‚£ä¹ˆä½¿ç”¨æ“ä½œç³»ç»Ÿé»˜è®¤çš„å¤§å°&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*SEND_BUFFER_CONFIG*, 128 * 1024);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;interceptor.classes&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;æ¶ˆæ¯å‘é€æ‹¦æˆªå™¨æ¶ˆæ¯å‘é€åˆ° broker ä¹‹å‰æ‹¦æˆªï¼Œå¯ä¿®æ”¹æ¶ˆæ¯å†…å®¹å®ç° ProducerInterceptor æ¥å£&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*INTERCEPTOR_CLASSES_CONFIG*, ProducerInterceptorPrefix.class.getName());&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;buffer.memory&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;32 * 1024 * 1024&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;ç¼“å­˜æ¶ˆæ¯å¤§å°ç”Ÿäº§è€…ä¸»çº¿ç¨‹ä¼šå°†æ¶ˆæ¯ç¼“å­˜åˆ° RecordAccumulator ä¸­ï¼Œç„¶åç”± Sender çº¿ç¨‹å‘é€åˆ° Kafkaï¼Œè¿™é‡Œçš„å‚æ•°æ˜¯ RecordAccumulator çš„ç¼“å­˜å¤§å°ï¼Œé»˜è®¤ 32M&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;// ç¼“å­˜æ¶ˆæ¯å¤§å°ï¼Œç”Ÿäº§è€…ä¸»çº¿ç¨‹ä¼šå°†æ¶ˆæ¯ç¼“å­˜åˆ°RecordAccumulatorä¸­ï¼Œç„¶åç”±Senderçº¿ç¨‹å‘é€åˆ°Kafkaï¼Œè¿™é‡Œçš„å‚æ•°æ˜¯RecordAccumulatorçš„ç¼“å­˜å¤§å°ï¼Œé»˜è®¤32M *properties*.put(ProducerConfig.*BUFFER_MEMORY_CONFIG*, 32 * 1024 * 1024L);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;max.block.ms&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;60 * 1000&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;RecordAccumulator ç¼“å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œæœ€å¤§é˜»å¡æ—¶é—´ï¼Œé»˜è®¤ 60s&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;// RecordAccumulatorç¼“å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œæœ€å¤§é˜»å¡æ—¶é—´ï¼Œé»˜è®¤60s *properties*.put(ProducerConfig.*MAX_BLOCK_MS_CONFIG*, 60 * 1000);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;batch.size&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;16 * 1024&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;å•æ¬¡å‘é€æ¶ˆæ¯å¤§å°ï¼Œkafka ä¼šå°†æ¶ˆæ¯ç»„è£…ä¸º ProducerBatchï¼Œæ­¤å‚æ•°å½±å“ ProducerBatch çš„å¤§å°ï¼Œå¦‚æœæ¶ˆæ¯å°äºæ­¤å‚æ•°ï¼Œåˆ™ä¼šé€šè¿‡ BufferPool è¿›è¡Œå¤ç”¨ï¼Œé»˜è®¤ 16k&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*BATCH_SIZE_CONFIG*, 16 * 1024);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;max.request.size&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;1024 * 1024&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;å®¢æˆ·ç«¯èƒ½å‘é€æ¶ˆæ¯çš„æœ€å¤§å€¼ï¼Œé»˜è®¤ 1Mï¼Œä¸å»ºè®®ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œå› ä¸ºæ¶‰åŠåˆ° broker ç«¯çš„å‚æ•°å®¢æˆ·ç«¯èƒ½å‘é€æ¶ˆæ¯çš„æœ€å¤§å€¼ï¼Œé»˜è®¤ 1Mï¼Œä¸å»ºè®®ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œå› ä¸ºæ¶‰åŠåˆ° broker ç«¯çš„å‚æ•°&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*MAX_REQUEST_SIZE_CONFIG*, 1024 * 1024);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;compression.type&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;none&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;æ¶ˆæ¯å‹ç¼©æ–¹å¼ï¼Œé»˜è®¤æ˜¯ noneï¼Œæ”¯æŒ noneã€gzipã€snappyã€lz4ï¼Œå¦‚æœéœ€è¦æå‡ååé‡ï¼Œå¯ä»¥å¼€å¯æ¶ˆæ¯å‹ç¼©&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*COMPRESSION_TYPE_CONFIG*, &amp;quot;none&amp;quot;);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td align=&quot;left&quot;&gt;connections.max.idle.ms&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;9 * 60 * 1000&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;å…³é—­é—²ç½®çš„è¿æ¥ï¼Œé»˜è®¤ 9 åˆ†é’Ÿï¼Œå¦‚æœç”Ÿäº§è€…åœ¨ 9 åˆ†é’Ÿå†…æ²¡æœ‰å‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆç”Ÿäº§è€…ä¼šå…³é—­è¿æ¥ï¼Œå¦‚æœç”Ÿäº§è€…åœ¨ 9 åˆ†é’Ÿå†…å‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆç”Ÿäº§è€…ä¼šé‡ç½®é—²ç½®æ—¶é—´&lt;/td&gt;
&lt;td align=&quot;left&quot;&gt;&lt;code&gt;*properties*.put(ProducerConfig.*CONNECTIONS_MAX_IDLE_MS_CONFIG*, 9 * 60 * 1000);&lt;/code&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;&lt;/table&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;49&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;50&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;51&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;52&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;53&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;54&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;55&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;56&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;57&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;58&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;59&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;60&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;61&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;62&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;63&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;64&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;65&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;66&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;67&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;68&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;69&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;70&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;71&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;72&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;73&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;74&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;75&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;76&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;77&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;78&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;79&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;80&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;81&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;82&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;83&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;84&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;85&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;86&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.BOOTSTRAP_SERVERS_CONFIG, brokerList);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG, StringSerializer.class.getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å‘é€æ‹¦æˆªå™¨&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.INTERCEPTOR_CLASSES_CONFIG, ProducerInterceptorPrefix.class.getName());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ç”Ÿäº§è€…å‘é€é…ç½®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ç¼“å­˜æ¶ˆæ¯å¤§å°ï¼Œç”Ÿäº§è€…ä¸»çº¿ç¨‹ä¼šå°†æ¶ˆæ¯ç¼“å­˜åˆ°RecordAccumulatorä¸­ï¼Œç„¶åç”±Senderçº¿ç¨‹å‘é€åˆ°Kafkaï¼Œè¿™é‡Œçš„å‚æ•°æ˜¯RecordAccumulatorçš„ç¼“å­˜å¤§å°ï¼Œé»˜è®¤32M&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.BUFFER_MEMORY_CONFIG, &lt;span class=&quot;number&quot;&gt;32&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1024L&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// RecordAccumulatorç¼“å­˜ç©ºé—´ä¸è¶³æ—¶ï¼Œæœ€å¤§é˜»å¡æ—¶é—´ï¼Œé»˜è®¤60s&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.MAX_BLOCK_MS_CONFIG, &lt;span class=&quot;number&quot;&gt;60&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å•æ¬¡å‘é€æ¶ˆæ¯å¤§å°ï¼Œkafkaä¼šå°†æ¶ˆæ¯ç»„è£…ä¸ºProducerBatchï¼Œæ­¤å‚æ•°å½±å“ProducerBatchçš„å¤§å°ï¼Œå¦‚æœæ¶ˆæ¯å°äºæ­¤å‚æ•°ï¼Œåˆ™ä¼šé€šè¿‡pBufferPoolè¿›è¡Œå¤ç”¨ï¼Œé»˜è®¤16k&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.BATCH_SIZE_CONFIG, &lt;span class=&quot;number&quot;&gt;16&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// é…ç½®å•ä¸ªè¿æ¥æœ€å¤§ç¼“å­˜è¯·æ±‚æ•°é‡ï¼Œå‘é€çš„è¯·æ±‚ProducerBatchä¼šç¼“å­˜åˆ°InFlightRequestsä¸­ï¼Œæ­¤å‚æ•°é™åˆ¶InFlightRequestsçš„å¤§å°ï¼Œé»˜è®¤5ï¼Œå³æ¯ä¸ªè¿æ¥æœ€å¤šåªèƒ½ç¼“å­˜5ä¸ªæœªå“åº”çš„è¯·æ±‚&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// é‡è¦çš„ç”Ÿäº§è€…å‚æ•°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æŒ‡å®šåˆ†åŒºä¸­å¿…é¡»æœ‰å¤šå°‘ä¸ªå‰¯æœ¬æ”¶åˆ°æ¶ˆæ¯ï¼Œç”Ÿäº§è€…æ‰è®¤ä¸ºæ¶ˆæ¯å†™å…¥æˆåŠŸï¼Œé»˜è®¤1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// acks=1 ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°åˆ†åŒºleaderï¼Œleaderå°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ—¥å¿—åå³è¿”å›æˆåŠŸ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// acks=0 ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°åˆ†åŒºleaderï¼Œä¸ç­‰å¾…leaderå†™å…¥æœ¬åœ°æ—¥å¿—ï¼Œç›´æ¥è¿”å›æˆåŠŸ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// acks=all/acks=-1 ç”Ÿäº§è€…å‘é€æ¶ˆæ¯åˆ°åˆ†åŒºleaderï¼Œleaderå°†æ¶ˆæ¯å†™å…¥æœ¬åœ°æ—¥å¿—åï¼Œç­‰å¾…ISRä¸­æ‰€æœ‰å‰¯æœ¬éƒ½å†™å…¥æˆåŠŸåæ‰è¿”å›æˆåŠŸ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// acks=all ç­‰ä»·äº acks=-1 å¹¶ä¸ä¸€å®šæœ€å¯é ï¼Œå› ä¸ºISRä¸­çš„å‰¯æœ¬å¯èƒ½ä¼šå› ä¸ºå„ç§åŸå› ä¸å¯ç”¨ï¼Œå¯¼è‡´ISRå‰¯æœ¬åªæœ‰leaderèŠ‚ç‚¹ä¸€ä¸ªï¼Œå¦‚æœéœ€è¦è·å¾—æ›´é«˜çš„å¯é æ€§ï¼Œéœ€è¦é…ç½® min.insync.replicas å‚æ•°ï¼Œæ­¤å‚æ•°è¡¨ç¤ºISRä¸­è‡³å°‘æœ‰å¤šå°‘ä¸ªå‰¯æœ¬æ˜¯å¯ç”¨çš„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.ACKS_CONFIG, &lt;span class=&quot;string&quot;&gt;&amp;quot;all&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å®¢æˆ·ç«¯èƒ½å‘é€æ¶ˆæ¯çš„æœ€å¤§å€¼ï¼Œé»˜è®¤1Mï¼Œä¸å»ºè®®ä¿®æ”¹è¿™ä¸ªå€¼ï¼Œå› ä¸ºæ¶‰åŠåˆ°brokerç«¯çš„å‚æ•°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æ­¤å‚æ•°è¡¨ç¤ºå•æ¬¡ç½‘ç»œè¯·æ±‚çš„å¤§å°ï¼Œè¿™æ¬¡è¯·æ±‚ä¸­å¯èƒ½åŒ…å«å¾ˆå¤šä¸ªProducerBatch&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.MAX_REQUEST_SIZE_CONFIG, &lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æŒ‡å®šç”Ÿäº§è€…å‘é€ProducerBatchä¹‹å‰ç­‰å¾…æ›´å¤šæ¶ˆæ¯åŠ å…¥åˆ°ProducerBatchçš„æ—¶é—´ï¼Œé»˜è®¤0ï¼Œå³ç«‹å³å‘é€ï¼Œè¿™ä¸ªå‚æ•°ä¸TCPçš„Nagleç®—æ³•ç±»ä¼¼&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.LINGER_MS_CONFIG, &lt;span class=&quot;number&quot;&gt;0&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è®¾ç½®socketå‘é€ç¼“å†²åŒºå¤§å°ï¼Œé»˜è®¤128kï¼Œå¦‚æœè®¾ç½®ä¸º-1ï¼Œé‚£ä¹ˆä½¿ç”¨æ“ä½œç³»ç»Ÿé»˜è®¤çš„å¤§å°&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.SEND_BUFFER_CONFIG, &lt;span class=&quot;number&quot;&gt;128&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1024&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// Producerç­‰å¾…æ°¢æ°”å“åº”çš„æœ€é•¿æ—¶é—´ï¼Œé»˜è®¤30sï¼Œå¦‚æœåœ¨30så†…æ²¡æœ‰æ”¶åˆ°å“åº”ï¼Œé‚£ä¹ˆä¼šé‡å‘æ¶ˆæ¯&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// è¿™ä¸ªå‚æ•°éœ€è¦æ¯”brokerç«¯çš„å‚æ•°replica.lag.time.max.msï¼ˆFollower å‰¯æœ¬èƒ½å¤Ÿè½å Leader å‰¯æœ¬çš„æœ€é•¿æ—¶é—´é—´éš”ï¼Œé»˜è®¤å€¼æ˜¯ 10 ç§’ï¼‰å¤§ï¼Œå¦åˆ™å¯èƒ½ä¼šå‡ºç°æ¶ˆæ¯ä¸¢å¤±&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.REQUEST_TIMEOUT_MS_CONFIG, &lt;span class=&quot;number&quot;&gt;30&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// é…ç½®é‡è¯•æ¬¡æ•°ï¼Œé‡è¯•æ¬¡æ•°åªé™åˆ¶äºå¯é‡è¯•çš„å¼‚å¸¸ï¼Œä¸å¯é‡è¯•çš„å¼‚å¸¸æ­¤å‚æ•°æ— æ„ä¹‰&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.RETRIES_CONFIG, &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// é‡è¯•çš„æ—¶é—´é—´éš”&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.RETRY_BACKOFF_MS_CONFIG, &lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æŸäº›åœºæ™¯ä¸‹æ¶ˆæ¯çš„é¡ºåºæ˜¯éå¸¸é‡è¦çš„ï¼Œå¦‚æœretryé‡è¯•æ¬¡æ•°è®¾ç½®å¤§äº0 &amp;amp; max.in.flight.requests.per.connection &amp;gt; 1ï¼Œé‚£ä¹ˆå¯èƒ½ä¼šå¯¼è‡´æ¶ˆæ¯ä¹±åº&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æ¯”å¦‚ç¬¬ä¸€æ‰¹æ¬¡æ¶ˆæ¯å‘é€å¤±è´¥ï¼Œç¬¬äºŒæ‰¹æ¬¡æ¶ˆæ¯å‘é€æˆåŠŸï¼Œç¬¬ä¸€æ‰¹æ¬¡æ¶ˆæ¯é‡è¯•å‘é€æˆåŠŸï¼Œé‚£ä¹ˆç¬¬ä¸€æ‰¹æ¬¡æ¶ˆæ¯å°±ä¼šå‡ºç°åœ¨ç¬¬äºŒæ‰¹æ¬¡æ¶ˆæ¯ä¹‹å&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å»ºè®®å¦‚æœéœ€è¦ä¿è¯æ¶ˆæ¯çš„é¡ºåºï¼Œé‚£ä¹ˆå°†max.in.flight.requests.per.connectionè®¾ç½®ä¸º1ï¼Œè€Œä¸æ˜¯è®¾ç½®é‡è¯•æ¬¡æ•°ä¸º0ï¼Œä¸è¿‡è¿™æ ·ä¼šå¯¼è‡´ååé‡ä¸‹é™&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ? todo-wl å¦‚æœé‡è¯•æ¬¡æ•°=0ï¼Œmax.in.flight.requests.per.connection&amp;gt;1ï¼Œæ€ä¹ˆä¿è¯æ¶ˆæ¯æ˜¯æœ‰åºçš„ï¼Ÿ&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// -&amp;gt; å› ä¸ºå•æ¬¡ç½‘ç»œåŒ…å¯èƒ½åŒ…å«å¤šä¸ªProducerBatchï¼Œkafkaåœ¨å¤„ç†çš„æ—¶å€™ä¼šå°†å¤šä¸ªProducerBatchåˆå¹¶ä¸ºä¸€ä¸ªè¯·æ±‚ï¼ŒåŒæ—¶å¯¹äºåŒä¸€ä¸ªåˆ†åŒºçš„æ¶ˆæ¯ï¼Œkafkaä¼šä¿è¯æ¶ˆæ¯çš„é¡ºåºï¼Œæ‰€ä»¥èƒ½ä¿è¯æ¶ˆæ¯æ˜¯æœ‰åºçš„&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æ¶ˆæ¯å‹ç¼©æ–¹å¼ï¼Œé»˜è®¤æ˜¯noneï¼Œæ”¯æŒnoneã€gzipã€snappyã€lz4ï¼Œå¦‚æœéœ€è¦æå‡ååé‡ï¼Œå¯ä»¥å¼€å¯æ¶ˆæ¯å‹ç¼©&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.COMPRESSION_TYPE_CONFIG, &lt;span class=&quot;string&quot;&gt;&amp;quot;none&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å…³é—­é—²ç½®çš„è¿æ¥ï¼Œé»˜è®¤9åˆ†é’Ÿï¼Œå¦‚æœç”Ÿäº§è€…åœ¨9åˆ†é’Ÿå†…æ²¡æœ‰å‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆç”Ÿäº§è€…ä¼šå…³é—­è¿æ¥ï¼Œå¦‚æœç”Ÿäº§è€…åœ¨9åˆ†é’Ÿå†…å‘é€æ¶ˆæ¯ï¼Œé‚£ä¹ˆç”Ÿäº§è€…ä¼šé‡ç½®é—²ç½®æ—¶é—´&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.CONNECTIONS_MAX_IDLE_MS_CONFIG, &lt;span class=&quot;number&quot;&gt;9&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;60&lt;/span&gt; * &lt;span class=&quot;number&quot;&gt;1000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å¹‚ç­‰æ€§é…ç½®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å¼€å¯å¹‚ç­‰æ€§&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG, &lt;span class=&quot;literal&quot;&gt;true&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å¹‚ç­‰çš„åŸç†æ˜¯æ¶ˆè´¹è€…ä¼šè¢«åˆ†é…ä¸€ä¸ªpidï¼Œpidæ˜¯ä¸€ä¸ªé€’å¢çš„åºåˆ—å·ï¼Œç”Ÿäº§è€…æ¯å‘é€ä¸€æ¡æ¶ˆæ¯å°±ä¼šå°†&amp;lt;PID,åˆ†åŒº&amp;gt;å¯¹åº”çš„åºåˆ—å·+1&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å½“å‘é€æ¶ˆæ¯æ—¶ï¼Œä¼šå°†seqå‘é€åˆ°brokerï¼Œbrokerå†…å­˜ä¸­ä¿å­˜&amp;lt;PID,åˆ†åŒº&amp;gt;å¯¹åº”çš„åºåˆ—å·ï¼Œå¦‚æœseqå¤§äºbrokerä¸­çš„åºåˆ—å·+1ï¼Œé‚£ä¹ˆbrokerä¼šå°†æ¶ˆæ¯å†™å…¥æ—¥å¿—ï¼Œç„¶åæ›´æ–°åºåˆ—å·&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å¦‚æœseqå°äºbrokerä¸­çš„åºåˆ—å·+1ï¼Œé‚£ä¹ˆbrokerä¼šç›´æ¥è¿”å›æˆåŠŸï¼Œä¸ä¼šå†™å…¥æ—¥å¿—&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å¦‚æœseqå¤§äºbrokerä¸­çš„åºåˆ—å·+1ï¼Œé‚£ä¹ˆbrokerä¼šè¿”å›é”™è¯¯&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// !! Kafkaå¹‚ç­‰åªä¿è¯å•ä¸ªç”Ÿäº§è€…ä¼šè¯(session)ä¸­å•ä¸ªåˆ†åŒºå†…çš„å¹‚ç­‰æ€§ï¼Œä¸ä¿è¯å¤šä¸ªåˆ†åŒºä¹‹é—´çš„å¹‚ç­‰æ€§&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å¦‚æœæ²¡æœ‰é…ç½®ä»¥ä¸‹é…ç½®ï¼Œåªéœ€è¦é…ç½®ä¸Šé¢çš„é…ç½®å³å¯&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// retryé‡è¯•æ¬¡æ•°å¿…é¡»å¤§äº0&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.RETRIES_CONFIG, &lt;span class=&quot;number&quot;&gt;10&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// acks å¿…é¡»æ˜¯ all&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.ACKS_CONFIG, &lt;span class=&quot;string&quot;&gt;&amp;quot;all&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// max.in.flight.requests.per.connection ä¸èƒ½å¤§äº5&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION, &lt;span class=&quot;number&quot;&gt;5&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// äº‹åŠ¡é…ç½®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// å¹‚ç­‰æ€§ä¸èƒ½è·¨åˆ†åŒºï¼Œå¦‚æœéœ€è¦è·¨åˆ†åŒºçš„å¹‚ç­‰æ€§ï¼Œé‚£ä¹ˆéœ€è¦ä½¿ç”¨äº‹åŠ¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// äº‹åŠ¡å¯ä»¥ä¿è¯å¯¹å¤šä¸ªåˆ†åŒºå†™å…¥æ“ä½œçš„åŸå­æ€§&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;// kafkaä¸­çš„äº‹åŠ¡å¯ä»¥ä½¿åº”ç”¨ç¨‹åºå°†æ¶ˆè´¹æ¶ˆæ¯ã€ç”Ÿäº§æ¶ˆæ¯ã€æäº¤æ¶ˆè´¹ä½ç§»å½“åšåŸå­æ“ä½œæ¥å¤„ç†ï¼ŒåŒæ—¶æˆåŠŸæˆ–å¤±è´¥&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;static&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// å¿…é¡»æä¾›å”¯ä¸€çš„transactional.idï¼Œå¦‚æœtransactional.idç›¸åŒï¼Œé‚£ä¹ˆä¼šè®¤ä¸ºæ˜¯åŒä¸€ä¸ªäº‹åŠ¡&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// æ˜¾ç¤ºè®¾ç½®&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    properties.put(ProducerConfig.TRANSACTIONAL_ID_CONFIG, &lt;span class=&quot;string&quot;&gt;&amp;quot;transactional-id&amp;quot;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;comment&quot;&gt;// ï¼ï¼äº‹åŠ¡è¦æ±‚ç”Ÿäº§è€…å¼€å¯å¹‚ç­‰æ€§&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="https://taeyang0126.github.io/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://taeyang0126.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="https://taeyang0126.github.io/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    <category term="ä¸­é—´ä»¶" scheme="https://taeyang0126.github.io/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    <category term="kafka" scheme="https://taeyang0126.github.io/tags/kafka/"/>
    
  </entry>
  
  <entry>
    <title>pulsar-ä½¿ç”¨</title>
    <link href="https://taeyang0126.github.io/2025/02/09/xiao-xi-dui-lie/pulsar/shi-yong/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/xiao-xi-dui-lie/pulsar/shi-yong/posts/undefined/</id>
    <published>2025-02-09T11:51:22.000Z</published>
    <updated>2025-02-10T14:16:05.825Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åˆ›å»ºä½¿ç”¨"><a href="#åˆ›å»ºä½¿ç”¨" class="headerlink" title="åˆ›å»ºä½¿ç”¨"></a>åˆ›å»ºä½¿ç”¨</h2><ul><li>docker å•æœºåˆ›å»º</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -it \</span><br><span class="line">    -p 6650:6650 \</span><br><span class="line">    -p 8650:8080 \</span><br><span class="line">    -v /Users/wulei/devTools/pulsar/data:/pulsar/data \</span><br><span class="line">    --name pulsar-standalone \</span><br><span class="line">    apachepulsar/pulsar:latest \</span><br><span class="line">    bin/pulsar standalone</span><br></pre></td></tr></table></figure><ul><li>å¯è§†åŒ– pulsar-manager</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">docker pull apachepulsar/pulsar-manager:v0.3.0</span><br><span class="line">docker run -d -it \</span><br><span class="line">    -p 9527:9527 -p 7750:7750 \</span><br><span class="line">    -e SPRING_CONFIGURATION_FILE=/pulsar-manager/pulsar-manager/application.properties \</span><br><span class="line">    --<span class="built_in">link</span> pulsar-standalone \</span><br><span class="line">    --name pulsar-manager\</span><br><span class="line">    apachepulsar/pulsar-manager:v0.3.0</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»º pulsar-manager admin ç”¨æˆ·ï¼Œç”¨æˆ·åï¼š admin å¯†ç ï¼š apachepulsar</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">CSRF_TOKEN=$(curl http://localhost:7750/pulsar-manager/csrf-token)</span><br><span class="line">curl \</span><br><span class="line">   -H <span class="string">&#x27;X-XSRF-TOKEN: $CSRF_TOKEN&#x27;</span> \</span><br><span class="line">   -H <span class="string">&#x27;Cookie: XSRF-TOKEN=$CSRF_TOKEN;&#x27;</span> \</span><br><span class="line">   -H <span class="string">&quot;Content-Type: application/json&quot;</span> \</span><br><span class="line">   -X PUT http://localhost:7750/pulsar-manager/users/superuser \</span><br><span class="line">   -d <span class="string">&#x27;&#123;&quot;name&quot;: &quot;admin&quot;, &quot;password&quot;: &quot;apachepulsar&quot;, &quot;description&quot;: &quot;test&quot;, &quot;email&quot;: &quot;username@test.org&quot;&#125;&#x27;</span></span><br></pre></td></tr></table></figure><ul><li>Pulsar-manager è¿æ¥ pulsar é›†ç¾¤ï¼Œæ³¨æ„ä½¿ç”¨å®¹å™¨åç§°+å®¹å™¨å†…éƒ¨ç«¯å£è¿›è¡Œè¿æ¥</li></ul><p><img data-src="/images/message/pulsar/01.png" alt="img"></p><ul><li>åˆ›å»ºç§Ÿæˆ·</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/pulsar-admin tenants create lei-learn</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»º namespace</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./bin/pulsar-admin namespaces create lei-learn/dev</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»º topic</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/bin/pulsar-admin topics create persistent://lei-learn/dev/string</span><br><span class="line"><span class="comment"># åˆ›å»º5ä¸ªåˆ†åŒºçš„topic</span></span><br><span class="line">/bin/pulsar-admin topics create-partitioned-topic -p 5 persistent://lei-learn/dev/string</span><br></pre></td></tr></table></figure><ul><li>æ˜¾ç¤ºæŸä¸ª namespace ä¸‹çš„ topic</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/pulsar-admin topics list lei-learn/dev/</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;åˆ›å»ºä½¿ç”¨&quot;&gt;&lt;a href=&quot;#åˆ›å»ºä½¿ç”¨&quot; class=&quot;headerlink&quot; title=&quot;åˆ›å»ºä½¿ç”¨&quot;&gt;&lt;/a&gt;åˆ›å»ºä½¿ç”¨&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;docker å•æœºåˆ›å»º&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight bash&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;docker run -d -it &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -p 6650:6650 &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -p 8650:8080 &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    -v /Users/wulei/devTools/pulsar/data:/pulsar/data &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    --name pulsar-standalone &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    apachepulsar/pulsar:latest &#92;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    bin/pulsar standalone&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="https://taeyang0126.github.io/categories/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://taeyang0126.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    <category term="æ¶ˆæ¯é˜Ÿåˆ—" scheme="https://taeyang0126.github.io/tags/%E6%B6%88%E6%81%AF%E9%98%9F%E5%88%97/"/>
    
    <category term="ä¸­é—´ä»¶" scheme="https://taeyang0126.github.io/tags/%E4%B8%AD%E9%97%B4%E4%BB%B6/"/>
    
    <category term="pulsar" scheme="https://taeyang0126.github.io/tags/pulsar/"/>
    
  </entry>
  
  <entry>
    <title>raft</title>
    <link href="https://taeyang0126.github.io/2025/02/09/fen-bu-shi/suan-fa/raft/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/fen-bu-shi/suan-fa/raft/posts/undefined/</id>
    <published>2025-02-09T11:50:22.000Z</published>
    <updated>2025-02-10T14:16:05.825Z</updated>
    
    <content type="html"><![CDATA[<h2 id="Raft-çš„æ ¸å¿ƒç›®æ ‡å’ŒåŸºæœ¬å·¥ä½œåŸç†"><a href="#Raft-çš„æ ¸å¿ƒç›®æ ‡å’ŒåŸºæœ¬å·¥ä½œåŸç†" class="headerlink" title="Raft çš„æ ¸å¿ƒç›®æ ‡å’ŒåŸºæœ¬å·¥ä½œåŸç†"></a>Raft çš„æ ¸å¿ƒç›®æ ‡å’ŒåŸºæœ¬å·¥ä½œåŸç†</h2><p>æ ¸å¿ƒç›®æ ‡ï¼š</p><ul><li>åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¾¾æˆå…±è¯†ï¼Œå®ç°å¼ºä¸€è‡´æ€§ã€‚</li><li>åœ¨ä¿è¯ä¸€è‡´æ€§çš„åŸºç¡€ä¸Šè¿›è¡Œå¯é çš„æ•°æ®å¤åˆ¶ã€‚</li></ul><p>åŸºæœ¬å·¥ä½œåŸç†ï¼š</p><ul><li>é¢†å¯¼è€…é€‰ä¸¾ï¼šä½¿ç”¨éšæœºåŒ–çš„é€‰ä¸¾è¶…æ—¶æœºåˆ¶ã€‚</li><li>æ—¥å¿—å¤åˆ¶ï¼šé‡‡ç”¨ WALï¼ˆWrite-Ahead Loggingï¼‰æ–¹å¼ã€‚</li><li>å®‰å…¨æ€§ä¿è¯ï¼šç¡®ä¿åªæœ‰åŒ…å«å…¨éƒ¨å·²æäº¤æ—¥å¿—çš„èŠ‚ç‚¹æ‰èƒ½æˆä¸ºé¢†å¯¼è€…ã€‚</li><li>æˆå‘˜ç®¡ç†ï¼šæ”¯æŒåŠ¨æ€çš„æˆå‘˜å˜æ›´ã€‚</li></ul><p>å…³é”®ç‰¹æ€§ï¼š</p><ul><li>å°†é—®é¢˜åˆ†è§£ä¸ºç›¸å¯¹ç‹¬ç«‹çš„å­é—®é¢˜ï¼šé¢†å¯¼è€…é€‰ä¸¾ã€æ—¥å¿—å¤åˆ¶å’Œå®‰å…¨æ€§ã€‚</li><li>ä½¿ç”¨ termï¼ˆä»»æœŸï¼‰ä½œä¸ºé€»è¾‘æ—¶é’Ÿï¼Œç®¡ç†æ•´ä¸ªé›†ç¾¤çš„æ—¶åºã€‚</li><li>è¦æ±‚å¤šæ•°èŠ‚ç‚¹ç¡®è®¤ä»¥æäº¤æ—¥å¿—ï¼Œä¿è¯æ•°æ®å®‰å…¨æ€§ã€‚</li></ul><h2 id="Term-çš„æ¦‚å¿µå’Œä½œç”¨"><a href="#Term-çš„æ¦‚å¿µå’Œä½œç”¨" class="headerlink" title="Term çš„æ¦‚å¿µå’Œä½œç”¨"></a>Term çš„æ¦‚å¿µå’Œä½œç”¨</h2><p>å®šä¹‰ï¼š</p><ul><li>Term æ˜¯ Raft ä¸­çš„é€»è¾‘æ—¶é’Ÿæ¦‚å¿µï¼Œè¡¨ç¤ºé¢†å¯¼è€…çš„ä»»æœŸã€‚</li><li>æ¯ä¸ª term ç”±ä¸€æ¬¡é€‰ä¸¾å¼€å§‹ï¼Œå¯èƒ½æœ‰ä¸€ä¸ªé¢†å¯¼è€…ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ï¼ˆé€‰ä¸¾å¤±è´¥ï¼‰ã€‚</li></ul><p>ä½œç”¨ï¼š</p><ul><li>æ ‡è¯†é›†ç¾¤çš„é€»è¾‘æ—¶é—´ï¼Œç”¨äºæ£€æµ‹è¿‡æ—¶çš„ä¿¡æ¯ã€‚</li><li>åœ¨é€‰ä¸¾ä¸­ç¡®ä¿æ–°é¢†å¯¼è€…åŒ…å«æ‰€æœ‰å·²æäº¤çš„æ—¥å¿—ã€‚</li><li>åœ¨ç½‘ç»œåˆ†åŒºæ¢å¤åï¼Œå¸®åŠ©è¯†åˆ«å’ŒåºŸé™¤æ—§çš„é¢†å¯¼è€…ã€‚</li><li>åœ¨æ‰€æœ‰ Raft çš„å†³ç­–è¿‡ç¨‹ä¸­èµ·å…³é”®ä½œç”¨ï¼Œå¦‚æ—¥å¿—å¤åˆ¶ã€æäº¤åˆ¤æ–­ç­‰ã€‚</li></ul><p>æ›´æ–°æœºåˆ¶ï¼š</p><ul><li>èŠ‚ç‚¹åœ¨å¼€å§‹æ–°é€‰ä¸¾æ—¶å¢åŠ è‡ªå·±çš„ termã€‚</li><li>èŠ‚ç‚¹åœ¨æ”¶åˆ°åŒ…å«æ›´é«˜ term çš„æ¶ˆæ¯æ—¶æ›´æ–°è‡ªå·±çš„ termã€‚</li></ul><h2 id="é¢†å¯¼è€…é€‰ä¸¾è¿‡ç¨‹"><a href="#é¢†å¯¼è€…é€‰ä¸¾è¿‡ç¨‹" class="headerlink" title="é¢†å¯¼è€…é€‰ä¸¾è¿‡ç¨‹"></a>é¢†å¯¼è€…é€‰ä¸¾è¿‡ç¨‹</h2><p>è§¦å‘æ¡ä»¶ï¼š</p><ul><li>Follower åœ¨é€‰ä¸¾è¶…æ—¶æ—¶é—´å†…æ²¡æœ‰æ”¶åˆ°æ¥è‡ª Leader çš„å¿ƒè·³ã€‚</li></ul><p>é€‰ä¸¾æ­¥éª¤ï¼š</p><ul><li>Follower è½¬å˜ä¸º Candidateï¼Œå¢åŠ å½“å‰ termï¼ŒæŠ•ç¥¨ç»™è‡ªå·±ã€‚</li><li>å‘é€ RequestVote RPC ç»™å…¶ä»–èŠ‚ç‚¹ï¼ŒåŒ…å«è‡ªå·±çš„ term å’Œæœ€åä¸€æ¡æ—¥å¿—çš„ index å’Œ termã€‚</li><li>å…¶ä»–èŠ‚ç‚¹æ ¹æ®ä»¥ä¸‹è§„åˆ™å†³å®šæ˜¯å¦æŠ•ç¥¨ï¼š <ul><li>å¦‚æœæ¥æ”¶åˆ°çš„ term å¤§äºè‡ªå·±çš„ termï¼Œåˆ™æ›´æ–°è‡ªå·±çš„ term å¹¶æŠ•ç¥¨ã€‚</li><li>å¦‚æœ term ç›¸åŒï¼Œæ¯”è¾ƒæ—¥å¿—çš„æ–°æ—§ç¨‹åº¦ï¼ˆå…ˆæ¯”è¾ƒæœ€åä¸€æ¡æ—¥å¿—çš„ termï¼Œå†æ¯”è¾ƒ indexï¼‰ã€‚</li><li>å¦‚æœæ¥æ”¶åˆ°çš„ term å°äºè‡ªå·±çš„ termï¼Œæ‹’ç»æŠ•ç¥¨å¹¶è¿”å›è‡ªå·±çš„ termã€‚</li></ul></li><li>å¦‚æœ Candidate æ”¶åˆ°å¤šæ•°é€‰ç¥¨ï¼Œåˆ™æˆä¸ºæ–°çš„ Leaderã€‚</li><li>å¦‚æœåœ¨ç­‰å¾…è¿‡ç¨‹ä¸­æ”¶åˆ°æ›´é«˜ term çš„æ¶ˆæ¯ï¼Œåˆ™è½¬ä¸º Followerã€‚</li></ul><p>é˜²æ­¢é€‰ç¥¨åˆ†è£‚ï¼š</p><ul><li>ä½¿ç”¨éšæœºåŒ–çš„é€‰ä¸¾è¶…æ—¶æ—¶é—´ï¼Œå‡å°‘å¤šä¸ªèŠ‚ç‚¹åŒæ—¶å‘èµ·é€‰ä¸¾çš„å¯èƒ½æ€§ã€‚</li></ul><p>é¢„é€‰ç¥¨æœºåˆ¶ï¼ˆä¼˜åŒ–ï¼‰ï¼š</p><ul><li>åœ¨æ­£å¼é€‰ä¸¾å‰è¿›è¡Œé¢„é€‰ç¥¨é˜¶æ®µï¼Œä¸å¢åŠ  termã€‚</li><li>æœ‰åŠ©äºé˜²æ­¢ç½‘ç»œåˆ†åŒºåçš„ä¸å¿…è¦ term å¢åŠ ã€‚</li></ul><h2 id="æ—¥å¿—ä¸€è‡´æ€§ä¿è¯"><a href="#æ—¥å¿—ä¸€è‡´æ€§ä¿è¯" class="headerlink" title="æ—¥å¿—ä¸€è‡´æ€§ä¿è¯"></a>æ—¥å¿—ä¸€è‡´æ€§ä¿è¯</h2><p>Log Matching Property: </p><ul><li>å¦‚æœä¸¤ä¸ªæ—¥å¿—åœ¨ç›¸åŒç´¢å¼•ä½ç½®çš„æ—¥å¿—æ¡ç›®å…·æœ‰ç›¸åŒçš„ termï¼Œåˆ™è¿™ä¸¤ä¸ªæ—¥å¿—åœ¨è¯¥ç´¢å¼•ä¹‹å‰çš„æ‰€æœ‰æ¡ç›®éƒ½ç›¸åŒã€‚</li></ul><p>å®ç°æœºåˆ¶ï¼š</p><ul><li>Leader åœ¨ AppendEntries RPC ä¸­åŒ…å« prevLogIndex å’Œ prevLogTermã€‚</li><li>Follower åœ¨æ¥æ”¶æ–°æ—¥å¿—å‰ï¼Œæ£€æŸ¥è‡ªå·±åœ¨ prevLogIndex ä½ç½®çš„æ—¥å¿—æ¡ç›®çš„ term æ˜¯å¦ä¸ prevLogTerm åŒ¹é…ã€‚</li><li>å¦‚æœåŒ¹é…ï¼Œåˆ™æ¥å—æ–°çš„æ—¥å¿—æ¡ç›®ï¼›å¦‚æœä¸åŒ¹é…ï¼Œåˆ™æ‹’ç»å¹¶è¿”å›å†²çªä¿¡æ¯ã€‚</li><li>Leader æ”¶åˆ°æ‹’ç»åï¼Œé€’å‡ nextIndex å¹¶é‡è¯•ï¼Œç›´åˆ°æ‰¾åˆ°åŒ¹é…ç‚¹ã€‚</li></ul><p>è¿™ç§æœºåˆ¶é€šè¿‡é€’å½’æ€§è´¨ä¿è¯äº†æ‰€æœ‰ä¹‹å‰çš„æ—¥å¿—ä¹Ÿæ˜¯ä¸€è‡´çš„ã€‚</p><h2 id="commitIndex-å’Œ-lastApplied"><a href="#commitIndex-å’Œ-lastApplied" class="headerlink" title="commitIndex å’Œ lastApplied"></a>commitIndex å’Œ lastApplied</h2><p>commitIndex: </p><ul><li>ä¸»è¦åœ¨ Leader ä¸Šç»´æŠ¤ã€‚</li><li>è¡¨ç¤ºæœ€åä¸€ä¸ªå·²çŸ¥è¢«æäº¤ï¼ˆå³ï¼Œè¢«å¤šæ•°èŠ‚ç‚¹å¤åˆ¶ï¼‰çš„æ—¥å¿—æ¡ç›®çš„ç´¢å¼•ã€‚</li><li>æ›´æ–°è§„åˆ™ï¼šLeader æ‰¾å‡º matchIndex ä¸­è¶…è¿‡åŠæ•°èŠ‚ç‚¹éƒ½å¤§äºç­‰äºçš„æœ€å¤§å€¼ï¼Œä¸”å¯¹åº”æ—¥å¿—çš„ term ç­‰äºå½“å‰ termã€‚</li></ul><p>lastApplied: </p><ul><li>åœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šç»´æŠ¤ã€‚</li><li>è¡¨ç¤ºæœ€åä¸€ä¸ªè¢«åº”ç”¨åˆ°çŠ¶æ€æœºçš„æ—¥å¿—æ¡ç›®çš„ç´¢å¼•ã€‚</li><li>æ›´æ–°è§„åˆ™ï¼šæˆåŠŸå°†æ—¥å¿—åº”ç”¨åˆ°çŠ¶æ€æœºåæ›´æ–°ã€‚</li></ul><p>å…³ç³»ï¼šlastApplied â‰¤ commitIndex</p><p>Follower æ›´æ–° commitIndexï¼šé€šè¿‡ Leader çš„ AppendEntries RPC ä¸­çš„ leaderCommit å­—æ®µæ›´æ–°ã€‚</p><h2 id="ç½‘ç»œåˆ†åŒºï¼ˆè„‘è£‚ï¼‰çš„å¤„ç†"><a href="#ç½‘ç»œåˆ†åŒºï¼ˆè„‘è£‚ï¼‰çš„å¤„ç†" class="headerlink" title="ç½‘ç»œåˆ†åŒºï¼ˆè„‘è£‚ï¼‰çš„å¤„ç†"></a>ç½‘ç»œåˆ†åŒºï¼ˆè„‘è£‚ï¼‰çš„å¤„ç†</h2><p>é˜²æ­¢è„‘è£‚çš„æ ¸å¿ƒæœºåˆ¶ï¼š</p><ul><li>è¦æ±‚å¤šæ•°èŠ‚ç‚¹çš„åŒæ„æ‰èƒ½é€‰ä¸¾ Leader å’Œæäº¤æ—¥å¿—ã€‚</li></ul><p>å…·ä½“è¡¨ç°ï¼š</p><ul><li>åœ¨ç½‘ç»œåˆ†åŒºæƒ…å†µä¸‹ï¼Œåªæœ‰åŒ…å«å¤šæ•°èŠ‚ç‚¹çš„åˆ†åŒºèƒ½é€‰å‡ºæ–° Leaderã€‚</li><li>å°‘æ•°æ´¾åˆ†åŒºå¯èƒ½ä¼šä¸æ–­å°è¯•é€‰ä¸¾ï¼Œä½†æ— æ³•è·å¾—å¤šæ•°é€‰ç¥¨ï¼Œå› æ­¤ä¸ä¼šæˆåŠŸã€‚</li><li>å½“ç½‘ç»œåˆ†åŒºæ¢å¤æ—¶ï¼Œè¾ƒé«˜ term çš„ Leader ä¼šä½¿å…¶ä»–èŠ‚ç‚¹å›å½’åˆ° Follower çŠ¶æ€ã€‚</li></ul><p>ä¼˜åŒ–ï¼šä½¿ç”¨é¢„é€‰ç¥¨æœºåˆ¶å‡å°‘ä¸å¿…è¦çš„ term å¢åŠ ã€‚</p><h2 id="æˆå‘˜å˜æ›´è¿‡ç¨‹"><a href="#æˆå‘˜å˜æ›´è¿‡ç¨‹" class="headerlink" title="æˆå‘˜å˜æ›´è¿‡ç¨‹"></a>æˆå‘˜å˜æ›´è¿‡ç¨‹</h2><p>ä¸¤é˜¶æ®µè¿‡ç¨‹ï¼š</p><p>ç¬¬ä¸€é˜¶æ®µï¼ˆè”åˆå…±è¯†ï¼‰ï¼š</p><ul><li>Leader åˆ›å»ºåŒ…å«æ–°æ—§é…ç½®çš„ç‰¹æ®Šæ—¥å¿—æ¡ç›®ï¼ˆC_old+C_newï¼‰ã€‚</li><li>å¤åˆ¶è¿™ä¸ªæ—¥å¿—åˆ°é›†ç¾¤ä¸­çš„å¤šæ•°èŠ‚ç‚¹ï¼ˆåŒ…æ‹¬æ–°æ—§é…ç½®ä¸­çš„èŠ‚ç‚¹ï¼‰ã€‚</li><li>åœ¨è¿™ä¸ªé˜¶æ®µï¼Œæ‰€æœ‰å†³ç­–ï¼ˆæ—¥å¿—æäº¤ã€é€‰ä¸¾ï¼‰éœ€è¦åŒæ—¶æ»¡è¶³æ–°æ—§é…ç½®çš„å¤šæ•°è¦æ±‚ã€‚</li></ul><p>ç¬¬äºŒé˜¶æ®µï¼ˆæ–°é…ç½®ï¼‰ï¼š</p><ul><li>å½“ç¬¬ä¸€é˜¶æ®µçš„æ—¥å¿—è¢«æäº¤ï¼Œä¸”æ–°èŠ‚ç‚¹å·²ç»å……åˆ†åŒæ­¥åï¼ŒLeader åˆ›å»ºåªåŒ…å«æ–°é…ç½®çš„æ—¥å¿—æ¡ç›®ï¼ˆC_newï¼‰ã€‚</li><li>å½“è¿™ä¸ªæ–°é…ç½®æ—¥å¿—è¢«æäº¤åï¼Œé›†ç¾¤å®Œå…¨åˆ‡æ¢åˆ°æ–°é…ç½®ã€‚</li></ul><p>è®¾è®¡åŸå› ï¼š</p><ul><li>ç¡®ä¿åœ¨é…ç½®å˜æ›´è¿‡ç¨‹ä¸­ä¸ä¼šå‡ºç°å†³ç­–å†²çªã€‚</li><li>å…è®¸æ–°èŠ‚ç‚¹åœ¨å‚ä¸é›†ç¾¤å†³ç­–ä¹‹å‰æœ‰æ—¶é—´åŒæ­¥æ—¥å¿—ã€‚</li><li>ä¿è¯åœ¨ä»»ä½•æ—¶å€™éƒ½æœ‰ä¸€ä¸ªæ˜ç¡®çš„ã€ä¸€è‡´çš„é›†ç¾¤é…ç½®ã€‚</li></ul><h2 id="æ—¥å¿—å‹ç¼©"><a href="#æ—¥å¿—å‹ç¼©" class="headerlink" title="æ—¥å¿—å‹ç¼©"></a>æ—¥å¿—å‹ç¼©</h2><p>å¿«ç…§æœºåˆ¶ï¼š</p><ul><li>å®šæœŸåˆ›å»ºåŒ…å«å®Œæ•´çŠ¶æ€æœºçŠ¶æ€çš„å¿«ç…§ã€‚</li><li>åˆ›å»ºå¿«ç…§åï¼Œå¯ä»¥å®‰å…¨åœ°ä¸¢å¼ƒè¯¥ç‚¹ä¹‹å‰çš„æ‰€æœ‰æ—¥å¿—ã€‚</li><li>å¿«ç…§åŒ…å«ï¼šæœ€ååº”ç”¨çš„æ—¥å¿—çš„ index å’Œ termï¼Œæœ€æ–°çš„é›†ç¾¤é…ç½®ã€‚</li></ul><p>ç”¨é€”ï¼š</p><ul><li>å‡å°‘å­˜å‚¨ç©ºé—´ä½¿ç”¨ã€‚</li><li>åŠ é€Ÿé‡å¯è¿‡ç¨‹ã€‚</li><li>å¸®åŠ©è½åå¤ªå¤šçš„èŠ‚ç‚¹å¿«é€Ÿèµ¶ä¸Šï¼ˆé€šè¿‡ç›´æ¥å‘é€å¿«ç…§ï¼‰ã€‚</li></ul><p>é’ˆå¯¹ç‰¹å®šåº”ç”¨çš„ä¼˜åŒ–ï¼š</p><ul><li>å¯¹äº KV å­˜å‚¨ï¼Œå¯ä»¥åªä¿ç•™æ¯ä¸ª key çš„æœ€æ–°å€¼ã€‚</li></ul><h2 id="è¯»æ“ä½œä¼˜åŒ–"><a href="#è¯»æ“ä½œä¼˜åŒ–" class="headerlink" title="è¯»æ“ä½œä¼˜åŒ–"></a>è¯»æ“ä½œä¼˜åŒ–</h2><p>æŒ‘æˆ˜ï¼šç¡®ä¿è¯»å–çš„æ˜¯æœ€æ–°æ•°æ®ã€‚</p><p>ä¼˜åŒ–ç­–ç•¥ï¼š</p><ul><li>Leader è¯»å–ï¼š <ul><li>Leader åœ¨å“åº”è¯»è¯·æ±‚å‰ç¡®è®¤è‡ªå·±ä»æ˜¯å½“å‰ Leaderï¼ˆé€šè¿‡ä¸å¤šæ•°èŠ‚ç‚¹é€šä¿¡ï¼‰ã€‚</li><li>ä½¿ç”¨ç§Ÿçº¦æœºåˆ¶å‡å°‘ç¡®è®¤å¼€é”€ã€‚</li></ul></li><li>Follower è¯»å–ï¼ˆéå¼ºä¸€è‡´æ€§ï¼‰ï¼š <ul><li>ç›´æ¥ä» Follower è¯»å–ï¼Œç”¨äºå¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ã€‚</li><li>å¯èƒ½è¯»åˆ°ç¨æ—§çš„æ•°æ®ï¼Œä½†å‡è½»äº† Leader çš„è´Ÿæ‹…ã€‚</li></ul></li><li>è¯»ç´¢å¼•ï¼ˆRead Indexï¼‰ï¼š <ul><li>Leader è®°å½•å½“å‰çš„ commitIndexï¼Œç¡®è®¤ leadershipï¼Œç„¶åç­‰å¾… applyIndex èµ¶ä¸Šè¯¥ commitIndexã€‚</li></ul></li><li>ç§Ÿçº¦è¯»ï¼ˆLease Readï¼‰ï¼š <ul><li>Leader ç»´æŠ¤ä¸€ä¸ªç§Ÿçº¦ï¼Œåœ¨ç§Ÿçº¦å†…ä¸ä¸ Followers é€šä¿¡å³å¯å“åº”è¯»è¯·æ±‚ã€‚</li></ul></li></ul><h2 id="Raft-vs-Paxos"><a href="#Raft-vs-Paxos" class="headerlink" title="Raft vs Paxos"></a>Raft vs Paxos</h2><p>è®¾è®¡ç†å¿µï¼š</p><ul><li>Raft è®¾è®¡ç›®æ ‡æ˜¯æ˜“äºç†è§£å’Œå®ç°ã€‚</li><li>Paxos æ›´åŠ ç†è®ºåŒ–å’Œé€šç”¨ã€‚</li></ul><p>ç»“æ„ï¼š</p><ul><li>Raft å°†é—®é¢˜åˆ†è§£ä¸ºé¢†å¯¼é€‰ä¸¾ã€æ—¥å¿—å¤åˆ¶ç­‰å­é—®é¢˜ã€‚</li><li>Paxos æ˜¯ä¸€ä¸ªæ›´å•ä¸€çš„åè®®ã€‚</li></ul><p>é¢†å¯¼æœºåˆ¶ï¼š</p><ul><li>Raft æœ‰æ˜ç¡®çš„é¢†å¯¼è€…é€‰ä¸¾è¿‡ç¨‹ã€‚</li><li>Paxos ä¸­é¢†å¯¼è§’è‰²ä¸é‚£ä¹ˆæ˜ç¡®ã€‚</li></ul><p>æ—¥å¿—ç‰¹æ€§ï¼š</p><ul><li>Raft ä¿è¯æ—¥å¿—æ˜¯è¿ç»­çš„ã€‚</li><li>Paxos å…è®¸æ—¥å¿—ä¸­æœ‰â€ç©ºæ´â€ã€‚</li></ul><p>å®ç°å¤æ‚åº¦ï¼š</p><ul><li>Raft é€šå¸¸æ›´å®¹æ˜“å®ç°å’Œè°ƒè¯•ã€‚</li><li>Paxos çš„æ­£ç¡®å®ç°å¾€å¾€æ›´å¤æ‚ã€‚</li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;Raft-çš„æ ¸å¿ƒç›®æ ‡å’ŒåŸºæœ¬å·¥ä½œåŸç†&quot;&gt;&lt;a href=&quot;#Raft-çš„æ ¸å¿ƒç›®æ ‡å’ŒåŸºæœ¬å·¥ä½œåŸç†&quot; class=&quot;headerlink&quot; title=&quot;Raft çš„æ ¸å¿ƒç›®æ ‡å’ŒåŸºæœ¬å·¥ä½œåŸç†&quot;&gt;&lt;/a&gt;Raft çš„æ ¸å¿ƒç›®æ ‡å’ŒåŸºæœ¬å·¥ä½œåŸç†&lt;/h2&gt;&lt;p&gt;æ ¸å¿ƒç›®æ ‡ï¼š&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è¾¾æˆå…±è¯†ï¼Œå®ç°å¼ºä¸€è‡´æ€§ã€‚&lt;/li&gt;
&lt;li&gt;åœ¨ä¿è¯ä¸€è‡´æ€§çš„åŸºç¡€ä¸Šè¿›è¡Œå¯é çš„æ•°æ®å¤åˆ¶ã€‚&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://taeyang0126.github.io/categories/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    
    <category term="åˆ†å¸ƒå¼" scheme="https://taeyang0126.github.io/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
    <category term="ç®—æ³•" scheme="https://taeyang0126.github.io/tags/%E7%AE%97%E6%B3%95/"/>
    
    <category term="raft" scheme="https://taeyang0126.github.io/tags/raft/"/>
    
  </entry>
  
  <entry>
    <title>LoadBalancerClient è‡ªå®šä¹‰</title>
    <link href="https://taeyang0126.github.io/2025/02/09/feign/loadbalancerclient-zi-ding-yi/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/feign/loadbalancerclient-zi-ding-yi/posts/undefined/</id>
    <published>2025-02-09T10:52:22.000Z</published>
    <updated>2025-02-10T14:16:05.824Z</updated>
    
    <content type="html"><![CDATA[<h2 id="è‡ªå®šä¹‰è·¯ç”±ä¿¡æ¯"><a href="#è‡ªå®šä¹‰è·¯ç”±ä¿¡æ¯" class="headerlink" title="è‡ªå®šä¹‰è·¯ç”±ä¿¡æ¯"></a>è‡ªå®šä¹‰è·¯ç”±ä¿¡æ¯</h2><blockquote><p>æ—¥å¸¸å¼€å‘ä¸­ loadBalancer ä¸€èˆ¬æ˜¯åŸºäºæœåŠ¡å‘ç°ï¼Œä¸éœ€è¦æˆ‘ä»¬æ˜¾ç¤ºçš„æŒ‡å®šï¼›æŸäº›åœºæ™¯ä¸‹ï¼ˆæ¯”å¦‚å•å…ƒæµ‹è¯•ã€è”è°ƒï¼‰éœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰ LoadBalancerClientï¼Œä¸èµ°é»˜è®¤çš„æœåŠ¡å‘ç°ï¼Œè€Œæ˜¯è‡ªå®šä¹‰è·¯ç”±ä¿¡æ¯</p></blockquote><ul><li><code>LoadBalancerClient</code> é»˜è®¤çš„é…ç½®æ˜¯ <code>LoadBalancerClientConfiguration</code></li><li>ä»¿é€  <code>LoadBalancerClientConfiguration</code> å®ç°è‡ªå·±çš„é…ç½®</li></ul><blockquote><p>ç”±äº<code>LoadBalancerClientConfiguration</code>ä¹Ÿæ˜¯åŸºäº NamedContextFactoryï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦å®ç°éœ€è¦ä¿®æ”¹çš„é…ç½®ï¼Œå…¶ä»–é…ç½®ä¼šé»˜è®¤è¯»å–<code>LoadBalancerClientConfiguration</code></p><p>æ¯”å¦‚ä¸‹é¢çš„ä»£ç ä¸­ï¼Œè‡ªå®šä¹‰äº†æœåŠ¡è·¯ç”±ä¿¡æ¯ï¼Œä¼šæ ¹æ®é…ç½®è¿”å›æœåŠ¡çš„è·¯ç”±ä¿¡æ¯</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceLoadBalanceConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ReactorLoadBalancer&lt;ServiceInstance&gt; <span class="title function_">reactorServiceInstanceLoadBalancer</span><span class="params">(Environment environment,</span></span><br><span class="line"><span class="params">                                                                                   LoadBalancerClientFactory loadBalancerClientFactory)</span> &#123;</span><br><span class="line">        <span class="comment">// è·å–å½“å‰ loadBalance çš„ client name</span></span><br><span class="line">        <span class="comment">// ç”±äºæ­¤é…ç½®ç”¨åœ¨ UserRegistrationService ä¸Šï¼Œæ‰€ä»¥è¿™é‡Œé»˜è®¤ = user-service</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> environment.getProperty(LoadBalancerClientFactory.PROPERTY_NAME);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">RoundRobinLoadBalancer</span>(</span><br><span class="line">                <span class="comment">// è¿™é‡Œç›¸å½“äºæ ¹æ®è¿™ä¸ªnameï¼Œæ‰¾åˆ°å¯¹åº”çš„å­contextï¼Œä»é‡Œé¢è·å–åˆ° ServiceInstanceListSupplier å¯¹åº”çš„bean</span></span><br><span class="line">                <span class="comment">// ä¹Ÿå°±æ˜¯ç›¸å½“äºè¿™ä¸ª UserRegistrationServiceLoadBalanceConfiguration ä¸‹é…ç½®çš„ ServiceInstanceListSupplier -&gt; ä¹Ÿå°±æ˜¯ ServiceInstanceListSupplier</span></span><br><span class="line">                loadBalancerClientFactory.getLazyProvider(name, ServiceInstanceListSupplier.class),</span><br><span class="line">                name</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ServiceInstanceListSupplier <span class="title function_">userServiceClientServiceInstanceListSupplier</span><span class="params">(</span></span><br><span class="line"><span class="params">            ConfigurableApplicationContext context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">UserServiceServiceInstanceListSupplier</span>(context.getEnvironment());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceServiceInstanceListSupplier</span> <span class="keyword">implements</span> <span class="title class_">ServiceInstanceListSupplier</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Environment environment;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceServiceInstanceListSupplier</span><span class="params">(Environment environment)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.environment = environment;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getServiceId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> environment.getProperty(<span class="string">&quot;user-service-name&quot;</span>, <span class="string">&quot;user-service&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Flux&lt;List&lt;ServiceInstance&gt;&gt; <span class="title function_">get</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">DefaultServiceInstance</span> <span class="variable">defaultServiceInstance</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DefaultServiceInstance</span>();</span><br><span class="line">        defaultServiceInstance.setServiceId(getServiceId());</span><br><span class="line">        defaultServiceInstance.setHost(environment.getProperty(<span class="string">&quot;user-service-host&quot;</span>, <span class="string">&quot;127.0.0.1&quot;</span>));</span><br><span class="line">        defaultServiceInstance.setPort(Integer.parseInt(environment.getProperty(<span class="string">&quot;user-service-port&quot;</span>, <span class="string">&quot;8080&quot;</span>)));</span><br><span class="line">        <span class="keyword">return</span> Flux.just(Arrays.asList(defaultServiceInstance));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ï¼Œæ³¨è§£ä¸ŠæŒ‡å®šé…ç½®å³å¯</li></ul><blockquote><p>@LoadBalancerClient(name &#x3D; â€œuser-serviceâ€, configuration &#x3D; UserServiceLoadBalanceConfiguration.class)</p></blockquote><ul><li>ä»¥ä¸Šå°±èƒ½å®ç°è‡ªå®šä¹‰è·¯ç”±çš„åŠŸèƒ½</li></ul>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;è‡ªå®šä¹‰è·¯ç”±ä¿¡æ¯&quot;&gt;&lt;a href=&quot;#è‡ªå®šä¹‰è·¯ç”±ä¿¡æ¯&quot; class=&quot;headerlink&quot; title=&quot;è‡ªå®šä¹‰è·¯ç”±ä¿¡æ¯&quot;&gt;&lt;/a&gt;è‡ªå®šä¹‰è·¯ç”±ä¿¡æ¯&lt;/h2&gt;&lt;blockquote&gt;
&lt;p&gt;æ—¥å¸¸å¼€å‘ä¸­ loadBalancer ä¸€èˆ¬æ˜¯åŸºäºæœåŠ¡å‘ç°ï¼Œä¸éœ€è¦æˆ‘ä»¬æ˜¾ç¤ºçš„æŒ‡å®šï¼›æŸäº›åœºæ™¯ä¸‹ï¼ˆæ¯”å¦‚å•å…ƒæµ‹è¯•ã€è”è°ƒï¼‰éœ€è¦æˆ‘ä»¬è‡ªå®šä¹‰ LoadBalancerClientï¼Œä¸èµ°é»˜è®¤çš„æœåŠ¡å‘ç°ï¼Œè€Œæ˜¯è‡ªå®šä¹‰è·¯ç”±ä¿¡æ¯&lt;/p&gt;
&lt;/blockquote&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code&gt;LoadBalancerClient&lt;/code&gt; é»˜è®¤çš„é…ç½®æ˜¯ &lt;code&gt;LoadBalancerClientConfiguration&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ä»¿é€  &lt;code&gt;LoadBalancerClientConfiguration&lt;/code&gt; å®ç°è‡ªå·±çš„é…ç½®&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="feign" scheme="https://taeyang0126.github.io/categories/feign/"/>
    
    
    <category term="feign" scheme="https://taeyang0126.github.io/tags/feign/"/>
    
    <category term="rpc" scheme="https://taeyang0126.github.io/tags/rpc/"/>
    
    <category term="å¾®æœåŠ¡" scheme="https://taeyang0126.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>Feign æ›´æ¢ Client</title>
    <link href="https://taeyang0126.github.io/2025/02/09/feign/feign-geng-huan-client/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/feign/feign-geng-huan-client/posts/undefined/</id>
    <published>2025-02-09T10:51:22.000Z</published>
    <updated>2025-02-10T14:16:05.824Z</updated>
    
    <content type="html"><![CDATA[<h2 id="åŸºäº-loadBalancer-æ›´æ¢-FeignClient-ä¸º-vertx-web-å®ç°"><a href="#åŸºäº-loadBalancer-æ›´æ¢-FeignClient-ä¸º-vertx-web-å®ç°" class="headerlink" title="åŸºäº loadBalancer æ›´æ¢ FeignClient ä¸º vertx-web å®ç°"></a>åŸºäº loadBalancer æ›´æ¢ FeignClient ä¸º vertx-web å®ç°</h2><ul><li>feignClient å®ç°ç±»ä¾æ—§æ˜¯ LoadBalancerFeignClient</li><li>LoadBalancerFeignClient ä¸­ delegate æ›´æ¢ä¸ºè‡ªå®šä¹‰å®ç°çš„ vertx-web-client</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VertxFeignClient</span> <span class="keyword">implements</span> <span class="title class_">Client</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> WebClient webClient;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">VertxFeignClient</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Vertx</span> <span class="variable">vertx</span> <span class="operator">=</span> Vertx.vertx();</span><br><span class="line">        <span class="type">WebClientOptions</span> <span class="variable">webClientOptions</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WebClientOptions</span>()</span><br><span class="line">                .setMaxPoolSize(<span class="number">100</span>)</span><br><span class="line">                .setMaxWaitQueueSize(<span class="number">10000</span>);</span><br><span class="line">        <span class="built_in">this</span>.webClient = WebClient.create(vertx, webClientOptions);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Response <span class="title function_">execute</span><span class="params">(Request request, Request.Options options)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">url</span> <span class="operator">=</span> request.url();</span><br><span class="line">        <span class="type">var</span> <span class="variable">bodys</span> <span class="operator">=</span> request.requestBody().asBytes();</span><br><span class="line">        Map&lt;String, Collection&lt;String&gt;&gt; headers = request.headers();</span><br><span class="line">        io.vertx.core.http.<span class="type">HttpMethod</span> <span class="variable">vertxMethod</span> <span class="operator">=</span> io.vertx.core.http.HttpMethod.valueOf(request.httpMethod().name());</span><br><span class="line"></span><br><span class="line">        <span class="type">HeadersMultiMap</span> <span class="variable">entries</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HeadersMultiMap</span>();</span><br><span class="line">        headers.forEach(entries::add);</span><br><span class="line"></span><br><span class="line">        CompletableFuture&lt;Response&gt; completableFuture = <span class="keyword">new</span> <span class="title class_">CompletableFuture</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">        webClient.requestAbs(vertxMethod, url)</span><br><span class="line">                .putHeaders(entries)</span><br><span class="line">                .sendBuffer(bodys == <span class="literal">null</span> ? Buffer.buffer() : Buffer.buffer(bodys))</span><br><span class="line">                .timeout(options.readTimeoutMillis(), TimeUnit.MILLISECONDS)</span><br><span class="line">                .onSuccess(t -&gt; &#123;</span><br><span class="line">                    log.info(<span class="string">&quot;url[&#123;&#125;] å“åº” -&gt; &#123;&#125;&quot;</span>, url, t.bodyAsString());</span><br><span class="line">                    <span class="type">MultiMap</span> <span class="variable">responseHeaders</span> <span class="operator">=</span> t.headers();</span><br><span class="line">                    Map&lt;String, Collection&lt;String&gt;&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">                    responseHeaders.forEach((k, v) -&gt; map.put(k, Collections.singleton(v)));</span><br><span class="line">                    completableFuture.complete(Response.builder()</span><br><span class="line">                            .status(t.statusCode())</span><br><span class="line">                            .reason(t.statusMessage())</span><br><span class="line">                            .headers(map)</span><br><span class="line">                            .body(t.bodyAsBuffer().getBytes())</span><br><span class="line">                            .request(request)</span><br><span class="line">                            .build());</span><br><span class="line">                &#125;).onFailure(completableFuture::completeExceptionally);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> completableFuture.get();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><ul><li>é…ç½®ç±»è£…é… FeignClient bean</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">VertxFeignClientConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="keyword">public</span> Client <span class="title function_">feignClient</span><span class="params">(CachingSpringLoadBalancerFactory cachingFactory,</span></span><br><span class="line"><span class="params">                              SpringClientFactory clientFactory)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LoadBalancerFeignClient</span>(<span class="keyword">new</span> <span class="title class_">VertxFeignClient</span>(), cachingFactory, clientFactory);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;åŸºäº-loadBalancer-æ›´æ¢-FeignClient-ä¸º-vertx-web-å®ç°&quot;&gt;&lt;a href=&quot;#åŸºäº-loadBalancer-æ›´æ¢-FeignClient-ä¸º-vertx-web-å®ç°&quot; class=&quot;headerlink&quot; title=&quot;åŸºäº loadBalancer æ›´æ¢ FeignClient ä¸º vertx-web å®ç°&quot;&gt;&lt;/a&gt;åŸºäº loadBalancer æ›´æ¢ FeignClient ä¸º vertx-web å®ç°&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;feignClient å®ç°ç±»ä¾æ—§æ˜¯ LoadBalancerFeignClient&lt;/li&gt;
&lt;li&gt;LoadBalancerFeignClient ä¸­ delegate æ›´æ¢ä¸ºè‡ªå®šä¹‰å®ç°çš„ vertx-web-client&lt;/li&gt;
&lt;/ul&gt;
&lt;figure class=&quot;highlight java&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;26&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;27&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;28&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;29&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;30&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;31&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;32&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;33&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;34&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;35&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;36&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;37&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;38&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;39&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;40&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;41&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;42&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;43&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;44&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;45&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;46&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;47&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;48&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;VertxFeignClient&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;implements&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;Client&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;private&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;final&lt;/span&gt; WebClient webClient;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; &lt;span class=&quot;title function_&quot;&gt;VertxFeignClient&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;()&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;Vertx&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;vertx&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; Vertx.vertx();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;WebClientOptions&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;webClientOptions&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;WebClientOptions&lt;/span&gt;()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .setMaxPoolSize(&lt;span class=&quot;number&quot;&gt;100&lt;/span&gt;)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .setMaxWaitQueueSize(&lt;span class=&quot;number&quot;&gt;10000&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;built_in&quot;&gt;this&lt;/span&gt;.webClient = WebClient.create(vertx, webClientOptions);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;meta&quot;&gt;@Override&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;public&lt;/span&gt; Response &lt;span class=&quot;title function_&quot;&gt;execute&lt;/span&gt;&lt;span class=&quot;params&quot;&gt;(Request request, Request.Options options)&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;throws&lt;/span&gt; IOException &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;url&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; request.url();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;var&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;bodys&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; request.requestBody().asBytes();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        Map&amp;lt;String, Collection&amp;lt;String&amp;gt;&amp;gt; headers = request.headers();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        io.vertx.core.http.&lt;span class=&quot;type&quot;&gt;HttpMethod&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;vertxMethod&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; io.vertx.core.http.HttpMethod.valueOf(request.httpMethod().name());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;type&quot;&gt;HeadersMultiMap&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;entries&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;HeadersMultiMap&lt;/span&gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        headers.forEach(entries::add);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        CompletableFuture&amp;lt;Response&amp;gt; completableFuture = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;CompletableFuture&lt;/span&gt;&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        webClient.requestAbs(vertxMethod, url)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .putHeaders(entries)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .sendBuffer(bodys == &lt;span class=&quot;literal&quot;&gt;null&lt;/span&gt; ? Buffer.buffer() : Buffer.buffer(bodys))&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .timeout(options.readTimeoutMillis(), TimeUnit.MILLISECONDS)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                .onSuccess(t -&amp;gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    log.info(&lt;span class=&quot;string&quot;&gt;&amp;quot;url[&amp;#123;&amp;#125;] å“åº” -&amp;gt; &amp;#123;&amp;#125;&amp;quot;&lt;/span&gt;, url, t.bodyAsString());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    &lt;span class=&quot;type&quot;&gt;MultiMap&lt;/span&gt; &lt;span class=&quot;variable&quot;&gt;responseHeaders&lt;/span&gt; &lt;span class=&quot;operator&quot;&gt;=&lt;/span&gt; t.headers();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    Map&amp;lt;String, Collection&amp;lt;String&amp;gt;&amp;gt; map = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;HashMap&lt;/span&gt;&amp;lt;&amp;gt;();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    responseHeaders.forEach((k, v) -&amp;gt; map.put(k, Collections.singleton(v)));&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                    completableFuture.complete(Response.builder()&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            .status(t.statusCode())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            .reason(t.statusMessage())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            .headers(map)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            .body(t.bodyAsBuffer().getBytes())&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            .request(request)&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                            .build());&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;                &amp;#125;).onFailure(completableFuture::completeExceptionally);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &lt;span class=&quot;keyword&quot;&gt;try&lt;/span&gt; &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;return&lt;/span&gt; completableFuture.get();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125; &lt;span class=&quot;keyword&quot;&gt;catch&lt;/span&gt; (InterruptedException | ExecutionException e) &amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;            &lt;span class=&quot;keyword&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;title class_&quot;&gt;RuntimeException&lt;/span&gt;(e);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;        &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;</summary>
    
    
    
    <category term="feign" scheme="https://taeyang0126.github.io/categories/feign/"/>
    
    
    <category term="feign" scheme="https://taeyang0126.github.io/tags/feign/"/>
    
    <category term="rpc" scheme="https://taeyang0126.github.io/tags/rpc/"/>
    
    <category term="å¾®æœåŠ¡" scheme="https://taeyang0126.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>Feignã€Hystrixã€Ribbon è¶…æ—¶æœºåˆ¶</title>
    <link href="https://taeyang0126.github.io/2025/02/09/feign/feign-hystrix-ribbon-chao-shi-ji-zhi/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/feign/feign-hystrix-ribbon-chao-shi-ji-zhi/posts/undefined/</id>
    <published>2025-02-09T10:50:22.000Z</published>
    <updated>2025-02-10T14:16:05.824Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ä½¿ç”¨ç‰ˆæœ¬"><a href="#ä½¿ç”¨ç‰ˆæœ¬" class="headerlink" title="ä½¿ç”¨ç‰ˆæœ¬"></a>ä½¿ç”¨ç‰ˆæœ¬</h2><ul><li><p>open-feignã€hystrixã€ribbon: 2.1.0.RELEASE</p></li><li><p>feign-okhttp: 10.1.0</p></li><li><p>archaius: 0.7.6</p></li><li><p>jackson: 2.17.0</p></li></ul><h2 id="å‰ç½®æ¡ä»¶"><a href="#å‰ç½®æ¡ä»¶" class="headerlink" title="å‰ç½®æ¡ä»¶"></a>å‰ç½®æ¡ä»¶</h2><ul><li>feign.okhttp.enabled&#x3D;true   #feign ä½¿ç”¨ OkHttpClient ä½œä¸º http è¯·æ±‚æ¡†æ¶</li><li>feign.hystrix.enabled&#x3D;true   #å¼€å¯ hystrix</li></ul><h2 id="å…³ç³»å›¾"><a href="#å…³ç³»å›¾" class="headerlink" title="å…³ç³»å›¾"></a>å…³ç³»å›¾</h2><p><img data-src="/images/feign/01.png" alt="img"></p><h2 id="è¶…æ—¶æœºåˆ¶"><a href="#è¶…æ—¶æœºåˆ¶" class="headerlink" title="è¶…æ—¶æœºåˆ¶"></a>è¶…æ—¶æœºåˆ¶</h2><h3 id="hystrix-è¶…æ—¶"><a href="#hystrix-è¶…æ—¶" class="headerlink" title="hystrix è¶…æ—¶"></a>hystrix è¶…æ—¶</h3><ul><li>æœ€ä¸Šå±‚æ˜¯ hystrix è¶…æ—¶ï¼Œhystrix ä¼šå¼‚æ­¥æäº¤ä¸€ä¸ªå»¶æ—¶ä»»åŠ¡ï¼Œå»¶æ—¶æ—¶é—´å°±æ˜¯é…ç½®çš„è¶…æ—¶æ—¶é—´</li><li>é…ç½® hystrix å…¨å±€çš„è¶…æ—¶æ—¶é—´</li></ul><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">hystrix:</span></span><br><span class="line">  <span class="attr">command:</span></span><br><span class="line">    <span class="comment"># é»˜è®¤çš„é…ç½®ï¼Œå¦‚æœæ²¡æœ‰ç‹¬ç«‹é…ç½®ï¼Œé‚£ä¹ˆè¿™ä¸ªä¼šæ˜¯é»˜è®¤çš„é…ç½®</span></span><br><span class="line">    <span class="attr">default:</span></span><br><span class="line">      <span class="attr">execution:</span></span><br><span class="line">        <span class="attr">isolation:</span></span><br><span class="line">          <span class="attr">thread:</span></span><br><span class="line">            <span class="attr">timeoutInMilliseconds:</span> <span class="number">6000</span></span><br></pre></td></tr></table></figure><ul><li>[é…ç½®æ–‡ä»¶]é…ç½®å…·ä½“æ¥å£çš„è¶…æ—¶æ—¶é—´ï¼Œ${commandKey} è¡¨ç¤º commandKeyï¼Œæ¯”å¦‚æ¥å£ä½äºç±» HttpBinFeignï¼Œæ–¹æ³•åä¸º delay_3ï¼ˆï¼‰ï¼Œåˆ™ commandKey&#x3D;HttpBinFeign#delay_3ï¼ˆï¼‰ï¼›é»˜è®¤ä¼šä¼˜å…ˆè¯»å–å…·ä½“æ¥å£çš„é…ç½®ï¼Œå…·ä½“æ¥å£çš„é…ç½®ä¸å­˜åœ¨åˆ™ä¼šä½¿ç”¨é»˜è®¤çš„é…ç½®</li></ul><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">hystrix.command.$&#123;commandKey&#125;.execution.isolation.thread.timeoutInMilliseconds</span>=<span class="string">4000</span></span><br></pre></td></tr></table></figure><p><img data-src="/images/feign/02.png" alt="img"></p><p><img data-src="/images/feign/03.png" alt="img"></p><ul><li><p>[@HystrixCommand]é…ç½®å…·ä½“æ¥å£çš„è¶…æ—¶æ—¶é—´</p><ol><li>å¯ç”¨åˆ‡é¢</li></ol>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HystrixConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> HystrixCommandAspect <span class="title function_">hystrixCommandAspect</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">HystrixCommandAspect</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="2"><li>@HystrixCommand é…ç½®ï¼Œè¿™é‡Œç”¨äº†ç§å–å·§çš„æ–¹å¼ï¼Œæ·»åŠ ä¸Šæ­¤æ³¨è§£ä¼šå…ˆè½¬æ¢ä¸º HystrixCommandPropertiesï¼Œç„¶åå½“ Feign æ¥å£å°è£…ä¸º hystrixCommand æ—¶å°±ä¼šä» factory ä¸­æ ¹æ® cacheKey è·å–ï¼ŒcacheKey å°±æ˜¯ commandKeyï¼Œæ‰€ä»¥åªéœ€è¦ä¿è¯åœ¨ feign æ¥å£å‰é¢ç»„è£…æ­¤é…ç½®å°±è¡Œã€‚è¿™é‡Œæ˜¯å–å·§çš„æ–¹å¼ï¼Œä¸ç¡®å®šä¼šæœ‰ä»€ä¹ˆé—®é¢˜- _ -</li></ol>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@HystrixCommand(</span></span><br><span class="line"><span class="meta">        commandKey = &quot;HttpBinFeign#delay_3()&quot;,</span></span><br><span class="line"><span class="meta">        commandProperties = &#123;</span></span><br><span class="line"><span class="meta">                @HystrixProperty(name = &quot;execution.isolation.thread.timeoutInMilliseconds&quot;, value = &quot;2000&quot;)</span></span><br><span class="line"><span class="meta">        &#125;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">delay_3</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> httpBinFeign.delay_3();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p><img data-src="/images/feign/04.png" alt="img"></p><h3 id="feignã€ribbon-è¶…æ—¶é…ç½®"><a href="#feignã€ribbon-è¶…æ—¶é…ç½®" class="headerlink" title="feignã€ribbon è¶…æ—¶é…ç½®"></a>feignã€ribbon è¶…æ—¶é…ç½®</h3><ul><li>feign æœªé…ç½®æ—¶ï¼Œè¯·æ±‚è¶…æ—¶æŒ‰ ribbon é…ç½®ï¼›è‹¥é…ç½®äº† feign è¶…æ—¶ï¼Œåˆ™è¯·æ±‚è¶…æ—¶æŒ‰ feign é…ç½®</li><li>feign å…¨å±€è¶…æ—¶é…ç½®ï¼Œ<strong>æ³¨æ„ connect-timeout ä¸ read-timeout ä¸¤ä¸ªé…ç½®éƒ½éœ€è¦é…ç½®</strong>ï¼Œå•ç‹¬é…ç½®ä¸ç”Ÿæ•ˆ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">feign:</span><br><span class="line">  client:</span><br><span class="line">    config:</span><br><span class="line">      # é»˜è®¤é…ç½®</span><br><span class="line">      <span class="keyword">default</span>:</span><br><span class="line">        connect-timeout: <span class="number">1000</span></span><br><span class="line">        read-timeout: <span class="number">5000</span></span><br></pre></td></tr></table></figure><p><img data-src="/images/feign/05.png" alt="img"></p><ul><li><p>å•ä¸ª feign æ¥å£è¶…æ—¶é…ç½®</p><ol><li>ä¼˜å…ˆçº§ï¼š é…ç½®åˆ†ä¸º 3 ç§ï¼Œåˆ†åˆ«æ˜¯ä»£ç é…ç½®ã€é»˜è®¤é…ç½®ã€å•ä¸ªæ¥å£é…ç½®æ–‡ä»¶é…ç½®ï¼›</li></ol><p>  é»˜è®¤æƒ…å†µä¸‹ï¼ˆfeign.client.defaultToProperties&#x3D;trueï¼‰ æ—¶é…ç½®ä¼˜å…ˆçº§ä¸º ä»£ç é…ç½® -&gt; é»˜è®¤é…ç½® -&gt; å•ä¸ªæ¥å£é…ç½®æ–‡ä»¶é…ç½®ï¼Œä¼˜å…ˆçº§ä»ä½åˆ°é«˜ï¼Œé«˜ä¼˜å…ˆçº§çš„ä¼šè¦†ç›–ä½ä¼˜å…ˆçº§çš„ï¼›</p><p>  feign.client.defaultToProperties&#x3D;false æ—¶é…ç½®ä¼˜å…ˆçº§ä¸º é»˜è®¤é…ç½® -&gt; å•ä¸ªæ¥å£é…ç½®æ–‡ä»¶é…ç½® -&gt; ä»£ç é…ç½®ï¼›</p><p>  ä¹Ÿå°±æ˜¯è¯´é»˜è®¤æƒ…å†µä¸‹ä»£ç é…ç½®ä¼šè¢«é»˜è®¤é…ç½®è¦†ç›–ï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦é’ˆå¯¹å•ä¸ªæ¥å£è¿›è¡Œé…ç½®ï¼Œå¿…é¡»è¦ä½¿ç”¨é…ç½®æ–‡ä»¶è¿›è¡Œé…ç½®ï¼›å½“ç„¶ä¹Ÿå¯ä»¥è®¾ç½® feign.client.defaultToProperties&#x3D;falseï¼Œè¿™æ ·ä»£ç é…ç½®çš„ä¼˜å…ˆçº§æœ€é«˜</p><p>  <img data-src="/images/feign/06.png" alt="img"></p><ol start="2"><li>å•ä¸ªæ¥å£é…ç½®</li></ol>  <figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># è¿™é‡Œçš„httpbinä»£è¡¨çš„æ˜¯FeignClientä¸­çš„contextId</span></span><br><span class="line"><span class="attr">feign.client.config.httpbin.read-timeout</span>=<span class="string">2500</span></span><br><span class="line"><span class="attr">feign.client.config.httpbin.connect-timeout</span>=<span class="string">800</span></span><br></pre></td></tr></table></figure><ol start="3"><li>å•ä¸ªæ¥å£ä»£ç é…ç½®ï¼Œæ³¨æ„é…ç½®ç±»ä¸èƒ½ä½¿ç”¨@component æ³¨è§£ï¼Œå¦åˆ™ä¼šå…¨å±€ç”Ÿæ•ˆ</li></ol>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CustomFeignConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> Request.Options <span class="title function_">request</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Request</span>.Options(<span class="number">1000</span>, <span class="number">3000</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@FeignClient(name = &quot;service-httpbin&quot;</span></span><br><span class="line"><span class="meta">        , contextId = &quot;httpbin&quot;, configuration = CustomFeignConfiguration.class</span></span><br><span class="line"><span class="meta">)</span></span><br></pre></td></tr></table></figure></li><li><p>ribbon å…¨å±€é…ç½®</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ribbon:</span><br><span class="line">  ReadTimeout: <span class="number">5000</span> # è¯·æ±‚å¤„ç†çš„è¶…æ—¶æ—¶é—´</span><br><span class="line">  ConnectTimeout: <span class="number">2000</span> # è¯·æ±‚è¿æ¥è¶…æ—¶æ—¶é—´</span><br><span class="line">  # ä»¥ä¸‹ä¸¤ä¸ªé‡è¯•é…ç½®è¡¨ç¤ºåŒä¸€ä¸ªæ¥å£æœ€å¤šè°ƒç”¨<span class="number">2</span>æ¬¡ï¼Œä¸”ç¬¬äºŒæ¬¡é‡è¯•ä¸åœ¨åŒä¸€ä¸ªå®ä¾‹ä¸Š</span><br><span class="line">  MaxAutoRetries: <span class="number">0</span> #åŒä¸€å°å®ä¾‹æœ€å¤§é‡è¯•æ¬¡æ•°,ä¸åŒ…æ‹¬é¦–æ¬¡è°ƒç”¨</span><br><span class="line">  MaxAutoRetriesNextServer: <span class="number">1</span> # åˆ‡æ¢å®ä¾‹çš„é‡è¯•æ¬¡æ•°</span><br><span class="line">  OkToRetryOnAllOperations: <span class="literal">false</span> #é‡è¯•æ“ä½œï¼Œ<span class="literal">false</span>è¡¨ç¤ºåªä¼šå¯¹getæ¥å£è¿›è¡Œé‡è¯•</span><br></pre></td></tr></table></figure><h3 id="éè´Ÿè½½å‡è¡¡ä¸‹è°ƒç”¨"><a href="#éè´Ÿè½½å‡è¡¡ä¸‹è°ƒç”¨" class="headerlink" title="éè´Ÿè½½å‡è¡¡ä¸‹è°ƒç”¨"></a>éè´Ÿè½½å‡è¡¡ä¸‹è°ƒç”¨</h3><ul><li>feignClient æŒ‡å®š url åˆ™ä¸ä¼šèµ° loadbalancer è°ƒç”¨ï¼Œä¼šç›´æ¥ä½¿ç”¨ okHttpClient è¿›è¡Œè°ƒç”¨ï¼Œå‚è€ƒå…³ç³»å›¾ä¸­[1]</li><li>OkHttpClient é»˜è®¤è¶…æ—¶é…ç½®å¦‚ä¸‹</li></ul><p><img data-src="/images/feign/07.png" alt="img"></p><ul><li>è‹¥é…ç½®äº† feign æ¥å£è¶…æ—¶ï¼Œåˆ™ä¼šè¦†ç›– okHttpClient é…ç½®</li></ul><p><img data-src="/images/feign/08.png" alt="img"></p><h3 id="è´Ÿè½½å‡è¡¡ä¸‹çš„è°ƒç”¨"><a href="#è´Ÿè½½å‡è¡¡ä¸‹çš„è°ƒç”¨" class="headerlink" title="è´Ÿè½½å‡è¡¡ä¸‹çš„è°ƒç”¨"></a>è´Ÿè½½å‡è¡¡ä¸‹çš„è°ƒç”¨</h3><ul><li>feignClient æœªæŒ‡å®š url æ—¶ä¼šæ ¹æ® name æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡ï¼Œèµ° loadbalancer è°ƒç”¨ï¼Œå‚è€ƒå…³ç³»å›¾ä¸­[2]</li><li>è‹¥æŒ‡å®šäº† feign è¶…æ—¶é…ç½®ï¼Œåˆ™ä½¿ç”¨ feign è¶…æ—¶é…ç½®ï¼Œå¦åˆ™ä½¿ç”¨ ribbon è¶…æ—¶é…ç½®</li></ul><p><img data-src="/images/feign/09.png" alt="img"></p><h3 id="è¶…æ—¶æœºåˆ¶æ€»ç»“"><a href="#è¶…æ—¶æœºåˆ¶æ€»ç»“" class="headerlink" title="è¶…æ—¶æœºåˆ¶æ€»ç»“"></a>è¶…æ—¶æœºåˆ¶æ€»ç»“</h3><ol><li>Hystrix é…ç½®çš„è¶…æ—¶æ—¶é—´éœ€è¦å¤§äº feign &amp; ribbon é…ç½®çš„è¶…æ—¶æ—¶é—´</li><li>ç”±äº ribbon æœ‰é‡è¯•æœºåˆ¶ï¼Œæ‰€ä»¥ hystrix é…ç½®çš„è¶…æ—¶æ—¶é—´éœ€è¦å¤§äºå•ä¸ªè¯·æ±‚è¶…æ—¶æ—¶é—´ * è¯·æ±‚çš„æ€»æ¬¡æ•°ï¼ˆ<strong>MaxAutoRetries+ 1ï¼‰*ï¼ˆMaxAutoRetriesNextServer+1</strong>ï¼‰ </li><li>åªè¦é…ç½®äº† feign è¶…æ—¶ï¼Œé‚£ä¹ˆæ— è®ºæ˜¯ Okhttp è¿˜æ˜¯ ribbon çš„è¶…æ—¶éƒ½ä¼šè¢«è¦†ç›–</li><li>feign è¶…æ—¶éœ€è¦åŒæ—¶é…ç½® connectTimeout &amp; readTimeout</li><li>å»ºè®® hystrixã€feignã€ribbon éƒ½é…ç½®é»˜è®¤çš„è¶…æ—¶æ—¶é—´ï¼Œä¸” hystrix è¶…æ—¶æ—¶é—´ &gt; feign &#x3D;&#x3D; ribbon</li><li>é’ˆå¯¹ç‹¬ç«‹æ¥å£çš„é…ç½®ï¼Œéœ€è¦æ³¨æ„ hystrixã€feign è¶…æ—¶éƒ½éœ€è¦é…ç½®</li></ol><h2 id="å®šåˆ¶-CachingSpringLoadBalancerFactoryï¼Œå®ç°è´Ÿè½½å‡è¡¡åˆ°æœ¬åœ°æœåŠ¡ä¸Š"><a href="#å®šåˆ¶-CachingSpringLoadBalancerFactoryï¼Œå®ç°è´Ÿè½½å‡è¡¡åˆ°æœ¬åœ°æœåŠ¡ä¸Š" class="headerlink" title="å®šåˆ¶ CachingSpringLoadBalancerFactoryï¼Œå®ç°è´Ÿè½½å‡è¡¡åˆ°æœ¬åœ°æœåŠ¡ä¸Š"></a>å®šåˆ¶ CachingSpringLoadBalancerFactoryï¼Œå®ç°è´Ÿè½½å‡è¡¡åˆ°æœ¬åœ°æœåŠ¡ä¸Š</h2><h3 id="è‡ªå®šä¹‰-CachingSpringLoadBalancerFactoryï¼Œç»™æ‰€æœ‰æœåŠ¡æ·»åŠ æœ¬åœ°åœ°å€"><a href="#è‡ªå®šä¹‰-CachingSpringLoadBalancerFactoryï¼Œç»™æ‰€æœ‰æœåŠ¡æ·»åŠ æœ¬åœ°åœ°å€" class="headerlink" title="è‡ªå®šä¹‰ CachingSpringLoadBalancerFactoryï¼Œç»™æ‰€æœ‰æœåŠ¡æ·»åŠ æœ¬åœ°åœ°å€"></a>è‡ªå®šä¹‰ CachingSpringLoadBalancerFactoryï¼Œç»™æ‰€æœ‰æœåŠ¡æ·»åŠ æœ¬åœ°åœ°å€</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LocalCachingSpringLoadBalancerFactory</span> <span class="keyword">extends</span> <span class="title class_">CachingSpringLoadBalancerFactory</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String, FeignLoadBalancer&gt; cache = <span class="keyword">new</span> <span class="title class_">ConcurrentReferenceHashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> String localHost;</span><br><span class="line">    <span class="keyword">private</span> Integer localPort;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LocalCachingSpringLoadBalancerFactory</span><span class="params">(SpringClientFactory factory, String localHost, Integer localPort)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(factory);</span><br><span class="line">        <span class="built_in">this</span>.localHost = localHost;</span><br><span class="line">        <span class="built_in">this</span>.localPort = localPort;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> FeignLoadBalancer <span class="title function_">create</span><span class="params">(String clientName)</span> &#123;</span><br><span class="line">        <span class="type">FeignLoadBalancer</span> <span class="variable">client</span> <span class="operator">=</span> <span class="built_in">this</span>.cache.get(clientName);</span><br><span class="line">        <span class="keyword">if</span>(client != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> client;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">IClientConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="built_in">this</span>.factory.getClientConfig(clientName);</span><br><span class="line">        <span class="type">ILoadBalancer</span> <span class="variable">lb</span> <span class="operator">=</span> <span class="built_in">this</span>.factory.getLoadBalancer(clientName);</span><br><span class="line">        <span class="comment">// æ·»åŠ æœ¬åœ°åœ°å€</span></span><br><span class="line">        lb.addServers(Lists.newArrayList(<span class="keyword">new</span> <span class="title class_">Server</span>(<span class="built_in">this</span>.localHost, <span class="built_in">this</span>.localPort)));</span><br><span class="line">        <span class="type">ServerIntrospector</span> <span class="variable">serverIntrospector</span> <span class="operator">=</span> <span class="built_in">this</span>.factory.getInstance(clientName, ServerIntrospector.class);</span><br><span class="line">        client = loadBalancedRetryFactory != <span class="literal">null</span> ? <span class="keyword">new</span> <span class="title class_">RetryableFeignLoadBalancer</span>(lb, config, serverIntrospector,</span><br><span class="line">                loadBalancedRetryFactory) : <span class="keyword">new</span> <span class="title class_">FeignLoadBalancer</span>(lb, config, serverIntrospector);</span><br><span class="line">        <span class="built_in">this</span>.cache.put(clientName, client);</span><br><span class="line">        <span class="keyword">return</span> client;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="æ³¨å…¥-beanï¼Œè¦†ç›–é»˜è®¤çš„é…ç½®-FeignRibbonClientAutoConfiguration"><a href="#æ³¨å…¥-beanï¼Œè¦†ç›–é»˜è®¤çš„é…ç½®-FeignRibbonClientAutoConfiguration" class="headerlink" title="æ³¨å…¥ beanï¼Œè¦†ç›–é»˜è®¤çš„é…ç½® FeignRibbonClientAutoConfiguration"></a>æ³¨å…¥ beanï¼Œè¦†ç›–é»˜è®¤çš„é…ç½® FeignRibbonClientAutoConfiguration</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LocalRibbonConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.local.host:127.0.0.1&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String localHost;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;server.local.port:8000&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer localPort;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    <span class="keyword">public</span> CachingSpringLoadBalancerFactory <span class="title function_">cachingLBClientFactory</span><span class="params">(</span></span><br><span class="line"><span class="params">            SpringClientFactory factory)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">LocalCachingSpringLoadBalancerFactory</span>(factory, localHost, localPort);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨-BeanPostProcessor-ä¿®æ”¹-LoadBalancerFeignClient-ä¸­çš„-CachingSpringLoadBalancerFactory"><a href="#ä½¿ç”¨-BeanPostProcessor-ä¿®æ”¹-LoadBalancerFeignClient-ä¸­çš„-CachingSpringLoadBalancerFactory" class="headerlink" title="ä½¿ç”¨ BeanPostProcessor ä¿®æ”¹ LoadBalancerFeignClient ä¸­çš„ CachingSpringLoadBalancerFactory"></a>ä½¿ç”¨ BeanPostProcessor ä¿®æ”¹ LoadBalancerFeignClient ä¸­çš„ CachingSpringLoadBalancerFactory</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LocalCachingSpringLoadBalancerFactoryBeanPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanPostProcessor</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String localHost;</span><br><span class="line">    <span class="keyword">private</span> Integer localPort;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LocalCachingSpringLoadBalancerFactoryBeanPostProcessor</span><span class="params">(String localHost, Integer localPort)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.localHost = localHost;</span><br><span class="line">        <span class="built_in">this</span>.localPort = localPort;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">postProcessAfterInitialization</span><span class="params">(Object bean, String beanName)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (bean <span class="keyword">instanceof</span> LoadBalancerFeignClient) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="type">var</span> <span class="variable">loadBalancerFeignClient</span> <span class="operator">=</span> (LoadBalancerFeignClient) bean;</span><br><span class="line">                <span class="type">Field</span> <span class="variable">lbClientFactory</span> <span class="operator">=</span> FieldUtils.getDeclaredField(LoadBalancerFeignClient.class, <span class="string">&quot;lbClientFactory&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">                lbClientFactory.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                <span class="type">var</span> <span class="variable">clientFactory</span> <span class="operator">=</span> FieldUtils.getDeclaredField(LoadBalancerFeignClient.class, <span class="string">&quot;clientFactory&quot;</span>, <span class="literal">true</span>);</span><br><span class="line">                clientFactory.setAccessible(<span class="literal">true</span>);</span><br><span class="line">                <span class="comment">// è·å–åˆ° springClientFactory</span></span><br><span class="line">                <span class="type">var</span> <span class="variable">springClientFactory</span> <span class="operator">=</span> (SpringClientFactory) clientFactory.get(loadBalancerFeignClient);</span><br><span class="line">                <span class="comment">// æ„å»ºlocal</span></span><br><span class="line">                <span class="type">LocalCachingSpringLoadBalancerFactory</span> <span class="variable">cachingSpringLoadBalancerFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LocalCachingSpringLoadBalancerFactory</span>(springClientFactory, localHost, localPort);</span><br><span class="line">                <span class="comment">// è®¾ç½®åˆ°å€¼é‡Œé¢</span></span><br><span class="line">                lbClientFactory.set(loadBalancerFeignClient, cachingSpringLoadBalancerFactory);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(e);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> bean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ä½¿ç”¨ç‰ˆæœ¬&quot;&gt;&lt;a href=&quot;#ä½¿ç”¨ç‰ˆæœ¬&quot; class=&quot;headerlink&quot; title=&quot;ä½¿ç”¨ç‰ˆæœ¬&quot;&gt;&lt;/a&gt;ä½¿ç”¨ç‰ˆæœ¬&lt;/h2&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;open-feignã€hystrixã€ribbon: 2.1.0.RELEASE&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;feign-okhttp: 10.1.0&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;archaius: 0.7.6&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;jackson: 2.17.0&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;å‰ç½®æ¡ä»¶&quot;&gt;&lt;a href=&quot;#å‰ç½®æ¡ä»¶&quot; class=&quot;headerlink&quot; title=&quot;å‰ç½®æ¡ä»¶&quot;&gt;&lt;/a&gt;å‰ç½®æ¡ä»¶&lt;/h2&gt;</summary>
    
    
    
    <category term="feign" scheme="https://taeyang0126.github.io/categories/feign/"/>
    
    
    <category term="feign" scheme="https://taeyang0126.github.io/tags/feign/"/>
    
    <category term="rpc" scheme="https://taeyang0126.github.io/tags/rpc/"/>
    
    <category term="å¾®æœåŠ¡" scheme="https://taeyang0126.github.io/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>æŠ“åŒ…ç›¸å…³</title>
    <link href="https://taeyang0126.github.io/2025/02/09/wang-luo/zhua-bao-xiang-guan/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/wang-luo/zhua-bao-xiang-guan/posts/undefined/</id>
    <published>2025-02-09T09:50:22.000Z</published>
    <updated>2025-02-10T14:16:05.826Z</updated>
    
    <content type="html"><![CDATA[<ul><li>æŸ¥çœ‹è·¯ç”±è¡¨ä¿¡æ¯<ul><li>å¯ä»¥æ˜¾ç¤ºæ•°æ®åŒ…çš„è·¯ç”±è§„åˆ™ï¼Œå‘Šè¯‰æˆ‘ä»¬å»å¾€ä¸åŒç›®æ ‡IPæ—¶ä¼šä½¿ç”¨å“ªä¸ªç½‘å¡ï¼Œæ–¹ä¾¿æŒ‡å®šç½‘å¡æŠ“åŒ…</li><li><code>netstat -nr</code> æ‰€æœ‰ç³»ç»Ÿå‡å¯ä½¿ç”¨ï¼Œnè¡¨ç¤ºä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºåœ°å€å’Œç«¯å£ï¼Œrè¡¨ç¤ºroute</li><li><code>ip route</code> linuxä¸‹ä½¿ç”¨ï¼Œæ›¿ä»£ netstat -r</li><li><code>ss</code>linuxä¸‹ä½¿ç”¨ï¼Œæ›¿ä»£ netstat</li></ul></li><li>ç¡®è®¤å·(ack)è®¡ç®—è§„åˆ™<ul><li>æ™®é€šæ•°æ®åŒ…ï¼šack &#x3D; å¯¹æ–¹seq + len</li><li>SYN&#x2F;FINåŒ…ï¼šack &#x3D; å¯¹æ–¹seq + len + 1</li><li>â€œæˆ‘å·²ç»æ”¶åˆ°åˆ°è¿™ä¸ªä½ç½®çš„æ•°æ®äº†â€  â€œä½ ä¸‹æ¬¡å°±ä»è¿™ä¸ªä½ç½®ç»§ç»­å‘â€</li></ul></li><li>seq <ul><li>ä¸æ˜¯åŒ…çš„å”¯ä¸€æ ‡è¯†ï¼Œè€Œæ˜¯æ•°æ®æµçš„ä½ç½®æ ‡è®°</li><li>è¡¨ç¤ºâ€æˆ‘ä¹‹åçš„æ•°æ®ä¼šä»è¿™ä¸ªä½ç½®å¼€å§‹å‘â€</li><li>ä¸‹ä¸€ä¸ªåŒ…çš„seqç­‰äºå¯¹ç«¯ç¡®è®¤çš„ackï¼Œseqã€ackæœ¬è´¨ä¸Šéƒ½æ˜¯æµçš„åºå·ï¼Œackè¡¨ç¤ºå¯¹ç«¯ç¡®è®¤åˆ°äº†è¿™ä¸ªä½ç½®ï¼Œè‡ªç„¶æˆ‘ç«¯éœ€è¦ä»æ­¤ä¸ºæ­¢å‘é€æ•°æ®</li></ul></li><li>æŸäº›åœºæ™¯ä¸‹æŒ¥æ‰‹æ—¶ FIN+ACKå¯èƒ½åˆå¹¶ä¸ºä¸€ä¸ªåŒ…<ul><li>å»¶è¿Ÿç¡®è®¤çš„åœºæ™¯ä¸‹ï¼ŒFIN+ACKå¯èƒ½åˆå¹¶ä¸ºä¸€ä¸ªåŒ…</li></ul></li><li>LSO<ul><li>ä¼ è¾“å±‚ä¸è´Ÿè´£æ‹†åŒ…å¤„ç†ï¼Œè€Œæ˜¯å°†æ•°æ®ç›´æ¥ä¼ é€’ç»™ç½‘å¡ï¼Œäº¤ç»™ç½‘å¡è´Ÿè´£åˆ†æ®µ</li><li>ä¼ ç»Ÿç½‘ç»œæ˜¯åº”ç”¨å±‚æŠŠæ•°æ®äº¤ç»™TCPå±‚ï¼ŒTCPå±‚æ ¹æ®MSSå¤§å°è¿›è¡Œåˆ†æ®µï¼ˆcpuè´Ÿè´£ï¼‰</li><li>å¯ç”¨LSOä¹‹åï¼ŒTCPå±‚ç›´æ¥æŠŠæ•°æ®å—ä¼ ç»™ç½‘å¡ï¼Œ è®©ç½‘å¡è´Ÿè´£åˆ†æ®µå·¥ä½œ</li><li>ä¼˜ç‚¹åœ¨äºèŠ‚çœäº†cpuèµ„æºï¼Œç¼ºç‚¹åœ¨æ•°æ®å‘é€æ–¹æŠ“åŒ…çš„æ—¶å€™å¯èƒ½çœ‹åˆ°ä¸€ä¸ªåˆ†æ®µå‰ï¼Œè¶…è¿‡MSSçš„å¤§åŒ…</li></ul></li><li>æ•°æ®åŒ…åˆ†æ®µ<ul><li>ä¼ è¾“å±‚åˆ†æ®µ(TCPåˆ†æ®µ)<ul><li>tcpä¼šæ ¹æ®mssè¿›è¡Œåˆ†æ®µï¼Œä¸€èˆ¬mssçš„é•¿åº¦æ˜¯MTU-40ï¼ŒåŒæ—¶ä¼šå°†IPå±‚çš„flagsæ‰“ä¸ŠDFæ ‡è®°é¿å…ipåˆ†ç‰‡</li><li>tcpå±‚åˆ†æ®µçš„å¥½å¤„æ˜¯æ”¯æŒè¶…æ—¶é‡ä¼ å’Œå¿«é€Ÿé‡ä¼ ç­‰æœºåˆ¶ä¿è¯å¯é æ€§</li><li>æœ‰æ—¶å€™TCPå¤´ä¸æ­¢20å­—èŠ‚ï¼Œæ‰€ä»¥ä¼šä¾µå ä¸€äº›MSSçš„ç©ºé—´ï¼Œæ¯”å¦‚ç”¨ä½œ TCP Optionsï¼Œè¿™æ ·ä¼ è¾“å±‚çœŸæ­£ç”¨æ¥æ‰¿è½½çš„å­—èŠ‚æ•° &#x3D; MTU(1500) - 20(ip header) - 20(tcp header) - length(Tcp Options)</li><li>TCPè¿æ¥å¿…é¡»è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œåœ¨å‰ä¸¤ä¸ªæ¡æ‰‹åŒ…ä¸­åŒæ–¹äº’ç›¸å£°æ˜è‡ªå·±çš„MSSï¼ŒåŒæ–¹é€‚é…å¾—åˆ°å…±è¯†çš„MTUï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°å®¢æˆ·ç«¯å‘é€çš„MTUå¤§äºæ¥æ”¶æ–¹çš„æƒ…å†µ</li></ul></li><li>ç½‘ç»œå±‚åˆ†æ®µ(UDP)<ul><li>ipå±‚åˆ†ç‰‡ï¼Œä¸¢å¤±ä¸€ä¸ªåˆ†ç‰‡åŒ…å°±éœ€è¦æ•´ä¸ªåŒ…é‡ä¼ </li><li>ä½¿ç”¨udpåè®®è‹¥ä¸åœ¨åº”ç”¨å±‚åšå¥½åˆ†æ®µå¤„ç†ï¼Œå°±å¯èƒ½ç”±äºåˆ†ç‰‡ä¸¢åŒ…é‡ä¼ å¯¼è‡´æ€§èƒ½åœ°ä¸‹</li><li>Udp æ²¡æœ‰MSSçš„æ¦‚å¿µï¼Œå…¨éƒ¨æ•°æ®ç§»äº¤ç»™ç½‘ç»œå±‚</li></ul></li><li>æ¥æ”¶æ–¹å¦‚ä½•é‡ç»„åˆ†æ®µåŒ…<ul><li>å°†IDç›¸åŒçš„åˆ†ç‰‡æŒ‰ç…§offå€¼ï¼ˆåç§»é‡ï¼‰è¿›è¡Œé‡ç»„</li><li>æ¥æ”¶æ–¹é€šè¿‡Flagsä¸‹é¢çš„çš„ <code>More Fragments = 0</code> åˆ¤æ–­æ˜¯ä¸æ˜¯æœ€åä¸€ä¸ªåˆ†ç‰‡ï¼Œå¦‚æœæ˜¯æœ€åä¸€ä¸ªåˆ†ç‰‡äº†ï¼Œå¯ä»¥å¼€å§‹é‡ç»„åˆ†ç‰‡äº†</li></ul></li></ul></li><li>Windos Scale<ul><li>TCPåè®®ä¸­åªç»™æ¥æ”¶çª—å£(win)é¢„ç•™äº†16ä¸ªæ¯”ç‰¹ï¼Œæ„å‘³ç€æœ€å¤§åªèƒ½è¡¨ç¤º 65535 å­—èŠ‚</li><li>éšç€ç½‘ç»œå¸¦å®½è¶Šæ¥è¶Šå¤§ï¼Œé¢„ç•™çš„16ä¸ªæ¯”ç‰¹å·²ç»ä¸å¤Ÿç”¨äº†ï¼ŒRFC 1323 æä¾›äº†ä¸€ä¸ªåˆ›æ„ï¼Œåœ¨ä¸‰æ¬¡æ¡æ‰‹æ—¶åŒæ–¹éƒ½æŠŠä¸€ä¸ªå« <code>Windows Scale</code> çš„å€¼å‘ŠçŸ¥å¯¹æ–¹ï¼Œå¯¹æ–¹æ”¶åˆ°åä¼šæŠŠè¿™ä¸ªå€¼å½“åš2çš„æŒ‡æ•°ï¼Œç®—å‡ºæ¥çš„å€¼å†ä½œä¸ºæ¥æ”¶çª—å£çš„ç³»æ•°</li><li>å‡è®¾ Windos Scale &#x3D; 3ï¼Œwin &#x3D; 10ï¼Œé‚£ä¹ˆå®é™…çš„æ¥æ”¶çª—å£ &#x3D; 10 * 2^3 &#x3D; 80</li><li>ï¼ï¼å¦‚æœåœ¨ä¸‰æ¬¡æ¡æ‰‹ä¹‹åæ‰å¼€å§‹æŠ“åŒ…ï¼Œå°±æ— æ³•è·å–åˆ°Windos Scaleï¼Œåªèƒ½æ˜¾ç¤ºå‡ºæ²¡æœ‰ç³»æ•°çš„å¤§å°ï¼Œè¿™æ˜¯ä¸å‡†ç¡®çš„</li></ul></li><li>TTL(Time to Live)<ul><li>TTL åˆå§‹å€¼ä¸€èˆ¬ä¸º64</li><li>RFC 1812 ä¸€ä¸ªç½‘ç»œåŒ…çš„TTLæ¯å‡å»1å°±æ„å‘³ç€å®ƒç»è¿‡ä¸€æ¬¡è·¯ç”±</li><li>TTLä¸€èˆ¬å¯ä»¥ç”¨æ¥éªŒè¯ç½‘ç»œæ‹“æ‰‘ï¼Œæ¯”å¦‚å½“å‰æ”¶åˆ°çš„åŒ…å…·ä½“æ˜¯å“ªä¸ªæœåŠ¡å™¨å‘å‡ºçš„</li></ul></li></ul><h3 id="TCP-æµé‡æ§åˆ¶ä¸çª—å£æœºåˆ¶"><a href="#TCP-æµé‡æ§åˆ¶ä¸çª—å£æœºåˆ¶" class="headerlink" title="TCP æµé‡æ§åˆ¶ä¸çª—å£æœºåˆ¶"></a>TCP æµé‡æ§åˆ¶ä¸çª—å£æœºåˆ¶</h3><ol><li><h4 id="TCPå¤´éƒ¨Winå­—æ®µ"><a href="#TCPå¤´éƒ¨Winå­—æ®µ" class="headerlink" title="TCPå¤´éƒ¨Winå­—æ®µ"></a>TCPå¤´éƒ¨Winå­—æ®µ</h4></li></ol><ul><li>Winå­—æ®µè¡¨ç¤ºå‘é€æ–¹çš„æ¥æ”¶çª—å£å¤§å°(rwnd)</li><li>å‘ŠçŸ¥å¯¹æ–¹è‡ªå·±è¿˜èƒ½æ¥æ”¶å¤šå°‘æ•°æ®</li><li>åŠ¨æ€å˜åŒ–ï¼šWin &#x3D; æ¥æ”¶ç¼“å†²åŒºå¤§å° - å·²æ¥æ”¶ä½†æœªå¤„ç†çš„æ•°æ®é‡</li></ul><h4 id="2-æµé‡æ§åˆ¶æœºåˆ¶"><a href="#2-æµé‡æ§åˆ¶æœºåˆ¶" class="headerlink" title="2.  æµé‡æ§åˆ¶æœºåˆ¶"></a>2.  æµé‡æ§åˆ¶æœºåˆ¶</h4><h5 id="2-1-æ¥æ”¶çª—å£-rwnd"><a href="#2-1-æ¥æ”¶çª—å£-rwnd" class="headerlink" title="2.1   æ¥æ”¶çª—å£(rwnd)"></a>2.1   æ¥æ”¶çª—å£(rwnd)</h5><ul><li>é€šè¿‡TCPå¤´éƒ¨Winå­—æ®µå‘ŠçŸ¥å¯¹æ–¹</li><li>åæ˜ æ¥æ”¶æ–¹çš„å¤„ç†èƒ½åŠ›</li><li>é˜²æ­¢æ¥æ”¶æ–¹ç¼“å†²åŒºæº¢å‡º</li><li>ç”±åº”ç”¨ç¨‹åºå¤„ç†é€Ÿåº¦å†³å®š</li></ul><h5 id="2-2-æ‹¥å¡çª—å£-cwnd"><a href="#2-2-æ‹¥å¡çª—å£-cwnd" class="headerlink" title="2.2  æ‹¥å¡çª—å£(cwnd)"></a>2.2  æ‹¥å¡çª—å£(cwnd)</h5><p><img data-src="/images/socket_02_11.jpeg" alt="img"></p><p><img data-src="/images/socket_02_12.png" alt="img"></p><ul><li>å‘é€æ–¹å†…éƒ¨ç»´æŠ¤ï¼Œä¸éœ€è¦å‘ŠçŸ¥å¯¹æ–¹</li><li>åæ˜ ç½‘ç»œçš„æ‰¿è½½èƒ½åŠ›</li><li>é˜²æ­¢ç½‘ç»œæ‹¥å¡</li><li>ç”±ç½‘ç»œçŠ¶å†µåŠ¨æ€è°ƒæ•´</li><li>æ‹¥å¡çª—å£å¯ä»¥é€šè¿‡ä¼°ç®—åœ¨é€”å­—èŠ‚æ•°è¿›è¡Œè®¡ç®—ï¼Œåœ¨é€”å­—èŠ‚æ•° &#x3D; seq + len - ackï¼Œç®€å•æ¥è¯´å°±æ˜¯å‘é€æ–¹è¿™è¾¹å‘é€è¿‡å»çš„å­—èŠ‚æ•°å‡å»å¯¹ç«¯ackçš„å­—èŠ‚æ•°å¾—åˆ°åœ¨é€”å­—èŠ‚æ•°ï¼Œé‚£ä¹ˆæ‹¥å¡çª—å£æ€ä¹ˆç¡®å®šæœ€åä¸€ä¸ªæ•°æ®åŒ…å‘¢ï¼Œæ‰¾åˆ°ç¬¬ä¸€ä¸ªå‘ç”Ÿé‡ä¼ çš„æ•°æ®åŒ…ï¼Œæ ¹æ®æ­¤æ•°æ®åŒ…è¿›è¡Œè¿‡æ»¤ï¼Œå¾—åˆ°æœ€åä¸€ä¸ªå‘é€çš„æ•°æ®åŒ…ä»¥åŠackåŒ…ï¼Œå°±èƒ½è®¡ç®—åœ¨é€”å­—èŠ‚æ•°äº†ï¼Œå½“ç„¶è¿™ç§æ–¹å¼åªæ˜¯ä¼°ç®—ï¼Œéœ€è¦é‡‡æ ·å‡ æ¬¡ï¼Œå»æœ€ä½çš„æ‹¥å¡ç‚¹ä½œä¸ºæ‹¥å¡çª—å£</li></ul><h5 id="2-3-å®é™…å‘é€æ§åˆ¶"><a href="#2-3-å®é™…å‘é€æ§åˆ¶" class="headerlink" title="2.3 å®é™…å‘é€æ§åˆ¶"></a>2.3 å®é™…å‘é€æ§åˆ¶</h5><blockquote><p>å‘é€çª—å£å¤§å° &#x3D; min(å¯¹æ–¹é€šå‘Šçš„win, æœ¬åœ°çš„cwnd)</p></blockquote>]]></content>
    
    
    <summary type="html">&lt;ul&gt;
&lt;li&gt;æŸ¥çœ‹è·¯ç”±è¡¨ä¿¡æ¯&lt;ul&gt;
&lt;li&gt;å¯ä»¥æ˜¾ç¤ºæ•°æ®åŒ…çš„è·¯ç”±è§„åˆ™ï¼Œå‘Šè¯‰æˆ‘ä»¬å»å¾€ä¸åŒç›®æ ‡IPæ—¶ä¼šä½¿ç”¨å“ªä¸ªç½‘å¡ï¼Œæ–¹ä¾¿æŒ‡å®šç½‘å¡æŠ“åŒ…&lt;/li&gt;
&lt;li&gt;&lt;code&gt;netstat -nr&lt;/code&gt; æ‰€æœ‰ç³»ç»Ÿå‡å¯ä½¿ç”¨ï¼Œnè¡¨ç¤ºä»¥æ•°å­—å½¢å¼æ˜¾ç¤ºåœ°å€å’Œç«¯å£ï¼Œrè¡¨ç¤ºroute&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ip route&lt;/code&gt; linuxä¸‹ä½¿ç”¨ï¼Œæ›¿ä»£ netstat -r&lt;/li&gt;
&lt;li&gt;&lt;code&gt;ss&lt;/code&gt;linuxä¸‹ä½¿ç”¨ï¼Œæ›¿ä»£ netstat&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç¡®è®¤å·(ack)è®¡ç®—è§„åˆ™&lt;ul&gt;
&lt;li&gt;æ™®é€šæ•°æ®åŒ…ï¼šack &amp;#x3D; å¯¹æ–¹seq + len&lt;/li&gt;
&lt;li&gt;SYN&amp;#x2F;FINåŒ…ï¼šack &amp;#x3D; å¯¹æ–¹seq + len + 1&lt;/li&gt;
&lt;li&gt;â€œæˆ‘å·²ç»æ”¶åˆ°åˆ°è¿™ä¸ªä½ç½®çš„æ•°æ®äº†â€  â€œä½ ä¸‹æ¬¡å°±ä»è¿™ä¸ªä½ç½®ç»§ç»­å‘â€&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;seq &lt;ul&gt;
&lt;li&gt;ä¸æ˜¯åŒ…çš„å”¯ä¸€æ ‡è¯†ï¼Œè€Œæ˜¯æ•°æ®æµçš„ä½ç½®æ ‡è®°&lt;/li&gt;
&lt;li&gt;è¡¨ç¤ºâ€æˆ‘ä¹‹åçš„æ•°æ®ä¼šä»è¿™ä¸ªä½ç½®å¼€å§‹å‘â€&lt;/li&gt;
&lt;li&gt;ä¸‹ä¸€ä¸ªåŒ…çš„seqç­‰äºå¯¹ç«¯ç¡®è®¤çš„ackï¼Œseqã€ackæœ¬è´¨ä¸Šéƒ½æ˜¯æµçš„åºå·ï¼Œackè¡¨ç¤ºå¯¹ç«¯ç¡®è®¤åˆ°äº†è¿™ä¸ªä½ç½®ï¼Œè‡ªç„¶æˆ‘ç«¯éœ€è¦ä»æ­¤ä¸ºæ­¢å‘é€æ•°æ®&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æŸäº›åœºæ™¯ä¸‹æŒ¥æ‰‹æ—¶ FIN+ACKå¯èƒ½åˆå¹¶ä¸ºä¸€ä¸ªåŒ…&lt;ul&gt;
&lt;li&gt;å»¶è¿Ÿç¡®è®¤çš„åœºæ™¯ä¸‹ï¼ŒFIN+ACKå¯èƒ½åˆå¹¶ä¸ºä¸€ä¸ªåŒ…&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;LSO&lt;ul&gt;
&lt;li&gt;ä¼ è¾“å±‚ä¸è´Ÿè´£æ‹†åŒ…å¤„ç†ï¼Œè€Œæ˜¯å°†æ•°æ®ç›´æ¥ä¼ é€’ç»™ç½‘å¡ï¼Œäº¤ç»™ç½‘å¡è´Ÿè´£åˆ†æ®µ&lt;/li&gt;
&lt;li&gt;ä¼ ç»Ÿç½‘ç»œæ˜¯åº”ç”¨å±‚æŠŠæ•°æ®äº¤ç»™TCPå±‚ï¼ŒTCPå±‚æ ¹æ®MSSå¤§å°è¿›è¡Œåˆ†æ®µï¼ˆcpuè´Ÿè´£ï¼‰&lt;/li&gt;
&lt;li&gt;å¯ç”¨LSOä¹‹åï¼ŒTCPå±‚ç›´æ¥æŠŠæ•°æ®å—ä¼ ç»™ç½‘å¡ï¼Œ è®©ç½‘å¡è´Ÿè´£åˆ†æ®µå·¥ä½œ&lt;/li&gt;
&lt;li&gt;ä¼˜ç‚¹åœ¨äºèŠ‚çœäº†cpuèµ„æºï¼Œç¼ºç‚¹åœ¨æ•°æ®å‘é€æ–¹æŠ“åŒ…çš„æ—¶å€™å¯èƒ½çœ‹åˆ°ä¸€ä¸ªåˆ†æ®µå‰ï¼Œè¶…è¿‡MSSçš„å¤§åŒ…&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ•°æ®åŒ…åˆ†æ®µ&lt;ul&gt;
&lt;li&gt;ä¼ è¾“å±‚åˆ†æ®µ(TCPåˆ†æ®µ)&lt;ul&gt;
&lt;li&gt;tcpä¼šæ ¹æ®mssè¿›è¡Œåˆ†æ®µï¼Œä¸€èˆ¬mssçš„é•¿åº¦æ˜¯MTU-40ï¼ŒåŒæ—¶ä¼šå°†IPå±‚çš„flagsæ‰“ä¸ŠDFæ ‡è®°é¿å…ipåˆ†ç‰‡&lt;/li&gt;
&lt;li&gt;tcpå±‚åˆ†æ®µçš„å¥½å¤„æ˜¯æ”¯æŒè¶…æ—¶é‡ä¼ å’Œå¿«é€Ÿé‡ä¼ ç­‰æœºåˆ¶ä¿è¯å¯é æ€§&lt;/li&gt;
&lt;li&gt;æœ‰æ—¶å€™TCPå¤´ä¸æ­¢20å­—èŠ‚ï¼Œæ‰€ä»¥ä¼šä¾µå ä¸€äº›MSSçš„ç©ºé—´ï¼Œæ¯”å¦‚ç”¨ä½œ TCP Optionsï¼Œè¿™æ ·ä¼ è¾“å±‚çœŸæ­£ç”¨æ¥æ‰¿è½½çš„å­—èŠ‚æ•° &amp;#x3D; MTU(1500) - 20(ip header) - 20(tcp header) - length(Tcp Options)&lt;/li&gt;
&lt;li&gt;TCPè¿æ¥å¿…é¡»è¿›è¡Œä¸‰æ¬¡æ¡æ‰‹ï¼Œåœ¨å‰ä¸¤ä¸ªæ¡æ‰‹åŒ…ä¸­åŒæ–¹äº’ç›¸å£°æ˜è‡ªå·±çš„MSSï¼ŒåŒæ–¹é€‚é…å¾—åˆ°å…±è¯†çš„MTUï¼Œè¿™æ ·å°±ä¸ä¼šå‡ºç°å®¢æˆ·ç«¯å‘é€çš„MTUå¤§äºæ¥æ”¶æ–¹çš„æƒ…å†µ&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;ç½‘ç»œå±‚åˆ†æ®µ(UDP)&lt;ul&gt;
&lt;li&gt;ipå±‚åˆ†ç‰‡ï¼Œä¸¢å¤±ä¸€ä¸ªåˆ†ç‰‡åŒ…å°±éœ€è¦æ•´ä¸ªåŒ…é‡ä¼ &lt;/li&gt;
&lt;li&gt;ä½¿ç”¨udpåè®®è‹¥ä¸åœ¨åº”ç”¨å±‚åšå¥½åˆ†æ®µå¤„ç†ï¼Œå°±å¯èƒ½ç”±äºåˆ†ç‰‡ä¸¢åŒ…é‡ä¼ å¯¼è‡´æ€§èƒ½åœ°ä¸‹&lt;/li&gt;
&lt;li&gt;Udp æ²¡æœ‰MSSçš„æ¦‚å¿µï¼Œå…¨éƒ¨æ•°æ®ç§»äº¤ç»™ç½‘ç»œå±‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;æ¥æ”¶æ–¹å¦‚ä½•é‡ç»„åˆ†æ®µåŒ…&lt;ul&gt;
&lt;li&gt;å°†IDç›¸åŒçš„åˆ†ç‰‡æŒ‰ç…§offå€¼ï¼ˆåç§»é‡ï¼‰è¿›è¡Œé‡ç»„&lt;/li&gt;
&lt;li&gt;æ¥æ”¶æ–¹é€šè¿‡Flagsä¸‹é¢çš„çš„ &lt;code&gt;More Fragments = 0&lt;/code&gt; åˆ¤æ–­æ˜¯ä¸æ˜¯æœ€åä¸€ä¸ªåˆ†ç‰‡ï¼Œå¦‚æœæ˜¯æœ€åä¸€ä¸ªåˆ†ç‰‡äº†ï¼Œå¯ä»¥å¼€å§‹é‡ç»„åˆ†ç‰‡äº†&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;Windos Scale&lt;ul&gt;
&lt;li&gt;TCPåè®®ä¸­åªç»™æ¥æ”¶çª—å£(win)é¢„ç•™äº†16ä¸ªæ¯”ç‰¹ï¼Œæ„å‘³ç€æœ€å¤§åªèƒ½è¡¨ç¤º 65535 å­—èŠ‚&lt;/li&gt;
&lt;li&gt;éšç€ç½‘ç»œå¸¦å®½è¶Šæ¥è¶Šå¤§ï¼Œé¢„ç•™çš„16ä¸ªæ¯”ç‰¹å·²ç»ä¸å¤Ÿç”¨äº†ï¼ŒRFC 1323 æä¾›äº†ä¸€ä¸ªåˆ›æ„ï¼Œåœ¨ä¸‰æ¬¡æ¡æ‰‹æ—¶åŒæ–¹éƒ½æŠŠä¸€ä¸ªå« &lt;code&gt;Windows Scale&lt;/code&gt; çš„å€¼å‘ŠçŸ¥å¯¹æ–¹ï¼Œå¯¹æ–¹æ”¶åˆ°åä¼šæŠŠè¿™ä¸ªå€¼å½“åš2çš„æŒ‡æ•°ï¼Œç®—å‡ºæ¥çš„å€¼å†ä½œä¸ºæ¥æ”¶çª—å£çš„ç³»æ•°&lt;/li&gt;
&lt;li&gt;å‡è®¾ Windos Scale &amp;#x3D; 3ï¼Œwin &amp;#x3D; 10ï¼Œé‚£ä¹ˆå®é™…çš„æ¥æ”¶çª—å£ &amp;#x3D; 10 * 2^3 &amp;#x3D; 80&lt;/li&gt;
&lt;li&gt;ï¼ï¼å¦‚æœåœ¨ä¸‰æ¬¡æ¡æ‰‹ä¹‹åæ‰å¼€å§‹æŠ“åŒ…ï¼Œå°±æ— æ³•è·å–åˆ°Windos Scaleï¼Œåªèƒ½æ˜¾ç¤ºå‡ºæ²¡æœ‰ç³»æ•°çš„å¤§å°ï¼Œè¿™æ˜¯ä¸å‡†ç¡®çš„&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;TTL(Time to Live)&lt;ul&gt;
&lt;li&gt;TTL åˆå§‹å€¼ä¸€èˆ¬ä¸º64&lt;/li&gt;
&lt;li&gt;RFC 1812 ä¸€ä¸ªç½‘ç»œåŒ…çš„TTLæ¯å‡å»1å°±æ„å‘³ç€å®ƒç»è¿‡ä¸€æ¬¡è·¯ç”±&lt;/li&gt;
&lt;li&gt;TTLä¸€èˆ¬å¯ä»¥ç”¨æ¥éªŒè¯ç½‘ç»œæ‹“æ‰‘ï¼Œæ¯”å¦‚å½“å‰æ”¶åˆ°çš„åŒ…å…·ä½“æ˜¯å“ªä¸ªæœåŠ¡å™¨å‘å‡ºçš„&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;TCP-æµé‡æ§åˆ¶ä¸çª—å£æœºåˆ¶&quot;&gt;&lt;a href=&quot;#TCP-æµé‡æ§åˆ¶ä¸çª—å£æœºåˆ¶&quot; class=&quot;headerlink&quot; title=&quot;TCP æµé‡æ§åˆ¶ä¸çª—å£æœºåˆ¶&quot;&gt;&lt;/a&gt;TCP æµé‡æ§åˆ¶ä¸çª—å£æœºåˆ¶&lt;/h3&gt;&lt;ol&gt;
&lt;li&gt;&lt;h4 id=&quot;TCPå¤´éƒ¨Winå­—æ®µ&quot;&gt;&lt;a href=&quot;#TCPå¤´éƒ¨Winå­—æ®µ&quot; class=&quot;headerlink&quot; title=&quot;TCPå¤´éƒ¨Winå­—æ®µ&quot;&gt;&lt;/a&gt;TCPå¤´éƒ¨Winå­—æ®µ&lt;/h4&gt;&lt;/li&gt;
&lt;/ol&gt;</summary>
    
    
    
    <category term="ç½‘ç»œ" scheme="https://taeyang0126.github.io/categories/%E7%BD%91%E7%BB%9C/"/>
    
    
    <category term="linux" scheme="https://taeyang0126.github.io/tags/linux/"/>
    
    <category term="ç½‘ç»œ" scheme="https://taeyang0126.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
    <category term="tcp" scheme="https://taeyang0126.github.io/tags/tcp/"/>
    
    <category term="æŠ“åŒ…" scheme="https://taeyang0126.github.io/tags/%E6%8A%93%E5%8C%85/"/>
    
  </entry>
  
  <entry>
    <title>linuxå†…æ ¸å‘é€ç½‘ç»œåŒ…</title>
    <link href="https://taeyang0126.github.io/2025/02/09/wang-luo/linux-nei-he-fa-song-wang-luo-bao/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/wang-luo/linux-nei-he-fa-song-wang-luo-bao/posts/undefined/</id>
    <published>2025-02-09T09:47:22.000Z</published>
    <updated>2025-02-10T14:16:05.825Z</updated>
    
    <content type="html"><![CDATA[<h3 id="ç½‘ç»œå‘é€è¿‡ç¨‹æ±‡æ€»"><a href="#ç½‘ç»œå‘é€è¿‡ç¨‹æ±‡æ€»" class="headerlink" title="ç½‘ç»œå‘é€è¿‡ç¨‹æ±‡æ€»"></a>ç½‘ç»œå‘é€è¿‡ç¨‹æ±‡æ€»</h3><p><img data-src="/images/socket_02_10.png" alt="img"></p><ul><li>ä¸Šå›¾ä¸­ç½‘ç»œè®¾å¤‡å­ç³»ç»Ÿåœ¨å‘é€ç½‘ç»œåŒ…çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡whileå¾ªç¯ä¸æ–­åœ°ä»é˜Ÿåˆ—ä¸­å–å‡ºskbå¹¶è¿›è¡Œå‘é€ã€‚è¿™æ—¶å€™å…¶å®éƒ½æ˜¯å ç”¨çš„ç”¨æˆ·è¿›ç¨‹çš„ç³»ç»Ÿæ€æ—¶é—´(sy)ï¼Œåªæœ‰å½“<code>quota</code> ç”¨å°½æˆ–è€…å…¶ä»–è¿›ç¨‹éœ€è¦cpuæ—¶æ‰è§¦å‘è½¯ä¸­æ–­è¿›è¡Œå‘é€ã€‚</li><li>ç½‘ç»œè®¾å¤‡å­ç³»ç»Ÿçš„é˜Ÿåˆ—å’Œç½‘å¡é©±åŠ¨çš„ Ring Buffer å®é™…ä¸Šæ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µ<ul><li>ç½‘ç»œè®¾å¤‡å­ç³»ç»Ÿçš„é˜Ÿåˆ—æ˜¯åœ¨å†…æ ¸ç½‘ç»œæ ˆä¸­çš„è½¯ä»¶é˜Ÿåˆ—ï¼Œå½“æ•°æ®åŒ…ï¼ˆskbï¼‰å‡†å¤‡å‘é€æ—¶ï¼Œå®ƒé¦–å…ˆè¢«æ”¾å…¥è¿™ä¸ªè½¯ä»¶é˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—ä¸»è¦ç”¨äºæµé‡æ§åˆ¶ã€QoSï¼ˆæœåŠ¡è´¨é‡ï¼‰ç®¡ç†ç­‰ç›®çš„</li><li>ç½‘å¡é©±åŠ¨çš„ Ring Bufferæ˜¯ä¸€ä¸ªç¡¬ä»¶çº§åˆ«çš„é˜Ÿåˆ—ï¼ŒRing Buffer å­˜å‚¨çš„ä¸æ˜¯å®Œæ•´çš„ skbï¼Œè€Œæ˜¯æŒ‡å‘å†…å­˜ä¸­æ•°æ®åŒ…çš„æè¿°ç¬¦ã€‚</li><li>Ring Buffer åŒ…å«ä¸¤ä¸ªä¸»è¦çš„æ•°ç»„ï¼Œä¸¤ä¸ªæ•°ç»„ç›¸åŒindexä¸‹å¯¹åº”å­˜å‚¨äº†åŒä¸€ä¸ªskbï¼Œåªä¸è¿‡å†…æ ¸éœ€è¦çš„æ˜¯skbï¼Œç½‘å¡éœ€è¦å…·ä½“çš„ç‰©ç†åœ°å€ï¼Œé€šè¿‡æ­¤è®¾è®¡å½“ç½‘å¡å‘é€å®Œæ¯•åï¼Œå†…æ ¸é€šè¿‡åŒä¸€ä¸ªindexèƒ½å®šä½åˆ°skbä»è€Œè¿›è¡Œæ¸…ç†ç­‰å·¥ä½œã€‚<ol><li>æè¿°ç¬¦æ•°ç»„ï¼ˆDescriptor Ringï¼‰ä¸»è¦æ˜¯ç½‘å¡ä½¿ç”¨</li><li>ç¼“å†²åŒºä¿¡æ¯æ•°ç»„ï¼ˆBuffer Info Arrayï¼‰ä¸»è¦æ˜¯å†…æ ¸ä½¿ç”¨</li></ol></li></ul></li><li>åœ¨ç›‘æ§å†…æ ¸å‘é€æ•°æ®æ¶ˆè€—çš„cpuæ—¶ï¼Œåº”è¯¥å°†syã€siéƒ½è€ƒè™‘è¿›æ¥<ul><li>ç½‘ç»œåŒ…å‘é€è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹(åœ¨å†…æ ¸æ€)å®Œæˆäº†ç»å¤§éƒ¨åˆ†çš„å·¥ä½œï¼Œç”šè‡³è¿è°ƒç”¨é©±åŠ¨çš„å·¥ä½œéƒ½å¹²äº†ã€‚åªæœ‰å½“å†…æ ¸æ€è¿›ç¨‹è¢«åˆ‡èµ°å‰æ‰ä¼šå‘èµ·è½¯ä¸­æ–­ã€‚å‘é€è¿‡ç¨‹ä¸­ï¼Œç»å¤§éƒ¨åˆ†ï¼ˆ90%ï¼‰ä»¥ä¸Šçš„å¼€é”€éƒ½æ˜¯åœ¨ç”¨æˆ·è¿›ç¨‹å†…æ ¸æ€æ¶ˆè€—æ‰çš„ã€‚</li><li>åªæœ‰ä¸€å°‘éƒ¨åˆ†æƒ…å†µæ‰ä¼šè§¦å‘è½¯ä¸­æ–­ï¼ˆNET_TXç±»å‹ï¼‰ï¼Œç”±è½¯ä¸­æ–­ksoftirqdçº¿ç¨‹æ¥å‘é€ã€‚</li></ul></li><li>åœ¨æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹&#x2F;proc&#x2F;softirqsï¼Œä¸ºä»€ä¹ˆNET_RXæ¯”NET_TXå¤§çš„å¤šçš„å¤šï¼Ÿ<ul><li>å½“æ•°æ®å‘é€å®Œæ¯•åï¼Œé€šè¿‡ç¡¬ä¸­æ–­çš„æ–¹å¼æ¥é€šçŸ¥é©±åŠ¨å‘é€å®Œæˆï¼Œä½†æ˜¯ç¡¬ä¸­æ–­æ— è®ºæ˜¯æ•°æ®æ¥æ”¶ï¼Œè¿˜æ˜¯å‘é€å®Œæ¯•ï¼Œè§¦å‘çš„è½¯ä¸­æ–­éƒ½æ˜¯NET_RX_SOFTIRQã€‚</li><li>å¯¹äºè¯»æ¥è¯´ï¼Œéƒ½æ˜¯éœ€è¦ç»è¿‡NET_RXè½¯ä¸­æ–­çš„ï¼Œéƒ½èµ°ksoftirqdå†…æ ¸çº¿ç¨‹ï¼Œè€Œå¯¹äºå‘é€æ¥è¯´ï¼Œç»å¤§éƒ¨åˆ†å·¥ä½œéƒ½æ˜¯åœ¨ç”¨æˆ·è¿›ç¨‹å†…æ ¸æ€å¤„ç†äº†ï¼Œåªæœ‰ç³»ç»Ÿæ€é…é¢ç”¨å°½æ‰å‘å‡ºNET_TXï¼Œè®©è½¯ä¸­æ–­ä¸Šã€‚</li></ul></li></ul><h3 id="å‘é€ç½‘ç»œæ•°æ®çš„æ—¶å€™éƒ½æ¶‰åŠå“ªäº›å†…å­˜æ‹·è´"><a href="#å‘é€ç½‘ç»œæ•°æ®çš„æ—¶å€™éƒ½æ¶‰åŠå“ªäº›å†…å­˜æ‹·è´" class="headerlink" title="å‘é€ç½‘ç»œæ•°æ®çš„æ—¶å€™éƒ½æ¶‰åŠå“ªäº›å†…å­˜æ‹·è´?"></a>å‘é€ç½‘ç»œæ•°æ®çš„æ—¶å€™éƒ½æ¶‰åŠå“ªäº›å†…å­˜æ‹·è´?</h3><blockquote><p>æŒ‡å¾…å‘é€æ•°æ®çš„å†…å­˜æ‹·è´</p></blockquote><ol><li>ç¬¬ä¸€æ¬¡æ‹·è´æ“ä½œæ˜¯åœ¨å†…æ ¸ç”³è¯·å®Œskbä¹‹åï¼Œè¿™æ—¶å€™ä¼šå°†ç”¨æˆ·ä¼ é€’è¿›æ¥çš„bufferé‡Œçš„æ•°æ®å†…å®¹éƒ½æ‹·è´åˆ°skbã€‚å¦‚æœè¦å‘é€çš„æ•°æ®é‡æ¯”è¾ƒå¤§ï¼Œè¿™ä¸ªæ‹·è´æ“ä½œå¼€é”€ä¸å°ã€‚</li><li>ç¬¬äºŒæ¬¡æ‹·è´æ“ä½œæ˜¯ä»ä¼ è¾“å±‚è¿›å…¥ç½‘ç»œå±‚çš„æ—¶å€™ï¼Œæ¯ä¸€ä¸ªskbéƒ½ä¼šè¢«å…‹éš†å‡ºæ¥ä¸€ä¸ªæ–°çš„å‰¯æœ¬ã€‚ç›®çš„æ˜¯ä¿ç•™åŸå§‹çš„skbï¼Œå½“ç½‘ç»œå‘ç°å¯¹æ–¹æ²¡æœ‰è¿”å›ackçš„æ—¶å€™ï¼Œè¿˜å¯ä»¥é‡æ–°å‘é€ï¼Œä»¥å®ç°TCPä¸­è¦æ±‚çš„å¯é ä¼ è¾“ï¼Œä¸è¿‡è¿™æ¬¡åªæ˜¯æµ…æ‹·è´ï¼Œåªæ‹·è´skbæè¿°ç¬¦æœ¬èº«ï¼Œæ‰€æŒ‡å‘çš„æ•°æ®è¿˜æ˜¯å¤ç”¨çš„ã€‚</li><li>ç¬¬ä¸‰æ¬¡æ‹·è´ä¸æ˜¯å¿…é¡»çš„ï¼Œåªæœ‰å½“IPå±‚å‘ç°skbå¤§äºMTUæ—¶æ‰éœ€è¦è¿›è¡Œã€‚æ­¤æ—¶ä¼šå†ç”³è¯·é¢å¤–çš„skbï¼Œå¹¶è®²ç©¶åŸæ¥çš„skbæ‹·è´ä¸ºå¤šä¸ªå°çš„skbã€‚</li></ol>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;ç½‘ç»œå‘é€è¿‡ç¨‹æ±‡æ€»&quot;&gt;&lt;a href=&quot;#ç½‘ç»œå‘é€è¿‡ç¨‹æ±‡æ€»&quot; class=&quot;headerlink&quot; title=&quot;ç½‘ç»œå‘é€è¿‡ç¨‹æ±‡æ€»&quot;&gt;&lt;/a&gt;ç½‘ç»œå‘é€è¿‡ç¨‹æ±‡æ€»&lt;/h3&gt;&lt;p&gt;&lt;img data-src=&quot;/images/socket_02_10.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;ä¸Šå›¾ä¸­ç½‘ç»œè®¾å¤‡å­ç³»ç»Ÿåœ¨å‘é€ç½‘ç»œåŒ…çš„æ—¶å€™ï¼Œæ˜¯é€šè¿‡whileå¾ªç¯ä¸æ–­åœ°ä»é˜Ÿåˆ—ä¸­å–å‡ºskbå¹¶è¿›è¡Œå‘é€ã€‚è¿™æ—¶å€™å…¶å®éƒ½æ˜¯å ç”¨çš„ç”¨æˆ·è¿›ç¨‹çš„ç³»ç»Ÿæ€æ—¶é—´(sy)ï¼Œåªæœ‰å½“&lt;code&gt;quota&lt;/code&gt; ç”¨å°½æˆ–è€…å…¶ä»–è¿›ç¨‹éœ€è¦cpuæ—¶æ‰è§¦å‘è½¯ä¸­æ–­è¿›è¡Œå‘é€ã€‚&lt;/li&gt;
&lt;li&gt;ç½‘ç»œè®¾å¤‡å­ç³»ç»Ÿçš„é˜Ÿåˆ—å’Œç½‘å¡é©±åŠ¨çš„ Ring Buffer å®é™…ä¸Šæ˜¯ä¸¤ä¸ªä¸åŒçš„æ¦‚å¿µ&lt;ul&gt;
&lt;li&gt;ç½‘ç»œè®¾å¤‡å­ç³»ç»Ÿçš„é˜Ÿåˆ—æ˜¯åœ¨å†…æ ¸ç½‘ç»œæ ˆä¸­çš„è½¯ä»¶é˜Ÿåˆ—ï¼Œå½“æ•°æ®åŒ…ï¼ˆskbï¼‰å‡†å¤‡å‘é€æ—¶ï¼Œå®ƒé¦–å…ˆè¢«æ”¾å…¥è¿™ä¸ªè½¯ä»¶é˜Ÿåˆ—ï¼Œè¿™ä¸ªé˜Ÿåˆ—ä¸»è¦ç”¨äºæµé‡æ§åˆ¶ã€QoSï¼ˆæœåŠ¡è´¨é‡ï¼‰ç®¡ç†ç­‰ç›®çš„&lt;/li&gt;
&lt;li&gt;ç½‘å¡é©±åŠ¨çš„ Ring Bufferæ˜¯ä¸€ä¸ªç¡¬ä»¶çº§åˆ«çš„é˜Ÿåˆ—ï¼ŒRing Buffer å­˜å‚¨çš„ä¸æ˜¯å®Œæ•´çš„ skbï¼Œè€Œæ˜¯æŒ‡å‘å†…å­˜ä¸­æ•°æ®åŒ…çš„æè¿°ç¬¦ã€‚&lt;/li&gt;
&lt;li&gt;Ring Buffer åŒ…å«ä¸¤ä¸ªä¸»è¦çš„æ•°ç»„ï¼Œä¸¤ä¸ªæ•°ç»„ç›¸åŒindexä¸‹å¯¹åº”å­˜å‚¨äº†åŒä¸€ä¸ªskbï¼Œåªä¸è¿‡å†…æ ¸éœ€è¦çš„æ˜¯skbï¼Œç½‘å¡éœ€è¦å…·ä½“çš„ç‰©ç†åœ°å€ï¼Œé€šè¿‡æ­¤è®¾è®¡å½“ç½‘å¡å‘é€å®Œæ¯•åï¼Œå†…æ ¸é€šè¿‡åŒä¸€ä¸ªindexèƒ½å®šä½åˆ°skbä»è€Œè¿›è¡Œæ¸…ç†ç­‰å·¥ä½œã€‚&lt;ol&gt;
&lt;li&gt;æè¿°ç¬¦æ•°ç»„ï¼ˆDescriptor Ringï¼‰ä¸»è¦æ˜¯ç½‘å¡ä½¿ç”¨&lt;/li&gt;
&lt;li&gt;ç¼“å†²åŒºä¿¡æ¯æ•°ç»„ï¼ˆBuffer Info Arrayï¼‰ä¸»è¦æ˜¯å†…æ ¸ä½¿ç”¨&lt;/li&gt;
&lt;/ol&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœ¨ç›‘æ§å†…æ ¸å‘é€æ•°æ®æ¶ˆè€—çš„cpuæ—¶ï¼Œåº”è¯¥å°†syã€siéƒ½è€ƒè™‘è¿›æ¥&lt;ul&gt;
&lt;li&gt;ç½‘ç»œåŒ…å‘é€è¿‡ç¨‹ä¸­ï¼Œç”¨æˆ·è¿›ç¨‹(åœ¨å†…æ ¸æ€)å®Œæˆäº†ç»å¤§éƒ¨åˆ†çš„å·¥ä½œï¼Œç”šè‡³è¿è°ƒç”¨é©±åŠ¨çš„å·¥ä½œéƒ½å¹²äº†ã€‚åªæœ‰å½“å†…æ ¸æ€è¿›ç¨‹è¢«åˆ‡èµ°å‰æ‰ä¼šå‘èµ·è½¯ä¸­æ–­ã€‚å‘é€è¿‡ç¨‹ä¸­ï¼Œç»å¤§éƒ¨åˆ†ï¼ˆ90%ï¼‰ä»¥ä¸Šçš„å¼€é”€éƒ½æ˜¯åœ¨ç”¨æˆ·è¿›ç¨‹å†…æ ¸æ€æ¶ˆè€—æ‰çš„ã€‚&lt;/li&gt;
&lt;li&gt;åªæœ‰ä¸€å°‘éƒ¨åˆ†æƒ…å†µæ‰ä¼šè§¦å‘è½¯ä¸­æ–­ï¼ˆNET_TXç±»å‹ï¼‰ï¼Œç”±è½¯ä¸­æ–­ksoftirqdçº¿ç¨‹æ¥å‘é€ã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;åœ¨æœåŠ¡å™¨ä¸ŠæŸ¥çœ‹&amp;#x2F;proc&amp;#x2F;softirqsï¼Œä¸ºä»€ä¹ˆNET_RXæ¯”NET_TXå¤§çš„å¤šçš„å¤šï¼Ÿ&lt;ul&gt;
&lt;li&gt;å½“æ•°æ®å‘é€å®Œæ¯•åï¼Œé€šè¿‡ç¡¬ä¸­æ–­çš„æ–¹å¼æ¥é€šçŸ¥é©±åŠ¨å‘é€å®Œæˆï¼Œä½†æ˜¯ç¡¬ä¸­æ–­æ— è®ºæ˜¯æ•°æ®æ¥æ”¶ï¼Œè¿˜æ˜¯å‘é€å®Œæ¯•ï¼Œè§¦å‘çš„è½¯ä¸­æ–­éƒ½æ˜¯NET_RX_SOFTIRQã€‚&lt;/li&gt;
&lt;li&gt;å¯¹äºè¯»æ¥è¯´ï¼Œéƒ½æ˜¯éœ€è¦ç»è¿‡NET_RXè½¯ä¸­æ–­çš„ï¼Œéƒ½èµ°ksoftirqdå†…æ ¸çº¿ç¨‹ï¼Œè€Œå¯¹äºå‘é€æ¥è¯´ï¼Œç»å¤§éƒ¨åˆ†å·¥ä½œéƒ½æ˜¯åœ¨ç”¨æˆ·è¿›ç¨‹å†…æ ¸æ€å¤„ç†äº†ï¼Œåªæœ‰ç³»ç»Ÿæ€é…é¢ç”¨å°½æ‰å‘å‡ºNET_TXï¼Œè®©è½¯ä¸­æ–­ä¸Šã€‚&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="ç½‘ç»œ" scheme="https://taeyang0126.github.io/categories/%E7%BD%91%E7%BB%9C/"/>
    
    
    <category term="linux" scheme="https://taeyang0126.github.io/tags/linux/"/>
    
    <category term="ç½‘ç»œ" scheme="https://taeyang0126.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
    <category term="socket" scheme="https://taeyang0126.github.io/tags/socket/"/>
    
  </entry>
  
  <entry>
    <title>linuxå†…æ ¸æ¥æ”¶ç½‘ç»œåŒ…</title>
    <link href="https://taeyang0126.github.io/2025/02/09/wang-luo/linux-nei-he-jie-shou-wang-luo-bao/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/wang-luo/linux-nei-he-jie-shou-wang-luo-bao/posts/undefined/</id>
    <published>2025-02-09T09:46:22.000Z</published>
    <updated>2025-02-10T14:16:05.826Z</updated>
    
    <content type="html"><![CDATA[<h3 id="RingBuffer"><a href="#RingBuffer" class="headerlink" title="RingBuffer"></a>RingBuffer</h3><h4 id="RingBufferåˆ°åº•æ˜¯ä»€ä¹ˆ"><a href="#RingBufferåˆ°åº•æ˜¯ä»€ä¹ˆ" class="headerlink" title="RingBufferåˆ°åº•æ˜¯ä»€ä¹ˆ?"></a>RingBufferåˆ°åº•æ˜¯ä»€ä¹ˆ?</h4><blockquote><p>æ˜¯å†…å­˜ä¸­çš„ä¸€å—ç‰¹æ®ŠåŒºåŸŸï¼Œç¯å½¢é˜Ÿåˆ—æ˜¯ç¬¼ç»Ÿçš„è¯´æ³•ï¼Œå®é™…ä¸ŠåŒ…æ‹¬<code>igb_rx_buffer</code> ç¯å½¢é˜Ÿåˆ—æ•°ç»„ã€<code>e1000_adv_rx_desc</code> ç¯å½¢é˜Ÿåˆ—æ•°ç»„åŠä¼—å¤šçš„skb</p></blockquote><p><img data-src="/images/socket_02_01.png" alt="img"></p><p>ç½‘å¡åœ¨æ”¶åˆ°æ•°æ®çš„æ—¶å€™ä»¥<code>DMA</code> æ–¹å¼å°†åŒ…å†™åˆ°RingBufferä¸­ã€‚è½¯ä¸­æ–­æ”¶åŒ…çš„æ—¶å€™æ¥è¿™é‡Œå°†skbå–èµ°ï¼Œå¹¶ç”³è¯·æ–°çš„skbé‡æ–°æŒ‚ä¸Šå»ã€‚</p><p>RingBufferå†…å­˜æ˜¯é¢„å…ˆåˆ†é…çš„è¿˜æ˜¯åŠ¨æ€åˆ†é…çš„ï¼Ÿ</p><p>æŒ‡é’ˆæ•°ç»„æ˜¯é¢„å…ˆåˆ†é…å¥½çš„ï¼Œè€Œskbè™½ç„¶ä¹Ÿä¼šé¢„å…ˆåˆ†é…å¥½ï¼Œä½†æ˜¯åœ¨åé¢çš„æ”¶åŒ…è¿‡ç¨‹ä¸­ä¼šä¸æ–­çš„åŠ¨æ€åœ°åˆ†é…ç”³è¯·</p><h4 id="RingBufferä¸ºä»€ä¹ˆä¼šä¸¢åŒ…ï¼Ÿ"><a href="#RingBufferä¸ºä»€ä¹ˆä¼šä¸¢åŒ…ï¼Ÿ" class="headerlink" title="RingBufferä¸ºä»€ä¹ˆä¼šä¸¢åŒ…ï¼Ÿ"></a>RingBufferä¸ºä»€ä¹ˆä¼šä¸¢åŒ…ï¼Ÿ</h4><ul><li>RingBufferæ˜¯æœ‰å¤§å°å’Œé•¿åº¦é™åˆ¶çš„</li><li>ä½¿ç”¨ <code>ethtool -g eth0</code> å‘½ä»¤æŸ¥çœ‹é•¿åº¦ï¼ŒPre-set maximums æŒ‡çš„æ˜¯æœ€å¤§å€¼ï¼ŒCurrent hardware settings è¡¨ç¤ºå½“å‰è®¾ç½®ï¼Œä¸‹å›¾è¡¨ç¤ºæœ€å¤§å…è®¸1024ï¼Œç›®å‰è®¾ç½®ä¸º1024</li></ul><p><img data-src="/images/socket_02_02.png" alt="img"></p><ul><li>æŸ¥çœ‹æ˜¯å¦æœ‰æº¢å‡ºæƒ…å†µå‘ç”Ÿ  <code>ethtool -S eth0</code>ï¼Œå¦‚æœæœ‰æº¢å‡ºæƒ…å†µå‘ç”Ÿ(ifconfigä¸­ä½“ç°ä¸ºoverrunsæŒ‡æ ‡å¢é•¿)ï¼Œè¡¨ç¤ºæœ‰åŒ…å› ä¸ºRingBufferè£…ä¸ä¸‹è€Œè¢«ä¸¢å¼ƒäº†ï¼Œè§£å†³æ€è·¯æœ‰ä¸¤ç§<ul><li>åŠ å¤§RingBufferé•¿åº¦ <code>ethtool -G eth0 rx 4096 tx 4096</code> ï¼Œæ­¤ç§æ–¹å¼åªæ˜¯ä¸´æ—¶è§£å†³ï¼Œæ²»æ ‡ä¸æ²»æœ¬</li><li>å¼€å¯å¤šé˜Ÿåˆ—æå‡ç½‘ç»œæ€§èƒ½ï¼Œæ‰“æ•£é˜Ÿåˆ—çš„äº²æ ¸æ€§</li><li>ç°åœ¨ä¸»æµç½‘å¡åŸºæœ¬ä¸Šéƒ½æ”¯æŒå¤šé˜Ÿåˆ—ï¼Œé€šè¿‡<code>ethtool -l eth0</code> è¿›è¡ŒæŸ¥çœ‹ï¼Œä¸‹å›¾è¡¨ç¤ºå½“å‰ç½‘å¡æ”¯æŒçš„æœ€å¤§é˜Ÿåˆ—æ•°æ˜¯2ï¼Œå½“å‰å¼€å¯çš„ä¹Ÿæ˜¯2ï¼Œé€šè¿‡sysfsä¹Ÿå¯ä»¥çœ‹åˆ°çœŸæ­£ç”Ÿæ•ˆçš„é˜Ÿåˆ—æ•°é‡ã€‚</li><li><img data-src="/images/socket_02_03.png" alt="img"></li><li><img data-src="/images/socket_02_04.png" alt="img"></li><li>åŠ å¤§é˜Ÿåˆ—æ•°é‡ï¼Œå¯ä»¥ä½¿ç”¨ <code>ethtool -L eth0 combined 32</code> </li><li>å¦‚æœå‘ç°æŸä¸ªcpuæ ¸å¿ƒsiç‰¹åˆ«é«˜ï¼Œå¯ä»¥è€ƒè™‘è°ƒæ•´é˜Ÿåˆ—äº²å’Œçš„cpuæ ¸å¿ƒ<ul><li><code>cat /proc/interrupts</code>æŸ¥çœ‹é˜Ÿåˆ—çš„ç¡¬ä»¶ç¡¬ä¸­æ–­ï¼Œä¸‹å›¾æ˜¾ç¤ºè¾“å…¥é˜Ÿåˆ—0çš„ä¸­æ–­å·æ˜¯25ï¼Œé˜Ÿåˆ—1çš„ä¸­æ–­å·æ˜¯27ï¼Œé€šè¿‡è¿™ä¸ªä¸­æ–­å·å¯¹åº”çš„<code>smp_affinity</code>å¯ä»¥æŸ¥çœ‹åˆ°äº²å’Œçš„cpuæ ¸æ˜¯å“ªä¸ªã€‚ä¸‹å›¾æ˜¾ç¤ºçš„2åœ¨äºŒè¿›åˆ¶ä¸­ä»£è¡¨ç¬¬äºŒä½æ˜¯1ï¼Œæ‰€ä»¥è¡¨ç¤ºç¬¬2ä¸ªcpuæ ¸å¿ƒâ€”â€”CPU2</li><li><img data-src="/images/socket_02_05.png" alt="img"></li><li><img data-src="/images/socket_02_06.png" alt="img"></li><li>æ¯ä¸ªé˜Ÿåˆ—éƒ½ä¼šæœ‰ç‹¬ç«‹çš„ã€ä¸åŒçš„ä¸­æ–­å·ã€‚æ‰€ä»¥ä¸åŒçš„é˜Ÿåˆ—åœ¨å°†æ•°æ®æ”¶å–åˆ°è‡ªå·±çš„RingBufferåï¼Œå¯ä»¥åˆ†åˆ«å‘ä¸åŒçš„CPUå‘èµ·ç¡¬ä¸­æ–­é€šçŸ¥ã€‚è€Œåœ¨ç¡¬ä¸­æ–­çš„å¤„ç†ä¸­ï¼Œå‘èµ·è½¯ä¸­æ–­æ˜¯åŸºäºå½“å‰æ ¸å¿ƒçš„ï¼Œè¿™æ„å‘³ç€<strong>å“ªä¸ªæ ¸å“åº”çš„ç¡¬ä¸­æ–­ï¼Œé‚£ä¹ˆè¯¥ç¡¬ä¸­æ–­å‘èµ·çš„è½¯ä¸­æ–­ä»»åŠ¡å°±å¿…ç„¶ç”±è¿™ä¸ªæ ¸æ¥å¤„ç†</strong>ã€‚</li><li>é€šè¿‡è®¾ç½®æ¯ä¸ªé˜Ÿåˆ—ä¸­æ–­å·ä¸Šçš„<code>smp_affinity</code>ï¼Œå°†å„ä¸ªé˜Ÿåˆ—çš„ç¡¬ä¸­æ–­æ‰“æ•£åˆ°ä¸åŒçš„cpuä¸Šã€‚</li></ul></li></ul></li></ul><h3 id="ç½‘ç»œç›¸å…³çš„ç¡¬ä¸­æ–­ã€è½¯ä¸­æ–­éƒ½æ˜¯ä»€ä¹ˆ"><a href="#ç½‘ç»œç›¸å…³çš„ç¡¬ä¸­æ–­ã€è½¯ä¸­æ–­éƒ½æ˜¯ä»€ä¹ˆ" class="headerlink" title="ç½‘ç»œç›¸å…³çš„ç¡¬ä¸­æ–­ã€è½¯ä¸­æ–­éƒ½æ˜¯ä»€ä¹ˆ?"></a>ç½‘ç»œç›¸å…³çš„ç¡¬ä¸­æ–­ã€è½¯ä¸­æ–­éƒ½æ˜¯ä»€ä¹ˆ?</h3><p> åœ¨ç½‘å¡å°†æ•°æ®æ”¾åˆ°<code>RingBuffer</code> ä¹‹åï¼Œæ¥ç€å°±å‘èµ·<code>ç¡¬ä¸­æ–­</code>ï¼Œé€šçŸ¥cpuè¿›è¡Œå¤„ç†ã€‚ä¸è¿‡åœ¨ç¡¬ä¸­æ–­çš„ä¸Šä¸‹æ–‡é‡Œåšçš„å·¥ä½œå¾ˆå°‘ï¼Œå°†ä¼ è¿‡æ¥çš„<code>poll_list</code> æ·»åŠ åˆ°æ¯ä¸ªcpuå˜é‡<code>softnet_data</code> çš„ <code>poll_list</code> é‡Œé¢ï¼Œæ¥ç€è§¦å‘<code>è½¯ä¸­æ–­</code> <code>NET_RX_SOFTIRQ</code>ã€‚åœ¨è½¯ä¸­æ–­ä¸­å¯¹softnet_dataçš„è®¾å¤‡åˆ—è¡¨poll_listè¿›è¡Œéå†ï¼Œæ‰§è¡Œç½‘å¡é©±åŠ¨æä¾›çš„pollæ¥æ”¶å–ç½‘ç»œåŒ…ã€‚å¤„ç†å®Œæˆåä¼šé€åˆ°åè®®æ ˆçš„ip_rcvã€udp_rcvã€tcp_rcv_v4ç­‰å‡½æ•°ä¸­</p><p>poll_list æ˜¯ä¸ªåŒå‘é“¾è¡¨ï¼Œå­˜å‚¨å¾…å¤„ç†NAPIå®ä¾‹çš„é“¾è¡¨ã€‚</p><p>ä¸€ä¸ªç½‘å¡é©±åŠ¨ç¨‹åºé€šå¸¸ä¼šæ³¨å†Œä¸€ä¸ªNAPIç»“æ„(struct napi_struct)ï¼Œè¿™ä¸ªç»“æ„åŸºæœ¬çº¦ç­‰äºä¸€ä¸ªæ¥æ”¶é˜Ÿåˆ—ï¼Œç›®çš„æ˜¯ä¸ºäº†å‡å°‘ç¡¬ä¸­æ–­çš„æ¬¡æ•°ã€‚åœ¨é«˜å¹¶å‘ç½‘ç»œä¸­ï¼Œé¢‘ç¹çš„æ¥æ”¶åˆ°ç½‘ç»œåŒ…å¯¼è‡´é¢‘ç¹è§¦å‘ç¡¬ä¸­æ–­ï¼Œæµªè´¹äº†CPUæ€§èƒ½ï¼Œé€šè¿‡NAPIä¸€ä¸ªé˜Ÿåˆ—ä¸­æ¥æ”¶åˆ°ç½‘ç»œåŒ…åå°†æ­¤é˜Ÿåˆ—ä¿¡æ¯ä¼ é€’ç»™è½¯ä¸­æ–­ï¼Œè½¯ä¸­æ–­å¤„ç†ç¨‹åºåœ¨å¤„ç†çš„æ—¶å€™å…ˆåœæ­¢è§¦å‘ç¡¬ä¸­æ–­ï¼Œä¸“æ³¨æ¥æ”¶åŒ…çš„å¤„ç†ï¼Œå¤„ç†å®Œæˆåå†æ‰“å¼€ç¡¬ä¸­æ–­è§¦å‘ï¼Œå¤§å¤§å‡å°‘äº†ç¡¬ä¸­æ–­çš„è§¦å‘ã€‚</p><h3 id="ksoftirqdå†…æ ¸çº¿ç¨‹æ˜¯ç”¨æ¥å¹²å˜›çš„"><a href="#ksoftirqdå†…æ ¸çº¿ç¨‹æ˜¯ç”¨æ¥å¹²å˜›çš„" class="headerlink" title="ksoftirqdå†…æ ¸çº¿ç¨‹æ˜¯ç”¨æ¥å¹²å˜›çš„?"></a>ksoftirqdå†…æ ¸çº¿ç¨‹æ˜¯ç”¨æ¥å¹²å˜›çš„?</h3><ul><li>æœºå™¨ä¸Šæœ‰å‡ æ ¸ï¼Œå†…æ ¸å°±ä¼šåˆ›å»ºå‡ ä¸ªksoftirqdçº¿ç¨‹å‡ºæ¥</li><li>å†…æ ¸çº¿ç¨‹ksoftirqdåŒ…å«äº†æ‰€æœ‰çš„è½¯ä¸­æ–­å¤„ç†é€»è¾‘ï¼Œè½¯ä¸­æ–­ä¿¡æ¯å¯ä»¥é€šè¿‡ <code>cat /proc/softirqs</code> å‘½ä»¤è¿›è¡ŒæŸ¥çœ‹</li></ul><p><img data-src="/images/socket_02_07.png" alt="img"></p><h3 id="tcpdumpæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"><a href="#tcpdumpæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ" class="headerlink" title="tcpdumpæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ"></a>tcpdumpæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</h3><blockquote><p>tcpdumpå·¥ä½œåœ¨è®¾å¤‡å±‚ï¼Œæ˜¯é€šè¿‡è™šæ‹Ÿåè®®çš„æ–¹å¼å·¥ä½œçš„ã€‚é€šè¿‡è°ƒç”¨packet_createå°†æŠ“åŒ…å‡½æ•°ä»¥åè®®çš„å½¢å¼æŒ‚åˆ°ptype_allä¸Šã€‚è¿™ä¸ªå‡½æ•°ä¼šå°†åŒ…é€åˆ°åè®®æ ˆå‡½æ•°(ip_rcvã€arp_rcv)ä¹‹å‰ï¼Œå°†åŒ…å…ˆé€åˆ°ptype_allæŠ“åŒ…ç‚¹ã€‚</p></blockquote><ul><li>iptable&#x2F;netfilter ä¸»è¦æ˜¯åœ¨IPã€ARPç­‰å±‚å®ç°çš„ã€‚å¦‚æœé…ç½®è¿‡äºå¤æ‚çš„è§„åˆ™ï¼Œåˆ™ä¼šæ¶ˆè€—è¿‡å¤šçš„cpuï¼ŒåŠ å¤§ç½‘ç»œå»¶è¿Ÿ</li><li>tcpdumpå·¥ä½œåœ¨è®¾å¤‡å±‚ï¼Œå°†åŒ…é€åˆ°ipå±‚ä»¥å‰å°±èƒ½å¤„ç†ï¼Œè€Œnetfilterå·¥ä½œåœ¨IPã€ARPç­‰å±‚ï¼Œä»ä¸‹å›¾æ¥çœ‹ï¼Œnetfilterå·¥ä½œåœ¨tcpdumpä¹‹åï¼Œæ‰€ä»¥iptableå°ç¦è§„åˆ™ä¸å½±å“tcpdumpæŠ“åŒ…ï¼›ä½†æ˜¯å‘åŒ…è¿‡ç¨‹æ°æ°ç›¸åï¼Œå‘åŒ…çš„æ—¶å€™netfilterå…ˆè¿›è¡Œå·¥ä½œï¼Œåœ¨åè®®å±‚å°±è¢«è¿‡æ»¤æ‰äº†ï¼Œæ‰€ä»¥tcpdumpä»€ä¹ˆéƒ½çœ‹ä¸åˆ°ã€‚</li></ul><p><img data-src="/images/socket_02_08.png" alt="img"></p><h3 id="ç½‘ç»œæ¥æ”¶è¿‡ç¨‹ä¸­çš„CPUå¼€é”€å¦‚ä½•æŸ¥çœ‹ï¼Ÿ"><a href="#ç½‘ç»œæ¥æ”¶è¿‡ç¨‹ä¸­çš„CPUå¼€é”€å¦‚ä½•æŸ¥çœ‹ï¼Ÿ" class="headerlink" title="ç½‘ç»œæ¥æ”¶è¿‡ç¨‹ä¸­çš„CPUå¼€é”€å¦‚ä½•æŸ¥çœ‹ï¼Ÿ"></a>ç½‘ç»œæ¥æ”¶è¿‡ç¨‹ä¸­çš„CPUå¼€é”€å¦‚ä½•æŸ¥çœ‹ï¼Ÿ</h3><blockquote><p>åœ¨ç½‘ç»œåŒ…çš„æ¥æ”¶è¿‡ç¨‹ä¸­ï¼Œä¸»è¦å·¥ä½œé›†ä¸­åœ¨ç¡¬ä¸­æ–­å’Œè½¯ä¸­æ–­ä¸Šï¼ŒäºŒè€…çš„æ¶ˆè€—å¯ä»¥é€šè¿‡topå‘½ä»¤è¿›è¡ŒæŸ¥çœ‹</p></blockquote><ul><li>è¾“å…¥topå‘½ä»¤åï¼Œå†è¾“å…¥1å³å¯æŸ¥çœ‹ã€‚å…¶ä¸­hiæ˜¯CPUå¤„ç†ç¡¬ä¸­æ–­çš„å¼€é”€ï¼Œsiæ˜¯å¤„ç†è½¯ä¸­æ–­çš„å¼€é”€ï¼Œéƒ½æ˜¯ä»¥ç™¾åˆ†æ¯”çš„å½¢å¼å±•ç°çš„ã€‚</li></ul><p><img data-src="/images/socket_02_09.png" alt="img"></p>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;RingBuffer&quot;&gt;&lt;a href=&quot;#RingBuffer&quot; class=&quot;headerlink&quot; title=&quot;RingBuffer&quot;&gt;&lt;/a&gt;RingBuffer&lt;/h3&gt;&lt;h4 id=&quot;RingBufferåˆ°åº•æ˜¯ä»€ä¹ˆ&quot;&gt;&lt;a href=&quot;#RingBufferåˆ°åº•æ˜¯ä»€ä¹ˆ&quot; class=&quot;headerlink&quot; title=&quot;RingBufferåˆ°åº•æ˜¯ä»€ä¹ˆ?&quot;&gt;&lt;/a&gt;RingBufferåˆ°åº•æ˜¯ä»€ä¹ˆ?&lt;/h4&gt;&lt;blockquote&gt;
&lt;p&gt;æ˜¯å†…å­˜ä¸­çš„ä¸€å—ç‰¹æ®ŠåŒºåŸŸï¼Œç¯å½¢é˜Ÿåˆ—æ˜¯ç¬¼ç»Ÿçš„è¯´æ³•ï¼Œå®é™…ä¸ŠåŒ…æ‹¬&lt;code&gt;igb_rx_buffer&lt;/code&gt; ç¯å½¢é˜Ÿåˆ—æ•°ç»„ã€&lt;code&gt;e1000_adv_rx_desc&lt;/code&gt; ç¯å½¢é˜Ÿåˆ—æ•°ç»„åŠä¼—å¤šçš„skb&lt;/p&gt;
&lt;/blockquote&gt;</summary>
    
    
    
    <category term="ç½‘ç»œ" scheme="https://taeyang0126.github.io/categories/%E7%BD%91%E7%BB%9C/"/>
    
    
    <category term="linux" scheme="https://taeyang0126.github.io/tags/linux/"/>
    
    <category term="ç½‘ç»œ" scheme="https://taeyang0126.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
    <category term="socket" scheme="https://taeyang0126.github.io/tags/socket/"/>
    
  </entry>
  
  <entry>
    <title>TCP è¿æ¥</title>
    <link href="https://taeyang0126.github.io/2025/02/09/wang-luo/tcp-lian-jie/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/wang-luo/tcp-lian-jie/posts/undefined/</id>
    <published>2025-02-09T09:45:22.000Z</published>
    <updated>2025-02-10T14:16:05.825Z</updated>
    
    <content type="html"><![CDATA[<h3 id="TCP-çŠ¶æ€è½¬æ¢å›¾"><a href="#TCP-çŠ¶æ€è½¬æ¢å›¾" class="headerlink" title="TCP çŠ¶æ€è½¬æ¢å›¾"></a>TCP çŠ¶æ€è½¬æ¢å›¾</h3><p><img data-src="/images/tcp_01_01.png" alt="img"></p><h3 id="TCP-è¿æ¥çš„åˆ†ç»„äº¤æ¢"><a href="#TCP-è¿æ¥çš„åˆ†ç»„äº¤æ¢" class="headerlink" title="TCP è¿æ¥çš„åˆ†ç»„äº¤æ¢"></a>TCP è¿æ¥çš„åˆ†ç»„äº¤æ¢</h3><p><img data-src="/images/tcp_01_02.png" alt="img"></p><ul><li>MSSï¼ˆMaximum Segment Sizeï¼‰: æŒ‡å®šäº† TCP æ•°æ®åŒ…ä¸­æ•°æ®éƒ¨åˆ†çš„æœ€å¤§é•¿åº¦<ul><li>ä¸€èˆ¬çº¦å®šæœ€å°æ˜¯ 536ï¼Œå› ä¸º IPv4 è§„èŒƒä¸­å»ºè®®çš„æœ€å° MTU æ˜¯ 576ï¼Œå‡å» 20 å­—èŠ‚çš„æ ‡å‡† IPv4 å¤´çš„é•¿åº¦ï¼Œå†å‡å» 20 å­—èŠ‚çš„æ ‡å‡† TCP å¤´çš„é•¿åº¦ï¼Œå¾—åˆ° 536 å­—èŠ‚</li><li>ä¸€èˆ¬çº¦å®šæœ€å¤§æ˜¯ 1460ï¼Œå› ä¸º IPv4 è§„èŒƒä¸­å»ºè®®çš„æœ€å¤§ MTU æ˜¯ 1500</li></ul></li><li>MSS ä»¥åŒæ–¹çº¦å®šçš„æœ€å°å€¼ä¸ºå‡†</li><li>è¯·æ±‚ ACK æ˜¯æœåŠ¡ç«¯å¯¹å®¢æˆ·ç«¯å‘é€è¿‡æ¥çš„æ•°æ®åŒ…çš„å“åº”</li><li>åº”ç­” ACK æ˜¯å®¢æˆ·ç«¯å¯¹æœåŠ¡ç«¯å‘é€è¿‡æ¥çš„æ•°æ®åŒ…çš„å“åº”</li><li>TIME_WAIT çŠ¶æ€<ul><li>ä¸»åŠ¨å…³é—­çš„é‚£ç«¯ç»å†äº†è¿™ä¸ªçŠ¶æ€</li><li>æ­¤çŠ¶æ€çš„æŒç»­æ—¶é—´æœ€é•¿æ˜¯ 2MSLï¼ŒMSL åœ¨ RFC 1122 çš„å»ºè®®å€¼æ˜¯ 2 åˆ†é’Ÿï¼Œåœ¨ Berkeley ä¿®æ”¹ä¸º 30sï¼Œæ„å‘³ç€ TIME_WAIT çŠ¶æ€çš„æŒç»­æ—¶é—´åœ¨ 1 åˆ†é’Ÿåˆ° 4 åˆ†é’Ÿä¹‹é—´<ul><li>MSL æ˜¯ä»»ä½• IP æ•°æ®æŠ¥èƒ½å­˜æ´»çš„æœ€é•¿æ—¶é—´ï¼Œå› ä¸ºæ¯ä¸ªæ•°æ®æŠ¥éƒ½æœ‰è·³é™ï¼ˆhop limitï¼‰ï¼Œæœ€å¤§æ˜¯ 255 è·³</li></ul></li><li>æ­¤çŠ¶æ€å­˜åœ¨çš„ç†ç”±<ul><li>å¯é çš„å®ç° TCP å…¨åŒå·¥è¿æ¥çš„ç»ˆæ­¢</li><li>è¢«åŠ¨ç»ˆæ­¢çš„ä¸€æ–¹ä¼šå‘é€æœ€ç»ˆçš„ FINï¼Œå› æ­¤æ­¤ç«¯å¿…é¡»ç»´æŠ¤çŠ¶æ€ä¿¡æ¯ï¼Œä»¥å…è®¸æ­¤ç«¯é‡æ–°å‘é€æœ€ç»ˆçš„ ACKã€‚å¦‚æœæ­¤ç«¯ä¸ç»´æŠ¤çŠ¶æ€ä¿¡æ¯äº†ï¼Œé‚£ä¹ˆä¼šå“åº”ä¸€ä¸ª <strong>RST</strong>ï¼Œä¼šè¢«å¯¹ç«¯è§£é‡Šä¸ºä¸€ä¸ªé”™è¯¯</li><li>å…è®¸è€çš„é‡å¤åˆ†èŠ‚åœ¨ç½‘ç»œä¸­æ¶ˆé€</li><li>å‡è®¾æŸä¸ªè¿æ¥å…³é—­äº†ï¼Œç„¶ååœ¨ç›¸åŒçš„å®¢æˆ·ç«¯ã€æœåŠ¡å™¨ä¹‹é—´å»ºç«‹çš„ä¸€ä¸ªæ–°çš„è¿æ¥ï¼Œè¿™ä¸ªè¿æ¥çš„å››å…ƒç»„ä¸ä¹‹å‰å…³é—­çš„è¿æ¥å®Œå…¨ä¸€è‡´ï¼Œåä¸€ä¸ªè¿æ¥ç§°ä¸ºå‰ä¸€ä¸ªè¿æ¥çš„åŒ–èº«ã€‚TCP å¿…é¡»é˜²æ­¢æ¥è‡ªæŸä¸ªè¿æ¥çš„è€çš„é‡å¤åˆ†ç»„åœ¨è¯¥è¿æ¥å·²ç»ˆæ­¢åå†ç°ï¼Œä»è€Œè¢«è¯¯è§£æˆå±äºåŒä¸€ä¸ªè¿æ¥çš„æŸä¸ªæ–°çš„åŒ–èº«ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼ŒTCP å°†ä¸ç»™å¤„äº TIME_WAIT çŠ¶æ€çš„è¿æ¥å‘èµ·æ–°çš„åŒ–èº«ã€‚åˆå› ä¸º TIME_WAIT æœ€é•¿å­˜æ´»æ—¶é—´ä¸º 2MSLï¼Œæ­¤æ—¶é—´è¶³å¤Ÿæ—§è¿æ¥çš„æ•°æ®åŒ…æ¶ˆé€äº†</li></ul></li></ul></li></ul><h3 id="Listen"><a href="#Listen" class="headerlink" title="Listen"></a>Listen</h3><blockquote><p>æœ€ä¸»è¦çš„å·¥ä½œå°±æ˜¯<code>ç”³è¯·å’Œåˆå§‹åŒ–</code>æ¥æ”¶é˜Ÿåˆ—ï¼ŒåŒ…æ‹¬<code>å…¨è¿æ¥é˜Ÿåˆ—ä»¥åŠåŠè¿æ¥é˜Ÿåˆ—</code></p></blockquote><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fdã€backlog</span></span><br><span class="line">listen(fd, <span class="number">128</span>)</span><br></pre></td></tr></table></figure><h4 id="å…¨è¿æ¥é˜Ÿåˆ—"><a href="#å…¨è¿æ¥é˜Ÿåˆ—" class="headerlink" title="å…¨è¿æ¥é˜Ÿåˆ—"></a>å…¨è¿æ¥é˜Ÿåˆ—</h4><blockquote><p>å…¨è¿æ¥é˜Ÿåˆ—æ˜¯ä¸€ä¸ªé“¾è¡¨ï¼Œå†…æ ¸ä¸­ä½¿ç”¨é“¾è¡¨çš„ headã€tailï¼Œæ–¹ä¾¿åº”ç”¨å±‚ç›´æ¥æ ¹æ®å¤´å°¾æŒ‡é’ˆæŸ¥æ‰¾æ¥å…¥çš„è¿æ¥</p></blockquote><h5 id="å…¨è¿æ¥é˜Ÿåˆ—çš„é•¿åº¦"><a href="#å…¨è¿æ¥é˜Ÿåˆ—çš„é•¿åº¦" class="headerlink" title="å…¨è¿æ¥é˜Ÿåˆ—çš„é•¿åº¦"></a>å…¨è¿æ¥é˜Ÿåˆ—çš„é•¿åº¦</h5><ul><li>æœ€å¤§é•¿åº¦æ˜¯ listen ä¼ å…¥çš„ backlog å’Œ net.core.somaxconn ä¹‹é—´è¾ƒå°çš„å€¼ã€‚å¦‚æœéœ€è¦åŠ å¤§é•¿åº¦ï¼Œéœ€è¦è°ƒæ•´è¿™ä¸¤ä¸ªå€¼ã€‚</li><li>ä½¿ç”¨ <code>cat /proc/sys/net/core/somaxconn</code> å‘½ä»¤æŸ¥çœ‹</li><li>æŸ¥çœ‹æŸä¸ªè¿›ç¨‹çš„å…¨è¿æ¥é˜Ÿåˆ—çš„é•¿åº¦ï¼Œé€šè¿‡ä½¿ç”¨å‘½ä»¤ **<code>ss -nlt</code>**è¿›è¡ŒæŸ¥çœ‹ï¼Œå…¶ä¸­ <strong>Send-Q</strong> è¡¨ç¤ºå…¨è¿æ¥é˜Ÿåˆ—é•¿åº¦</li></ul><p><img data-src="/images/tcp_01_03.png" alt="img"></p><h5 id="åˆ¤æ–­å…¨è¿æ¥é˜Ÿåˆ—æ˜¯å¦æº¢å‡º"><a href="#åˆ¤æ–­å…¨è¿æ¥é˜Ÿåˆ—æ˜¯å¦æº¢å‡º" class="headerlink" title="åˆ¤æ–­å…¨è¿æ¥é˜Ÿåˆ—æ˜¯å¦æº¢å‡º"></a>åˆ¤æ–­å…¨è¿æ¥é˜Ÿåˆ—æ˜¯å¦æº¢å‡º</h5><p><strong><code>watch &#39;netstat -s | grep overflowed&#39;</code></strong></p><p>å¦‚æœä¸Šè¿°å‘½ä»¤ç»“æœæ˜¾ç¤º <strong>xx times the listen queue of a socket overflowed</strong> åˆ™è¯´æ˜æœ‰å…¨è¿æ¥é˜Ÿåˆ—æº¢å‡ºäº†</p><h5 id="åŠè¿æ¥é˜Ÿåˆ—çš„é•¿åº¦"><a href="#åŠè¿æ¥é˜Ÿåˆ—çš„é•¿åº¦" class="headerlink" title="åŠè¿æ¥é˜Ÿåˆ—çš„é•¿åº¦"></a>åŠè¿æ¥é˜Ÿåˆ—çš„é•¿åº¦</h5><ul><li>åŠè¿æ¥é˜Ÿåˆ—çš„é•¿åº¦æ˜¯ <em><strong>minï¼ˆbacklogï¼Œsomaxconnï¼Œtcp_max_syn_backlogï¼‰ + 1</strong></em> å†å‘ä¸Šå»æ•´åˆ° <strong>2</strong> çš„ <em><strong>N</strong></em> æ¬¡å¹‚ï¼Œä½†æœ€å°ä¸èƒ½å°äº <strong>16</strong></li><li><code>cat /proc/sys/net/ipv4/tcp_max_syn_backlog</code> å‘½ä»¤æŸ¥çœ‹ tcp_max_syn_backlog</li><li>å‡è®¾æŸå†…æ ¸å‚æ•° net.core.somaxconn&#x3D;128ï¼Œnet.ipv4.tcp_max_syn_backlog&#x3D;8192ï¼Œç”¨æˆ· backlog&#x3D;5ï¼Œç»è¿‡ä»¥ä¸‹æ­¥éª¤è®¡ç®—å¾—å‡ºä¸º 16<ul><li>min(backlog, somaxconn) &#x3D; min(5, 128) &#x3D; 5</li><li>min(5, tcp_max_syn_backlog) &#x3D; min(5, 8192) &#x3D; 5</li><li>maxï¼ˆ5ï¼Œ 8ï¼‰ &#x3D; 8  è¿™ä¸€æ­¥æ˜¯å†…æ ¸ä¸ºäº†é¿å…ä¼ å…¥ä¸€ä¸ªå¤ªå°çš„å€¼å¯¼è‡´æ— æ³•æ¥æ”¶è¿æ¥ï¼Œæ‰€ä»¥å¿…é¡»è¦&gt;&#x3D;8</li><li>roundup_pow_of_two(8 + 1) &#x3D; 16</li></ul></li><li>å‡è®¾æŸå†…æ ¸å‚æ•° net.core.somaxconn&#x3D;128ï¼Œnet.ipv4.tcp_max_syn_backlog&#x3D;8192ï¼Œç”¨æˆ· backlog&#x3D;512ï¼Œç»è¿‡ä»¥ä¸‹æ­¥éª¤è®¡ç®—å¾—å‡ºä¸º 256<ul><li>min(backlog, somaxconn) &#x3D; min(512, 128) &#x3D; 128</li><li>min(128, tcp_max_syn_backlog) &#x3D; min(128, 8192) &#x3D; 128</li><li>max(128, 8) &#x3D; 128  </li><li>roundup_pow_of_two(128 + 1) &#x3D; 256</li></ul></li></ul><h5 id="åˆ¤æ–­åŠè¿æ¥é˜Ÿåˆ—æ˜¯å¦æº¢å‡ºï¼Ÿ"><a href="#åˆ¤æ–­åŠè¿æ¥é˜Ÿåˆ—æ˜¯å¦æº¢å‡ºï¼Ÿ" class="headerlink" title="åˆ¤æ–­åŠè¿æ¥é˜Ÿåˆ—æ˜¯å¦æº¢å‡ºï¼Ÿ"></a>åˆ¤æ–­åŠè¿æ¥é˜Ÿåˆ—æ˜¯å¦æº¢å‡ºï¼Ÿ</h5><ol><li>è®¡ç®—åŠè¿æ¥é˜Ÿåˆ—çš„é•¿åº¦</li><li>æŸ¥çœ‹å½“å‰SYN_RECVçŠ¶æ€çš„è¿æ¥æ•°é‡</li></ol><p><strong><code>netstat -antp | grep SYN_RECV | wc -l</code></strong></p><p>å…¶å®åªéœ€è¦ä¿è¯ <strong><code>tcp_syncookies</code></strong> è¿™ä¸ªå†…æ ¸å‚æ•°æ˜¯ <strong>1</strong> å°±ä¸ä¼šæœ‰åŠè¿æ¥é˜Ÿåˆ—æº¢å‡ºçš„é—®é¢˜ï¼ŒğŸ‘ğŸ»æ¨èå¼€å¯æ­¤å‚æ•°ï¼ï¼ä¸”å¼€å¯æ­¤å‚æ•°å¯ä»¥æŠµå¾¡ SYN flood æ”»å‡»</p><p><strong><code>cat /proc/sys/net/ipv4/tcp_syncookies</code></strong> é€šè¿‡æ­¤å‘½ä»¤æŸ¥çœ‹å¯¹åº”å‚æ•°</p><p><strong><code>echo 1 &gt; /proc/sys/net/ipv4/tcp_syncookies</code></strong> æ­¤å‘½ä»¤è¿›è¡Œä¿®æ”¹</p><h3 id="Connect"><a href="#Connect" class="headerlink" title="Connect"></a>Connect</h3><p>å®¢æˆ·ç«¯åœ¨æ‰§è¡Œ connect å‡½æ•°çš„æ—¶å€™ï¼ŒæŠŠæœ¬åœ° socket çŠ¶æ€è®¾ç½®æˆäº†**<code>TCP_SYN_SENT</code>**ï¼Œé€‰äº†ä¸€ä¸ªå¯ç”¨ç«¯å£ï¼Œæ¥ç€å‘å‡º SYN æ¡æ‰‹è¯·æ±‚å¹¶å¯åŠ¨é‡ä¼ å®šæ—¶å™¨</p><h4 id="é€‰æ‹©å¯ç”¨ç«¯å£"><a href="#é€‰æ‹©å¯ç”¨ç«¯å£" class="headerlink" title="é€‰æ‹©å¯ç”¨ç«¯å£"></a>é€‰æ‹©å¯ç”¨ç«¯å£</h4><ol><li>å¦‚æœè°ƒç”¨è¿‡ bindï¼Œé‚£ä¹ˆä»¥ bind å®šä¹‰çš„ç«¯å£ä¸ºå‡†ï¼Œå¦åˆ™éœ€è¦æŒ‰ç…§ä»¥ä¸‹è§„åˆ™å¯»æ‰¾å¯ç”¨çš„ç«¯å£</li><li>å¯ç”¨çš„ç«¯å£èŒƒå›´æ˜¯æ ¹æ®å†…æ ¸å‚æ•° <strong><code>net.ipv4.ip_local_port_range</code></strong>ï¼Œæ­¤å‚æ•°çš„èŒƒå›´å°±æ˜¯èƒ½é€‰æ‹©çš„ç«¯å£èŒƒå›´ï¼Œå¯ä»¥ä½¿ç”¨å‘½ä»¤ **<code>cat /proc/sys/net/ipv4/ip_local_port_range</code>**è¿›è¡ŒæŸ¥çœ‹ï¼Œä¸‹å›¾è¡¨ç¤ºèƒ½ä½¿ç”¨çš„èŒƒå›´æ˜¯ 32768-60999ã€‚æ³¨æ„è¿™é‡ŒæŸ¥æ‰¾ç«¯å£æ˜¯å¾ªç¯çš„ï¼Œå¦‚æœéœ€è¦å¾ˆå¤šè½®æ‰æŸ¥æ‰¾åˆ°å¯ç”¨çš„ç«¯å£ï¼Œä¼šå¯¼è‡´ connect ç³»ç»Ÿè°ƒç”¨çš„ cpu å‡é«˜<ul><li><img data-src="/images/tcp_01_04.png" alt="img"></li></ul></li><li>åˆ¤æ–­é€‰æ‹©çš„ç«¯å£æ˜¯å¦åœ¨ä¿ç•™ç«¯å£ä¸­ï¼Œå¦‚æœæ˜¯åˆ™ä¸èƒ½ä½¿ç”¨æ­¤ç«¯å£ã€‚å†…æ ¸å‚æ•°**<code>net.ipv4.ip_local_reserved_ports</code>** è¡¨ç¤ºä¿ç•™ç«¯å£ï¼Œå¦‚æœå¸Œæœ›æŸäº›ç«¯å£ä¸è¢«å†…æ ¸ä½¿ç”¨ï¼Œå°†ä»–ä»¬å†™åˆ°è¿™ä¸ªå‚æ•°é‡Œé¢å°±å¯ä»¥ã€‚<strong><code>cat /proc/sys/net/ipv4/ip_local_reserved_ports</code></strong></li><li>åˆ¤æ–­é€‰æ‹©çš„ç«¯å£æ˜¯å¦å·²ç»ä½¿ç”¨è¿‡äº†ï¼Œå†…æ ¸ä¼šç»´æŠ¤ä¸€ä¸ªä½¿ç”¨è¿‡çš„ç«¯å£çš„ hash è¡¨ï¼Œå¦‚æœåœ¨ hash è¡¨ä¸­æ²¡æœ‰æ‰¾åˆ°ï¼Œè¯æ˜æ­¤ç«¯å£æ˜¯å¯ç”¨çš„ï¼Œåé¢ä¼šåœ¨æ­¤ hash è¡¨ä¸­è®°å½•ç«¯å£å·²ç»è¢«ä½¿ç”¨</li><li>å¦‚æœä¸Šé¢è¿˜æ˜¯æ²¡æœ‰æ‰¾åˆ°åˆé€‚çš„ç«¯å£ï¼Œå°±ä¼šå‡ºç° <strong>Cannot assign requested address</strong> è¿™ä¸ªé”™è¯¯</li></ol><h4 id="ç«¯å£è¢«ä½¿ç”¨è¿‡æ€ä¹ˆåŠï¼Ÿ"><a href="#ç«¯å£è¢«ä½¿ç”¨è¿‡æ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="ç«¯å£è¢«ä½¿ç”¨è¿‡æ€ä¹ˆåŠï¼Ÿ"></a>ç«¯å£è¢«ä½¿ç”¨è¿‡æ€ä¹ˆåŠï¼Ÿ</h4><blockquote><p>ğŸ‘†ğŸ»é€‰æ‹©å¯ç”¨ç«¯å£çš„ç¬¬å››æ­¥åˆ¤æ–­ç«¯å£æ˜¯å¦å·²ç»ä½¿ç”¨è¿‡äº†ï¼Œä¸æ˜¯ç®€å•çš„åˆ¤æ–­ç«¯å£æ˜¯å¦ä½¿ç”¨è¿‡äº†ï¼Œè€Œæ˜¯å¦‚æœç«¯å£è¢«ä½¿ç”¨è¿‡äº†ï¼Œä¸”<strong>å››å…ƒç»„å®Œå…¨ä¸€è‡´</strong>æ—¶æ‰æ— æ³•ä½¿ç”¨æ­¤ç«¯å£ï¼Œå¦‚æœå››å…ƒç»„æœ‰ä¸€ä¸ªä¸ä¸€è‡´ï¼Œé‚£ä¹ˆè¿™ä¸ªç«¯å£æ˜¯å¯ä»¥ä½¿ç”¨çš„ã€‚</p></blockquote><h4 id="å‘èµ·-sync-è¯·æ±‚"><a href="#å‘èµ·-sync-è¯·æ±‚" class="headerlink" title="å‘èµ· sync è¯·æ±‚"></a>å‘èµ· sync è¯·æ±‚</h4><ol><li>ç”³è¯·ä¸€ä¸ª skbï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º<code>SYN</code>åŒ…</li><li>æ·»åŠ åˆ°å‘é€é˜Ÿåˆ— <code>sk_write_queue</code> </li><li>è°ƒç”¨<code>tcp_transmit_skb</code>å°†è¯¥åŒ…å‘å‡º</li><li>å¯åŠ¨ä¸€ä¸ªé‡ä¼ å®šæ—¶å™¨ï¼Œè¶…æ—¶ä¼šé‡å‘ã€‚é¦–æ¬¡è¶…æ—¶æ—¶é—´æ˜¯åœ¨<code>TCP_TIMEOUT_INIT</code>å®ä¸­å®šä¹‰çš„</li></ol><h3 id="ä¸‰æ¬¡æ¡æ‰‹"><a href="#ä¸‰æ¬¡æ¡æ‰‹" class="headerlink" title="ä¸‰æ¬¡æ¡æ‰‹"></a>ä¸‰æ¬¡æ¡æ‰‹</h3><p><img data-src="/images/tcp_01_05.png" alt="img"></p><ol><li>ç¬¬ä¸€æ¬¡æ¡æ‰‹æœåŠ¡ç«¯åªæ˜¯åˆ›å»ºäº†**<code>request sock</code>**ï¼Œå¹¶åŠ å…¥åˆ°åŠè¿æ¥é˜Ÿåˆ—ä¸­ï¼Œå¹¶æ²¡æœ‰åˆ›å»º socketï¼Œå®é™…åˆ›å»ºsocketæ˜¯åœ¨ä¸‰æ¬¡æ¡æ‰‹å®Œæˆæ—¶ã€‚</li><li>TCP è¿æ¥å»ºç«‹çš„ç½‘ç»œè€—æ—¶å¤§çº¦éœ€è¦ä¸‰æ¬¡ä¼ è¾“ï¼Œå†åŠ ä¸Šå°‘è®¸çš„åŒæ–¹ cpu å¼€é”€ï¼Œæ€»å…±å¤§çº¦æ¯” <strong>1.5 å€ RTT</strong> å¤§ä¸€ç‚¹ç‚¹ã€‚ä¸è¿‡ä»å®¢æˆ·ç«¯è§’åº¦æ¥çœ‹ï¼Œåªè¦ ACK åŒ…å‘å‡ºäº†ï¼Œå†…æ ¸å°±è®¤ä¸ºè¿æ¥å»ºç«‹æˆåŠŸå¯ä»¥å¼€å§‹å‘é€æ•°æ®äº†ï¼Œæ‰€ä»¥å¦‚æœåœ¨å®¢æˆ·ç«¯è¿›è¡Œæ‰“ç‚¹ç»Ÿè®¡ TCP è¿æ¥å»ºç«‹è€—æ—¶åªéœ€è¦ä¸¤æ¬¡ä¼ è¾“è€—æ—¶â€”â€”å³ä¸€ä¸ª RTT å¤šä¸€ç‚¹çš„æ—¶é—´ï¼ˆæœåŠ¡ç«¯ä¹Ÿæ˜¯åŒç†ï¼Œä» SYN åŒ…æ¥æ”¶åˆ°å¼€å§‹ç®—èµ·ï¼Œåˆ° ACK åŒ…æ¥æ”¶å®Œæ¯•ï¼‰</li></ol>]]></content>
    
    
    <summary type="html">&lt;h3 id=&quot;TCP-çŠ¶æ€è½¬æ¢å›¾&quot;&gt;&lt;a href=&quot;#TCP-çŠ¶æ€è½¬æ¢å›¾&quot; class=&quot;headerlink&quot; title=&quot;TCP çŠ¶æ€è½¬æ¢å›¾&quot;&gt;&lt;/a&gt;TCP çŠ¶æ€è½¬æ¢å›¾&lt;/h3&gt;&lt;p&gt;&lt;img data-src=&quot;/images/tcp_01_01.png&quot; alt=&quot;img&quot;&gt;&lt;/p&gt;
&lt;h3 id=&quot;TCP-è¿æ¥çš„åˆ†ç»„äº¤æ¢&quot;&gt;&lt;a href=&quot;#TCP-è¿æ¥çš„åˆ†ç»„äº¤æ¢&quot; class=&quot;headerlink&quot; title=&quot;TCP è¿æ¥çš„åˆ†ç»„äº¤æ¢&quot;&gt;&lt;/a&gt;TCP è¿æ¥çš„åˆ†ç»„äº¤æ¢&lt;/h3&gt;</summary>
    
    
    
    <category term="ç½‘ç»œ" scheme="https://taeyang0126.github.io/categories/%E7%BD%91%E7%BB%9C/"/>
    
    
    <category term="linux" scheme="https://taeyang0126.github.io/tags/linux/"/>
    
    <category term="ç½‘ç»œ" scheme="https://taeyang0126.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
    <category term="tcp" scheme="https://taeyang0126.github.io/tags/tcp/"/>
    
  </entry>
  
  <entry>
    <title>Socket</title>
    <link href="https://taeyang0126.github.io/2025/02/09/wang-luo/socket/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/wang-luo/socket/posts/undefined/</id>
    <published>2025-02-09T09:43:22.000Z</published>
    <updated>2025-02-10T14:16:05.825Z</updated>
    
    <content type="html"><![CDATA[<ul><li><a href="https://zhuanlan.zhihu.com/p/455352339">èŠèŠNettyé‚£äº›äº‹å„¿ä¹‹ä»å†…æ ¸è§’åº¦çœ‹IOæ¨¡å‹</a></li></ul><h3 id="Socket-æ•°æ®æ¥æ”¶åˆ°-Epoll-å¤„ç†æµç¨‹"><a href="#Socket-æ•°æ®æ¥æ”¶åˆ°-Epoll-å¤„ç†æµç¨‹" class="headerlink" title="Socket æ•°æ®æ¥æ”¶åˆ° Epoll å¤„ç†æµç¨‹"></a>Socket æ•°æ®æ¥æ”¶åˆ° Epoll å¤„ç†æµç¨‹</h3><pre><code class="mermaid">sequenceDiagram    participant S as Socket    participant WQ as Wait Queue    participant CB as Callback (ep_poll_callback)    participant EP as eppoll_entry    participant EI as epitem    participant EPL as eventpoll    S-&gt;&gt;S: æ¥æ”¶æ•°æ®    S-&gt;&gt;WQ: è§¦å‘ç­‰å¾…é˜Ÿåˆ—    WQ-&gt;&gt;CB: è°ƒç”¨å›è°ƒå‡½æ•°    CB-&gt;&gt;EP: container_of æ‰¾åˆ° eppoll_entry    EP-&gt;&gt;EI: è®¿é—® base æŒ‡é’ˆæ‰¾åˆ° epitem    EI-&gt;&gt;EPL: å°† epitem åŠ å…¥æ´»è·ƒé˜Ÿåˆ—</code></pre><ol><li><p>æ•°æ®åˆ°è¾¾å’Œåˆå§‹å¤„ç†ï¼š </p><ul><li>ç½‘å¡æ¥æ”¶æ•°æ®ï¼Œé€šè¿‡ DMA å°†æ•°æ®æ”¾å…¥ Ring Bufferã€‚</li><li>è§¦å‘è½¯ä¸­æ–­ï¼Œå†…æ ¸å°†æ•°æ®åŒ…ï¼ˆsk_buffï¼‰æ”¾å…¥ socket çš„æ¥æ”¶é˜Ÿåˆ—ã€‚</li></ul></li><li><p>Socket å”¤é†’ç­‰å¾…é˜Ÿåˆ—ï¼š </p><ul><li>Socket æ£€æµ‹åˆ°æœ‰æ–°æ•°æ®ï¼Œå¼€å§‹å”¤é†’å…¶ç­‰å¾…é˜Ÿåˆ—ï¼ˆwait_queueï¼‰ä¸­çš„ç­‰å¾…è€…ã€‚</li><li>è·å–å…¶ä¸­ä¸€ä¸ª wait_queue_entry_tï¼Œè¿™é‡Œä¸è·å–å…¨éƒ¨ä¸€æ˜¯é¿å…æƒŠç¾¤æ•ˆåº”ï¼ŒäºŒæ˜¯ epoll åœºæ™¯ä¸‹ä¸€èˆ¬ä¹Ÿåªä¼šæœ‰ä¸€ä¸ª wait_queue_entry_t</li></ul></li><li><p>å›è°ƒå‡½æ•°è§¦å‘ï¼š </p><ul><li>å¯¹äº epoll æ·»åŠ çš„ç­‰å¾…é¡¹ï¼Œå…¶ wait_queue_entry_t çš„å›è°ƒå‡½æ•°æ˜¯ ep_poll_callbackã€‚</li><li>å†…æ ¸è°ƒç”¨è¿™ä¸ªå›è°ƒå‡½æ•°ï¼Œä¼ å…¥ wait_queue_entry_t æŒ‡é’ˆä½œä¸ºå‚æ•°ã€‚</li></ul></li><li><p>æ‰¾åˆ° eppoll_entryï¼š </p><ul><li>åœ¨ ep_poll_callback å‡½æ•°ä¸­ï¼Œä½¿ç”¨ container_of å®ã€‚</li><li>é€šè¿‡ wait_queue_entry_t æŒ‡é’ˆï¼Œæ‰¾åˆ°åŒ…å«å®ƒçš„ eppoll_entry ç»“æ„ã€‚</li></ul> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eppoll_entry</span> *<span class="title">pwq</span> =</span> container_of(wait, <span class="keyword">struct</span> eppoll_entry, wait);</span><br></pre></td></tr></table></figure></li><li><p>ä» eppoll_entry åˆ° epitemï¼š </p><ul><li>eppoll_entry ç»“æ„ä¸­æœ‰ä¸€ä¸ª base æŒ‡é’ˆï¼Œç›´æ¥æŒ‡å‘å…³è”çš„ epitemã€‚</li></ul> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">epitem</span> *<span class="title">epi</span> =</span> pwq-&gt;base;</span><br></pre></td></tr></table></figure></li><li><p>è·å– eventpoll ç»“æ„ï¼š </p><ul><li>epitem ç»“æ„ä¸­åŒ…å«æŒ‡å‘å…¶å…³è”çš„ eventpoll ç»“æ„çš„æŒ‡é’ˆã€‚</li></ul> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">eventpoll</span> *<span class="title">ep</span> =</span> epi-&gt;ep;</span><br></pre></td></tr></table></figure></li><li><p>å°† epitem åŠ å…¥æ´»è·ƒé˜Ÿåˆ—ï¼š </p><ul><li>æ£€æŸ¥ epitem æ˜¯å¦å·²ç»åœ¨æ´»è·ƒé˜Ÿåˆ—ä¸­ã€‚</li><li>å¦‚æœä¸åœ¨ï¼Œåˆ™å°†å…¶æ·»åŠ åˆ° eventpoll çš„æ´»è·ƒé˜Ÿåˆ—ï¼ˆrdllistï¼‰ä¸­ã€‚</li></ul> <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (!ep_is_linked(&amp;epi-&gt;rdllink))</span><br><span class="line">    list_add_tail(&amp;epi-&gt;rdllink, &amp;ep-&gt;rdllist);</span><br></pre></td></tr></table></figure></li><li><p>å”¤é†’ç­‰å¾…çš„è¿›ç¨‹ï¼š </p><ul><li>å¦‚æœæœ‰è¿›ç¨‹æ­£åœ¨ç­‰å¾… epoll äº‹ä»¶ï¼ˆé€šè¿‡ epoll_waitï¼‰ï¼Œå”¤é†’å®ƒã€‚</li></ul></li></ol>]]></content>
    
    
    <summary type="html">&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/455352339&quot;&gt;èŠèŠNettyé‚£äº›äº‹å„¿ä¹‹ä»å†…æ ¸è§’åº¦çœ‹IOæ¨¡å‹&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;Socket-æ•°æ®æ¥æ”¶åˆ°-Epoll-å¤„ç†æµç¨‹&quot;&gt;&lt;a href=&quot;#Socket-æ•°æ®æ¥æ”¶åˆ°-Epoll-å¤„ç†æµç¨‹&quot; class=&quot;headerlink&quot; title=&quot;Socket æ•°æ®æ¥æ”¶åˆ° Epoll å¤„ç†æµç¨‹&quot;&gt;&lt;/a&gt;Socket æ•°æ®æ¥æ”¶åˆ° Epoll å¤„ç†æµç¨‹&lt;/h3&gt;&lt;pre&gt;
&lt;code class=&quot;mermaid&quot;&gt;

sequenceDiagram
    participant S as Socket
    participant WQ as Wait Queue
    participant CB as Callback (ep_poll_callback)
    participant EP as eppoll_entry
    participant EI as epitem
    participant EPL as eventpoll

    S-&amp;gt;&amp;gt;S: æ¥æ”¶æ•°æ®
    S-&amp;gt;&amp;gt;WQ: è§¦å‘ç­‰å¾…é˜Ÿåˆ—
    WQ-&amp;gt;&amp;gt;CB: è°ƒç”¨å›è°ƒå‡½æ•°
    CB-&amp;gt;&amp;gt;EP: container_of æ‰¾åˆ° eppoll_entry
    EP-&amp;gt;&amp;gt;EI: è®¿é—® base æŒ‡é’ˆæ‰¾åˆ° epitem
    EI-&amp;gt;&amp;gt;EPL: å°† epitem åŠ å…¥æ´»è·ƒé˜Ÿåˆ—
&lt;/code&gt;
&lt;/pre&gt;</summary>
    
    
    
    <category term="ç½‘ç»œ" scheme="https://taeyang0126.github.io/categories/%E7%BD%91%E7%BB%9C/"/>
    
    
    <category term="linux" scheme="https://taeyang0126.github.io/tags/linux/"/>
    
    <category term="ç½‘ç»œ" scheme="https://taeyang0126.github.io/tags/%E7%BD%91%E7%BB%9C/"/>
    
    <category term="socket" scheme="https://taeyang0126.github.io/tags/socket/"/>
    
  </entry>
  
  <entry>
    <title>Netty Reactor å¯åŠ¨æµç¨‹-1</title>
    <link href="https://taeyang0126.github.io/2025/02/09/netty/1.netty-reactor-qi-dong-liu-cheng/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/netty/1.netty-reactor-qi-dong-liu-cheng/posts/undefined/</id>
    <published>2025-02-09T07:00:22.000Z</published>
    <updated>2025-02-10T14:16:05.825Z</updated>
    
    <content type="html"><![CDATA[<h2 id="ç›¸å…³é“¾æ¥"><a href="#ç›¸å…³é“¾æ¥" class="headerlink" title="ç›¸å…³é“¾æ¥"></a>ç›¸å…³é“¾æ¥</h2><p><a href="https://zhuanlan.zhihu.com/p/459313682">è¯¦ç»†å›¾è§£Netty Reactorå¯åŠ¨å…¨æµç¨‹ | ä¸‡å­—é•¿æ–‡ | å¤šå›¾é¢„è­¦</a></p><p><img data-src="/images/netty_01_01.png" alt="netty"></p><h2 id="Netty-æœåŠ¡ç«¯çš„å¯åŠ¨æµç¨‹"><a href="#Netty-æœåŠ¡ç«¯çš„å¯åŠ¨æµç¨‹" class="headerlink" title="Netty æœåŠ¡ç«¯çš„å¯åŠ¨æµç¨‹"></a>Netty æœåŠ¡ç«¯çš„å¯åŠ¨æµç¨‹</h2><ul><li>åˆ›å»ºæœåŠ¡ç«¯<code>NioServerSocketChannel</code>å¹¶åˆå§‹åŒ–</li><li>å°†æœåŠ¡ç«¯<code>NioServerSocketChannel</code>æ³¨å†Œåˆ°<code>ä¸»Reactorçº¿ç¨‹ç»„</code>ä¸­</li><li>æ³¨å†ŒæˆåŠŸåï¼Œå¼€å§‹åˆå§‹åŒ–<code>NioServerSocketChannel</code>ä¸­çš„ pipelineï¼Œç„¶ååœ¨ pipeline ä¸­è§¦å‘ channelRegister äº‹ä»¶ã€‚</li><li>éšåç”±<code>NioServerSocketChannel</code>ç»‘å®šç«¯å£åœ°å€ã€‚</li><li>ç»‘å®šç«¯å£åœ°å€æˆåŠŸåï¼Œå‘<code>NioServerSocketChannel</code>å¯¹åº”çš„<code>Pipeline</code>ä¸­è§¦å‘ä¼ æ’­<code>ChannelActiveäº‹ä»¶</code>ï¼Œåœ¨<code>ChannelActiveäº‹ä»¶å›è°ƒ</code>ä¸­å‘<code>Main Reactor</code>æ³¨å†Œ<code>OP_ACCEPTäº‹ä»¶</code>ï¼Œå¼€å§‹ç­‰å¾…å®¢æˆ·ç«¯è¿æ¥ã€‚æœåŠ¡ç«¯å¯åŠ¨å®Œæˆã€‚</li></ul><p><img data-src="/images/netty_01_02.png" alt="netty"></p><h2 id="1-initAndRegister"><a href="#1-initAndRegister" class="headerlink" title="1. initAndRegister"></a>1. initAndRegister</h2><p><img data-src="/images/netty_01_03.png" alt="netty"></p><p>å¼€å§‹æ³¨å†Œ</p><p><img data-src="/images/netty_01_04.png" alt="netty"></p><h2 id="2-Bind"><a href="#2-Bind" class="headerlink" title="2. Bind"></a>2. Bind</h2><p><code>bindäº‹ä»¶</code>åœ¨ Netty ä¸­è¢«å®šä¹‰ä¸º<code>outboundäº‹ä»¶</code>ï¼Œæ‰€ä»¥å®ƒåœ¨<code>pipeline</code>ä¸­æ˜¯åå‘ä¼ æ’­ã€‚å…ˆä»<code>TailContext</code>å¼€å§‹åå‘ä¼ æ’­ç›´åˆ°<code>HeadContext</code>ï¼›<code>bind</code>çš„æ ¸å¿ƒé€»è¾‘ä¹Ÿæ­£æ˜¯å®ç°åœ¨<code>HeadContext</code>ä¸­</p><blockquote><p>headContext ä¸­çš„ç»‘å®šæ–¹æ³•</p></blockquote><p><img data-src="/images/netty_01_05.png" alt="netty"></p><blockquote><p>NioServerSocketChannel ä¸­çš„ç»‘å®šåŠ¨ä½œ</p></blockquote><p><img data-src="/images/netty_01_06.png" alt="netty"></p><blockquote><p>ç»‘å®šå®Œæˆåè§¦å‘ active æ“ä½œ â€“&gt; HeadContext</p></blockquote><p><img data-src="/images/netty_01_07.png" alt="netty"></p><blockquote><p>io.netty.channel.AbstractChannel.AbstractUnsafe#beginRead</p></blockquote><p><img data-src="/images/netty_01_08.png" alt="netty"></p><blockquote><p>io.netty.channel.nio.AbstractNioChannel#doBeginRead</p></blockquote><p><img data-src="/images/netty_01_09.png" alt="netty"></p><h2 id="ç»†èŠ‚ç‚¹"><a href="#ç»†èŠ‚ç‚¹" class="headerlink" title="ç»†èŠ‚ç‚¹"></a>ç»†èŠ‚ç‚¹</h2><h3 id="Reactorçº¿ç¨‹çš„å¯åŠ¨æ˜¯åœ¨å‘Reactoræäº¤ç¬¬ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„æ—¶å€™å¯åŠ¨çš„"><a href="#Reactorçº¿ç¨‹çš„å¯åŠ¨æ˜¯åœ¨å‘Reactoræäº¤ç¬¬ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„æ—¶å€™å¯åŠ¨çš„" class="headerlink" title="Reactorçº¿ç¨‹çš„å¯åŠ¨æ˜¯åœ¨å‘Reactoræäº¤ç¬¬ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„æ—¶å€™å¯åŠ¨çš„"></a><code>Reactorçº¿ç¨‹</code>çš„å¯åŠ¨æ˜¯åœ¨å‘<code>Reactor</code>æäº¤ç¬¬ä¸€ä¸ªå¼‚æ­¥ä»»åŠ¡çš„æ—¶å€™å¯åŠ¨çš„</h3><blockquote><p>io.netty.util.concurrent.SingleThreadEventExecutor#execute(java.lang.Runnable, boolean)</p></blockquote><p><img data-src="/images/netty_01_10.png" alt="netty"></p><h3 id="Reactorçº¿ç¨‹çš„æ ¸å¿ƒå·¥ä½œ-è½®è¯¢æ‰€æœ‰æ³¨å†Œå…¶ä¸Šçš„Channelä¸­çš„IOå°±ç»ªäº‹ä»¶ï¼Œå¤„ç†å¯¹åº”Channelä¸Šçš„IOäº‹ä»¶ï¼Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡"><a href="#Reactorçº¿ç¨‹çš„æ ¸å¿ƒå·¥ä½œ-è½®è¯¢æ‰€æœ‰æ³¨å†Œå…¶ä¸Šçš„Channelä¸­çš„IOå°±ç»ªäº‹ä»¶ï¼Œå¤„ç†å¯¹åº”Channelä¸Šçš„IOäº‹ä»¶ï¼Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡" class="headerlink" title="Reactorçº¿ç¨‹çš„æ ¸å¿ƒå·¥ä½œ è½®è¯¢æ‰€æœ‰æ³¨å†Œå…¶ä¸Šçš„Channelä¸­çš„IOå°±ç»ªäº‹ä»¶ï¼Œå¤„ç†å¯¹åº”Channelä¸Šçš„IOäº‹ä»¶ï¼Œæ‰§è¡Œå¼‚æ­¥ä»»åŠ¡"></a><code>Reactor</code>çº¿ç¨‹çš„æ ¸å¿ƒå·¥ä½œ <code>è½®è¯¢æ‰€æœ‰æ³¨å†Œå…¶ä¸Šçš„Channelä¸­çš„IOå°±ç»ªäº‹ä»¶</code>ï¼Œ<code>å¤„ç†å¯¹åº”Channelä¸Šçš„IOäº‹ä»¶</code>ï¼Œ<code>æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡</code></h3><blockquote><p>io.netty.channel.nio.NioEventLoop#run</p></blockquote><p><img data-src="/images/netty_01_11.png" alt="netty"></p><h3 id="Channel-çš„å„ç§äº‹ä»¶è§¦å‘é¡ºåº"><a href="#Channel-çš„å„ç§äº‹ä»¶è§¦å‘é¡ºåº" class="headerlink" title="Channel çš„å„ç§äº‹ä»¶è§¦å‘é¡ºåº"></a>Channel çš„å„ç§äº‹ä»¶è§¦å‘é¡ºåº</h3><ol><li><p>handlerAdded</p><p> socket å‘ jdk selector æ³¨å†Œåã€åœ¨é€šçŸ¥æ³¨å†Œçš„ promise å®Œæˆä¹‹å‰ï¼ˆä¹Ÿå°±æ˜¯ promise å›è°ƒä¹‹å‰ï¼‰è§¦å‘</p><p> <img data-src="/images/netty_01_12.png" alt="netty"></p></li><li><p>channelRegistered</p><p> åœ¨é€šçŸ¥ promise å®Œæˆåï¼ˆä¹Ÿå°±æ˜¯å›è°ƒæ‰§è¡Œå®Œæˆä¹‹åï¼‰ä¼šä¼ æ’­ Registered äº‹ä»¶</p><p> <img data-src="/images/netty_01_13.png" alt="netty"></p></li><li><p>Active </p><p>a. æœåŠ¡ç«¯ NioServerSocketChannel åˆ¤æ–­æ˜¯å¦æ¿€æ´»çš„æ ‡å‡†ä¸ºç«¯å£æ˜¯å¦ç»‘å®šæˆåŠŸã€‚</p><p>b. </p>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NioServerSocketChannel</span> <span class="keyword">extends</span> <span class="title class_">AbstractNioMessageChannel</span></span><br><span class="line">                             <span class="keyword">implements</span> <span class="title class_">io</span>.netty.channel.socket.ServerSocketChannel &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isActive</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> isOpen() &amp;&amp; javaChannel().socket().isBound();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>c. å®¢æˆ·ç«¯<code>NioSocketChannel</code>åˆ¤æ–­æ˜¯å¦æ¿€æ´»çš„æ ‡å‡†ä¸ºæ˜¯å¦å¤„äº<code>ConnectedçŠ¶æ€</code>ã€‚</p><p>d. </p>   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isActive</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">SocketChannel</span> <span class="variable">ch</span> <span class="operator">=</span> javaChannel();</span><br><span class="line">    <span class="keyword">return</span> ch.isOpen() &amp;&amp; ch.isConnected();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p> e. å‘åä¼ æ’­ active äº‹ä»¶<br> f. <code>readIfIsAutoRead</code></p><blockquote><p>å¦‚æœå¼€å¯äº†è‡ªåŠ¨è¯»ï¼ˆio.netty.channel.ChannelConfig#isAutoReadï¼‰ï¼Œåˆ™æ³¨å†Œå¯¹åº”æ„Ÿå…´è¶£çš„äº‹ä»¶</p></blockquote><ul><li>server è¿æ¥æ³¨å†Œ OP_ACCEPT äº‹ä»¶</li><li>client è¿æ¥æ³¨å†Œ OP_READ äº‹ä»¶</li></ul></li></ol><h3 id="å‘åº•å±‚-selector-æ³¨å†Œ"><a href="#å‘åº•å±‚-selector-æ³¨å†Œ" class="headerlink" title="å‘åº•å±‚ selector æ³¨å†Œ"></a>å‘åº•å±‚ selector æ³¨å†Œ</h3><blockquote><p>io.netty.channel.nio.AbstractNioChannel#doRegister</p></blockquote><p><img data-src="/images/netty_01_14.png" alt="netty"></p><h3 id="NioServerSocketChannel-æ³¨å†ŒæˆåŠŸåå›è°ƒä»»åŠ¡è¿›è¡Œç«¯å£ç»‘å®šï¼Œä¼šå°†ç«¯å£ç»‘å®šå°è£…ä¸ºä¸€ä¸ªä»»åŠ¡æäº¤åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œä¸æ˜¯å³åˆ»æ‰§è¡Œ"><a href="#NioServerSocketChannel-æ³¨å†ŒæˆåŠŸåå›è°ƒä»»åŠ¡è¿›è¡Œç«¯å£ç»‘å®šï¼Œä¼šå°†ç«¯å£ç»‘å®šå°è£…ä¸ºä¸€ä¸ªä»»åŠ¡æäº¤åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œä¸æ˜¯å³åˆ»æ‰§è¡Œ" class="headerlink" title="NioServerSocketChannel æ³¨å†ŒæˆåŠŸåå›è°ƒä»»åŠ¡è¿›è¡Œç«¯å£ç»‘å®šï¼Œä¼šå°†ç«¯å£ç»‘å®šå°è£…ä¸ºä¸€ä¸ªä»»åŠ¡æäº¤åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œä¸æ˜¯å³åˆ»æ‰§è¡Œ"></a>NioServerSocketChannel æ³¨å†ŒæˆåŠŸåå›è°ƒä»»åŠ¡è¿›è¡Œç«¯å£ç»‘å®šï¼Œä¼šå°†ç«¯å£ç»‘å®šå°è£…ä¸ºä¸€ä¸ªä»»åŠ¡æäº¤åˆ°é˜Ÿåˆ—ä¸­ï¼Œè€Œä¸æ˜¯å³åˆ»æ‰§è¡Œ</h3><p><img data-src="/images/netty_01_15.png" alt="netty"></p><h3 id="äº‹ä»¶åœ¨pipelineä¸­çš„ä¼ æ’­"><a href="#äº‹ä»¶åœ¨pipelineä¸­çš„ä¼ æ’­" class="headerlink" title="äº‹ä»¶åœ¨pipelineä¸­çš„ä¼ æ’­"></a>äº‹ä»¶åœ¨<code>pipeline</code>ä¸­çš„ä¼ æ’­</h3><ul><li><code>inboundäº‹ä»¶</code>ä»<code>HeadContext</code>å¼€å§‹é€ä¸ªå‘åä¼ æ’­ç›´åˆ°<code>TailContext</code></li><li><code>outboundäº‹ä»¶</code>åˆ™æ˜¯åå‘ä¼ æ’­ï¼Œä»<code>TailContext</code>å¼€å§‹åå‘å‘å‰ä¼ æ’­ç›´åˆ°<code>HeadContext</code></li></ul><p><img data-src="/images/netty_01_16.png" alt="netty"></p><h3 id="æœåŠ¡ç«¯-Socket-å’Œå®¢æˆ·ç«¯-Socket-åˆ†åˆ«åœ¨ä½•æ—¶å‘-seletor-æ³¨å†Œæ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Ÿ"><a href="#æœåŠ¡ç«¯-Socket-å’Œå®¢æˆ·ç«¯-Socket-åˆ†åˆ«åœ¨ä½•æ—¶å‘-seletor-æ³¨å†Œæ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Ÿ" class="headerlink" title="æœåŠ¡ç«¯ Socket å’Œå®¢æˆ·ç«¯ Socket åˆ†åˆ«åœ¨ä½•æ—¶å‘ seletor æ³¨å†Œæ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Ÿ"></a>æœåŠ¡ç«¯ Socket å’Œå®¢æˆ·ç«¯ Socket åˆ†åˆ«åœ¨ä½•æ—¶å‘ seletor æ³¨å†Œæ„Ÿå…´è¶£çš„äº‹ä»¶ï¼Ÿ</h3><ul><li>æ³¨å†Œæ„Ÿå…´è¶£çš„äº‹ä»¶è§¦å‘æ—¶æœºéƒ½æ˜¯<code>ChannelActive</code><ul><li><img data-src="/images/netty_01_17.png" alt="netty"></li><li>å¯¹äºæœåŠ¡ç«¯ socket æ¥è¯´ï¼Œbind æˆåŠŸåä¼šä¼ é€’ <code>channelActive</code>äº‹ä»¶</li><li>io.netty.channel.AbstractChannel.AbstractUnsafe#bind</li><li><img data-src="/images/netty_01_18.png" alt="netty"></li><li>å¯¹äºå®¢æˆ·ç«¯ socket æ¥è¯´ï¼Œregister æˆåŠŸåä¼šä¼ é€’ <code>channelActive</code>äº‹ä»¶</li><li>io.netty.channel.AbstractChannel.AbstractUnsafe#register0</li><li><img data-src="/images/netty_01_19.png" alt="netty"></li></ul></li><li>é€šè¿‡ <code>HeadContext#read</code> æ–¹æ³•è¿›è¡Œæ„Ÿå…´è¶£äº‹ä»¶çš„æ³¨å†Œ</li></ul><blockquote><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">io.netty.channel.AbstractChannel.AbstractUnsafe#beginRead</span><br></pre></td></tr></table></figure></blockquote><p><img data-src="/images/netty_01_20.png" alt="netty"></p><blockquote><p>io.netty.channel.nio.AbstractNioChannel#doBeginRead</p></blockquote><p><img data-src="/images/netty_01_21.png" alt="netty"></p>]]></content>
    
    
    <summary type="html">&lt;h2 id=&quot;ç›¸å…³é“¾æ¥&quot;&gt;&lt;a href=&quot;#ç›¸å…³é“¾æ¥&quot; class=&quot;headerlink&quot; title=&quot;ç›¸å…³é“¾æ¥&quot;&gt;&lt;/a&gt;ç›¸å…³é“¾æ¥&lt;/h2&gt;&lt;p&gt;&lt;a href=&quot;https://zhuanlan.zhihu.com/p/459313682&quot;&gt;è¯¦ç»†å›¾è§£Netty Reactorå¯åŠ¨å…¨æµç¨‹ | ä¸‡å­—é•¿æ–‡ | å¤šå›¾é¢„è­¦&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;img data-src=&quot;/images/netty_01_01.png&quot; alt=&quot;netty&quot;&gt;&lt;/p&gt;</summary>
    
    
    
    <category term="Netty" scheme="https://taeyang0126.github.io/categories/Netty/"/>
    
    
    <category term="Netty" scheme="https://taeyang0126.github.io/tags/Netty/"/>
    
    <category term="æºç è§£æ" scheme="https://taeyang0126.github.io/tags/%E6%BA%90%E7%A0%81%E8%A7%A3%E6%9E%90/"/>
    
  </entry>
  
  <entry>
    <title>Arthas</title>
    <link href="https://taeyang0126.github.io/2025/02/09/arthas/arthas/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/arthas/arthas/posts/undefined/</id>
    <published>2025-02-09T06:51:22.000Z</published>
    <updated>2025-02-10T14:16:05.824Z</updated>
    
    <content type="html"><![CDATA[<ul><li><p><a href="https://github.com/alibaba/arthas/issues/71">Arthasçš„ä¸€äº›ç‰¹æ®Šç”¨æ³•æ–‡æ¡£è¯´æ˜ Â· Issue #71 Â· alibaba&#x2F;arthas</a></p></li><li><p><a href="https://github.com/alibaba/arthas/issues/1424">arthas è·å–springè¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡ Â· Issue #1424 Â· alibaba&#x2F;arthas</a></p></li><li><p><a href="https://github.com/alibaba/arthas/issues/537">Arthaså®è·µâ€“jad&#x2F;mc&#x2F;redefineçº¿ä¸Šçƒ­æ›´æ–°ä¸€æ¡é¾™ Â· Issue #537 Â· alibaba&#x2F;arthas</a></p></li></ul><h3 id="1-è·å–å½“å‰HttpServletRequest"><a href="#1-è·å–å½“å‰HttpServletRequest" class="headerlink" title="1. è·å–å½“å‰HttpServletRequest"></a>1. è·å–å½“å‰HttpServletRequest</h3><ul><li><p>æ‰§è¡ŒæŸä¸ªrequestæ–¹æ³•</p><p>  <code>@org.springframework.web.context.request.RequestContextHolder@currentRequestAttributes().getRequest().xxx</code></p></li><li><p>è·å–å…¨éƒ¨çš„è¯·æ±‚å¤´</p><p>  <code>@org.springframework.web.context.request.RequestContextHolder@currentRequestAttributes().getRequest().getHeaderNames()</code></p></li></ul><h3 id="2-è·å–spring-context-å¹¶æ‰§è¡ŒæŸäº›æ“ä½œ"><a href="#2-è·å–spring-context-å¹¶æ‰§è¡ŒæŸäº›æ“ä½œ" class="headerlink" title="2. è·å–spring context å¹¶æ‰§è¡ŒæŸäº›æ“ä½œ"></a>2. è·å–spring context å¹¶æ‰§è¡ŒæŸäº›æ“ä½œ</h3><blockquote><p><strong>å‰ç½®</strong> ä½¿ç”¨ttè®°å½•è¯·æ±‚ï¼Œè·å–åˆ°ä¸Šä¸‹æ–‡</p><p>tt -t org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter invokeHandlerMethod -n 3</p></blockquote><pre><code>tt -i 1000 -w &#39;target.getApplicationContext().getBean(&quot;jdbcTemplate&quot;)&#39;tt -i 1000 -w &#39;target.getApplicationContext().getBean(&quot;jdbcTemplate&quot;).dataSource.ConnectionPool&#39;tt -i 1000 -w &#39;target.getApplicationContext().getBean(&quot;jdbcTemplate&quot;).getTargetSource().target&#39;tt -i 1000 -w &#39;target.getApplicationContext().getBean(&quot;jdbcTemplate&quot;).getTargetSource().target.cacheMap&#39;tt -i 1000  -w &#39;target.getApplicationContext().getEnvironment().getProperty(&quot;spring.datasource.riskctrl.url&quot;)&#39;</code></pre><h3 id="3-ä½¿ç”¨ognl"><a href="#3-ä½¿ç”¨ognl" class="headerlink" title="3. ä½¿ç”¨ognl"></a>3. ä½¿ç”¨<a href="https://commons.apache.org/dormant/commons-ognl/language-guide.html">ognl</a></h3><ul><li><p>å¯¹å‰ç½®è¡¨è¾¾å¼å€¼è¿›è¡ŒäºŒæ¬¡è®¡ç®—  #this è¡¨ç¤ºå‰ç½®è¡¨è¾¾å¼çš„å€¼ <strong><code>.()</code></strong> è¡¨ç¤ºè‡ªè¡¨è¾¾å¼ï¼Œäº§ç”Ÿä¸€ä¸ªå•ä¸€å€¼</p><p>  <strong><code>listeners.size().(#this &gt; 100? 2\*#this : 20+#this)</code></strong></p></li><li><p>å¯¹å‰ç½®è¡¨è¾¾å¼è¿›è¡ŒäºŒæ¬¡è®¡ç®—ï¼Œäº§ç”Ÿä¸€ä¸ªæ•°ç»„</p><p>  <strong><code>params[0].&#123;#this == &quot;lei&quot; ?  &quot;yes&quot; : &quot;no&quot;&#125;</code></strong></p></li><li><p>å¯¹å‰ç½®è¡¨è¾¾å¼(æ•°ç»„ç±»å‹)è¿›è¡ŒäºŒæ¬¡è®¡ç®—ï¼Œäº§ç”Ÿä¸€ä¸ªæ–°çš„æ•°ç»„</p><p>  <strong><code>params.&#123;#this instanceof String ?  &quot;yes&quot; : &quot;no&quot;&#125;</code></strong></p></li><li><p>è¿”å›æ•°ç»„ä¸­ç¬¬ä¸€ä¸ªåŒ¹é…çš„å¯¹è±¡</p><p>  <strong><code>params.&#123;^#this instanceof Integer&#125;</code></strong></p></li><li><p>è°ƒç”¨staticæ–¹æ³• ä½¿ç”¨  <strong>@class@method(<strong><strong>args</strong></strong>)</strong></p><p>  <strong><code>@org.springframework.web.context.request.RequestContextHolder@currentRequestAttributes()</code></strong></p></li><li><p>è·å–é™æ€å­—æ®µ <strong>@class@field</strong></p></li></ul><h3 id="4-ä¸€äº›å¸¸ç”¨å‘½ä»¤"><a href="#4-ä¸€äº›å¸¸ç”¨å‘½ä»¤" class="headerlink" title="4. ä¸€äº›å¸¸ç”¨å‘½ä»¤"></a>4. ä¸€äº›å¸¸ç”¨å‘½ä»¤</h3><ul><li><p>è·å–classloader hashï¼Œå¦‚æœæ˜¯springBooté¡¹ç›®å– org.springframework.boot.loader.LaunchedURLClassLoader</p><p>  <strong><code>classloader -t</code></strong></p></li><li><p>å®¹å™¨å®‰è£… vim</p><p>  <strong><code>apt-get update &amp;&amp; apt-get install -y vim</code></strong></p></li><li><p>Ognl è·å–spring context</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 49c2faae è¡¨ç¤ºclassloader hash</span><br><span class="line"># cn.hutool.extra.spring.SpringUtil è¡¨ç¤ºèƒ½è·å–åˆ°springå®¹å™¨çš„æ–¹æ³•</span><br><span class="line">ognl -c 49c2faae &#x27;#beanName=&quot;eventDataAuthManage&quot;, #bean=@cn.hutool.extra.spring.SpringUtil@getBean(#beanName), @org.springframework.aop.support.AopUtils@getTargetClass(#bean).getName()&#x27;</span><br></pre></td></tr></table></figure></li><li><p>Ognl lambda è¡¨è¾¾å¼</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">-- ä½¿ç”¨ =:[] å®šä¹‰lambdaå³å‡½æ•°</span><br><span class="line">-- ä½¿ç”¨ #getBean() è°ƒç”¨</span><br><span class="line">ognl -c 49c2faae &#x27;</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">getBean =:[@cn.hutool.extra.spring.SpringUtil@getBean(#this)],</span></span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">getBean(<span class="string">&quot;syncDataAuthController&quot;</span>).dataCodeList<span class="string">&#x27;</span></span></span><br></pre></td></tr></table></figure></li><li><p>æŸ¥æ‰¾æ–¹æ³•</p><p>  <strong><code>sm com.xx.class</code></strong></p></li><li><p>ä¿®æ”¹é™æ€å˜é‡çš„å€¼</p><p>  <strong><code>getstatic com.xyz.HelloWorld s &quot;#s=&#39;abc&#39;&quot;</code></strong></p></li><li><p>ä¿®æ”¹å˜é‡çš„å€¼</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-- 1. ä½¿ç”¨ tt è®°å½•æ–¹æ³•è°ƒç”¨</span><br><span class="line">tt -t com.example.UserService getUserById</span><br><span class="line">-- 2. æŸ¥çœ‹è®°å½•</span><br><span class="line">tt -l</span><br><span class="line">-- 3. ä¿®æ”¹æ•è·çš„å¯¹è±¡ target ä»£è¡¨å½“å‰è¢«è°ƒç”¨æ–¹æ³•çš„å¯¹è±¡å®ä¾‹ï¼ˆå³ &quot;this&quot; å¯¹è±¡ï¼‰</span><br><span class="line">tt -i 1000 -w &#x27;target.name=&quot;newName&quot;&#x27;</span><br></pre></td></tr></table></figure></li><li><p>è¿‡æ»¤å‚æ•°ç±»å‹ä¸ºclassçš„æ–¹æ³•</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-- è¿‡æ»¤è¦ç‚¹å°±æ˜¯é€šè¿‡å…¨ç±»å@classæ‹¿åˆ°classå¯¹è±¡ï¼Œå†getName()è·å–åç§°</span><br><span class="line">watch com.wangji92.arthas.plugin.demo.controller.StaticTest invokeClass &#x27;&#123;returnObj,throwExp&#125;&#x27;  -n 5  -x 3  </span><br><span class="line">&#x27;params[0].getName().equals(@com.wangji92.arthas.plug.demo.controller.User@class.getName())&#x27; -v</span><br></pre></td></tr></table></figure></li><li><p>æŸ¥æ‰¾response404çš„å †æ ˆ</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">stack -E javax.servlet.http.HttpServletResponse sendError|setStatus params[0]==404</span><br></pre></td></tr></table></figure></li></ul><h3 id="5-ç‰¹æ®Šå‘½ä»¤"><a href="#5-ç‰¹æ®Šå‘½ä»¤" class="headerlink" title="5. ç‰¹æ®Šå‘½ä»¤"></a>5. ç‰¹æ®Šå‘½ä»¤</h3><ul><li><p>Trace å‘½ä»¤å¤šä¸ªç±»ã€å¤šä¸ªæ–¹æ³•ã€æŒ‡å®šçº¿ç¨‹ã€æŒ‡å®šè€—æ—¶æ—¶é—´</p>  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># trace -E è¡¨ç¤ºæ­£åˆ™</span><br><span class="line">trace -E </span><br><span class="line"># è¡¨ç¤ºç±»æ˜¯ NioEventLoop æˆ–è€… SingleThreadEventExecutor</span><br><span class="line">&#x27;io\.netty\.channel\.nio\.NioEventLoop|io\.netty\.util\.concurrent\.SingleThreadEventExecutor&#x27;  </span><br><span class="line"># è¡¨ç¤ºæ–¹æ³•æ˜¯ select processSelectedKeys runAllTasks</span><br><span class="line">&#x27;select|processSelectedKeys|runAllTasks&#x27; </span><br><span class="line"># @Thread arthasæä¾›è¡¨ç¤ºå½“å‰çº¿ç¨‹ #cost arthasæä¾›ï¼Œè¡¨ç¤ºè€—æ—¶</span><br><span class="line">&#x27;@Thread@currentThread().getName().contains(&quot;IO-HTTP-WORKER-IOPool&quot;)&amp;&amp;#cost&gt;500&#x27;</span><br></pre></td></tr></table></figure></li><li><p>è·å–ä»£ç†å¯¹è±¡çš„åŸå§‹å¯¹è±¡</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tt -w &#x27;#isProxy=:[ @org.springframework.aop.support.AopUtils@isAopProxy(#this)?1: #this instanceof java.lang.reflect.Proxy ? 0 :-1],#isJdkDynamicProxy =:[@org.springframework.aop.support.AopUtils@isJdkDynamicProxy(#this) ? true :false ],#cglibTarget =:[#hField =#this.getClass().getDeclaredField(&quot;CGLIB$CALLBACK_0&quot;),#hField.setAccessible(true),#dynamicAdvisedInterceptor=#hField.get(#this),#fieldAdvised=#dynamicAdvisedInterceptor.getClass().getDeclaredField(&quot;advised&quot;),#fieldAdvised.setAccessible(true),1==1? #fieldAdvised.get(#dynamicAdvisedInterceptor).getTargetSource().getTarget():null],#jdkTarget=:[ #hField=#this.getClass().getSuperclass().getDeclaredField(&quot;h&quot;),#hField.setAccessible(true),#aopProxy=#hField.get(#this),#advisedField=#aopProxy.getClass().getDeclaredField(&quot;advised&quot;),#advisedField.setAccessible(true),1==1?#advisedField.get(#aopProxy).getTargetSource().getTarget():null],#nonProxyResultFunc = :[#proxyResul=#isProxy(#this),#proxyResul== -1 ?#this :#proxyResul== 0? @java.lang.reflect.Proxy@getInvocationHandler(#this):#isJdkDynamicProxy(#this)? #isJdkDynamicProxy(#this) : #cglibTarget(#this)],#nonProxyTarget=#nonProxyResultFunc(target),#nonProxyTarget&#x27;  -x 1 -i 1002</span><br></pre></td></tr></table></figure></li></ul><h3 id="6-Vmtool-ä½¿ç”¨"><a href="#6-Vmtool-ä½¿ç”¨" class="headerlink" title="6. Vmtool ä½¿ç”¨"></a>6. Vmtool ä½¿ç”¨</h3><blockquote><p><code>vmtool</code> åˆ©ç”¨ Java çš„ Instrumentation API å’Œ JVM TIï¼ˆJVM Tool Interfaceï¼‰ä¸ JVM è¿›è¡Œäº¤äº’ï¼Œå¯ä»¥ç»•è¿‡spring context ç›´æ¥è·å–å¯¹è±¡</p></blockquote><ul><li><p>å¸¸ç”¨å­å‘½ä»¤</p><ul><li><code>--action getInstances</code>ï¼šè·å–ç±»çš„å®ä¾‹</li><li><code>--action forceGc</code>ï¼šå¼ºåˆ¶æ‰§è¡Œåƒåœ¾å›æ”¶</li><li><code>--action getClassLoader</code>ï¼šè·å–ç±»åŠ è½½å™¨ä¿¡æ¯</li></ul></li><li><p>com.xxx.cache.CacheAspect ä¸­çš„ boolean å˜é‡ cacheEnabled ä¿®æ”¹ä¸ºfalse</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vmtool: Arthas çš„ä¸€ä¸ªå‘½ä»¤ï¼Œç”¨äºå¯¹ JVM è¿›è¡Œåº•å±‚æ“ä½œã€‚</span><br><span class="line">-x 3: è®¾ç½®æ‰§è¡Œæ¬¡æ•°é™åˆ¶ä¸º 3 æ¬¡ã€‚</span><br><span class="line">--action getInstances: æŒ‡å®šæ“ä½œä¸ºè·å–ç±»çš„å®ä¾‹ã€‚</span><br><span class="line">--className com.xxx.cache.CacheAspect: æŒ‡å®šè¦æ“ä½œçš„ç±»åã€‚</span><br><span class="line">--express: åé¢è·Ÿç€çš„æ˜¯è¦æ‰§è¡Œçš„ OGNL è¡¨è¾¾å¼</span><br><span class="line">onglè¡¨è¾¾å¼:</span><br><span class="line">åå°„è·å–å­—æ®µ #field=instances[0].getClass().getDeclaredField(&quot;cacheEnabled&quot;)</span><br><span class="line">è®¾ç½®ä¸ºtrue #field.setAccessible(true)</span><br><span class="line">ä¿®æ”¹å­—æ®µ #field.set(instances[0],false)</span><br><span class="line"></span><br><span class="line">vmtool -x 3 --action getInstances --className com.xxx.cache.CacheAspect --express &#x27;#field=instances[0].getClass().getDeclaredField(&quot;cacheEnabled&quot;),#field.setAccessible(true),#field.set(instances[0],false)&#x27; -c 3bd94634</span><br></pre></td></tr></table></figure></li><li><p>ä¿®æ”¹finalå˜é‡</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool -x 4 --action getInstances --className com.wangji92.arthas.plugin.demo.controller.CommonController  --express &#x27;#field=instances[0].getClass().getDeclaredField(&quot;FINAL_VALUE&quot;),#modifiers=#field.getClass().getDeclaredField(&quot;modifiers&quot;),#modifiers.setAccessible(true),#modifiers.setInt(#field,#field.getModifiers() &amp; ~@java.lang.reflect.Modifier@FINAL),#field.setAccessible(true),#field.set(instances[0],&quot; 3333&quot;)&#x27; -c  18b4aac2</span><br></pre></td></tr></table></figure></li><li><p>æ‰§è¡ŒæŸä¸ªæ–¹æ³•</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vmtool -x 1 --action getInstances </span><br><span class="line">--className com.xx.SyncDataAuthController </span><br><span class="line">--express &#x27;instances[0].getDataCodePage(@com.xx.UtilJson@convertValue(&quot;&#123;\&quot;pageIndex\&quot;:0,\&quot;pageSize\&quot;:0&#125;&quot;, @com.xx.BaseQuery@class))&#x27;</span><br><span class="line">-c 49c2faae</span><br></pre></td></tr></table></figure></li><li><p>è·å–spring context</p>  <figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vmtool --action getInstances --className org.springframework.context.ConfigurableApplicationContext --express &#x27;instances[0].getEnvironment().getProperty(&quot;server.port&quot;)&#x27;</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    
    <summary type="html">&lt;ul&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/alibaba/arthas/issues/71&quot;&gt;Arthasçš„ä¸€äº›ç‰¹æ®Šç”¨æ³•æ–‡æ¡£è¯´æ˜ Â· Issue #71 Â· alibaba&amp;#x2F;arthas&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/alibaba/arthas/issues/1424&quot;&gt;arthas è·å–springè¢«ä»£ç†çš„ç›®æ ‡å¯¹è±¡ Â· Issue #1424 Â· alibaba&amp;#x2F;arthas&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;&lt;a href=&quot;https://github.com/alibaba/arthas/issues/537&quot;&gt;Arthaså®è·µâ€“jad&amp;#x2F;mc&amp;#x2F;redefineçº¿ä¸Šçƒ­æ›´æ–°ä¸€æ¡é¾™ Â· Issue #537 Â· alibaba&amp;#x2F;arthas&lt;/a&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;1-è·å–å½“å‰HttpServletRequest&quot;&gt;&lt;a href=&quot;#1-è·å–å½“å‰HttpServletRequest&quot; class=&quot;headerlink&quot; title=&quot;1. è·å–å½“å‰HttpServletRequest&quot;&gt;&lt;/a&gt;1. è·å–å½“å‰HttpServletRequest&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æ‰§è¡ŒæŸä¸ªrequestæ–¹æ³•&lt;/p&gt;
&lt;p&gt;  &lt;code&gt;@org.springframework.web.context.request.RequestContextHolder@currentRequestAttributes().getRequest().xxx&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;&lt;p&gt;è·å–å…¨éƒ¨çš„è¯·æ±‚å¤´&lt;/p&gt;
&lt;p&gt;  &lt;code&gt;@org.springframework.web.context.request.RequestContextHolder@currentRequestAttributes().getRequest().getHeaderNames()&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="Arthas" scheme="https://taeyang0126.github.io/categories/Arthas/"/>
    
    
    <category term="Arthas" scheme="https://taeyang0126.github.io/tags/Arthas/"/>
    
    <category term="é—®é¢˜æ’æŸ¥" scheme="https://taeyang0126.github.io/tags/%E9%97%AE%E9%A2%98%E6%8E%92%E6%9F%A5/"/>
    
  </entry>
  
  <entry>
    <title>å¤šçº¿ç¨‹å¼‚å¸¸å¤„ç†</title>
    <link href="https://taeyang0126.github.io/2025/02/09/java/duo-xian-cheng-yi-chang-chu-li/posts/undefined/"/>
    <id>https://taeyang0126.github.io/2025/02/09/java/duo-xian-cheng-yi-chang-chu-li/posts/undefined/</id>
    <published>2025-02-09T06:43:22.000Z</published>
    <updated>2025-02-10T14:16:05.824Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p> å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œå¦‚æœæ²¡æœ‰æ˜¾ç¤ºçš„æ•è·å¼‚å¸¸å¹¶å¤„ç†ï¼Œé‚£ä¹ˆå¼‚å¸¸ä¼šè¾“å‡ºåˆ° System.err ä¸­ï¼Œå¯¼è‡´å¼‚å¸¸ä¿¡æ¯ä¸¢å¤±</p></blockquote><h3 id="å¼‚å¸¸è¢«åå™¬çš„ä¾‹å­"><a href="#å¼‚å¸¸è¢«åå™¬çš„ä¾‹å­" class="headerlink" title="å¼‚å¸¸è¢«åå™¬çš„ä¾‹å­"></a>å¼‚å¸¸è¢«åå™¬çš„ä¾‹å­</h3><ul><li>æ–°èµ·çº¿ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸</li></ul><blockquote><p>ç”±äºæ˜¯æ–°å¯åŠ¨çš„çº¿ç¨‹ï¼Œæ­¤å¼‚å¸¸å¹¶ä¸ä¼šæŠ›åˆ°çˆ¶çº¿ç¨‹æˆ–è€…è°ƒç”¨æ–¹ä¸Šï¼Œå¯¼è‡´å¼‚å¸¸è¢«æ²¡äº†- - </p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;è¿™æ˜¯ä¸€ä¸ªå¼‚å¸¸!&quot;</span>);</span><br><span class="line">&#125;).start();</span><br></pre></td></tr></table></figure><ul><li>çº¿ç¨‹æ± ä¸­æŠ›å‡ºçš„å¼‚å¸¸</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Executors.newFixedThreadPool(<span class="number">1</span>)</span><br><span class="line">        .execute(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;çº¿ç¨‹æ± ä¸­çš„å¼‚å¸¸!&quot;</span>);</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure><h3 id="è§£å†³æ–¹æ¡ˆ"><a href="#è§£å†³æ–¹æ¡ˆ" class="headerlink" title="è§£å†³æ–¹æ¡ˆ"></a>è§£å†³æ–¹æ¡ˆ</h3><blockquote><p>é’ˆå¯¹ä¸Šé¢å‡ºç°çš„å¼‚å¸¸åå™¬çš„ä¾‹å­ï¼Œæœ‰ä»¥ä¸‹è§£å†³æ–¹æ¡ˆ</p></blockquote><ul><li><p>Try catch æ˜¾ç¤ºå¤„ç†å¼‚å¸¸</p></li><li><p>æŒ‡å®š<code> Thread.UncaughtExceptionHandler</code></p><ul><li><p>çº¿ç¨‹å¤„ç†</p></li><li><p>thread.setUncaughtExceptionHandler</p></li><li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Thread.<span class="type">UncaughtExceptionHandler</span> <span class="variable">uncaughtExceptionHandler</span> <span class="operator">=</span> (t, e) -&gt; log.error(<span class="string">&quot;[catch error]thread -&gt; &#123;&#125;, e -&gt; &#123;&#125;&quot;</span>, t, e);</span><br><span class="line"><span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;[catch]è¿™æ˜¯ä¸€ä¸ªå¼‚å¸¸!&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line">thread.setUncaughtExceptionHandler(uncaughtExceptionHandler);</span><br><span class="line">thread.start();</span><br></pre></td></tr></table></figure></li><li><p>çº¿ç¨‹æ± å¤„ç†</p></li><li><p>new ThreadFactoryBuilder().setUncaughtExceptionHandler  çº¿ç¨‹å·¥å‚ä¸­è®¾ç½®</p></li><li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Thread.<span class="type">UncaughtExceptionHandler</span> <span class="variable">uncaughtExceptionHandler</span> <span class="operator">=</span> (t, e) -&gt; log.error(<span class="string">&quot;[catch error]thread -&gt; &#123;&#125;, e -&gt; &#123;&#125;&quot;</span>, t, e);</span><br><span class="line"><span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;[catch]è¿™æ˜¯ä¸€ä¸ªå¼‚å¸¸!&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="type">ThreadPoolExecutor</span> <span class="variable">threadPoolExecutor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(<span class="number">1</span>, <span class="number">1</span>, <span class="number">0</span>, TimeUnit.SECONDS</span><br><span class="line">        , <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">1000</span>)</span><br><span class="line">        , <span class="keyword">new</span> <span class="title class_">ThreadFactoryBuilder</span>().setUncaughtExceptionHandler(uncaughtExceptionHandler).build());</span><br><span class="line">threadPoolExecutor.execute(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;[catch]çº¿ç¨‹æ± ä¸­çš„å¼‚å¸¸!&quot;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></li></ul></li></ul><p>Hold onâ€¦..æœ‰äººçš„åœ°æ–¹å°±ä¸å­˜åœ¨ä¿¡ä»»è¿™ä¸€è¯´- -</p><h3 id="å…œåº•æ–¹æ¡ˆ"><a href="#å…œåº•æ–¹æ¡ˆ" class="headerlink" title="å…œåº•æ–¹æ¡ˆ"></a>å…œåº•æ–¹æ¡ˆ</h3><blockquote><p>ä¸Šé¢çš„è§£å†³æ–¹æ¡ˆæ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯ä½†æ˜¯ä½†æ˜¯ï¼ŒæŸäº›å¼€å‘è€…å¯èƒ½æ²¡æœ‰è¿™ä¸ªæ„è¯†æˆ–è€…å¿˜è®°äº†ï¼Œå¯¼è‡´å¼‚å¸¸è¿˜æ˜¯è¢«åå™¬äº†</p></blockquote><p>æ—¢ç„¶æœªæ•è·çš„å¼‚å¸¸æœ€ç»ˆä¼šè¾“å‡ºåˆ° <code>System.err</code> é‚£ä¹ˆé‡æ–°è®¾ç½®ç³»ç»Ÿçš„ err å¤„ç†ï¼ŒæŠŠä¿¡æ¯è¾“å‡ºåˆ°æ—¥å¿—ç³»ç»Ÿä¸­ã€‚ä¸‹é¢è¿™ä¸ªæ˜¯å…œåº•æ–¹æ¡ˆï¼Œä¼šå­˜åœ¨éƒ¨åˆ†çš„ä¸åˆç†ï¼Œä½†æ˜¯ä¸ºäº†ä¸ä¸¢å¼‚å¸¸ä¿¡æ¯è¿˜æ˜¯å¯ä»¥å®¹å¿çš„ï¼Œæ—¥å¸¸å¼€å‘ä¸­å‘ç°æ­¤ç±»å¼‚å¸¸ï¼Œéœ€è¦å®šä½åˆ°å¯¹åº”çš„ä¸šåŠ¡ä»£ç ï¼Œç”¨ä¸Šé¢æä¾›çš„è§£å†³æ–¹æ¡ˆå®Œå–„ä»£ç ï¼›æ¯•ç«Ÿè¿™åªæ˜¯ä¸€ä¸ªå…œåº•çš„æ–¹æ¡ˆï¼Œè€Œä¸æ˜¯å¸¸è§„æ–¹æ¡ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Stderr</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Logger</span> <span class="variable">logErr</span> <span class="operator">=</span> LoggerFactory.getLogger(<span class="string">&quot;[UnCatchError]&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">PrintStream</span> <span class="variable">STDERR</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PrintStream</span>(System.err) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">println</span><span class="params">(String x)</span> &#123;</span><br><span class="line">            logErr.error(x);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">println</span><span class="params">(Object x)</span> &#123;</span><br><span class="line">            logErr.error(<span class="string">&quot;&quot;</span> + x);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(<span class="type">boolean</span> b)</span> &#123;</span><br><span class="line">            logErr.error(<span class="string">&quot;&quot;</span> + b);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(<span class="type">char</span> c)</span> &#123;</span><br><span class="line">            logErr.error(<span class="string">&quot;&quot;</span> + c);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(<span class="type">int</span> i)</span> &#123;</span><br><span class="line">            logErr.error(<span class="string">&quot;&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(<span class="type">long</span> l)</span> &#123;</span><br><span class="line">            logErr.error(<span class="string">&quot;&quot;</span> + l);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(<span class="type">float</span> f)</span> &#123;</span><br><span class="line">            logErr.error(<span class="string">&quot;&quot;</span> + f);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(<span class="type">double</span> d)</span> &#123;</span><br><span class="line">            logErr.error(<span class="string">&quot;&quot;</span> + d);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">print</span><span class="params">(String s)</span> &#123;</span><br><span class="line">            logErr.error(s);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.setErr(STDERR);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    
    <summary type="html">&lt;blockquote&gt;
&lt;p&gt; å¤šçº¿ç¨‹åœºæ™¯ä¸‹ï¼Œå¦‚æœæ²¡æœ‰æ˜¾ç¤ºçš„æ•è·å¼‚å¸¸å¹¶å¤„ç†ï¼Œé‚£ä¹ˆå¼‚å¸¸ä¼šè¾“å‡ºåˆ° System.err ä¸­ï¼Œå¯¼è‡´å¼‚å¸¸ä¿¡æ¯ä¸¢å¤±&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;å¼‚å¸¸è¢«åå™¬çš„ä¾‹å­&quot;&gt;&lt;a href=&quot;#å¼‚å¸¸è¢«åå™¬çš„ä¾‹å­&quot; class=&quot;headerlink&quot; title=&quot;å¼‚å¸¸è¢«åå™¬çš„ä¾‹å­&quot;&gt;&lt;/a&gt;å¼‚å¸¸è¢«åå™¬çš„ä¾‹å­&lt;/h3&gt;&lt;ul&gt;
&lt;li&gt;æ–°èµ·çº¿ç¨‹ä¸­æŠ›å‡ºå¼‚å¸¸&lt;/li&gt;
&lt;/ul&gt;</summary>
    
    
    
    <category term="JAVA" scheme="https://taeyang0126.github.io/categories/JAVA/"/>
    
    
    <category term="JAVA" scheme="https://taeyang0126.github.io/tags/JAVA/"/>
    
    <category term="å¤šçº¿ç¨‹" scheme="https://taeyang0126.github.io/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
</feed>
